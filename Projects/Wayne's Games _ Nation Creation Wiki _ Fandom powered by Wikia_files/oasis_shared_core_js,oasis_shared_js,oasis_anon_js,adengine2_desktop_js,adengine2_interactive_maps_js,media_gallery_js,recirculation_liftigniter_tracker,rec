(function(){my={};my.Class=function(){var len=arguments.length;var body=arguments[len-1];var SuperClass=len>1?arguments[0]:null;var hasImplementClasses=len>2;var Class,SuperClassEmpty;if(body.constructor===Object){Class=function(){};}else{Class=body.constructor;delete body.constructor;}
if(SuperClass){SuperClassEmpty=function(){};SuperClassEmpty.prototype=SuperClass.prototype;Class.prototype=new SuperClassEmpty();Class.prototype.constructor=Class;Class.Super=SuperClass;extend(Class,SuperClass,false);}
if(hasImplementClasses)
for(var i=1;i<len-1;i++)
extend(Class.prototype,arguments[i].prototype,false);extendClass(Class,body);return Class;};var extendClass=my.extendClass=function(Class,extension,override){if(extension.STATIC){extend(Class,extension.STATIC,override);delete extension.STATIC;}
extend(Class.prototype,extension,override)};var extend=function(obj,extension,override){var prop;if(override===false){for(prop in extension)
if(!(prop in obj))
obj[prop]=extension[prop];}else{for(prop in extension)
obj[prop]=extension[prop];if(extension.toString!==Object.prototype.toString)
obj.toString=extension.toString;}};})();;(function(context){'use strict';var sloth=function(){var slice=Array.prototype.slice,wTop,wBottom,undef,debounce=(function(element){return element?parseInt(element.getAttribute('data-sloth-debounce'),10):200;})(context.document.querySelector('script[data-sloth-debounce]')),delegate=context.setTimeout,branches=[],Branch=function(element,threshold,callback){this.elem=element;this.threshold=threshold;this.callback=function(){callback(element);};},addEvent=function(){context.addEventListener('scroll',execute);},removeEvent=function(){context.removeEventListener('scroll',execute);},lock=0,execute=function(force){var i=branches.length,branch;if(debounce){removeEvent();}
if(i&&(force||!lock)){if(debounce){lock=delegate(function(){lock=0;addEvent();},debounce);}
wTop=context.scrollY||context.pageYOffset;wBottom=wTop+context.innerHeight;while(i--){branch=branches[i];if(branch.isVisible()){delegate(branch.callback,0);branches.splice(i,1);}}}};Branch.prototype.isVisible=function(){var elem=this.elem,mayBeVisible=elem.offsetHeight||elem.offsetWidth,height,threshold,top,bottom;if(mayBeVisible){threshold=this.threshold;height=elem.offsetHeight;top=(elem.offsetTop||elem.y||0)-threshold;bottom=top+height+threshold;return wBottom>=top&&wTop<=bottom;}
return false;};Branch.prototype.compare=function(element){return this.elem===element;};return function(params){if(params){var elements=params.on,prune=params.off,threshold=params.threshold!==undef?params.threshold:100,callback=params.callback,i;if(elements&&callback){if(elements.length!==undef){elements=slice.call(elements);i=elements.length;while(i--){branches.push(new Branch(elements[i],threshold,callback));}}else{branches.push(new Branch(elements,threshold,callback));}}
if(prune){if(prune.length!==undef){prune=slice.call(prune);i=prune.length;while(i--){branches=branches.filter(function(branch){return!branch.compare(prune[i]);});}}else{branches=branches.filter(function(branch){return!branch.compare(prune);});}}}
execute(true);};};if(context.define&&context.define.amd){context.define('sloth',sloth);}else{context.sloth=sloth();}})(this);;var Mustache=(typeof module!=="undefined"&&module.exports)||{};(function(exports){exports.name="mustache.js";exports.version="0.5.0-dev";exports.tags=["{{","}}"];exports.parse=parse;exports.compile=compile;exports.render=render;exports.clearCache=clearCache;exports.to_html=function(template,view,partials,send){var result=render(template,view,partials);if(typeof send==="function"){send(result);}else{return result;}};var _toString=Object.prototype.toString;var _isArray=Array.isArray;var _forEach=Array.prototype.forEach;var _trim=String.prototype.trim;var isArray;if(_isArray){isArray=_isArray;}else{isArray=function(obj){return _toString.call(obj)==="[object Array]";};}
var forEach;if(_forEach){forEach=function(obj,callback,scope){return _forEach.call(obj,callback,scope);};}else{forEach=function(obj,callback,scope){for(var i=0,len=obj.length;i<len;++i){callback.call(scope,obj[i],i,obj);}};}
var spaceRe=/^\s*$/;function isWhitespace(string){return spaceRe.test(string);}
var trim;if(_trim){trim=function(string){return string==null?"":_trim.call(string);};}else{var trimLeft,trimRight;if(isWhitespace("\xA0")){trimLeft=/^\s+/;trimRight=/\s+$/;}else{trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}
trim=function(string){return string==null?"":String(string).replace(trimLeft,"").replace(trimRight,"");};}
var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;'};function escapeHTML(string){return String(string).replace(/&(?!\w+;)|[<>"']/g,function(s){return escapeMap[s]||s;});}
function debug(e,template,line,file){file=file||"<template>";var lines=template.split("\n"),start=Math.max(line-3,0),end=Math.min(lines.length,line+3),context=lines.slice(start,end);var c;for(var i=0,len=context.length;i<len;++i){c=i+start+1;context[i]=(c===line?" >> ":"    ")+context[i];}
e.template=template;e.line=line;e.file=file;e.message=[file+":"+line,context.join("\n"),"",e.message].join("\n");return e;}
function lookup(name,stack,defaultValue){if(name==="."){return stack[stack.length-1];}
var names=name.split(".");var lastIndex=names.length-1;var target=names[lastIndex];var value,context,i=stack.length,j,localStack;while(i){localStack=stack.slice(0);context=stack[--i];j=0;while(j<lastIndex){context=context[names[j++]];if(context==null){break;}
localStack.push(context);}
if(context&&typeof context==="object"&&target in context){value=context[target];break;}}
if(typeof value==="function"){value=value.call(localStack[localStack.length-1]);}
if(value==null){return defaultValue;}
return value;}
function renderSection(name,stack,callback,inverted){var buffer="";var value=lookup(name,stack);if(inverted){if(value==null||value===false||(isArray(value)&&value.length===0)){buffer+=callback();}}else if(isArray(value)){forEach(value,function(value){stack.push(value);buffer+=callback();stack.pop();});}else if(typeof value==="object"){stack.push(value);buffer+=callback();stack.pop();}else if(typeof value==="function"){var scope=stack[stack.length-1];var scopedRender=function(template){return render(template,scope);};buffer+=value.call(scope,callback(),scopedRender)||"";}else if(value){buffer+=callback();}
return buffer;}
function parse(template,options){options=options||{};var tags=options.tags||exports.tags,openTag=tags[0],closeTag=tags[tags.length-1];var code=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var spaces=[],hasTag=false,nonSpace=false;var stripSpace=function(){if(hasTag&&!nonSpace&&!options.space){while(spaces.length){code.splice(spaces.pop(),1);}}else{spaces=[];}
hasTag=false;nonSpace=false;};var sectionStack=[],updateLine,nextOpenTag,nextCloseTag;var setTags=function(source){tags=trim(source).split(/\s+/);nextOpenTag=tags[0];nextCloseTag=tags[tags.length-1];};var includePartial=function(source){code.push('";',updateLine,'\nvar partial = partials["'+trim(source)+'"];','\nif (partial) {','\n  buffer += render(partial,stack[stack.length - 1],partials);','\n}','\nbuffer += "');};var openSection=function(source,inverted){var name=trim(source);if(name===""){throw debug(new Error("Section name may not be empty"),template,line,options.file);}
sectionStack.push({name:name,inverted:inverted});code.push('";',updateLine,'\nvar name = "'+name+'";','\nvar callback = (function () {','\n  return function () {','\n    var buffer = "";','\nbuffer += "');};var openInvertedSection=function(source){openSection(source,true);};var closeSection=function(source){var name=trim(source);var openName=sectionStack.length!=0&&sectionStack[sectionStack.length-1].name;if(!openName||name!=openName){throw debug(new Error('Section named "'+name+'" was never opened'),template,line,options.file);}
var section=sectionStack.pop();code.push('";','\n    return buffer;','\n  };','\n})();');if(section.inverted){code.push("\nbuffer += renderSection(name,stack,callback,true);");}else{code.push("\nbuffer += renderSection(name,stack,callback);");}
code.push('\nbuffer += "');};var sendPlain=function(source){code.push('";',updateLine,'\nbuffer += lookup("'+trim(source)+'",stack,"");','\nbuffer += "');};var sendEscaped=function(source){code.push('";',updateLine,'\nbuffer += escapeHTML(lookup("'+trim(source)+'",stack,""));','\nbuffer += "');};var line=1,c,callback;for(var i=0,len=template.length;i<len;++i){if(template.slice(i,i+openTag.length)===openTag){i+=openTag.length;c=template.substr(i,1);updateLine='\nline = '+line+';';nextOpenTag=openTag;nextCloseTag=closeTag;hasTag=true;switch(c){case"!":i++;callback=null;break;case"=":i++;closeTag="="+closeTag;callback=setTags;break;case">":i++;callback=includePartial;break;case"#":i++;callback=openSection;break;case"^":i++;callback=openInvertedSection;break;case"/":i++;callback=closeSection;break;case"{":closeTag="}"+closeTag;case"&":i++;nonSpace=true;callback=sendPlain;break;default:nonSpace=true;callback=sendEscaped;}
var end=template.indexOf(closeTag,i);if(end===-1){throw debug(new Error('Tag "'+openTag+'" was not closed properly'),template,line,options.file);}
var source=template.substring(i,end);if(callback){callback(source);}
var n=0;while(~(n=source.indexOf("\n",n))){line++;n++;}
i=end+closeTag.length-1;openTag=nextOpenTag;closeTag=nextCloseTag;}else{c=template.substr(i,1);switch(c){case'"':case"\\":nonSpace=true;code.push("\\"+c);break;case"\r":break;case"\n":spaces.push(code.length);code.push("\\n");stripSpace();line++;break;default:if(isWhitespace(c)){spaces.push(code.length);}else{nonSpace=true;}
code.push(c);}}}
if(sectionStack.length!=0){throw debug(new Error('Section "'+sectionStack[sectionStack.length-1].name+'" was not closed properly'),template,line,options.file);}
stripSpace();code.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var body=code.join("").replace(/buffer \+= "";\n/g,"");if(options.debug){if(typeof console!="undefined"&&console.log){console.log(body);}else if(typeof print==="function"){print(body);}}
return body;}
function _compile(template,options){var args="view,partials,stack,lookup,escapeHTML,renderSection,render";var body=parse(template,options);var fn=new Function(args,body);return function(view,partials){partials=partials||{};var stack=[view];try{return fn(view,partials,stack,lookup,escapeHTML,renderSection,render);}catch(e){throw debug(e.error,template,e.line,options.file);}};}
var _cache={};function clearCache(){_cache={};}
function compile(template,options){options=options||{};if(options.cache!==false){if(!_cache[template]){_cache[template]=_compile(template,options);}
return _cache[template];}
return _compile(template,options);}
function render(template,view,partials){return compile(template)(view,partials);}})(Mustache);(function(context){context.Mustache=Mustache;if(context.define&&context.define.amd){context.define('wikia.mustache',Mustache);}}(window));;define('wikia.browserDetect',['wikia.window'],function(win){'use strict';var appName=win.navigator.appName,userAgent=win.navigator.userAgent,browser=null,operatingSystem=null;function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);}
function isIE(){var bool=false;if(appName==='Microsoft Internet Explorer'||(appName==='Netscape'&&userAgent.indexOf('Trident/')!==-1)){bool=true;}
return bool;}
function isEdge(){return userAgent.indexOf('Edge')!==-1;}
function isFirefox(){return userAgent.toLowerCase().indexOf('firefox')>-1;}
function isIPad(){var bool=false;if(userAgent.match(/iPad/i)!==null){bool=true;}
return bool;}
function isIOS7orLower(){return!!userAgent.match(/iPad.+OS.[6,7].\d.+like.Mac.OS.+Safari/i);}
function isAndroid(){return userAgent.toLowerCase().indexOf('android')>-1;}
function getOS(){if(null!==operatingSystem){return operatingSystem;}
operatingSystem='unknown';if(userAgent.indexOf('Win')!==-1){operatingSystem='Windows';}
if(userAgent.indexOf('Mac')!==-1){operatingSystem='OSX';}
if(userAgent.indexOf('Linux')!==-1){operatingSystem='Linux';}
if(userAgent.indexOf('Android')!==-1){operatingSystem='Android';}
if(userAgent.indexOf('like Mac')!==-1){operatingSystem='iOS';}
return operatingSystem;}
function getBrowser(){if(null!==browser){return browser;}
var appVersion=win.navigator.appVersion,temp,matches=userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(matches[1])){temp=/\brv[ :]+(\d+)/g.exec(userAgent)||[];browser='IE '+(temp[1]||'');return browser;}
if(matches[1]==='Chrome'){temp=userAgent.match(/\b(OPR|Edge)\/(\d+)/);if(temp!==null){browser=temp.slice(1).join(' ').replace('OPR','Opera');return browser;}}
matches=matches[2]?[matches[1],matches[2]]:[appName,appVersion,'-?'];temp=userAgent.match(/version\/(\d+)/i);if(temp!==null){matches.splice(1,1,temp[1]);}
browser=matches.join(' ');return browser;}
function getBrowserVersion(){var browserStringParts=getBrowser().split(' ');return parseInt(browserStringParts[1],10);}
return{getBrowser:getBrowser,getBrowserVersion:getBrowserVersion,getOS:getOS,isIE:isIE,isFirefox:isFirefox,isIPad:isIPad,isIOS7orLower:isIOS7orLower,isAndroid:isAndroid,isMobile:isMobile,isEdge:isEdge};});;(function(mw,$){function cat(pre,val,post,raw){if(val===undefined||val===null||val===''){return'';}
return pre+(raw?val:mw.Uri.encode(val))+post;}
var parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/(?:(?:([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?([^:\/?#]*)(?::(\d*))?)?((?:[^?#\/]*\/)*[^?#]*)(?:\?([^#]*))?(?:#(.*))?/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?(?:(?:([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?([^:\/?#]*)(?::(\d*))?((?:\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?[^?#\/]*)(?:\?([^#]*))?(?:#(.*))?/},properties=['protocol','user','password','host','port','path','query','fragment'];mw.UriRelative=function(documentLocation){var defaultUri;function Uri(uri,options){options=typeof options==='object'?options:{strictMode:!!options};options=$.extend({strictMode:false,overrideKeys:false},options);if(uri!==undefined&&uri!==null&&uri!==''){if(typeof uri==='string'){this.parse(uri,options);}else if(typeof uri==='object'){for(var prop in uri){if(uri.hasOwnProperty(prop)){if($.isArray(uri[prop])||$.isPlainObject(uri[prop])){this[prop]=$.extend(true,{},uri[prop]);}else{this[prop]=uri[prop];}}}
if(!this.query){this.query={};}}}else{return defaultUri.clone();}
if(!this.protocol){this.protocol=defaultUri.protocol;}
if(!this.host){this.host=defaultUri.host;if(!this.port){this.port=defaultUri.port;}}
if(this.path&&this.path.charAt(0)!=='/'){throw new Error('Bad constructor arguments');}
if(!(this.protocol&&this.host&&this.path)){throw new Error('Bad constructor arguments');}}
Uri.encode=function(s){return encodeURIComponent(s).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/%20/g,'+');};Uri.decode=function(s){return decodeURIComponent(s.replace(/\+/g,'%20'));};Uri.prototype={parse:function(str,options){var q,uri=this,matches=parser[options.strictMode?'strict':'loose'].exec(str);$.each(properties,function(i,property){uri[property]=matches[i+1];});q={};if(uri.query){uri.query.replace(/(?:^|&)([^&=]*)(?:(=)([^&]*))?/g,function($0,$1,$2,$3){var k,v;if($1){k=Uri.decode($1);v=($2===''||$2===undefined)?null:Uri.decode($3);if(options.overrideKeys||q[k]===undefined){q[k]=v;}else{if(typeof q[k]==='string'){q[k]=[q[k]];}
if($.isArray(q[k])){q[k].push(v);}}}});}
this.query=q;},getUserInfo:function(){return cat('',this.user,cat(':',this.password,''));},getHostPort:function(){return this.host+cat(':',this.port,'');},getAuthority:function(){return cat('',this.getUserInfo(),'@')+this.getHostPort();},getQueryString:function(){var args=[];$.each(this.query,function(key,val){var k=Uri.encode(key),vals=$.isArray(val)?val:[val];$.each(vals,function(i,v){if(v===null){args.push(k);}else if(k==='title'){args.push(k+'='+mw.util.wikiUrlencode(v));}else{args.push(k+'='+Uri.encode(v));}});});return args.join('&');},getRelativePath:function(){return this.path+cat('?',this.getQueryString(),'',true)+cat('#',this.fragment,'');},toString:function(){return this.protocol+'://'+this.getAuthority()+this.getRelativePath();},clone:function(){return new Uri(this);},extend:function(parameters){$.extend(this.query,parameters);return this;}};defaultUri=new Uri(documentLocation);return Uri;};if(document&&document.location&&document.location.href){mw.Uri=mw.UriRelative(document.location.href);}}(mediaWiki,jQuery));;(function(window,$,mustache){'use strict';var defaultTimeout=10000,types={'notify':'blue','confirm':'green','error':'red','warn':'yellow'},classes=Object.keys(types).join(' '),closeImageSource=window.stylepath+'/oasis/images/icon_close.png',$pageContainer,$header,modal,template='<div class="banner-notification">'+'<button class="close wikia-chiclet-button"><img></button>'+'<div class="msg">{{{content}}}</div>'+'</div>';function BannerNotification(content,type,$parent,timeout){if(content instanceof jQuery&&content.hasClass('banner-notification')){this.content=content.find('.msg').html();this.$element=content;this.$parent=content.parent();this.hidden=false;}else{this.content=content;this.$element=null;this.$parent=$parent;this.hidden=true;this.type=type;this.timeout=timeout;}
this.onCloseHandler=Function.prototype;}
BannerNotification.prototype.show=function(){if(!this.hidden){return this;}
if(!this.$element){this.$element=createMarkup(this.content,this.type);}
this.setType(this.type);setUpClose(this);if(isModalShown()&&typeof this.timeout!=='number'){this.timeout=defaultTimeout;}
addToDOM(this.$element,this.$parent);this.hidden=false;handleScrolling();if(typeof this.timeout==='number'){setTimeout(function(){this.hide();}.bind(this),this.timeout);}
return this;};BannerNotification.prototype.hide=function(){if(!this.hidden){fadeOut(this.$element,removeFromDOM);this.$element=null;this.hidden=true;}
return this;};BannerNotification.prototype.setType=function(type){if(type!==this.type&&types.hasOwnProperty(type)){this.type=type;if(this.$element){this.$element.removeClass(classes).addClass(type);}}
return this;};BannerNotification.prototype.setContent=function(content){if(content&&content!==this.content){this.content=content;if(this.$element){this.$element.find('.msg').html(content);}}
return this;};BannerNotification.prototype.showConnectionError=function(){return this.setType('error').setContent(window.mw.message('bannernotifications-general-ajax-failure').escaped()).show();};BannerNotification.prototype.onClose=function(callback){if(typeof callback==='function'){this.onCloseHandler=callback;}
return this;};function init(){$header=$('#globalNavigation');if(window.skin==='monobook'){$pageContainer=$('#content');}else{$pageContainer=$('.WikiaPageContentWrapper');require(['wikia.onScroll'],function(onScroll){onScroll.bind(handleScrolling);});}
if(mw.config.get('wgVisualEditor')&&mw.config.get('wgIsArticle')){mw.hook('ve.activationComplete').add(function(){$('.banner-notification').fadeOut(400);});mw.hook('ve.cancelButton').add(function(){$('.banner-notification').fadeIn(400);});}
createBackendNotifications();}
function createBackendNotifications(){$('.banner-notification').each(function(){var backendNotification=new BannerNotification($(this));setUpClose(backendNotification);});}
function handleScrolling(){var containerTop,notificationWrapper=$pageContainer.children('.banner-notifications-wrapper'),headerBottom;if(!$pageContainer.length||!notificationWrapper.length){return;}
containerTop=$pageContainer.get(0).getBoundingClientRect().top;headerBottom=$header.length>0?$header.get(0).getBoundingClientRect().bottom:0;if(containerTop<headerBottom){if(!notificationWrapper.hasClass('float')){notificationWrapper.addClass('float');if(!notificationWrapper.prop('style').top){notificationWrapper.css('top',headerBottom);}}}else{notificationWrapper.removeClass('float');}}
function getPageContainer(){if($pageContainer.length){return $pageContainer;}else if(window.skin==='monobook'){$pageContainer=$('#content');}else{$pageContainer=$('.WikiaPageContentWrapper');}
return $pageContainer;}
function createMarkup(content,type){return $(mustache.render(template,{imageSource:closeImageSource,content:content})).addClass(type).hide();}
function addToDOM($element,$parentElement){var $parent=$parentElement||(isModalShown()?modal:getPageContainer()),$bannerNotificationsWrapper=$parent.find('.banner-notifications-wrapper');if(!$bannerNotificationsWrapper.length){$bannerNotificationsWrapper=$('<div></div>').addClass('banner-notifications-wrapper');$parent.prepend($bannerNotificationsWrapper);}
$bannerNotificationsWrapper.prepend($element);$element.fadeIn('slow');}
function setUpClose(notification){$(notification.$element).on('click','.close',function(event){notification.hide();notification.onCloseHandler(event);});}
function isModalShown(){modal=$('.modalWrapper, .yui-panel, .modal');return modal.is(':visible');}
function fadeOut($element,callback){if($element.length){$element.animate({'height':0,'padding':0,'opacity':0},400,function(){callback($element);});}}
function removeFromDOM($element){var $parent=$element.parent();if($parent.hasClass('.banner-notifications-wrapper')&&$parent.children().length===1){$parent.remove();}else{$element.remove();}}
$(init);window.BannerNotification=BannerNotification;define('BannerNotification',function(){return BannerNotification;});})(window,$,window.Mustache);;define('BannerNotifications.templates.mustache',[],function(){'use strict';return{"BannerNotifications":'<div class="banner-notification"><button class="close wikia-chiclet-button"><img></button><div class="msg">{{{content}}}</div></div>',"done":"true"};});;(function(context){'use strict';function nirvana($){var allowedFormats=['json','html','jsonp'];function getUrl(options){var dataParams=options.data||{},format=(options.format||'json').toLowerCase(),i,key,sortedDict={},sortedKeys=[],urlParams,url=options.scriptPath||context.wgServer+context.wgScriptPath;if((typeof options.controller==='undefined')||(typeof options.method==='undefined')){throw'controller and method are required';}
urlParams={controller:options.controller.replace(/Controller$/,''),method:options.method};if(typeof dataParams==='string'){dataParams+='&format='+format;}else{dataParams.format=format;}
if(typeof dataParams!=='string'){for(key in dataParams){sortedKeys[sortedKeys.length]=key;}
sortedKeys.sort();for(i=0;i<sortedKeys.length;i++){sortedDict[sortedKeys[i]]=dataParams[sortedKeys[i]];}
dataParams=$.param(sortedDict);}
return url+'/wikia.php?'+$.param(urlParams)+'&'+dataParams;}
function sendRequest(attr){var type=(attr.type||'POST').toUpperCase(),format=(attr.format||'json').toLowerCase(),data={},callback=attr.callback||function(){},onErrorCallback=attr.onErrorCallback||function(){},url;if(allowedFormats.indexOf(format)===-1){throw'Only Json,Jsonp and Html format are allowed';}
if(type==='POST'&&typeof attr.data!=='undefined'){data=attr.data;delete attr.data;}
url=getUrl(attr);var settings={url:url,dataType:format,type:type,data:data,success:callback,error:onErrorCallback};if(typeof attr.contentType!='undefined'){settings.contentType=attr.contentType;}
if(typeof attr.processData!='undefined'){settings.processData=attr.processData;}
return $.ajax(settings);}
return{sendRequest:sendRequest,getUrl:getUrl,getJson:function(controller,method,data,callback,onErrorCallback){if(typeof data==='function'){onErrorCallback=callback;callback=data;data={};}
return sendRequest({controller:controller,method:method,data:data,type:'GET',callback:callback,onErrorCallback:onErrorCallback});},postJson:function(controller,method,data,callback,onErrorCallback){if(typeof data==='function'){onErrorCallback=callback;callback=data;data={};}
return sendRequest({controller:controller,method:method,data:data,callback:callback,onErrorCallback:onErrorCallback});}};}
if(context.define&&context.define.amd){context.define('wikia.nirvana',['jquery'],nirvana);}
if(context.jQuery){context.jQuery.nirvana=nirvana(context.jQuery);}}(this));;define('wikia.ui.factory',['wikia.nirvana','wikia.window','wikia.loader','wikia.ui.component','jquery'],function uifactory(nirvana,window,loader,UIComponent,$){'use strict';function getComponentsConfig(components){var deferred=new $.Deferred(),data={components:components,cb:window.wgStyleVersion};nirvana.getJson('Wikia\\UI\\UIFactoryApi','getComponentsConfig',data,function(data){deferred.resolve(data);},function(xhrObject){deferred.reject(JSON.parse(xhrObject.responseText));});return deferred.promise();}
function getComponentInstance(){return new UIComponent();}
function arrayUnique(array){var o={},uniqueArray=[],i;for(i=0;i<array.length;i++){if(o.hasOwnProperty(array[i])){continue;}
uniqueArray.push(array[i]);o[array[i]]=1;}
return uniqueArray;}
function init(componentName){var deferred=new $.Deferred(),components=[],dependencyObjects={};if(!(componentName instanceof Array)){componentName=[componentName];}
getComponentsConfig(componentName).done(function(data){var jsAssets=[],cssAssets=[],createComponent=function(element){var component=getComponentInstance(),templateVarsConfig=element.templateVarsConfig,assets=element.assets,templates=element.templates,dependencies=element.dependencies,dependencyList={};if(typeof dependencies==='object'){dependencies.forEach(function(name){if(typeof dependencyObjects[name]!=='undefined'){dependencyList[name]=dependencyObjects[name];}else{deferred.reject();throw new Error('Sub component '+name+' not found');}});}
if(assets){jsAssets=jsAssets.concat(assets.js);cssAssets=cssAssets.concat(assets.css);}
if(templateVarsConfig&&templates){component.setComponentsConfig({name:element.name,jsWrapperModule:element.jsWrapperModule,templates:templates,templateVarsConfig:templateVarsConfig,dependencies:dependencyList});}
return component;};if(data.dependencies){Object.keys(data.dependencies).forEach(function(name){dependencyObjects[name]=createComponent(data.dependencies[name]);});}
data.components.forEach(function(element){components.push(createComponent(element));});jsAssets=arrayUnique(jsAssets);cssAssets=arrayUnique(cssAssets);loader({type:loader.CSS,resources:cssAssets});function resolveDeferred(){deferred.resolve.apply(null,components);}
if(jsAssets.length>0){loader({type:loader.JS,resources:jsAssets}).done(resolveDeferred);}else{resolveDeferred();}}).fail(function(data){if(data.error){throw new Error(data.error+': '+data.message);}
deferred.reject();});return deferred.promise();}
return{init:init};});;define('wikia.ui.component',['wikia.mustache'],function uicomponent(mustache){'use strict';function validateComponent(componentConfig,componentType,componentVars){var supportedTypes=componentConfig.templates,variables,requiredVars,missingVars=[];if(!supportedTypes.hasOwnProperty(componentType)){throw new Error('Requested component type is not supported!');}
requiredVars=componentConfig.templateVarsConfig[componentType].required;missingVars=[];requiredVars.forEach(function(element){if(!componentVars.hasOwnProperty(element)){missingVars.push(element);}});if(missingVars.length>0){variables=missingVars.join(', ');throw new Error('Missing required mustache variables: '+variables+'!');}}
function UIComponent(){if(!(this instanceof UIComponent)){return new UIComponent();}
var componentConfig={},componentType,componentVars;this.render=function(params){componentType=params.type;componentVars=params.vars;validateComponent(componentConfig,componentType,componentVars);return mustache.render(componentConfig.templates[componentType],componentVars);};this.setComponentsConfig=function(config){componentConfig=config;};this.createComponent=function(params,callback){var that=this;if(componentConfig.jsWrapperModule){require([componentConfig.jsWrapperModule],function(object){callback(object.createComponent(params,that));});}else{callback(that,params);}};this.getSubComponent=function(componentName){if(typeof componentConfig.dependencies[componentName]!=='undefined'){return componentConfig.dependencies[componentName];}
throw new Error('Dependency '+componentName+' not found.');};}
return UIComponent;});;

jQuery.fn.placeholder=function(){var a="placeholder" in document.createElement("input");return this.each(function(){if(a){return}var b=$(this);var c=b.attr("placeholder");if(b.val()==""){b.addClass("placeholder").val(c)}b.focus(function(){if(b.val()==c){b.val("")}b.removeClass("placeholder")});b.blur(function(){if(b.val()==""){b.addClass("placeholder").val(c)}});b.closest("form").submit(function(){if(b.val()==c){b.val("")}})})};$(function(){$("input[placeholder], textarea[placeholder]").placeholder()});(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(d,c){var b,a;c=c||0;for(b=c,a=this.length;b<a;b++){if(this[b]===d){return b}}return -1}}if(!Array.prototype.filter){Array.prototype.filter=function(b,e){var d,a,c=[];for(d=0,a=this.length;d<a;d++){if(b.call(e,this[d],d,this)){c[c.length]=this[d]}}return c}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=a;if(arguments.length>1){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=(1/0)&&e!=-(1/0)){e=(e>0||-1)*Math.floor(Math.abs(e))}}}var b=e>=0?Math.min(e,a-1):a-Math.abs(e);for(;b>=0;b--){if(b in d&&d[b]===c){return b}}return -1}}}());(function(f,b,g){var d=b.getElementsByTagName("head")[0],a=/loaded|complete/,e={},c=0,h;g.getCSS=function(k,j,m){if(g.isFunction(j)){m=j;j={}}var l=b.createElement("link");l.rel="stylesheet";l.type="text/css";l.media=j.media||"screen";l.href=k;if(j.charset){l.charset=j.charset}if(j.title){m=(function(n){return function(){l.title=j.title;n(l,"success")}})(m)}if(l.readyState){l.onreadystatechange=function(){if(a.test(l.readyState)){l.onreadystatechange=null;m(l,"success")}}}else{if(l.onload===null&&l.all){l.onload=function(){l.onload=null;m(l,"success")}}else{e[l.href]=function(){m(l,"success")};if(!c++){h=f.setInterval(function(){var s,p,r=b.styleSheets,n,o=r.length;while(o--){p=r[o];if((n=p.href)&&(s=e[n])){try{s.r=p.cssRules;throw"SECURITY"}catch(q){if(/SECURITY/.test(q)||/SECURITY/i.test(q.name)){s(l,"success");delete e[n];if(!--c){h=f.clearInterval(h)}}}}}},13)}}}d.appendChild(l)}})(this,this.document,this.jQuery);var jaaulde=window.jaaulde||{};jaaulde.utils=jaaulde.utils||{};jaaulde.utils.cookies=(function(){var d=[];var b={hoursToLive:null,path:"/",domain:null,secure:false};var g=function(h){var j;if(typeof h!=="object"||h===null){j=b}else{j={hoursToLive:(typeof h.hoursToLive==="number"&&h.hoursToLive!==0?h.hoursToLive:b.hoursToLive),path:(typeof h.path==="string"&&h.path!==""?h.path:b.path),domain:(typeof h.domain==="string"&&h.domain!==""?h.domain:b.domain),secure:(typeof h.secure==="boolean"&&h.secure?h.secure:b.secure)}}return j};var a=function(h){var j=new Date();j.setTime(j.getTime()+(h*60*60*1000));return j.toGMTString()};var f=function(h){h=g(h);return((typeof h.hoursToLive==="number"?"; expires="+a(h.hoursToLive):"")+"; path="+h.path+(typeof h.domain==="string"?"; domain="+h.domain:"")+(h.secure===true?"; secure":""))};var e=function(){d={};var m,j,l,h=document.cookie.split(";");for(var k=0;k<h.length;k=k+1){m=h[k].split("=");j=m[0].replace(/^\s*/,"").replace(/\s*$/,"");l=decodeURIComponent(m[1]);d[j]=l}return d};var c=function(){};c.prototype.get=function(k){var h;e();if(typeof k==="string"){h=(typeof d[k]!=="undefined")?d[k]:null}else{if(typeof k==="object"&&k!==null){h={};for(var j in k){if(typeof d[k[j]]!=="undefined"){h[k[j]]=d[k[j]]}else{h[k[j]]=null}}}else{h=d}}return h};c.prototype.filter=function(h){var j={};e();if(typeof h==="string"){h=new RegExp(h)}for(var k in d){if(k.match(h)){j[k]=d[k]}}return j};c.prototype.set=function(l,j,h){if(typeof j==="undefined"||j===null){if(typeof h!=="object"||h===null){h={}}j="";h.hoursToLive=-8760}var k=f(h);document.cookie=l+"="+encodeURIComponent(j)+k};c.prototype.del=function(l,k){var h={};if(typeof k!=="object"||k===null){k={}}if(typeof l==="boolean"&&l===true){h=this.get()}else{if(typeof l==="string"){h[l]=true}}for(var j in h){if(typeof j==="string"&&j!==""){this.set(j,null,k)}}};c.prototype.test=function(){var j=false,h="cT",k="data";this.set(h,k);if(this.get(h)===k){this.del(h);j=true}return j};c.prototype.setOptions=function(h){if(typeof h!=="object"){h=null}b=g(h)};return new c()})();(function(){if(window.jQuery){(function(b){b.cookies=jaaulde.utils.cookies;var a={cookify:function(c){return this.each(function(){var g,e=false,d=false,f="",k="",j=["name","id"],l,h;for(g in j){if(!isNaN(g)){f=b(this).attr(j[g]);if(typeof f==="string"&&f!==""){e=true;break}}}if(e){l=this.nodeName.toLowerCase();if(l!=="input"&&l!=="textarea"&&l!=="select"&&l!=="img"){k=b(this).html();d=true}else{h=b(this).attr("type");if(typeof h==="string"&&h!==""){h=h.toLowerCase()}if(h!=="radio"&&h!=="checkbox"){k=b(this).val();d=true}}if(d){if(typeof k!=="string"||k===""){k=null}b.cookies.set(f,k,c)}}})},cookieFill:function(){return this.each(function(){var e,c=false,d="",h,g=["name","id"],f=0,j;for(e in g){if(!isNaN(e)){d=b(this).attr(g[e]);if(typeof d==="string"&&d!==""){c=true;break}}}if(c){h=b.cookies.get(d);if(h!==null){j=this.nodeName.toLowerCase();if(j==="input"||j==="textarea"||j==="select"){b(this).val(h)}else{b(this).html(h)}}}f=0})},cookieBind:function(c){return this.each(function(){b(this).cookieFill().change(function(){b(this).cookify(c)})})}};b.each(a,function(c){b.fn[c]=this})})(window.jQuery)}})();(function(d){function f(g){return(new Date().getTime()-g.getTime())}function c(g){return e.inWords(f(g))}function b(){var g=a(this);if(!isNaN(g.datetime)){d(this).text(c(g.datetime))}return this}function a(g){g=d(g);if(!g.data("timeago")){g.data("timeago",{datetime:e.datetime(g)});var h=d.trim(g.text());if(h.length>0){g.attr("title",h)}}return g.data("timeago")}d.timeago=function(g){if(g instanceof Date){return c(g)}else{if(typeof g==="string"){return c(d.timeago.parse(g))}else{return c(d.timeago.datetime(g))}}};var e=d.timeago;d.extend(d.timeago,{settings:{refreshMillis:60000,allowFuture:true,strings:window.wgTimeAgoi18n||{}},inWords:function(l){var m=this.settings.strings,p=false;if(this.settings.allowFuture){if(l<0){p=true}l=Math.abs(l)}var o=l/1000;var g=o/60;var n=g/60;var q=n/24;var j=q/365;function h(s,t){var r=m[p?(s+"-from-now"):s]||"";return r.replace(/%d/i,t)}var k=(o<45&&h("seconds",Math.round(o)))||(o<90&&h("minute",1))||(g<45&&h("minutes",Math.round(g)))||(g<90&&h("hour",1))||(n<24&&h("hours",Math.round(n)))||(n<48&&h("day",1))||(q<30&&h("days",Math.floor(q)))||(q<60&&h("month",1))||(q<365&&h("months",Math.floor(q/30)))||(j<2&&h("year",1))||h("years",Math.floor(j));return k},parse:function(h){var g=d.trim(h);g=g.replace(/\.\d\d\d+/,"");g=g.replace(/-/,"/").replace(/-/,"/");g=g.replace(/T/," ").replace(/Z/," UTC");g=g.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2");return new Date(g)},datetime:function(j){var h=d(j);var k=h.get(0).tagName.toLowerCase()==="time";var g=k?h.attr("datetime"):h.attr("title");return e.parse(g)}});d.fn.timeago=function(){var h=this;h.each(b);var g=e.settings;if(g.refreshMillis>0){setInterval(function(){h.each(b)},g.refreshMillis)}return h};document.createElement("abbr");document.createElement("time")}(jQuery));(function(a){a.store=function(e,b){var d=this;this.encoders=[];this.decoders=[];if(typeof e=="string"){if(a.store.drivers[e]){this.driver=a.store.drivers[e]}else{throw new Error("Unknown driver "+e)}}else{if(typeof e=="object"){var c=!a.isFunction(e.init)||!a.isFunction(e.get)||!a.isFunction(e.set)||!a.isFunction(e.del)||!a.isFunction(e.flush);if(c){throw new Error("The specified driver does not fulfill the API requirements")}this.driver=e}else{a.each(a.store.drivers,function(){if(!a.isFunction(this.available)||!this.available()){return true}d.driver=this;if(d.driver.init()===false){d.driver=null;return true}return false})}}if(!b){b=a.store.serializers}this.serializers={};a.each(b,function(f,g){if(!a.isFunction(this.init)){return true}d.serializers[f]=this;d.serializers[f].init(d.encoders,d.decoders)})};a.extend(a.store.prototype,{get:function(b){var c=this.driver.get(b);return this.driver.encodes?c:this.unserialize(c)},set:function(b,c){this.driver.set(b,this.driver.encodes?c:this.serialize(c))},del:function(b){this.driver.del(b)},flush:function(){this.driver.flush()},driver:undefined,serialize:function(c){var b=this;a.each(this.encoders,function(){var d=b.serializers[this+""];if(!d||!d.encode){return true}try{c=d.encode(c)}catch(f){}});return c},unserialize:function(c){var b=this;if(!c){return c}a.each(this.decoders,function(){var d=b.serializers[this+""];if(!d||!d.decode){return true}c=d.decode(c)});return c}});a.store.drivers={localStorage:{ident:"$.store.drivers.localStorage",scope:"browser",available:function(){try{return !!window.localStorage}catch(b){return false}},init:a.noop,get:function(b){return window.localStorage.getItem(b)},set:function(c,d){try{window.localStorage.setItem(c,d)}catch(b){}},del:function(b){window.localStorage.removeItem(b)},flush:function(){window.localStorage.clear()}},userData:{ident:"$.store.drivers.userData",element:null,nodeName:"userdatadriver",scope:"browser",initialized:false,available:function(){try{return !!(document.documentElement&&document.documentElement.addBehavior)}catch(b){return false}},init:function(){if(this.initialized){return}try{this.element=document.createElement(this.nodeName);document.documentElement.insertBefore(this.element,document.getElementsByTagName("title")[0]);this.element.addBehavior("#default#userData");this.initialized=true}catch(b){return false}},get:function(b){this.element.load(this.nodeName);return this.element.getAttribute(b)},set:function(b,c){this.element.setAttribute(b,c);this.element.save(this.nodeName)},del:function(b){this.element.removeAttribute(b);this.element.save(this.nodeName)},flush:function(){this.element.expires=(new Date()).toUTCString();this.element.save(this.nodeName)}},windowName:{ident:"$.store.drivers.windowName",scope:"window",cache:{},encodes:true,available:function(){return true},init:function(){this.load()},save:function(){window.name=a.store.serializers.json.encode(this.cache)},load:function(){this.cache=a.store.serializers.json.decode(window.name+"")},get:function(b){return this.cache[b]},set:function(b,c){this.cache[b]=c;this.save()},del:function(b){try{delete this.cache[b]}catch(c){this.cache[b]=undefined}this.save()},flush:function(){window.name="{}"}}};a.store.serializers={json:{ident:"$.store.serializers.json",init:function(c,b){c.push("json");b.push("json")},encode:function(b){try{return JSON.stringify(b)}catch(c){return""}},decode:function(b){try{return JSON.parse(b)}catch(c){return{}}}}}})(jQuery);$.storage=new $.store();
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,k,j){var h,d=0;if(typeof f!=="boolean"){j=k;k=f;f=c}function g(){var p=this,n=+new Date()-d,o=arguments;function m(){d=+new Date();k.apply(p,o)}function l(){h=c}if(j&&!h){m()}h&&clearTimeout(h);if(j===c&&n>e){m()}else{if(f!==true){h=setTimeout(j?l:m,j===c?e-n:e)}}}if($.guid){g.guid=k.guid=k.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*
 * jQuery Floating Scrollbar - v0.5 - 09/05/2013
 * http://benalman.com/
 *
 * Copyright (c) 2011 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(d,k){var h=d(k),a=d([]),j,e,f=d('<div id="floating-scrollbar"><div/></div>'),b=f.children();function g(m){f.toggle(!!m)}function l(){if(j){f.scrollLeft(j.scrollLeft())}}function c(){e=j;j=null;a.each(function(){var t=d(this),u=t.offset().top,q=u+t.height(),s=h.scrollTop()+h.height()-d.floatingScrollbarOptions.bottom,r=30;if(u+r<s&&q>s){j=t;return false}});if(!j){g();return}var n=j.scrollLeft(),m=j.scrollLeft(90019001).scrollLeft(),p=j.innerWidth(),o=p+m;j.scrollLeft(n);if(o<=p){g();return}g(true);if(!e||e[0]!==j[0]){if(e){e.unbind("scroll",l)}j.scroll(l).after(f)}f.css({bottom:d.floatingScrollbarOptions.bottom,left:j.offset().left-h.scrollLeft(),width:p}).scrollLeft(n);b.width(o)}f.hide().css({position:"fixed",bottom:0,height:"30px",overflowX:"auto",overflowY:"hidden"}).scroll(function(){if(j){j.scrollLeft(f.scrollLeft())}});b.css({border:"1px solid #fff",opacity:0.01});d.fn.floatingScrollbar=function(m){if(m===false){a=a.not(this);this.unbind("scroll",l);if(!a.length){f.detach();h.unbind("resize scroll",c)}}else{if(this.length){if(!a.length){h.resize(c).scroll(c)}a=a.add(this)}}c();return this};d.floatingScrollbarUpdate=c;d.floatingScrollbarOptions={bottom:0}})(jQuery,this);(function(window,$){var getAssetManagerUrl=function(elements,params,requesttype){if(typeof elements==="string"){elements=[elements]}params=params||{};if(window.debug===true){params.minify=0}return wgCdnRootUrl+wgAssetsManagerQuery.replace("%1$s",requesttype).replace("%2$s",elements.join(",")).replace("%3$s",$.isEmptyObject(params)?"-":encodeURIComponent($.param(params))).replace("%4$d",wgStyleVersion)};$.getSassURL=function(rootURL,scssFilePath,params){return rootURL+wgAssetsManagerQuery.replace("%1$s","sass").replace("%2$s",scssFilePath).replace("%3$s",encodeURIComponent($.param(params||window.sassParams))).replace("%4$d",wgStyleVersion)};$.getSassCommonURL=function(scssFilePath,params){return $.getSassURL(wgCdnRootUrl,scssFilePath,params)};$.getSassLocalURL=function(scssFilePath,params){return $.getSassURL(wgServer,scssFilePath,params)};$.getAssetManagerGroupUrl=function(groups,params){return getAssetManagerUrl(groups,params,"groups")};$.getSassesURL=function(sasses,params){return getAssetManagerUrl(sasses,params,"sasses")};$.ajaxSetup({cache:true});$.getScript=function(url,callback,failureFn){return $.ajax({type:"GET",url:url,success:function(xhr){if(typeof callback==="function"){try{callback()}catch(e){eval(xhr);callback();$().log("eval() fallback applied for "+url,"getScript")}}},error:(typeof failureFn==="function"?failureFn:$.noop),dataType:"script"})};$.fn.log=function(msg,group){Wikia.log(msg,Wikia.log.levels.info,group);return this};$.fn.exists=function(){return this.length>0};$.fn.getModal=function(url,id,options){$.get(url,function(html){$("body").append(html);if(typeof options=="object"&&typeof options.callbackBefore==="function"){options.callbackBefore()}if(typeof id==="string"){$(id).makeModal(options);$().log("getModal: "+id+" modal made")}if(typeof options=="object"&&typeof options.callback==="function"){options.callback()}})};$.showModal=function(title,content,options){options=(typeof options!=="object")?{}:options;var header=$("<h1>").text(title),dialog=$("<div>"),wrapper;if(typeof options.rawHTML!=="undefined"&&options.rawHTML===true){dialog.get(0).innerHTML=content}else{dialog.html(content)}dialog.prepend(header).appendTo("body");if(typeof options.callbackBefore==="function"){options.callbackBefore()}wrapper=dialog.makeModal(options);if(typeof options.callback==="function"){options.callback(wrapper)}return wrapper};$.confirm=function(options){var dialog;options=(typeof options!=="object")?{}:options;options.id="WikiaConfirm";var html="";if(options.title){html+="<h1>"+options.title+"</h1>"}html+="<p>"+(options.content||"")+'</p><div class="neutral modalToolbar"><button id="WikiaConfirmCancel" class="wikia-button secondary">'+(options.cancelMsg||$.msg("cancel"))+'</button><button id="WikiaConfirmOk" class="wikia-button">'+(options.okMsg||$.msg("ok"))+"</button></div>";dialog=$("<div>").appendTo("body").html(html).attr("title",options.title||"");if(typeof options.callbackBefore==="function"){options.callbackBefore()}$("#WikiaConfirmOk").click(function(){$("#WikiaConfirm").closeModal();if(typeof options.onOk==="function"){options.onOk()}});$("#WikiaConfirmCancel").click(function(){$("#WikiaConfirm").closeModal();if(typeof options.onCancel==="function"){options.onCancel()}});dialog.makeModal(options);if(typeof options.callback==="function"){options.callback()}};$.showCustomModal=function(title,content,options){var buttons="",buttonNo,button,dialog,modal;options=(typeof options!=="object")?{}:options;if(options.buttons){buttons=$('<div class="neutral modalToolbar"></div>');for(buttonNo=0;buttonNo<options.buttons.length;buttonNo++){button='<a id="'+options.buttons[buttonNo].id+'" class="wikia-button'+(options.buttons[buttonNo].defaultButton?"":" secondary")+'">'+options.buttons[buttonNo].message+"</a>";$(button).bind("click",options.buttons[buttonNo].handler).appendTo(buttons)}}dialog=$("<div>").html(content).attr("title",title).append(buttons);$("body").append(dialog);if(typeof options.callbackBefore==="function"){options.callbackBefore()}modal=dialog.makeModal(options);if(typeof options.callback==="function"){options.callback(modal)}return modal};$.postJSON=function(u,d,callback){return $.post(u,d,callback,"json")};$.extend({_urlVars:null,getUrlVars:function(){if($._urlVars===null){var i,j,hash,hashes=window.location.search.slice(window.location.search.indexOf("?")+1).split("&");$._urlVars={};for(i=0,j=hashes.length;i<j;i++){hash=hashes[i].split("=");$._urlVars[hash[0]]=hash[1]}}return $._urlVars},getUrlVar:function(name){return $.getUrlVars()[name]}});$.fn.reverse=function(){return this.pushStack(this.get().reverse(),arguments)};$.fn.isChrome=function(){if($.browser.webkit&&!$.browser.opera&&!$.browser.msie&&!$.browser.mozilla){var userAgent=navigator.userAgent.toLowerCase();if(userAgent.indexOf("chrome")>-1){return true}}return false};$.fn.hasParent=function(selector){return this.first().parent().closest(selector).exists()};$.fn.startThrobbing=function(){return this.append('<div class="wikiaThrobber"></div>')};$.fn.stopThrobbing=function(){this.find(".wikiaThrobber").remove();return this};$.preloadThrobber=function(){var img=new Image();img.src=stylepath+"/common/images/ajax.gif"};$.thumbUrl2ThumbUrl=function(url,type,width,height){return Wikia.Thumbnailer.getThumbURL(url,type,width,height)};$.htmlentities=function(s){return String(s).replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\'/g,"&apos;").replace(/\"/g,"&quot;")};$.createClass=function(sc,o){var constructor=o.constructor;if(typeof constructor!=="function"||constructor==Object.prototype.constructor){constructor=function(){sc.apply(this,arguments)}}var bc=constructor;var f=function(){};f.prototype=sc.prototype||{};bc.prototype=new f();if(typeof o.statics=="object"){bc=$.extend(bc,o.statics);delete o.statics}for(var m in o){bc.prototype[m]=o[m]}bc.prototype.constructor=bc;bc.superclass=sc.prototype;return bc};$.proxyBind=function(fn,thisObject,baseArgs){return function(){var args=baseArgs.slice(0).concat(Array.prototype.call(arguments,0));return fn.apply(thisObject,args)}};var Observable=$.createClass(Object,{constructor:function(){Observable.superclass.constructor.apply(this,arguments);this.events={}},bind:function(e,cb,scope){if(typeof e=="object"){scope=cb;for(var i in e){if(i!=="scope"){this.bind(i,e[i],e.scope||scope)}}}else{if($.isArray(cb)){for(var i=0;i<cb.length;i++){this.bind(e,cb[i],scope)}}else{scope=scope||this;this.events[e]=this.events[e]||[];this.events[e].push({fn:cb,scope:scope})}}return true},unbind:function(e,cb,scope){if(typeof e=="object"){scope=cb;var ret=false;for(var i in e){if(i!=="scope"){ret=this.unbind(i,e[i],e.scope||scope)||ret}}return ret}else{if($.isArray(cb)){var ret=false;for(var i=0;i<cb.length;i++){ret=this.unbind(e,cb[i],scope)||ret}return ret}else{if(!this.events[e]){return false}scope=scope||this;for(var i in this.events[e]){if(this.events[e][i].fn==cb&&this.events[e][i].scope==scope){delete this.events[e][i];return true}}return false}}},on:function(e,cb){this.bind.apply(this,arguments)},un:function(e,cb){this.unbind.apply(this,arguments)},relayEvents:function(o,e,te){te=te||e;o.bind(e,function(){var a=[te].concat(arguments);this.fire.apply(this,a)},this)},fire:function(e){var a=Array.prototype.slice.call(arguments,1);if(!this.events[e]){return true}var ee=this.events[e];for(var i=0;i<ee.length;i++){if(typeof ee[i].fn=="function"){var scope=ee[i].scope||this;if(ee[i].fn.apply(scope,a)===false){return false}}}return true},proxy:function(func){return $.proxy(func,this)},debugEvents:function(list){var fns=list?list:["bind","unbind","fire","relayEvents"];for(var i=0;i<fns.length;i++){(function(fn){if(typeof this["nodebug-"+fn]=="undefined"){var f=this["nodebug-"+fn]=this[fn];this[fn]=function(){window.console&&console.log&&console.log(this,fn,arguments);return f.apply(this,arguments)}}}).call(this,fns[i])}}});var GlobalTriggers=(function(){var GlobalTriggersClass=$.createClass(Observable,{fired:null,constructor:function(){GlobalTriggersClass.superclass.constructor.apply(this);this.fired={}},bind:function(e,cb,scope){GlobalTriggersClass.superclass.bind.apply(this,arguments);if(typeof e=="object"||$.isArray(cb)){return}if(typeof this.fired[e]!="undefined"){var a=this.fired[e].slice(0);setTimeout(function(){for(i=0;i<a.length;i++){cb.apply(scope||window,a[i])}},10)}},fire:function(e){var a=Array.prototype.slice.call(arguments,1);this.fired[e]=this.fired[e]||[];this.fired[e].push(a);GlobalTriggersClass.superclass.fire.apply(this,arguments)}});return new GlobalTriggersClass()})();var Timer=$.createClass(Object,{callback:null,timeout:1000,timer:null,constructor:function(callback,timeout){this.callback=callback;this.timeout=(typeof timeout=="number")?timeout:this.timeout},run:function(){this.callback.apply(window)},start:function(timeout){this.stop();timeout=(typeof timeout=="number")?timeout:this.timeout;this.timer=setTimeout(this.callback,timeout)},stop:function(){if(this.timer!=null){clearTimeout(this.timer);this.timer=null}}});$.extend(Timer,{create:function(callback,timeout){var timer=new Timer(callback,timeout);return timer},once:function(callback,timeout){var timer=Timer.create(callback,timeout);timer.start();return timer}});$(function(){if(typeof wgNow!="undefined"){var loadTime=(new Date()).getTime()-wgNow.getTime();$().log("DOM ready after "+loadTime+" ms",window.skin)}window.wgWikiaDOMReady=true;if(typeof $.fn.timeago!="undefined"){$(".timeago").timeago()}});var $window=$(window);$window.bind("load",function(){if(typeof wgNow!="undefined"){var loadTime=(new Date()).getTime()-wgNow.getTime();$().log("window onload after "+loadTime+" ms",window.skin)}});$window.on("scroll",$.debounce(100,function(event){$window.trigger("scrollstop",[event])}));$.toJSON=JSON.stringify;$.evalJSON=$.secureEvalJSON=JSON.parse;window.GlobalTriggers=GlobalTriggers;window.Observable=Observable;window.Timer=Timer})(window,jQuery);(function(b,a){b.fn.carousel=function(f){var k=b(this);var m={transitionSpeed:500,itemsShown:3,activeIndex:0,nextClass:"next",prevClass:"previous",attachBlindImages:false,itemClick:false,trackProgress:false,beforeMove:false,afterMove:false};f=b.extend(m,f);var w={wrapper:k,carousel:k.find(".carousel"),items:k.find(".carousel > li"),container:k.children("div:first"),next:k.siblings("."+f.nextClass),previous:k.siblings("."+f.prevClass)};var A={viewPortWidth:k.outerWidth(),itemWidth:l(),carouselWidth:0,minLeft:0};var h={browsing:false,enable_next:false,enable_previous:false,currIndex:0,left:0};function s(){if(h.browsing==false&&h.enable_next==true){h.browsing=true;j(h.currIndex+f.itemsShown)}return false}function n(){if(h.browsing==false&&h.enable_previous==true){h.browsing=true;j(h.currIndex-1)}return false}function j(B){if(!q(B)){if(B>(w.items.length-f.itemsShown)){B=w.items.length-f.itemsShown}if(h.currIndex>B){var C=B-f.itemsShown+1;if(C<0){C=0}B=C}var D=A.itemWidth*B*-1;h.currIndex=B;p(D)}else{r()}}function p(B){h.left=B;if(typeof f.beforeMove=="function"){f.beforeMove()}w.carousel.animate({left:B},f.transitionSpeed,function(){h.browsing=false;r()})}function r(){d();u();if(typeof f.trackProgress=="function"){e(f.trackProgress)}if(typeof f.afterMove=="function"){f.afterMove(h.currIndex+f.itemsShown)}}function q(B){return B>=h.currIndex&&B<(h.currIndex+f.itemsShown)}function x(B){if(B>-1){w.items.removeClass("active");w.items.eq(B).addClass("active");j(B)}else{d()}}function e(E){var D=w.items.length,C=Math.floor(h.currIndex)+1,B=Math.floor(h.currIndex)+(f.itemsShown>D?D:f.itemsShown);if(B>D){B=D}E(C,B,D)}function d(){if(w.items.length<=f.itemsShown){o();y();return}var B=parseInt(w.carousel.css("left"));if(isNaN(B)){B=0}if(B<A.minLeft+A.itemWidth/2){o();t()}else{if(B==0){y();v()}else{t();v()}}}function u(){var E=h.currIndex-f.itemsShown,C=h.currIndex,B=h.currIndex+f.itemsShown*2;E=E<0?0:E;var D=w.items.slice(C,B).find("img[data-src]"),F=w.items.slice(E,C).find("img[data-src]");c(D);c(F)}function c(B){B.each(function(){var C=b(this);C.attr("src",C.attr("data-src")).removeAttr("data-src")})}function z(){if(!A.itemWidth){A.itemWidth=l()}var C=A.itemWidth*w.items.length;w.carousel.css("width",C);var B=(C-A.viewPortWidth)*-1;A.carouselWidth=C;A.minLeft=B}function g(){if(w.carousel.find("li").length==5){w.carousel.append("<li class='blind'></li>")}else{if(w.carousel.find("li").length==4){w.carousel.append("<li class='blind'></li>");w.carousel.append("<li class='blind'></li>")}}w.carousel.find("li").first().addClass("first-image");w.carousel.find("li").last().addClass("last-image")}function o(){h.enable_next=false;w.next.addClass("disabled")}function v(){h.enable_next=true;w.next.removeClass("disabled")}function y(){h.enable_previous=false;w.previous.addClass("disabled")}function t(){h.enable_previous=true;w.previous.removeClass("disabled")}function l(){return w.items.first().outerWidth(true)}this.updateCarouselItems=function(){w.items=w.carousel.find("li");u()};this.updateCarouselWidth=function(){z()};this.updateCarouselArrows=function(){d()};this.resetPosition=function(){w.carousel.css("left",0);h.currIndex=0};return this.each(function(){if(typeof f.attachBlindImages=="function"){g()}w.next.click(s);w.previous.click(n);z();x(f.activeIndex);if(f.itemClick){w.carousel.on("click","li",function(B){x(b(this).index());f.itemClick.call(this,B)})}u()})}})(jQuery,this);$.fn.extend({getModalTopOffset:function(){var b=Math.max((($(window).height()-this.outerHeight())/2),20);var a=this.data("settings");if(a&&typeof a.topMaximum=="number"){b=Math.min(b,a.topMaximum)}return $(window).scrollTop()+b},makeModal:function(q){var g={showCloseButton:true,width:400,height:"auto",tabsOutsideContent:false,topOffset:50,escapeToClose:true},j,k,h;if(q){$.extend(g,q)}var m=Math.round((new Date()).getTime()/1000),d=g.id||($(this).attr("id")||m)+"Wrapper",c;if(skin==="oasis"||g.appendToBody){c=$("<section>",{"class":"modalWrapper",id:d}).append($("<section>",{"class":"modalContent"}).append(this)).appendTo("body")}else{this.wrap('<div class="modalWrapper" id="'+d+'"></div>');c=this.closest(".modalWrapper");c.appendTo("#positioned_elements")}if(g.className){c.addClass(g.className)}var p=g.zIndex?parseInt(g.zIndex):(5001101+($("body").children(".blackout").length)*2);j=p+1;c.data("settings",g);if(!g.noHeadline){var e=c.find("h1:first");if(e.exists()){e.remove()}else{e=$("<h1>").html($(this).attr("title")||"")}e.prependTo(c)}if(g.tabsOutsideContent||skin==="oasis"){var a=c.find(".modal-tabs");if(a.exists()){a.insertBefore(c.find(".modalContent"))}}if(skin==="oasis"){if(g.width!=="auto"){if(g.width!==undefined){k=g.width+40}else{h=$("#WikiaMainContent");if(h.length>0){k=h.width()}}}else{k="auto"}c.width(k).css({left:"50%",height:g.height,"margin-left":-c.outerWidth(false)/2,top:$(window).scrollTop()+g.topOffset,zIndex:j})}else{if(g.suppressDefaultStyles){c.css({zIndex:j,top:$(window).scrollTop()+g.topOffset})}else{c.width(g.width).css({marginLeft:-c.outerWidth(false)/2,top:c.getModalTopOffset(),zIndex:j}).fadeIn("fast")}}if(g.showCloseButton){c.prepend('<button class="close wikia-chiclet-button"><img src="'+stylepath+'/oasis/images/icon_close.png"></button>')}c.log("makeModal: #"+d);this.removeAttr("title");var f=(typeof g.persistent=="boolean")?g.persistent:false;var o=(typeof g.onClose=="function")?g.onClose:false;var n=(typeof g.closeOnBlackoutClick=="boolean")?g.closeOnBlackoutClick:true;c.find(".close").bind("click",function(){var s=$(this).closest(".modalWrapper");var r=s.data("settings");if(typeof r.onClose=="function"){if(r.onClose({click:1})==false){return}}if(f){s.hideModal()}else{s.closeModal()}});if(g.escapeToClose){$(window).bind("keydown.modal"+d,function(r){if(r.keyCode==27){if(typeof g.onClose=="function"){if(g.onClose({keypress:1})==false){return}}if(f){c.hideModal()}else{c.closeModal()}return false}})}$(window).bind("resize.modal",function(){if(window.skin=="oasis"||!g.resizeModal){return}c.css("top",c.getModalTopOffset());$(".blackout:last").height($(document).height())});var b=0.65;if(g.blackoutOpacity){b=g.blackoutOpacity}var l=$("<div>").addClass("blackout").attr("data-opacity",b);l.css({zIndex:p}).fadeTo("fast",b).bind("click",function(){if(!n){return}if(typeof g.onClose=="function"){if(g.onClose({click:1})==false){return}}if(f){c.hideModal()}else{c.closeModal()}});if(skin=="oasis"||g.appendToBody){l.appendTo("body")}else{l.appendTo("#positioned_elements")}c.data("blackout",l);if(typeof g.onCreate=="function"){g.onCreate(this,c)}$(document.body).addClass("modalShown");return c},closeModal:function(){$(window).unbind(".modal"+this.attr("id"));this.animate({top:this.offset()["top"]+100,opacity:0},"fast",function(){$(this).remove()});var b=$(this).data("blackout"),a=$(this).data("settings");b.fadeOut("fast",function(){$(this).remove();var c=a&&a.onAfterClose;if($.isFunction(c)){c()}});$(document.body).removeClass("modalShown")},hideModal:function(){var b=$(this).data("blackout"),a=$(this).data("settings");b.fadeOut("fast").addClass("blackoutHidden");this.animate({top:this.offset()["top"]+100,opacity:0},"fast",function(){$(this).hide();var c=a&&a.onAfterClose;if($.isFunction(c)){c()}});$(document.body).removeClass("modalShown")},showModal:function(){var d=this.closest(".modalWrapper");var c=5001101+($("body").children(".blackout").length)*2;var b=$(this).data("blackout");var a=b.attr("data-opacity");if(!a){a=0.65}b.css({display:"block",opacity:a,zIndex:c}).removeClass("blackoutHidden");d.css({top:d.getModalTopOffset(),zIndex:c+1,opacity:1,display:"block"}).log("showModal: #"+this.attr("id"));$(document.body).addClass("modalShown")},resizeModal:function(a){a=parseInt(a);var b=this.closest(".modalWrapper");b.width(a).css("marginLeft",-b.outerWidth(false)>>1).log("resizeModal: #"+this.attr("id")+" resized to "+a+"px")},isModalShown:function(){return $(document.body).hasClass("modalShown")},getModalWrapper:function(){return $(".modalWrapper")}});$.expiryStorage=new $.store();$.expiryStorage.get=function(a){var c=this.driver.get(a);if(!c){return}var b=this.driver.encodes?c:this.unserialize(c);c=null;var e=new Date();if(b.expires>=e.getTime()){c=b.value}else{this.del(a)}return c};$.expiryStorage.set=function(b,e,a){var f;if(typeof a=="number"){f=new Date();f.setTime(f.getTime()+(a))}else{if(typeof a=="object"&&a.toUTCString){f=a}else{throw"expires is not in a valid form"}}var c={value:e,expires:f.getTime()};this.driver.set(b,this.driver.encodes?c:this.serialize(c))};(function(a){a.fn.focusNoScroll=function(){var b=a(window).scrollLeft(),c=a(window).scrollTop();a(this).focus();a(window).scrollLeft(b).scrollTop(c);return this}})(jQuery);(function(a){function b(){var d={af:"ZA",ak:"GH",am:"ET",ar:"AR",as:"IN",ay:"BO",az:"AZ",be:"BY",bg:"BG",bn:"IN",br:"FR",bs:"BA",ca:"ES",cb:"IQ",ck:"US",co:"FR",cs:"CZ",cx:"PH",cy:"GB",da:"DK",de:"DE",el:"GR",en:"US",eo:"EO",es:"ES",et:"EE",eu:"ES",fa:"IR",fb:"LT",ff:"NG",fi:"FI",fo:"FO",fr:"FR",fy:"NL",ga:"IE",gl:"ES",gn:"PY",gu:"IN",gx:"GR",ha:"NG",he:"IL",hi:"IN",hr:"HR",hu:"HU",hy:"AM",id:"ID",ig:"NG",is:"IS",it:"IT",ja:"JP",jv:"ID",ka:"GE",kk:"KZ",km:"KH",kn:"IN",ko:"KR",ku:"TR",la:"VA",lg:"UG",li:"NL",ln:"CD",lo:"LA",lt:"LT",lv:"LV",mg:"MG",mk:"MK",ml:"IN",mn:"MN",mr:"IN",ms:"MY",mt:"MT",my:"MM",nb:"NO",nd:"ZW",ne:"NP",nl:"NL",nn:"NO",ny:"MW",or:"IN",pa:"IN",pl:"PL",ps:"AF",pt:"PT",qu:"PE",rm:"CH",ro:"RO",ru:"RU",rw:"RW",sa:"IN",sc:"IT",se:"NO",si:"LK",sk:"SK",sl:"SI",sn:"ZW",so:"SO",sq:"AL",sr:"RS",sv:"SE",sw:"KE",sy:"SY",sz:"PL",ta:"IN",te:"IN",tg:"TJ",th:"TH",tk:"TM",tl:"PH",tr:"TR",tt:"RU",tz:"MA",uk:"UA",ur:"PK",uz:"UZ",vi:"VN",wo:"SN",xh:"ZA",yi:"DE",yo:"NG",zh:"CN",zu:"ZA",zz:"TR"},c={AF:["ps"],AL:["sq"],AM:["hy"],AR:["ar"],AZ:["az"],BA:["bs"],BE:["nl"],BG:["bg"],BO:["ay"],BR:["pt"],BY:["be"],CA:["fr"],CD:["ln"],CH:["rm"],CL:["es"],CN:["zh"],CO:["es"],CZ:["cs"],DE:["de","yi"],DK:["da"],EE:["et"],EO:["eo"],ES:["ca","es","eu","gl"],ET:["am"],FI:["fi"],FR:["br","co","fr"],FO:["fo"],GB:["cy","en"],GE:["ka"],GH:["ak"],GR:["el","gx"],HK:["zh"],HR:["hr"],HU:["hu"],ID:["id","jv"],IE:["ga"],IL:["he"],IN:["as","bn","en","gu","hi","kn","ml","mr","or","pa","sa","ta","te"],IQ:["cb"],IR:["fa"],IS:["is"],IT:["it","sc"],JP:["ja"],KE:["sw"],KH:["km"],KR:["ko"],KS:["ja"],KZ:["kk"],LA:["es","lo"],LK:["si"],LT:["fb","lt"],LV:["lv"],MA:["tz"],MG:["mg"],MK:["mk"],MM:["my"],MN:["mn"],MT:["mt"],MW:["ny"],MX:["es"],MY:["ms"],NG:["ff","ha","ig","yo"],NL:["fy","li","nl"],NO:["nb","nn","se"],NP:["ne"],PE:["qu"],PH:["cx","tl"],PI:["en"],PK:["ur"],PL:["pl","sz"],PT:["pt"],PY:["gn"],RO:["ro"],RS:["sr"],RU:["ru","tt"],RW:["rw"],SE:["sv"],SI:["sl"],SK:["sk"],SN:["wo"],SO:["so"],ST:["tl"],SY:["sy"],TH:["th"],TJ:["tg"],TM:["tk"],TR:["ku","tr","zz"],TW:["zh"],UA:["uk"],UD:["en"],UG:["lg"],US:["ck","en"],UZ:["uz"],VA:["la"],VE:["es"],VN:["vi"],ZA:["af","xh","zu"],ZW:["nd","sn"]};function e(j){var h,k=j.length===2?j.toLowerCase():"en",g=Geo.getCountryCode(),f="";if(g){h=c[g.toUpperCase()];if(h&&k in h){f=g.toUpperCase()}}if(!f){f=d[k];if(!f){k="en";f="US"}}return"//connect.facebook.net/"+k+"_"+f+"/sdk.js"}return{getSdkUrl:e}}if(!a.Wikia){a.Wikia={}}a.Wikia.fbLocale=b();if(a.define&&a.define.amd){a.define("wikia.fbLocale",[],b)}}(this));(function(b,c){var a=(function(){var d=new RegExp(b.wgAssetsManagerQuery.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&").replace(/\//g,"\\/").replace("%1\\$s","groups?").replace(/%\d\\\$(?:s|d)/g,"(.*)")),f=/(js|s?css)/,e=/\.(js|s?css)$/;return function(k,t,h){var o,j,q,p,g,s=new c.Deferred(),m,r;g=function(){p--;if(p<1){if(typeof t==="function"){t()}s.resolve()}};if(!c.isArray(k)){k=[k]}if(!(o=p=k.length)){g()}for(j=0;j<o;j++){m=k[j];r=typeof m;if(r==="object"){if(m.type&&m.url){r=m.type;m=m.url}}else{if(r==="string"){q=m.match(d);q=q?q[3].match(f):m.match(e);r=q?q[1]:"unknown"}}if(r==="js"){c.getScript(m,g).fail(h)}else{if(r==="css"||r==="scss"){c.getCSS(m,g)}else{if(r==="function"){m.call(c,g)}else{c().log("getResources: unknown type "+m);s.reject({error:"Unknown type",resource:m})}}}}return s.promise()}}());c.getResources=c.getResource=a})(window,jQuery);(function(a){a.loadLibrary=function(e,f,c,g,d){var b=new jQuery.Deferred();if(c==="undefined"){a().log("loading "+e,"loadLibrary");f=(typeof f==="string")?[f]:f;a.getResources(f,function(){a().log(e+" loaded","loadLibrary");if(typeof g==="function"){g()}},d).then(function(){b.resolve()}).fail(function(){b.reject()})}else{a().log(e+" already loaded","loadLibrary");if(typeof g==="function"){g()}b.resolve()}return b.promise()};a.loadYUI=function(b){return mw.loader.using("wikia.yui").done(b)};a.loadModalJS=function(b){if(typeof b==="function"){b()}};a.loadJQueryUI=function(b){return mw.loader.using("wikia.jquery.ui").done(b)};a.loadJQueryAutocomplete=function(b){return mw.loader.using("jquery.autocomplete").done(b)};a.loadJQueryAIM=function(b){return mw.loader.using("wikia.aim").done(b)};a.loadMustache=function(b){return mw.loader.using("jquery.mustache").done(b)};a.loadHandlebars=function(b){return mw.loader.using("wikia.handlebars").done(b)};a.loadGoogleMaps=function(d){var b=new jQuery.Deferred(),c=function(){if(typeof d==="function"){d()}b.resolve()};if(typeof(window.google&&window.google.maps)!=="undefined"){c()}else{window.onGoogleMapsLoaded=function(){delete window.onGoogleMapsLoaded;c()};a.loadLibrary("GoogleMaps",[{url:"http://maps.googleapis.com/maps/api/js?sensor=false&callback=onGoogleMapsLoaded",type:"js"}],typeof(window.google&&window.google.maps)).fail(function(){b.reject()})}return b.promise()};a.loadGooglePlusAPI=function(b){return a.loadLibrary("Google Plus API","//apis.google.com/js/plusone.js",typeof(window.gapi&&window.gapi.plusone),b)};a.loadTwitterAPI=function(b){return a.loadLibrary("Twitter API","//platform.twitter.com/widgets.js",typeof(window.twttr&&window.twttr.widgets),b)}})(jQuery);(function(c){function a(g,f,e){var d=c.Deferred();if(window.wgNoExternals){d.reject()}else{if(e==="undefined"){b(f,d)}else{Wikia.log(g+" already loaded",Wikia.log.levels.feedback,"loadExternalLibrary");d.resolve()}}return d}function b(e,d){var f=document.getElementsByTagName("script")[0],g=document.createElement("script");g.src=e;g.onload=function(){d.resolve()};g.onerror=function(){d.reject()};f.parentNode.insertBefore(g,f)}c.loadFacebookSDK=function(f){var d=c.Deferred(),e=window.fbScript||window.Wikia.fbLocale.getSdkUrl(window.wgUserLanguage);if(typeof f==="function"){d.done(f)}d.done(function(){c(".sso-login").removeClass("hidden")});if(typeof window.FB==="object"){d.resolve()}else{window.fbAsyncInit=function(){window.FB.init({appId:window.fbAppId,cookie:true,version:"v2.1"});d.resolve()};c.when(a("FacebookSDK",e,typeof window.FB)).fail(function(){d.reject()})}return d};c.loadReCaptcha=function(){var d="https://www.google.com/recaptcha/api.js?hl="+window.wgUserLanguage;return a("ReCaptcha",d,typeof window.grecaptcha)};c.loadGoogleSearchAPI=function(e){var d=(document.location.protocol=="https:"?"https:":"http:")+"//cse.google.com/cse.js?cx="+e;return a("googleSearchUrl",d,typeof window.GoogleSearch)}})(jQuery);(function(a){a.Wikia=a.Wikia||{};Wikia.isTouchScreen=function(){return("ontouchstart" in a)};if(Wikia.isTouchScreen()){$.getResources([$.getSassCommonURL("/skins/oasis/css/touchScreen.scss"),a.stylepath+"/oasis/js/touchScreen.js"])}})(window);jQuery(function(g){var d=g("#WikiaArticle"),f=d.find("table"),e=g("#WikiaBarWrapper"),c='<div class="table-wrapper table-is-wide"><div class="table-scrollable"></div></div>';function a(){f.each(function(){var h=g(this),k=h.parent(".table-scrollable"),j=h.width()>d.width();if(j&&!k.length){h.wrap(c);k=h.parent(".table-scrollable")}else{if(!j&&k.length){h.unwrap().unwrap()}}k.floatingScrollbar(j)})}function b(){var h=e.length&&!e.hasClass("hidden")?e.height():0;g("#floating-scrollbar").css("bottom",h);g.floatingScrollbarOptions.bottom=h}a();g(window).on("resize",g.debounce(50,a)).on("wikiaTabClicked WideTablesScan",a).on("WikiaBarStateChanged WikiaBarReady UpdateFloatingScrollbar",b)});define("wikia.backgroundchanger",function(){var a=[];function b(f){var h=new Image(),e={"background-dynamic":f.backgroundDynamic||false,"background-image":f.skinImage||"","background-image-width":f.skinImageWidth||0,"background-image-height":f.skinImageHeight||0,"color-body":f.backgroundColor,"color-body-middle":f.backgroundMiddleColor||f.backgroundColor},g=$.extend({},window.wgSassParams,e),k=$.extend({},g,{widthType:0}),d=window.wgOasisBreakpoints?$.getSassCommonURL("/skins/oasis/css/core/breakpoints-background.scss",k):$.getSassCommonURL("/skins/oasis/css/core/background.scss",g);h.src=f.skinImage;var c=function(){if(f.skinImage!==""&&f.skinImageWidth>0&&f.skinImageHeight>0){if((f.backgroundFixed===undefined)||!!f.backgroundFixed){$("body").addClass("background-fixed")}else{$("body").removeClass("background-fixed")}if((f.backgroundTiled!==undefined)&&!!f.backgroundTiled){$("body").removeClass("background-not-tiled")}else{$("body").addClass("background-not-tiled")}if((f.backgroundDynamic===undefined)||!!f.backgroundDynamic){$("body").addClass("background-dynamic")}else{$("body").removeClass("background-dynamic")}if(!!f.ten64){$(".background-image-gradient").addClass("no-gradients")}}else{$("body").removeClass("background-dynamic background-not-tiled background-fixed")}};var j=a.indexOf(d);if(j>-1){$("link[data-background-changer]").attr("disabled",true);$('link[data-background-changer="'+d+'"]').attr("disabled",false);c()}else{$.getCSS(d,function(l){a.push(d);$(l).attr("data-background-changer",d);c()})}}return{load:b}});define("SearchAbTest.DomUpdater",["jquery","wikia.log"],function(d,b){var a=".wikia-paginator a.paginator-page, .search-tabs a, a.paginator-next, a.paginator-prev",c="form.WikiaSearch";return{linkUpdater:{update:function(f){if(!f){return}var e=this;d(a).each(function(){var h=d(this).attr("href");if(!!h){var g=e.modifyLink(h,f);b('Modifying link: "'+h+'" to "'+g+'"',b.levels.debug,"search");d(this).attr("href",g)}})},modifyLink:function(f,h){h=h||{};var e=f;var j="?";if(f.indexOf("?")>-1){j="&"}if(f.indexOf("?")==f.length-1){j=""}for(var g in h){e=e+j+g+"="+h[g];j="&"}return e}},formUpdater:{update:function(h){if(!h){return}var f=d(c);for(var g in h){var e='<input type="hidden" name="'+g+'" value="'+h[g]+'">';f.append(e);b("Add new input: "+e,b.levels.debug,"search")}}}}});define("SearchAbTest.Context",["wikia.window","wikia.log","wikia.querystring"],function(e,d,a){if(!e||!e.Wikia||!e.Wikia.AbTest){d("AbTest is not present. Fallback to dummy SearchAbTest.GroupProvider",d.levels.debug,"search");return{getAbTestGroups:function(){return[]},getAbTestParameters:function(){return{}},getQueryParameters:function(){return{}}}}var b=e.Wikia.AbTest;function c(){var j=[];var h=b.getExperiments();for(var g=0;g<h.length;g++){var f=h[g];if(f&&f.name&&f.name.toUpperCase().indexOf("SEARCH")===0){j.push(f)}}return j}return{getAbTestGroups:function(){var h=c();var f=[];for(var g=0;g<h.length;g++){if(h[g].group){f.push(h[g].group.id)}}d("Found A/B groups: "+f.join(","),d.levels.debug,"search");return f},getQueryParameters:function(){var f=a(e.location.url);return f.getVals()},getAbTestParameters:function(){var g={};var h=this.getQueryParameters();for(var f in h){if(f.indexOf("AbTest.")===0||f=="ab"){g[f]=h[f]}}return g}}});require(["wikia.window","SearchAbTest.Context","SearchAbTest.DomUpdater","wikia.log"],function(j,b,a,g){var e="ab";if(j.Wikia&&j.Wikia.AbTest){g("AbTest is present. Enable Search A/B testing.",g.levels.debug,"search");var l=[a.linkUpdater,a.formUpdater];var d=b.getAbTestGroups();var f={};if(d.length){f[e]=d.join(",")}var c=b.getAbTestParameters();for(var k in c){f[k]=c[k]}for(var h=0;h<l.length;h++){l[h].update(f)}}});require(["jquery","wikia.window","wikia.tracker"],function(d,f,h){var g=800,j=100,e=1,b,k,a,c;if(Math.random()*100<e&&f.wgIsArticle){b=d(".WikiaArticle");a=h.buildTrackingFunction({action:h.ACTIONS.IMPRESSION,category:"articleContentLengthTest",trackingMethod:"analytics"});c=Math.floor(d(f).width()/j);if(b.height()>g){k="long-"}else{k="short-"}a({label:k+c})}});$(function(){function e(){var l={},k,f=Wikia.Querystring(),j=0,h=["noexternals","noads","uselang","mcache","rebuildmessages"],g=h.length;for(j=0;j<g;j++){k=f.getVal(h[j]);if(k!==undefined){l[h[j]]=k}}return l}var d=$("#WikiaRail"),b=10,c={},a;d.trigger("beginLoad.rail");if(d.find(".loading").exists()){c={articleTitle:window.wgTitle,namespace:window.wgNamespaceNumber,cb:window.wgStyleVersion};if(typeof wgSassLoadedScss!=="undefined"){c.excludeScss=window.wgSassLoadedScss}c.isAdMixExperimentEnabled=window.ads.context.opts.adMixExperimentEnabled;$.extend(c,e());$.nirvana.sendRequest({controller:"RailController",method:(window.wgUserName)?"lazy":"lazyForAnons",data:c,type:"get",format:"json",callback:function(g){var f=function(h){d.addClass("loaded").find(".loading").remove().end().append(h.railLazyContent+h.js);if(b>=Math.floor((Math.random()*100+1))){a=(new Date())-(window.wgNow||0);Wikia.Tracker.track({action:Wikia.Tracker.ACTIONS.IMPRESSION,category:"right-rail",label:"lazy-loaded",trackingMethod:"analytics",value:a})}if(window.ChatWidget&&typeof window.wgWikiaChatUsers!=="undefined"){window.ChatWidget.init()}if(typeof $.fn.timeago!=="undefined"){d.find(".timeago").timeago()}if(window.Wikia&&window.Wikia.initRailTracking){Wikia.initRailTracking()}require(["wikia.window",require.optional("ext.wikia.adEngine.slot.floatingMedrec")],function(k,j){if(j){k.wgAfterContentAndJS.push(j.init)}});if(window.wgEnableLightboxExt){window.LightboxLoader.init()}d.trigger("afterLoad.rail")};if(g.css.length===0){f(g)}else{require(["wikia.loader"],function(h){h({type:h.CSS,resources:g.css}).done(function(){f(g)})})}}})}});define("wikia.pageShare",["wikia.window","wikia.tracker","wikia.log","jquery"],function(g,h,d,e){var b=h.buildTrackingFunction({action:g.Wikia.Tracker.ACTIONS.CLICK,category:"social-share",trackingMethod:"analytics"});function c(o){o.stopPropagation();o.preventDefault();var k=e(o.target).closest("a"),m=k.prop("href"),p=k.prop("title"),n=Math.floor(g.innerHeight/2),l=Math.floor(g.innerWidth/2);b({label:k.data("share-service")});g.open(m,p,"width="+l+",height="+n)}function f(m){if(m.socialIcons){var k=encodeURIComponent(g.location.origin+g.location.pathname),n=encodeURIComponent(g.document.title),l=encodeURIComponent(e('meta[property="og:description"]').attr("content"));m.socialIcons=m.socialIcons.replace(/\$url/g,k).replace(/\$title/g,n).replace(/\$description/g,l);return m}}function j(){var k=e.getUrlVar("mcache"),l={lang:a(e.getUrlVar("uselang")),isTouchScreen:g.Wikia.isTouchScreen()?1:0,title:g.wgPageName};if(k){l.mcache=k}return e.nirvana.sendRequest({type:"GET",controller:"PageShare",method:"getShareIcons",data:l}).then(f)}function a(k){if(k){return k}else{if(g.wgUserName){return g.wgUserLanguage}else{if(g.navigator.languages){return g.navigator.languages[0].substr(0,2)}else{if(g.navigator.language){return g.navigator.language.substr(0,2)}else{if(g.navigator.userLanguage){return g.navigator.userLanguage.substr(0,2)}else{d("Couldn't pick a language for Page Share extension.",d.levels.debug,"PageShare");return null}}}}}}return{loadShareIcons:j,getShareLang:a,shareLinkClickHandler:c}});require(["wikia.pageShare","wikia.ui.factory","jquery"],function(b,a,c){c("#ShareEntryPoint").click(function(){c.when(a.init(["modal"]),b.loadShareIcons()).then(function(d,e){d.createComponent({vars:{id:"PageShareModalDialog",classes:["page-share-modal-dialog"],size:"small",title:e.modalTitle,content:e.socialIcons,}},function(f){f.$element.find("#PageShareToolbar").on("click","a",b.shareLinkClickHandler);f.show()})})})});window.Wikia=window.Wikia||{};window.Wikia.getMultiTypePackage=function(a){var d={},b=a.templates,c=["styles","scripts","messages","mustache","handlebars"],g=a.callback,f=a.params,e=false;$.each(c,function(){if(typeof a[this]==="string"){d[this]=a[this];e=true}});if(typeof b!="undefined"){d.templates=(typeof b==="object")?JSON.stringify(b):b;e=true}if(typeof f==="object"){d=$.extend(d,f)}if(e){d.cb=wgStyleVersion;return $.nirvana.getJson("AssetsManagerController","getMultiTypePackage",d,function(h){if(h.messages){wgMessages=$.extend(wgMessages,h.messages)}if(typeof g==="function"){g(h)}})}else{throw"No resources to load specified"}};window.Wikia.processScript=function(c){var a=document.createElement("script"),b=document.head||document.getElementsByTagName("head")[0];a.type="text/javascript";a.text=c;b.appendChild(a)};window.Wikia.processStyle=function(b){var c=document.createElement("style"),a=document.head||document.getElementsByTagName("head")[0];c.type="text/css";if(c.styleSheet){c.styleSheet.cssText=b}else{c.appendChild(document.createTextNode(b))}a.appendChild(c)};window.Wikia.getAMgroups=function(a,b){return $.getScript($.getAssetManagerGroupUrl(a),b)};(function(c){var b=Array.prototype.shift,e=Array.prototype.join;function a(k,j,h){var g=function(){var p=(b.call(arguments)||"").trim(),n=p;if(h.wgMessages){n=h.wgMessages[p]||n;n=d.process(n,arguments,h.wgUserLanguage);if(n!==p&&arguments.length){for(var o=0,m=arguments.length;o<m;o++){n=n.replace(new RegExp("\\$"+(o+1),"g"),arguments[o])}}}return n};g.get=function(m,o,n){var l=j.Deferred();if(typeof m!="string"){m=e.call(m,",")}n=n||h.wgUserLanguage;k.sendRequest({type:"GET",controller:"JSMessages",method:"getMessages",data:{packages:m,uselang:n,cb:h.wgJSMessagesCB}}).then(function(p){h.wgMessages=j.extend(h.wgMessages||{},p.messages);if(typeof o=="function"){o()}l.resolve()}).fail(function(){l.reject()});return l.promise()};g.getForContent=function(l,m){return g.get(l,m,h.wgContentLanguage)};return g}var d={defaultPluralRule:function(g){return(g!=1)?1:0},pluralRules:{"ay bo cgg dz fa id ja jbo ka kk km ko ky lo ms su th tr tt ug uz vi wo zh zh-hans zh-hant zh-tw":function(){return 0},"ach ak am arn br fil fr gun ln mfe mg mi nso oc pt-br ti wa":function(g){return(g>1)?1:0},"cs sk":function(g){return(g==1)?0:((g>=2&&g<=4)?1:2)},"be bs ru sr uk":function(g){return(g%10==1&&g%100!=11)?0:((g%10>=2&&g%10<=4&&(g%100<10||g%100>=20))?1:2)},jv:function(g){return(g!=0)?1:0},mk:function(g){return(g==1||g%10==1)?0:1},mnk:function(g){return(g==0)?0:g==1?1:2},lv:function(g){return(g%10==1&&g%100!=11)?0:((g!=0)?1:2)},kw:function(g){return(g==1)?0:((g==2)?1:((g==3)?2:3))},ro:function(g){return(g==1)?0:((g==0||(g%100>0&&g%100<20))?1:2)},ga:function(g){return(g==1)?0:((g==2)?1:((g<7)?2:((g<11)?3:4)))},gd:function(g){return(g==1||g==11)?0:(g==2||g==12)?1:(g>2&&g<20)?2:3},sl:function(g){return(g%100==1)?0:((g%100==2)?1:((g%100==3||g%100==4)?2:3))},pl:function(g){return(g==1)?0:((g%10>=2&&g%10<=4&&(g%100<10||g%100>=20))?1:2)},csb:function(g){return(g==1)?0:((g%10>=2&&g%10<=4&&(g%100<10||g%100>=20))?1:2)},lt:function(g){return(g%10==1&&g%100!=11)?0:((g%10>=2&&(g%100<10||g%100>=20))?1:2)},cy:function(g){return(g==0)?0:((g==1)?1:((g==2)?2:((g==3)?3:((g==6)?4:5))))},hr:function(g){return(g%10==1&&g%100!=11)?0:((g%10>=2&&g%10<=4&&(g%100<10||g%100>=20))?1:2)},mt:function(g){return(g==1)?0:((g==0||(g%100>1&&g%100<11))?1:((g%100>10&&g%100<20)?2:3))},ar:function(g){return(g==0)?0:((g==1)?1:((g==2)?2:((g%100>=3&&g%100<=10)?3:((g%100>=11&&g%100<=99)?4:5))))}},getPluralRuleFunction:function(l){if(typeof d.pluralRules[l]==="undefined"){var n=d.defaultPluralRule,k=[l],g=l.split("-"),j;if(g.length>1){k.push(g[0])}for(j=0;(j<k.length)&&(n===d.defaultPluralRule);j++){var h=new RegExp("(?:^| )"+k[j]+"(?: |$)");for(var m in d.pluralRules){if(d.pluralRules.hasOwnProperty(m)){if(h.test(m)){n=d.pluralRules[m];break}}}}d.pluralRules[l]=n}return d.pluralRules[l]},getPlural:function(g,k,j){var h=isNaN(j)?-1:k(j);if((h<0)||(h>=g.length)){h=g.length-1}return g[h]},process:function(h,g,j){h=h.replace(/\{\{PLURAL:\$(\d+)\|([^\{\}]+)\}\}/gi,function(n,m,l){var k=NaN;if((m>0)&&(m<=g.length)){k=g[m-1];if(typeof k!=="number"){k=parseInt(k)}}return d.getPlural(l.split("|"),d.getPluralRuleFunction(j),k)});return h}};if(jQuery){var f=a(jQuery.nirvana,jQuery,c);jQuery.extend(jQuery,{msg:f,getMessages:f.get,getMessagesForContent:f.getForContent})}if(c.define&&c.define.amd){c.define("JSMessages",["wikia.nirvana","jquery","wikia.window"],a)}})(this);(function(a,d,e){var c=a.wgAction,b=a.wgCategorySelect;if(!b||(c!="view"&&c!="purge")){return}d(function(){var j=a.wgArticleId,g=false,h="categorySelectView",k=d("#articleCategories");if(!k.hasClass("userCanEdit")){return}k.on("click."+h,".add",function(){k.addClass("editMode").find(".input").focus();if(!g){g=true;d.when(e.loader.using("jquery.ui.autocomplete"),e.loader.using("jquery.ui.sortable"),d.getResources([wgResourceBasePath+"/resources/wikia/libraries/mustache/mustache.js",wgResourceBasePath+"/extensions/wikia/CategorySelect/js/CategorySelect.js",wgResourceBasePath+"/resources/wikia/modules/uifactory.js",wgResourceBasePath+"/resources/wikia/modules/uicomponent.js"])).done(function(l){k.categorySelect({placement:"right",popover:{hint:true},sortable:{axis:false,forcePlaceholderSize:true,items:".new",revert:200}}).on("add",function(n,m,o){k.find(".last").before(o.element)}).on("click."+h,".cancel",function(){f({label:"cancel-edit"});k.removeClass("editMode").trigger("reset").find(".category.new").remove()}).on("click."+h,".save",function(){f({label:"submit-save"});var m=k.find(".container").startThrobbing();d(this).attr("disabled",true);d.nirvana.sendRequest({controller:"CategorySelectController",data:{articleId:j,categories:k.data("categorySelect").getData(".new"),token:e.user.tokens.get("editToken")},method:"save"}).done(function(n){m.stopThrobbing();if(n.error){throw"Saving error: "+n.error}else{k.removeClass("editMode").find(".category").remove();k.find(".last").before(n.html);k.find(".input").val("")}}).fail(function(n){m.stopThrobbing();throw"Saving error: "+n.responseText})}).on("update",function(){var m=k.find(".category.new").length>0;k.toggleClass("modified",m).find(".save").prop("disabled",!m)})})}});var f=Wikia.Tracker.buildTrackingFunction(Wikia.trackEditorComponent,{action:Wikia.Tracker.ACTIONS.CLICK,category:"category-tool",trackingMethod:"analytics"})})})(window,window.jQuery,window.mw);(function(){var a=function(b){this.el=$(b);this.form=this.el.is("form")?this.el:this.el.find("form");if(!this.form.length){Wikia.log('WikiaForm with selector "'+this.el.selector+"\" doesn't include a form element",Wikia.log.levels.error,"WikiaForm")}this.initGenericError();this.initGenericSuccess();this.setInputs();this.inputGroups={};this.el.find("[rel=tooltip]").tooltip()};a.prototype.initGenericError=function(){this.genericError=this.el.find(".general-errors");if(this.genericError.length===0){this.el.find("fieldset").prepend('<div class="input-group general-errors error"><div class="error-msg"></div></div>');this.genericError=this.el.find(".general-errors");this.genericError.hide();this.genericErrorMsg=this.genericError.find(".error-msg")}};a.prototype.initGenericSuccess=function(){this.genericSuccess=this.el.find(".general-success");if(this.genericSuccess.length===0){this.el.find("fieldset").prepend('<div class="input-group general-success success"><div class="success-msg"></div></div>');this.genericSuccess=this.el.find(".general-success");this.genericSuccess.hide();this.genericSuccessMsg=this.genericSuccess.find(".success-msg")}};a.prototype.setInputs=function(){var b,e,d,c;this.inputs={};b=this.el.find("input, select, textarea");for(d=0;d<b.length;d++){e=$(b[d]);c=e.attr("name");if(c){this.inputs[c]=e}}};a.prototype.showGenericError=function(b){this.genericError.show();this.showErrorMsg(this.genericError,b)};a.prototype.showGenericSuccess=function(b){this.genericSuccess.show();this.showSuccessMsg(this.genericSuccess,b)};a.prototype.getInputGroup=function(d){var c,b=this.inputGroups[d];if(!b){b=this.inputs[d].closest(".input-group");if(!b.length){c=this.el.find("input[name="+d+"]");if(c.length!==0){b=c.closest(".input-group")}}if(b.length!==0){this.inputGroups[d]=b}}return b};a.prototype.showInputError=function(c,d){var b=this.getInputGroup(c);if(b){b.addClass("error").removeClass("success");this.showErrorMsg(b,d)}};a.prototype.clearInputError=function(c){var b=this.getInputGroup(c);b.removeClass("error").addClass("success");this.clearErrorMsg(b)};a.prototype.showErrorMsg=function(b,d){var c=b.find(".error-msg");if(!c.length){c='<div class="error-msg"></div>';b.append(c);c=b.find(".error-msg")}c.html(d)};a.prototype.showSuccessMsg=function(c,d){var b=c.find(".success-msg");if(!b.length){b='<div class="success-msg"></div>';c.append(b);b=c.find(".success-msg")}b.text(d)};a.prototype.clearErrorMsg=function(b){b.find(".error-msg").remove()};a.prototype.clearSuccessMsg=function(b){b.find(".success-msg").remove()};a.prototype.clearGenericError=function(b){b.hide().find(".error-msg").remove()};a.prototype.clearGenericSuccess=function(b){b.hide().find(".success-msg").remove()};a.prototype.clearAllInputErrors=function(){for(var b in this.inputGroups){this.clearInputError(b)}};a.prototype.disableAll=function(){$.each(this.inputs,function(){this.attr("disabled",true)})};window.WikiaForm=a})();define("wikia.csspropshelper",["wikia.document"],function(b){var d=["Moz","webkit","ms","O"],a=d.length;function g(j){var h=b.documentElement,k,l=j.length;for(k=0;k<l;k++){var m=j[k];if(m in h.style){return m}}return false}function f(m){var j,h=[m],k=m.charAt(0).toUpperCase()+m.slice(1);for(j=0;j<a;j++){var l=d[j]+k;h.push(l)}return h}function e(o){var k,m=o.split("-"),l=m.length,h=[m[0]];for(k=1;k<l;k++){var j=m[k],n=j.charAt(0).toUpperCase()+j.slice(1);h.push(n)}return h.join("")}function c(l){var j=e(l),k=f(j),h=g(k);if(h===false){throw new Error("Requested CSS property - "+l+" is not supported by your browser!")}return h}return{formatName:e,getSupportedProp:c}});define("wikia.fluidlayout",function(){var s=768,u=1300,t=1030,d=20,m=1,e=170,b=1023,f=300;function j(){return s}function c(){return u}function h(){return d}function p(){return m}function o(){return d/2}function k(){return b}function a(){return t}function l(){return t+2*e}function g(){return e}function n(){return s}function q(){return u+2*e}function r(){return f}return{getMinArticleWidth:j,getMaxArticleWidth:c,getWidthGutter:h,getArticleBorderWidth:p,getWidthPadding:o,getBreakpointSmall:k,getBreakpointContent:a,getBreakpointFluid:l,getBreakpointMin:n,getBreakpointMax:q,getRightRailWidth:r,getAdSkinWidth:g}});define("wikia.breakpointsLayout",function(){var j=768,c=1,h=1238,f=30,m=1064,r=20,p=768,b=24,g=320;function o(s){var t=h-2*f;return s?t:t-g}function l(s){var t=m-2*r;return s?t:t-g}function a(){return p-2*(b+c)}function n(){return r}function d(){return g}function k(){return h}function e(t,s){switch(t){case"current":return l(s);case"max":return o(s);case"min":return a();default:return a()}}function q(){return j}return{getArticleMinWidth:q,getArticlePadding:n,getArticleWidth:e,getLargeContentWidth:k,getRailWidthWithSpacing:d}});!function(b){var a=function(d,c){this.init("tooltip",d,c)};a.prototype={constructor:a,init:function(f,e,d){var g,c;this.type=f;this.$element=b(e);this.options=this.getOptions(d);this.enabled=true;if(this.options.trigger!="manual"){g=this.options.trigger=="hover"?"mouseenter":"focus";c=this.options.trigger=="hover"?"mouseleave":"blur";this.$element.on(g,this.options.selector,b.proxy(this.enter,this));this.$element.on(c,this.options.selector,b.proxy(this.leave,this))}this.options.selector?(this._options=b.extend({},this.options,{trigger:"manual",selector:""})):this.fixTitle()},getOptions:function(c){c=b.extend({},b.fn[this.type].defaults,c,this.$element.data());if(c.delay&&typeof c.delay=="number"){c.delay={show:c.delay,hide:c.delay}}return c},enter:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(!c.options.delay||!c.options.delay.show){return c.show()}clearTimeout(this.timeout);c.hoverState="in";this.timeout=setTimeout(function(){if(c.hoverState=="in"){c.show()}},c.options.delay.show)},leave:function(d){var c=b(d.currentTarget)[this.type](this._options).data(this.type);if(this.timeout){clearTimeout(this.timeout)}if(!c.options.delay||!c.options.delay.hide){return c.hide()}c.hoverState="out";this.timeout=setTimeout(function(){if(c.hoverState=="out"){c.hide()}},c.options.delay.hide)},show:function(){var g,c,j,e,h,d,f;if(this.hasContent()&&this.enabled){g=this.tip();this.setContent();if(this.options.animation){g.addClass("fade")}d=typeof this.options.placement=="function"?this.options.placement.call(this,g[0],this.$element[0]):this.options.placement;c=/in/.test(d);g.remove().css({top:0,left:0,display:"block"}).appendTo(c?this.$element:document.body);if(this.options&&this.options["z-index"]){g.css("z-index",this.options["z-index"])}j=this.getPosition(c);e=g[0].offsetWidth;h=g[0].offsetHeight;switch(c?d.split(" ")[1]:d){case"bottom":f={top:j.top+j.height,left:j.left+j.width/2-e/2};break;case"top":f={top:j.top-h,left:j.left+j.width/2-e/2};break;case"left":f={top:j.top+j.height/2-h/2,left:j.left-e};break;case"right":f={top:j.top+j.height/2-h/2,left:j.left+j.width};break;case"wikiaBar":f={top:j.top-h,right:0};break;case"wikiaBarMessage":f={top:j.top-h,right:0};break}g.css(f).addClass(d).addClass("in")}},isHTML:function(c){return typeof c!="string"||(c.charAt(0)==="<"&&c.charAt(c.length-1)===">"&&c.length>=3)||/^(?:[^<]*<[\w\W]+>[^>]*$)/.exec(c)},setContent:function(){var d=this.tip(),c=this.getTitle();d.find(".tooltip-inner")[this.isHTML(c)?"html":"text"](c);d.removeClass("fade in top bottom left right")},hide:function(){var c=this,d=this.tip();d.removeClass("in");function e(){var f=setTimeout(function(){d.off(b.support.transition.end).remove()},500);d.one(b.support.transition.end,function(){clearTimeout(f);d.remove()})}b.support.transition&&this.$tip.hasClass("fade")?e():d.remove();return this},fixTitle:function(){var c=this.$element;if(c.attr("title")||typeof(c.attr("data-original-title"))!="string"){c.attr("data-original-title",c.attr("title")||"").removeAttr("title")}},hasContent:function(){return this.getTitle()},getPosition:function(c){return b.extend({},(c?{top:0,left:0}:this.$element.offset()),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,c=this.$element,d=this.options;e=c.attr("data-original-title")||(typeof d.title=="function"?d.title.call(c[0]):d.title);return e},tip:function(){return this.$tip=this.$tip||b(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()}};b.fn.tooltip=function(c){return this.each(function(){var f=b(this),e=f.data("tooltip"),d=typeof c=="object"&&c;if(!e){f.data("tooltip",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.tooltip.Constructor=a;b.fn.tooltip.defaults={animation:true,placement:"top",selector:false,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0}}(window.jQuery);!function(b){var a=function(d,c){this.init("popover",d,c)};a.prototype=b.extend({},b.fn.tooltip.Constructor.prototype,{constructor:a,setContent:function(){var e=this.tip(),d=this.getTitle(),c=this.getContent();e.find(".popover-title")[this.isHTML(d)?"html":"text"](d);e.find(".popover-content")[this.isHTML(c)?"html":"text"](c);e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var d,c=this.$element,e=this.options;d=c.attr("data-content")||(typeof e.content=="function"?e.content.call(c[0]):e.content);return d},tip:function(){if(!this.$tip){this.$tip=b(this.options.template)}return this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});b.fn.popover=function(c){return this.each(function(){var f=b(this),e=f.data("popover"),d=typeof c=="object"&&c;if(!e){f.data("popover",(e=new a(this,d)))}if(typeof c=="string"){e[c]()}})};b.fn.popover.Constructor=a;b.fn.popover.defaults=b.extend({},b.fn.tooltip.defaults,{placement:"right",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"></div></div></div>'})}(window.jQuery);var PageHeader={settings:{mouseoverDelay:300,mouseoutDelay:350},init:function(){if(typeof FB!="undefined"&&typeof FB.Event!="undefined"){FB.Event.subscribe("xfbml.render",function(){var a=$(".commentslikes").children(".likes");a.css("width","auto")})}if(typeof $.browser.msie!="undefined"&&typeof $.browser.version!="undefined"&&$.browser.version&&$.browser.version.substring(0,$.browser.version.indexOf("."))<9){GlobalTriggers.bind("fbinit",function(){$(".likes").each(function(){var b=$(this),a=b.html();b.html("").append(a);FB.XFBML.parse(b.get(0))});$().log("fixed like buttons","FB")})}}};var ProfileSyncButton={init:function(){ProfileSyncButton.attachEventListeners()},attachEventListeners:function(){$("a[data-id=syncprofile]").click(function(){window.location.href=$(this).attr("data-href");return false})}};$(function(){PageHeader.init();ProfileSyncButton.init()});WikiaSearchApp=(function(){function a(b){this.id=b;this.searchForm=$(b);this.positionRight=this.searchForm.innerWidth()-this.searchForm.children("input:first-child").outerWidth()+4;this.searchField=this.searchForm.children("input[placeholder]");this.ads=$("[id$='TOP_RIGHT_BOXAD']");if(!this.searchForm.hasClass("noautocomplete")){this.searchField.bind({suggestShow:$.proxy(this.hideAds,this),suggestHide:$.proxy(this.showAds,this)});this.searchField.one("focus",$.proxy(this.initSuggest,this))}}a.prototype.track=Wikia.Tracker.buildTrackingFunction({trackingMethod:"internal"});a.prototype.hideAds=function(){this.ads.each(function(){$(this).children().css("margin-left","-9999px")})};a.prototype.showAds=function(){this.ads.each(function(){$(this).children().css("margin-left","auto")})};a.prototype.initSuggest=function(){$.when($.loadJQueryAutocomplete()).then($.proxy(function(){this.searchField.autocomplete({serviceUrl:wgServer+wgScript+"?action=ajax&rs=getLinkSuggest&format=json",onSelect:$.proxy(function(f,e,d){var c=encodeURIComponent(f.replace(/ /g,"_")),b=wgArticlePath.replace(/\$1/,c).replace(encodeURIComponent("/"),"/");this.track({eventName:"search_start_suggest",sterm:c,rver:0});if(d.button===1||d.metaKey||d.ctrlKey){window.open(b);return false}else{window.location.href=b}},this),appendTo:this.id,deferRequestBy:400,minLength:3,maxHeight:1000,selectedClass:"selected",width:"100%",positionRight:this.positionRight+"px",skipBadQueries:true});if(window.Wikia.newSearchSuggestions){window.Wikia.newSearchSuggestions.setAsMainSuggestions("search")}},this))};return a})();$(function(){new WikiaSearchApp("#WikiaSearch");new WikiaSearchApp("#HeaderWikiaSearch")});var WikiaFooterApp={init:function(){if(window.wgEnableWikiaBarExt){this.footer=$("#WikiaBarWrapper").find(".wikia-bar")}else{this.footer=$("#WikiaFooter")}this.toolbar=this.footer.children(".toolbar");this.windowObj=$(window);this.originalWidth=this.toolbar.width();if(this.toolbar.exists()){if(!(navigator.platform in {iPad:"",iPhone:"",iPod:""}||(navigator.userAgent.match(/android/i)!==null))){this.addScrollEvent();this.addResizeEvent()}this.tcToolbar=new ToolbarCustomize.Toolbar(this.footer.find(".tools"))}},addScrollEvent:function(){WikiaFooterApp.windowObj.off("scroll.FooterAp");WikiaFooterApp.windowObj.on("scroll.FooterAp",WikiaFooterApp.resolvePosition).triggerHandler("scroll")},addResizeEvent:function(){WikiaFooterApp.windowObj.on("resize",WikiaFooterApp.centerBar).triggerHandler("resize")},centerBar:function(){var a=WikiaFooterApp.windowObj.width();if(a<WikiaFooterApp.originalWidth&&WikiaFooterApp.footer.hasClass("float")){WikiaFooterApp.toolbar.css("width",a+10);if(!WikiaFooterApp.toolbar.hasClass("small")){WikiaFooterApp.toolbar.addClass("small")}}else{if(WikiaFooterApp.toolbar.hasClass("small")){WikiaFooterApp.toolbar.css("width",WikiaFooterApp.originalWidth);WikiaFooterApp.toolbar.removeClass("small")}}WikiaFooterApp.resolvePosition()},resolvePosition:function(){if(window.wgIsEditPage){return}var c=WikiaFooterApp.windowObj.scrollTop(),a=c+WikiaFooterApp.windowObj.height(),b=0;if(WikiaFooterApp.footer.offset()){b=WikiaFooterApp.footer.offset().top+WikiaFooterApp.toolbar.outerHeight()}if(a>b&&WikiaFooterApp.footer.hasClass("float")){WikiaFooterApp.footer.removeClass("float");WikiaFooterApp.centerBar()}else{if(a<b&&!WikiaFooterApp.footer.hasClass("float")){WikiaFooterApp.footer.addClass("float");WikiaFooterApp.centerBar()}}}};(function(){window.ToolbarCustomize=window.ToolbarCustomize||{};var a=window.ToolbarCustomize;a.MenuGroup=$.createClass(window.Observable,{showTimer:false,hideTimer:false,showTimeout:300,hideTimeout:350,showing:false,visible:false,constructor:function(){a.MenuGroup.superclass.constructor.call(this);this.showTimer=window.Timer.create($.proxy(this.show,this),this.showTimeout);this.hideTimer=window.Timer.create($.proxy(this.hide,this),this.hideTimeout)},add:function(b){var c=$(b);c.unbind(".menugroup").bind("mouseenter.menugroup",$.proxy(this.delayedShow,this)).bind("mouseleave.menugroup",$.proxy(this.delayedHide,this)).children("a","img").unbind(".menugroup").bind("click.menugroup",$.proxy(this.showOnClick,this))},remove:function(b){$(b).unbind(".menugroup").children("a","img").unbind(".menugroup")},show:function(){this.hideTimer.stop();this.showTimer.stop();if(!this.showing||this.visible===this.showing){return}if(this.visible){this.hide()}if(this.showing){this.visible=this.showing;this.showing=false;this.fire("menushow",this,this.visible,this.visible.children("ul"));this.visible.children("ul").show()}},delayedShow:function(b){this.showing=$(b.currentTarget);if(this.visible){this.show(b)}else{this.hideTimer.stop();this.showTimer.start()}},showOnClick:function(b){b.preventDefault();this.showing=$(b.currentTarget).parent();this.show(b)},hide:function(){this.hideTimer.stop();this.showTimer.stop();if(this.visible){this.fire("menuhide",this,this.visible,this.visible.children("ul"));this.visible.children("ul").hide();this.visible=false}},delayedHide:function(){this.hideTimer.stop();if(this.visible){this.hideTimer.start()}else{if(this.showing){this.showing=false;this.showTimer.start()}}}});a.Toolbar=$.createClass(Object,{el:false,more:false,menuGroup:false,constructor:function(b){a.Toolbar.superclass.constructor.call(this);this.el=b;this.menuGroup=new a.MenuGroup();this.menuGroup.bind("menushow",this.onShowMenu,this);this.initialize()},initialize:function(){this.el.find(".tools-customize").click($.proxy(this.openConfiguration,this));this.menuGroup.add(this.el.find("li.menu"));var b=this;$("body").on("userToolsItemAdded",function(c,d){b.load(d)});require(["wikia.fluidlayout"],function(c){b.handleOverflowMenu(c.getBreakpointSmall(),2*c.getAdSkinWidth(),window.wgOasisResponsive?false:c.getBreakpointSmall())})},openConfiguration:function(b){b.preventDefault();require(["wikia.toolsCustomization"],function(c){new c.ToolsCustomization(this).show();return false})},buildOveflowItem:function(){return this.el.find(".overflow-menu")},generateMediaQuery:function(l,b,k,f,e){var d=true,c="",h=l.length,g=(b>=k),j=false;l.each(function(o,n){var m=$(n).outerWidth(true);if(e!==false&&(b+m>e)){j=true}if(!g&&((b+m)>=k)){g=true;m+=f}c+="@media screen ";if(!d){c+="and (min-width:"+b+"px) "}if(!j){c+="and (max-width:"+(b+m)+"px) "}c+="{ .WikiaBarWrapper .tools > .overflow:nth-of-type(n + "+(o+1)+") { display:none; } .WikiaBarWrapper .tools .overflow-menu {  display: block; }.WikiaBarWrapper .tools .overflow-menu .overflow:nth-of-type(-n + "+(h-o)+") { display:block; }} ";if(j){return false}b+=m;d=false});return c},getMinWidth:function(d){var e=this.el.parents(".wikia-bar:first").find(".arrow"),c=parseInt(this.el.css("padding-left"),10)+parseInt(this.el.css("padding-right"),10)+e.outerWidth(true),b=d.filter(":not(.overflow)");b.each(function(g,f){c+=$(f).outerWidth(true)});return c},generateSubMenu:function(e){var b=e.last().next(),d=this.buildOveflowItem(),c=d.children("ul").empty();if(b.exists()){b.before(d)}else{this.el.append(d)}e.each(function(g,f){$(f).clone().prependTo(c)});this.menuGroup.add(d,$.proxy(this.onShowMenu,this))},addStyles:function(d){var c="WikiaFooterMediaQueries",b='<style id="'+c+'" type"text/css">'+d+"</style>";$("#"+c).remove();$("head").append(b)},handleOverflowMenu:function(b,e,f){var d=this.el.children("li"),g=d.filter(".overflow"),c=this.getMinWidth(d);this.addStyles(this.generateMediaQuery(g,c,b,e,f));this.generateSubMenu(g)},onShowMenu:function(c,b,d){d.css("left",(b.offset().left-this.el.offset().left)+"px");d.css("right","auto")},load:function(b){this.el.children("li").not(".loadtime").remove();this.el.prepend($(b));this.initialize()}})})();$(function(){WikiaFooterApp.init()});var WikiaButtons={settings:{delay:350},init:function(a){if(typeof a=="object"){WikiaButtons.menuButtons=$(".wikia-menu-button",a)}else{WikiaButtons.menuButtons=$(".wikia-menu-button")}WikiaButtons.timer=null;WikiaButtons.add(WikiaButtons.menuButtons)},add:function(d,b){var c={click:WikiaButtons.click};var a=$.extend({},c,b||{});d.unbind(".wikiabutton").one("mouseover.wikiabutton",WikiaButtons.setup).bind("mouseenter.wikiabutton",WikiaButtons.mouseover).bind("mouseleave.wikiabutton",WikiaButtons.mouseout);d.filter(".combined").bind("click.wikiabutton",a.click);d.not(".combined").find(".drop").bind("click.wikiabutton",a.click)},setup:function(){$(this).data("menu",$(this).find("ul"))},click:function(c){var a=$(this).closest(".wikia-menu-button");if(!a.attr("disabled")){if(c.target.tagName!=="A"){var b=a.outerWidth();if(b!==a.data("prevWidth")){a.data("prevWidth",b);var d=a.data("menu");b=b-(parseInt(d.css("padding-left"))+parseInt(d.css("padding-right"))+parseInt(d.css("border-left-width"))+parseInt(d.css("border-right-width")));d.css("min-width",b)}a.toggleClass("active")}}else{c.preventDefault();return false}},mouseover:function(){clearTimeout(WikiaButtons.timer)},mouseout:function(b){var a=$(b.target).closest(".wikia-menu-button").attr("data-delay");if((typeof a)!="string"){a=WikiaButtons.settings.delay}WikiaButtons.timer=setTimeout(function(){$(b.currentTarget).removeClass("active")},a)}};$(function(){WikiaButtons.init()});(function(b,c){var a=Wikia.isTouchScreen(),d={lastSubnavClicked:-1,isDisplayed:false,activeL1:null,editformSubmitAllowed:false,settings:{mouseoverDelay:a?0:200,mouseoutDelay:a?0:350},log:function(e){c().log(e,"WikiHeader")},init:function(g){var j=false;this.nav=c("#WikiHeader > nav");this.navLI=this.nav.find(".nav-item");this.subnav2=this.nav.find(".subnav-2");this.subnav2LI=this.subnav2.find(".subnav-2-item");this.subnav3=this.nav.find(".subnav-3");this.positionNav();this.nav.on("mouseenter",".nav-item",c.proxy(this.mouseoverL1,this)).on("mouseleave",".nav-item",c.proxy(this.mouseoutL1,this)).on("click",".nav-item",c.proxy(this.mouseclickL1,this)).on("focus",".nav-item > a",c.proxy(function(l){this.showSubNavL2(c(l.target).parent("li"))},this));this.nav.on("mouseenter",".subnav-2-item",c.proxy(this.mouseoverL2,this)).on("mouseleave",".subnav-2-item",c.proxy(this.mouseoutL2,this)).on("click",".subnav-2-item",c.proxy(this.mouseclickL2,this)).on("focus",".subnav-2-item > a",c.proxy(function(l){this.hideNavL3();this.showSubNavL3(c(l.target).parent("li"))},this));this.nav.on("mousedown",".subnav-3 a",function(){j=true}).on("mouseup",".subnav-3 a",function(){j=false}).on("focus",".subnav-3 a",c.proxy(function(l){if(!j){this.hideNavL3();this.showSubNavL3(c(l.currentTarget).closest(".subnav").parent("li"))}},this)).on("focusout",".subnav-3:last-child > li:last-child a",c.proxy(this.hideNavL3,this));if((b.wgIsWikiNavMessage)&&(b.wgAction==="edit")){c("#wpSave").hide();c("#editform").submit(function(l){if(!d.editformSubmitAllowed){l.stopImmediatePropagation();return false}});c("#wpSummary").bind("keypress",function(l){if(l.keyCode===13&&!d.editformSubmitAllowed){l.stopImmediatePropagation()}})}c(document).mouseout(c.proxy(function(l){if(this.isDisplayed){var m=l.relatedTarget||l.toElement;if(!m||m.nodeName==="HTML"){this.hideNavL3()}}},this));if(!g){var h,e,k=this.subnav2LI.height(),f=0;this.subnav2.each(function(l){h=c(this);if(h.height()>k){e=h.children("li").reverse();if(l>0){h.css("visibility","hidden").show()}e.each(function(){var m=c(this),n=m.position();if(n.top===0){return false}else{m.remove();f++}});if(l>0){h.css("visibility","visible").hide()}}});if(f>0){this.log("items removed: "+f)}}},mouseclickL1:function(g){var f=c(g.target),e;if(!c(g.currentTarget).hasClass("marked")){g.preventDefault();this.subnav2LI.removeClass("marked2");this.navLI.removeClass("marked");this.hideNavL3();c(g.currentTarget).addClass("marked");e=this.subnav2.not();if(c("body").data("accessible")){e.css("top","-9999px")}else{e.hide()}this.activeL1=g.currentTarget;this.showSubNavL2(g.currentTarget)}if(f.is("a")&&f.attr("data-canonical")==="chat"){g.preventDefault();b.ChatWidget.onClickChatButton(f.attr("href"))}},mouseoverL1:function(f){var e=f.currentTarget;if(this.activeL1===e){return}this.mouseoverTimer=setTimeout(c.proxy(function(){this.navLI.removeClass("marked");this.hideNavL3();c(e).addClass("marked");var g=this.subnav2.not();if(c("body").data("accessible")){g.css("top","-9999px")}else{g.hide()}this.activeL1=e;this.showSubNavL2(e)},this),this.settings.mouseoverDelay)},mouseoutL1:function(){clearTimeout(this.mouseoverTimer)},mouseclickL2:function(f){var e=this.subnav3.not(c(f.currentTarget).find(".subnav"));if(c(f.currentTarget).find(".subnav").exists()&&!c(f.currentTarget).hasClass("marked2")){this.hideNavL3();f.preventDefault();c(f.currentTarget).addClass("marked2");if(c("body").data("accessible")){e.css("top","-9999px")}else{e.hide()}this.showSubNavL3(f.currentTarget)}},mouseoverL2:function(f){var e=f.currentTarget;clearTimeout(this.mouseoutTimer);this.mouseoverTimer=setTimeout(c.proxy(function(){var g=this.subnav3.not(c(e).find(".subnav"));if(c("body").data("accessible")){g.css("top","-9999px")}else{g.hide()}c(e).siblings().removeClass("marked2");this.showSubNavL3(e)},this),this.settings.mouseoverDelay)},mouseoutL2:function(){clearTimeout(this.mouseoverTimer);this.mouseoutTimer=setTimeout(c.proxy(function(){this.hideNavL3()},this),this.settings.mouseoutDelay)},showSubNavL2:function(e){var f=c(e).children("ul");if(f.exists()){f.show()}},showSubNavL3:function(e){var f=c(e).children("ul");if(f.exists()){c(e).addClass("marked2");this.isDisplayed=true;f.css("top",this.navtop).show()}},hideNavL3:function(){this.isDisplayed=false;this.lastSubnavClicked=-1;this.subnav2LI.removeClass("marked2");if(c("body").data("accessible")){this.subnav3.css("top","-9999px")}else{this.subnav3.hide()}},positionNav:function(){this.navtop=this.nav.height()-7},firstMenuValidator:function(){var g=0,f=true,e=c(".ArticlePreview #WikiHeader > nav > ul > li");e.reverse().each(c.proxy(function(h,k){var j=c(k),l=j.position();if(l.top===0){return false}else{f=false;this.log("menu level #1 not valid")}},this));e.each(function(h,j){g+=c(j).width()});if(g>550){f=false;this.log("menu level #1 not valid")}return f},secondMenuValidator:function(){var h=0,f=true,g=c("#WikiaPage").width()-280,e=c(".ArticlePreview #WikiHeader .subnav-2");c.each(e,c.proxy(function(j,k){var l=c(k);l.show();c.each(l.children("li"),function(){h+=c(this).width()});l.hide();if(h>g){f=false;this.log("menu level #2 not valid")}h=0},this));e.eq(0).show();return f}};c(function(e){d.init();if(b.wgIsWikiNavMessage){e.getMessages("Oasis-navigation-v2").done(function(){e(b).bind("EditPageAfterRenderPreview",function(j,g){g.removeClass("WikiaArticle");d.init(true);var h=d.firstMenuValidator(),k=d.secondMenuValidator(),f=!!g.find("nav > ul").attr("data-parse-errors"),l=[];if(f){l.push(e.msg("oasis-navigation-v2-magic-word-validation"))}if(!h&&!k){l.push(e.msg("oasis-navigation-v2-level12-validation"))}else{if(!h){l.push(e.msg("oasis-navigation-v2-level1-validation"))}else{if(!k){l.push(e.msg("oasis-navigation-v2-level2-validation"))}}}if(l.length>0){e("#publish").remove();new b.BannerNotification(l.join("</br>"),"error",e(".modalContent .ArticlePreview")).show()}else{d.editformSubmitAllowed=true}g.find("nav > ul a").click(function(){if(e(this).attr("href")==="#"){return false}});g.find(".msg > a").click(function(){b.location=this.href})})});e(b).bind("EditPagePreviewClosed",function(){d.editformSubmitAllowed=false});e(b).bind("EditPageRenderPreview",function(g,f){f.width=(e("#WikiaPage").width()-271)+32});e("#wpPreview").parent().removeClass("secondary");e("#EditPageMain").addClass("editpage-wikianavmode")}})})(this,jQuery);var WikiaNotificationsApp={purgeCurrentPage:function(){$.post(wgScript,{action:"purge",title:wgPageName})},track:Wikia.Tracker.buildTrackingFunction({category:"sitewidemessages",trackingMethod:"analytics"}),init:function(){var a=this,b=$("#WikiaNotifications");b.find(".close-notification").click(function(e){var g=$(this).parent();var f=parseInt(g.attr("data-type"));switch(f){case 1:$.post(wgScript,{action:"ajax",rs:"wfDismissWikiaNewtalks"},WikiaNotificationsApp.purgeCurrentPage);g.parent().remove();break;case 2:$.post(wgScript,{action:"ajax",rs:"CommunityMessagesAjax",method:"dismissMessage"},WikiaNotificationsApp.purgeCurrentPage);g.parent().remove();break;case 5:var d=parseInt(g.attr("id").substr(4));var h=g.next();$.post(wgScript,{title:"Special:SiteWideMessages",action:"dismiss",mID:d},WikiaNotificationsApp.purgeCurrentPage);a.track({action:Wikia.Tracker.ACTIONS.CLICK_LINK_BUTTON,browserEvent:e,label:"swm-dismiss",value:d});g.remove();h.css("display","block");if(h.length){var c=parseInt(h.attr("id").substr(4));a.track({action:Wikia.Tracker.ACTIONS.IMPRESSION,label:"swm-impression",value:c})}break;case 10:$.post($(this).attr("data-url"),WikiaNotificationsApp.purgeCurrentPage);g.parent().remove();break;default:g.parent().remove();break}})}};$(function(){WikiaNotificationsApp.init()});(function(b){var a={scrollThreshold:30,lastScroll:0,init:function(){b(window).scroll(b.proxy(this.analyze,this)).mousedown(b.proxy(this.cancelTimer,this))},analyze:function(){if(window.getSelection().toString()){var c=b(window).scrollTop();if(c>this.lastScroll+this.scrollThreshold){this.adjust()}this.lastScroll=c}},adjust:function(){b(window).scrollTop(b(window).scrollTop()+this.scrollThreshold);this.anchorOffset=window.getSelection().anchorOffset;if(!this.timer){this.timer=setInterval(this.monitorHighlight,250)}},monitorHighlight:function(){if(window.getSelection().anchorOffset!=this.anchorOffset){if(this.timer){this.adjust()}}},cancelTimer:function(){if(this.timer){clearInterval(this.timer);this.timer=null}}};if(b.browser.mozilla){b(function(){if(b("#WikiaFooter .toolbar").exists()){a.init()}})}}(jQuery));jQuery(function(a){a("body").on("click",".tabs a",function(b){if(a(this).parent().hasClass("disabled")){return}var c=a(this).parent().data("tab");if(a('[data-tab-body="'+c+'"]').length>0){b.preventDefault();var d=a(this).closest("ul").find(".selected").removeClass("selected").data("tab");a(this).closest("li").addClass("selected");a('[data-tab-body="'+d+'"]').removeClass("selected");a('[data-tab-body="'+c+'"]').addClass("selected");a(window).trigger("wikiaTabClicked",[c])}else{a().log('Tried to switch to tab but could not find data-tab-body: "'+c+'"')}})});jQuery(function(f){var e=f("body"),a=f("#WikiaArticle"),l=f("#WikiaRail"),c=f("#WikiHeader"),g=f(".WikiaArticleInterlang"),d=/&diff=\d+/,j=/&action=history/,b,h,m;b=Wikia.Tracker.buildTrackingFunction({action:Wikia.Tracker.ACTIONS.CLICK,trackingMethod:"analytics"});h=function(n){if(window.veTrack&&n.data.label==="section-edit"){veTrack({action:(f("#ca-ve-edit").exists()?"ve-section-edit":"other-section-edit")+"-click"})}if(n.type==="mousedown"&&n.which!==1){return}b({browserEvent:n},n.data)};m=(function(){var n=Array.prototype.slice;return function(){var p=window.WikiaEditor&&WikiaEditor.getInstance(),o=Wikia.Tracker.track;if(p&&(!p.config.isMiniEditor||p.plugins.MiniEditor.hasFocus)){o=WikiaEditor.track}o.apply(o,n.call(arguments))}})();(function(){f("#WikiaPageHeader").on("mousedown","a",function(p){var n,o=f(p.currentTarget),q=o.data("id");if(p.which!==1){return}if(window.veTrack){if(q==="edit"){veTrack({action:"other-edit-click"})}if(q==="ve-edit"){veTrack({action:"ve-edit-click"})}}switch(q){case"createpage":n="add-a-page";break;case"comment":n=o.hasClass("talk")?"talk":"comment";break;case"share":case"edit":n=q;break;case"delete":case"history":case"move":case"protect":case"flags":n="edit-"+q;break}if(n!==undefined){b({browserEvent:p,category:"title-area",label:n})}})})();(function(){var n="article";if(e.hasClass("ns-special")){return}a.on("mousedown","a",function(q){var o,p=f(q.currentTarget);if(q.which!==1){return}if(p.hasClass("video")){o="video"}else{if(p.hasClass("image")){o="image"}else{if(p.parents(".infobox, .wikia-infobox").length>0){o="infobox"}else{if(p.hasClass("external")){o="link-external"}else{if(p.hasClass("wikia-photogallery-add")){o="add-photo-to-gallery"}else{if(p.prop("className")===""){o="link-internal"}}}}}}if(o!==undefined){b({browserEvent:q,category:n,label:o})}}).on("mousedown",".editsection a",{category:n,label:"section-edit"},h);f("#articleCategories").on("mousedown","a",{category:n,label:"category-name"},h).on("mousedown",".add",{category:n,label:"add-category"},h)})();(function(){var n="category";a.on("mousedown",".category-gallery a",{category:n,label:"category-gallery"},h);f("#mw-pages").on("mousedown","a",{category:n,label:"category-item"},h)})();(function(){var o=f(".alliance-module",a),p="Alliance",n,q;if(o.length){o.on("mousedown","a",function(r){q="-click";if(f(this).attr("href").indexOf("http://www.wikia.com/Alliance")!==-1){q="-logo-click"}n=f(r.delegateTarget).attr("data-label");if(n!==undefined){n+=q;b({category:p,label:n})}});o.each(function(){q="-impression";n=f(this).attr("data-label");if(n!==undefined){n+=q;b({action:Wikia.Tracker.ACTIONS.IMPRESSION,category:p,label:n})}})}})();c.find(".buttons .contribute").on("mousedown","a",function(p){var n,o=f(p.target),q=o.data("id");if(p.which!==1){return}switch(q){case"createpage":n="add-a-page";break;case"edit":n="edit-a-page";break;case"upload":n="add-a-photo";break;case"wikiavideoadd":n="add-a-video";break;case"wikiactivity":n="wiki-activity";break;case"wikinavedit":n="edit-wiki-navigation";break}if(n!==undefined){b({browserEvent:p,category:"contribute",label:n})}});if(e.hasClass("page-Special_RecentChanges")){a.on("mousedown","a",function(q){var p=f(q.target),o=p.attr("data-action"),n=p.attr("href");if(q.which!==1){return}if(!o){if(d.test(n)){o="diff"}else{if(j.test(n)){o="history"}else{if(p.hasClass("mw-userlink")){o="username"}else{if(!p.parent().is("span")){o="title"}}}}}if(o!==undefined){b({browserEvent:q,category:"recent-changes",label:o})}})}a.find(".diff-header").on("mousedown","a",function(p){var n=f(p.target),o=n.attr("data-action");if(o){b({browserEvent:p,category:"oasis-diff",label:o})}});(function(){var t="search",n=false,u=f(".top-wiki-articles"),s=f(".exact-wiki-match"),r=f(".fandom-stories"),q=f(".category-articles"),p=f(".search-tracking"),o=f(".results-wrapper .no-result");if(e.hasClass("page-Special_Search")){t="special-search"}p.on("mousedown",".autocomplete",{category:t,label:"search-suggest"},h).on("mousedown",".wikia-button",function(w){if(w.which===1&&w.clientX>0){var v=!n?"search-button":"search-after-suggest-button";b({category:t,label:v})}}).on("keypress","[name=search]",function(w){if(w.which===13&&f(this).is(":focus")){var v=!n?"search-enter":"search-after-suggest-enter";b({category:t,label:v})}}).on("suggestEnter",{category:t,label:"search-suggest-enter"},h).one("suggestShow",{action:Wikia.Tracker.ACTIONS.VIEW,category:t,label:"search-suggest-show"},function(v){n=true;h(v)});if(e.hasClass("page-Special_Search")){if(o.length){b({action:Wikia.Tracker.ACTIONS.VIEW,category:t,label:"empty-page"})}p.on("mousedown",".search-tabs a",function(v){b({browserEvent:v,category:t,label:"sidebar-"+f(v.currentTarget).prop("className")})}).on("mousedown",".Results .result-link",function(x){var w=f(x.currentTarget),v="result-"+(w.data("event")==="search_click_match"?"push-top":"item-"+w.data("pos"));b({browserEvent:x,category:t,label:v})}).on("mousedown",".Results .wiki-thumb-tracking",function(x){var w=f(x.currentTarget),v="result-item-"+w.data("pos")+"-image"+(w.data("event")==="search_click_wiki-no-thumb"?"-placeholder":"");b({browserEvent:x,category:t,label:v})}).on("mousedown",".thumb-tracking",function(x){var w=f(x.currentTarget),v="result-item-image-"+(w.data("event")==="search_click_match"?"push-top":w.data("pos"));b({browserEvent:x,category:t,label:v})}).on("mousedown",".image",function(x){var v=f(x.currentTarget),w="result-"+(v.hasClass("video")?"video":"photo")+((v.parents(".video-addon-results").length>0)?"-video-addon":"");b({browserEvent:x,category:t,label:w})}).on("mousedown",".video-addon-seach-video",function(v){b({browserEvent:v,category:t,label:"video-addon-results-header"})})}if(s.length){b({action:Wikia.Tracker.ACTIONS.IMPRESSION,category:t,label:"exact-wiki-match"});s.on("mousedown","a",function(w){var v=f(w.currentTarget);b({browserEvent:w,category:t,label:"exact-wiki-match-"+v.data("event")})})}if(r.length){b({action:Wikia.Tracker.ACTIONS.IMPRESSION,category:t,label:"fandom-stories"});r.on("mousedown",".fandom-story-link",function(v){b({browserEvent:v,category:t,label:"fandom-story-link-"+f(v.currentTarget).data("pos")})}).on("mousedown",".fandom-story-image",function(v){b({browserEvent:v,category:t,label:"fandom-story-image-"+f(v.currentTarget).data("pos")})})}if(u.length){b({action:Wikia.Tracker.ACTIONS.IMPRESSION,category:t,label:"top-wiki-articles"});u.on("mousedown",".top-wiki-article-link",function(v){b({browserEvent:v,category:t,label:"top-wiki-article-link-"+f(v.currentTarget).data("pos")})}).on("mousedown",".top-wiki-article-image",function(v){b({browserEvent:v,category:t,label:"top-wiki-article-image-"+f(v.currentTarget).data("pos")})})}if(q.length){q.on("mousedown",".category-articles-thumb a",function(w){var v=f(w.currentTarget);b({browserEvent:w,category:t,label:"category-module-thumb-"+v.data("pos")})}).on("mousedown",".category-articles-text a",function(w){var v=f(w.currentTarget);b({browserEvent:w,category:t,label:"category-module-title-"+v.data("pos")})})}})();f("#RelatedForumDiscussion").on("mousedown","a",function(p){var n,o=f(p.target);if(p.which!==1){return}if(o.hasClass("forum-thread-title")){n="title"}else{if(o.hasClass("forum-new-post")){n="start-discussion"}else{if(o.parent().hasClass("forum-see-more")){n="see-more"}}}if(n!==undefined){b({browserEvent:p,category:"thread-module",label:n})}});f("#WikiaBarWrapper").on("mousedown",".toolbar a",function(q){var o,p=f(q.target),n=p.data("name");if(q.which!==1){return}switch(n){case"customize":case"follow":case"history":case"whatlinkshere":o=n;break;default:o="custom";break}if(o!==undefined){b({browserEvent:q,category:"toolbar",label:o})}});(function(){var n="top-nav";f("#wall-notifications-markasread").on("mousedown","span",function(q){var o,p=f(q.target),r=p.attr("id");if(q.which!==1){return}switch(r){case"wall-notifications-markasread-this-wiki":case"wall-notifications-markasread-all-wikis":o=r;break}if(o!==undefined){b({browserEvent:q,category:n,label:o})}})})();if(e.hasClass("page-Special_WikiActivity")){a.find(".activityfeed").on("mousedown","a",function(r){var n,q,p=f(r.target),o=p.parent();if(r.which!==1){return}if(p.hasClass("title")){n="title"}else{if(p.hasClass("username")||p.hasClass("real-name")||o.hasClass("wall-owner")||o.hasClass("subtle")){n="username"}else{if(o.hasClass("activityfeed-diff")){n="diff"}else{q=p.closest("tr").data("type");if(q==="inserted-image"){n="thumbnail-photo"}else{if(q==="inserted-video"){n="thumbnail-video"}}}}}if(n!==undefined){b({browserEvent:r,category:"wiki-activity",label:n})}})}c.on("mousedown","a",function(q){var o,p=f(q.target),n;if(q.which!==1){return}if(p.closest(".wordmark").length>0){o="wordmark"}else{if(p.closest(".WikiNav").length>0){n=p.data("canonical");if(n!==undefined){switch(n){case"wikiactivity":o="on-the-wiki-activity";break;case"random":o="on-the-wiki-random";break;case"newfiles":case"images":o="on-the-wiki-new-photos";break;case"chat":o="on-the-wiki-chat";break;case"forum":o="on-the-wiki-forum";break;case"videos":o="on-the-wiki-videos";break}}else{if(p.attr("href")==="/d/f"){o="on-the-wiki-discussions"}else{if(p.parent().hasClass("nav-item")){o="custom-level-1"}else{if(p.hasClass("subnav-2a")){o="custom-level-2"}else{if(p.hasClass("subnav-3a")){o="custom-level-3"}}}}}}}if(o!==undefined){b({browserEvent:q,category:"wiki-nav",label:o})}});g.on("click","a",function(){var n=f(this).data("tracking");b({category:"interwiki-links",label:n})});function k(){l.find(".chat-module").on("mousedown",".start-a-chat-button",{category:"chat-module",label:"chat-join"},h);l.find("#ForumRelatedThreadsModule").on("mousedown","a",function(o){var n=o.target.getAttribute("data-tracking");if(o.which!==1){return}if(n){b({browserEvent:o,category:"related-threads-module",label:n})}});l.find("#ForumActivityModule").on("mousedown","a",function(o){var n=o.target.getAttribute("data-tracking");if(o.which!==1){return}if(n){b({browserEvent:o,category:"forum-activity-module",label:n})}});l.find("#wikia-recent-activity .page-title-link, #wikia-recent-activity .edit-info-user").on("mousedown",function(o){var n=o.target.getAttribute("data-tracking");if(o.which!==1){return}if(n){b({browserEvent:o,category:"recent-wiki-activity-module",label:n})}})}Wikia.trackEditorComponent=m;Wikia.initRailTracking=k});define("wikia.onScroll",["jquery","wikia.window"],function(f,e){var a=[],c=5;function h(j){if(typeof j==="function"){a.push(j)}}function d(k){var j=a.indexOf(k);if(j>-1){a.splice(j,1)}}function b(j){a.forEach(function(k){k(j)})}function g(){e.addEventListener("scroll",f.throttle(c,b))}return{bind:h,unbind:d,init:g}});require(["wikia.onScroll"],function(a){a.init()});define("wikia.toolsCustomization",["wikia.window","wikia.browserDetect","jquery","wikia.ui.factory","mw","BannerNotification"],function(e,f,c,k,h,a){e.ToolbarCustomize=e.ToolbarCustomize||{};var g=e.ToolbarCustomize,d=false,b=e.wgBlankImgUrl,j=new a().setType("error");d=f.isIPad();g.OptionsTree=c.createClass(e.Observable,{constructor:function(l){g.OptionsTree.superclass.constructor.call(this);this.el=l;if(!d){this.el.sortable({axis:"y",handle:".drag",opacity:0.8,update:c.proxy(this.updateLevels,this)})}},updateLevels:function(){var l=this.el.children("li"),n=0,m;l.removeClass("list-item-indent-1");l.each(function(o,p){if(c(p).hasClass("list-item-menu")){n++}else{if(n>0){c(p).addClass("list-item-indent-"+n)}}});this.el.find(".tree-visual").remove();m=this.el.children("li.list-item-indent-1");m.prepend('<span class="tree-visual tree-line"></span><span class="tree-visual tree-dash"></span>');m.last().find(".tree-visual").remove();m.last().prepend('<span class="tree-visual tree-line-last"></span><span class="tree-visual tree-dash"></span>');this.fire("update",this)},buildItem:function(p,q){var o=(p.id.substr(0,5)==="Menu:")?"menu":"item",l=q?"list-item-indent-"+q:"",n,m;if(o==="menu"){l+=" list-item-menu"}n='<li data-tool-id="'+c.htmlentities(p.id)+'" data-default-caption="'+c.htmlentities(p.defaultCaption)+'" data-caption="'+c.htmlentities(p.caption)+'"'+(l?' class="'+l+'"':"")+">";if(o==="menu"){n+='<img src="'+b+'" class="folder-icon" height="16" width="16" />'}n+='<span class="name">'+c.htmlentities(p.caption)+"</span>";if(o==="item"){n+=this.addIcons()}n+="</li>";m=c(n);this.fire("itembuild",this,p,m);return m},addIcons:function(){var l=['<img src="'+b+'" class="sprite edit-pencil">','<img src="'+b+'" class="sprite trash">'];if(!d){l.push('<img src="'+b+'" class="sprite drag">')}return l.join("")},loadLevel:function(m,n){var l;for(l=0;l<m.length;l++){this.el.append(this.buildItem(m[l],n));if(m[l].items){this.loadLevel(m[l].items,n+1)}}},load:function(l){this.el.empty();this.loadLevel(l,0);this.updateLevels()},save:function(){var m=this.el.children("li"),l=[[]],n=0;m.each(function(p,q){q=c(q);var r={id:q.attr("data-tool-id"),defaultCaption:q.attr("data-default-caption"),caption:q.attr("data-caption")};l[n].push(r);if(q.hasClass("list-item-menu")){n=1;r.items=[];r.isMenu=true;l[n]=r.items}});return l[0]},update:function(){this.updateLevels()},add:function(m,o){var l=this.buildItem(m,o||0),n;if(o===0){n=this.el.children(".list-item-menu");if(n){n.before(l)}else{this.el.append(l)}}else{this.el.append(l)}this.scrollToItem(l);this.updateLevels()},scrollToItem:function(o){var m=this.el.scrollTop(),p=o.offset().top-this.el.offset().top,l=this.el.innerHeight()-o.outerHeight(),n=0;if(p>l){n=p-l}if(p<0){n=p}if(n!==0){this.el.scrollTop(m+n)}}});g.OptionLinks=c.createClass(e.Observable,{constructor:function(l){g.OptionLinks.superclass.constructor.call(this);this.el=l},onItemClick:function(l){l.preventDefault();this.fire("itemclick",this,c(l.target).attr("data-tool-id"));return false},buildItem:function(n){var m='<li><a href="#" data-tool-id="'+c.htmlentities(n.id)+'">'+c.htmlentities(n.defaultCaption)+"</a></li>",l=c(m);l.find("a").click(c.proxy(this.onItemClick,this));return l},load:function(m){var l;this.el.empty();for(l=0;l<m.length;l++){this.el.append(this.buildItem(m[l]))}}});g.Toggle=c.createClass(Object,{constructor:function(n,m,l){this.target=n;this.buttons=m;this.cls=l;this.state=false;this.hide();this.buttons.bind("click.toggle",c.proxy(this.toggle,this))},hide:function(){this.target.hide();this.buttons.hide();this.buttons.filter("."+this.cls).show()},show:function(){this.target.show();this.buttons.hide();this.buttons.not("."+this.cls).show()},toggle:function(l){if(c(l.currentTarget).hasClass(this.cls)){this.show()}else{this.hide()}}});g.Configuration=c.createClass(Object,{toolbar:false,data:false,w:false,tree:false,popular:false,toggle:false,constructor:function(l){g.Configuration.superclass.constructor.call(this);this.toolbar=l},show:function(){c.when(c.loadJQueryAutocomplete(),c.loadJQueryUI(),c.getResources([c.getSassCommonURL("extensions/wikia/UserTools/styles/UserTools.scss")]),c.nirvana.sendRequest({controller:"UserTools",method:"ToolbarConfiguration",callback:c.proxy(this.onDataLoaded,this)})).done(c.proxy(this.checkLoad,this)).fail(c.proxy(this.onLoadFailure,this))},onDataLoaded:function(l){this.data=l},onLoadFailure:function(l,n,m){j.setContent(m).show()},checkLoad:function(){var l=this;k.init(["modal"]).then(function(o){var n=l.data.messages,m={vars:{id:"MyToolsConfigurationWrapper",size:"small",content:l.data.configurationHtml,title:n["user-tools-edit-title"],buttons:[{vars:{value:n["user-tools-edit-save"],classes:["button","primary"],data:[{key:"event",value:"save"}]}},{vars:{value:n["user-tools-edit-cancel"],data:[{key:"event",value:"close"}]}}]}};o.createComponent(m,function(s){l.w=s.$content;l.modal=s;var r=l.w.find(".options-list"),p=l.w.find(".popular-tools-group"),q=l.w.find(".search");l.tree=new g.OptionsTree(r);if(d){r.addClass("on-ipad")}else{r.addClass("no-ipad")}l.tree.on("itembuild",c.proxy(l.initItem,l));l.tree.load(l.data.options);l.w.find(".reset-defaults a").click(c.proxy(l.loadDefaults,l));q.placeholder();q.pluginAutocomplete({lookup:l.getAutocompleteData(),onSelect:c.proxy(l.addItemFromSearch,l),selectedClass:"selected",appendTo:l.w.find(".search-box"),width:"300px",maxHeight:"auto"});l.w.find(".advanced-tools a").attr("target","_blank");l.popular=new g.OptionLinks(l.w.find(".popular-list"));l.popular.load(l.data.popularOptions);l.popular.on("itemclick",c.proxy(l.addPopularOption,l));l.toggle=new g.Toggle(p.children(".popular-list"),p.children(".popular-toggle"),"toggle-1");l.w.find(".popular-toggle").click(c.proxy(l.togglePopular,l));s.bind("save",function(t){t.preventDefault();s.deactivate();l.save(s)});s.show()})})},getAutocompleteData:function(){var l=[],o=[],n=this.data.allOptions.length,m;for(m=0;m<n;m++){l.push(this.data.allOptions[m].caption);o.push(this.data.allOptions[m].id)}return{suggestions:l,data:o}},findOptionByName:function(n){var m=this.data.allOptions.length,l;for(l=0;l<m;l++){if(this.data.allOptions[l].id===n){return this.data.allOptions[l]}}return false},findOptionByCaption:function(l){var n=this.data.allOptions.length,m;for(m=0;m<n;m++){if(this.data.allOptions[m].caption===l){return this.data.allOptions[m]}}return false},addItemFromSearch:function(n,m){var l=this.findOptionByName(m);if(l){this.tree.add(l,0)}this.w.find(".search").val("")},addPopularOption:function(n,m){var l=this.findOptionByName(m);if(l){this.tree.add(l,0)}return false},loadDefaults:function(){this.tree.load(this.data.defaultOptions);return false},initItem:function(l,n,m){if(d){m.click(function(o){l.el.children().removeClass("hover");c(o.currentTarget).addClass("hover")})}m.find(".edit-pencil").click(c.proxy(this.renameItem,this));m.find(".trash").click(c.proxy(this.deleteItem,this))},renameItem:function(n){var m=this,l=c(n.currentTarget).closest("li");n.preventDefault();k.init(["modal"]).then(function(q){var p=m.data.messages,o={vars:{id:"MyToolsRenameItem",size:"small",content:m.data.renameItemHtml,title:p["user-tools-edit-rename"],buttons:[{vars:{value:p["user-tools-edit-save"],classes:["button","primary"],data:[{key:"event",value:"save"}]}},{vars:{value:p["user-tools-edit-cancel"],data:[{key:"event",value:"close"}]}}]}};q.createComponent(o,function(r){var s=r.$content.find(".input-box");s.val(l.data("caption"));r.bind("save",function(t){t.preventDefault();var u=s.val();l.attr("data-caption",u);l.find(".name").text(u);r.trigger("close")});r.show()})});return false},deleteItem:function(l){c(l.currentTarget).closest("li").remove();this.tree.update();return false},save:function(m){var l=this.tree.save();c.nirvana.sendRequest({controller:"UserTools",method:"ToolbarSave",data:{title:e.wgPageName,toolbar:l,token:h.user.tokens.get("editToken")},callback:c.proxy(function(o,n){this.afterSave(m,o,n)},this)})},afterSave:function(n,m,l){n.activate();if(l==="success"){c("body").trigger("userToolsItemAdded",[m.toolbar]);this.modal.trigger("close")}else{j.setContent(l).show()}}});e.ToolbarCustomize=g;return{ToolsCustomization:g.Configuration}});var WeppyImpl;(function(H){var h=3,C=".",b="::",l=false,f={host:"/weppy",transport:"url",active:true,sample:0.01,aggregationInterval:1000,maxInterval:5000,decimalPrecision:3,page:"index",context:{},debug:false},k=+(new Date),v,y,g,A,d=function(){return window.performance&&window.performance.now?window.performance.now():+(new Date)},n=function(){if(f.debug){if(typeof f.debug==="function"){f.debug.apply(window,arguments)}else{window.console&&window.console.log&&window.console.log.apply?window.console.log.apply(window.console,arguments):void 0}}},B=function(){window.console&&window.console.error&&window.console.error.apply&&window.console.error.apply(window.console,arguments)};function E(J,I){if(I===void 0){I=f.decimalPrecision}return Math.round(J*Math.pow(10,I))/Math.pow(10,I)}function c(K,I,J){if(J===void 0){J=C}return K+((K!=""&&I!="")?J:"")+I}function x(){l=f.active&&Math.random()<f.sample}function z(K,I){var J;if(K&&I){for(J in I){if(I.hasOwnProperty(J)){K[J]=I[J]}}}return K||I}function q(L){var K=Object.keys(L).sort(),J,I={};for(J=0;J<K.length;J++){I[K[J]]=L[K[J]]}return JSON.stringify(I)}(function(I){I[I.Counter=0]="Counter";I[I.Gauge=1]="Gauge";I[I.Timer=2]="Timer"})(H.MetricType||(H.MetricType={}));var a=H.MetricType;var G=(function(){function I(){this.clear()}I.prototype.clear=function(){this.all={};this._empty=true};I.prototype.empty=function(){return this._empty};I.prototype.add=function(J,L,N,M){var K=this.find(J,M);if(N){K.count=K.count||0;K.count++;K.value+=(L-K.value)/K.count;K.rollingAverage=true}else{K.value+=L}this._empty=false};I.prototype.find=function(J,N){var K=N?q(N):false,L=this.all[J]=this.all[J]||{},M;if(K){L=L.annotated=L.annotated||{};L=L[K]=L[K]||{}}M=L.data=L.data||{value:0};return M};I.prototype.get=function(){var J={},R,K,Q,O,L,P,N;function M(S,T,U){if(T){R=T.value;if(T.rollingAverage){R=E(R)}K=[R];if(U){K.push(U)}J[S].push(K)}}Q=Object.keys(this.all);for(P=0;P<Q.length;P++){J[Q[P]]=[];O=this.all[Q[P]].data;L=this.all[Q[P]].annotated;if(O){M(Q[P],O,null)}if(L){for(N in L){if(L.hasOwnProperty(N)){M(Q[P],L[N].data,JSON.parse(N))}}}}return J};return I})();v=new G();function t(J,I,K,L){var M;if(!l){return}M=J!=0;v.add(I,K,M,L);o()}function o(){clearTimeout(y);y=setTimeout(j,f.aggregationInterval);if(!g){g=setTimeout(j,f.maxInterval)}}function D(){clearTimeout(y);clearTimeout(g);y=null;g=null}function j(){var J,I;D();if(v.empty()){return}if(!l){n("Weppy: would send queue but inactive");return}if(!window.JSON||!JSON.stringify){v.clear();return}J=v.get();v.clear();I={context:f.context,data:J};n("Weppy: sending",I);m(I)}function m(J){var I;if(typeof f.transport=="function"){f.transport(J);return}I=f.host+"/v"+h+"/send";if(f.transport=="url"){I+="?p="+encodeURIComponent(JSON.stringify(J));F(I,null)}else{if(f.transport=="post"){F(I,JSON.stringify(J))}}}function F(J,M){var K=window.XMLHttpRequest&&(XMLHttpRequest.defake||(new XMLHttpRequest()).withCredentials),N=true,I,L,O;I=/^(https?:\/\/[^\/]+)/i.exec(J);if(I&&I[1]!=document.location.protocol+"//"+document.location.host){N=false}if(!N&&!K&&window.XDomainRequest){L=new XDomainRequest()}else{L=new XMLHttpRequest()}O=M==null?"text/plain":"application/json";L.weppy=L.bucky={track:false};L.open("POST",J,true);L.setRequestHeader("Content-Type",O);L.send(M);return L}var s=(function(){function I(K,J){this._root=K;this._path=J;this.timer=new r(this)}I.prototype.namespace=function(J,K){return new I(J,K||"")};I.prototype.into=function(J){return new I(this._root,c(this._path,J))};I.prototype.key=function(J){return c(this._root,c(this._path,J),b)};I.prototype.send=function(K,J,L,M){J=this.key(J);t(K,J,L,M);n("Weppy: queued",{type:a[K],name:J,value:L,annotations:M})};I.prototype.count=function(J,K,L){if(K===void 0){K=1}this.send(0,J,K,L)};I.prototype.store=function(J,K,L){this.send(1,J,K,L)};I.prototype.flush=function(){j()};I.prototype.setOptions=function(K){var J;for(J in K){if(K.hasOwnProperty(J)){f[J]=K[J]}}if("sample" in K||"active" in K){x()}};I.prototype.sendPagePerformance=function(){var K,J,N,Q,M,P,O={},L;if(!window.performance||!window.performance.timing||A){return false}K=this;J=document.readyState;if(J=="uninitialized"||J=="loading"){if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){K.sendPagePerformance()},false)}return false}A=true;N=window.performance.timing;Q=N.navigationStart;for(M in N){P=N[M];if(P&&typeof P=="number"){O[M]=(P-Q)}}delete O.navigationStart;L=f.page;K.namespace("PAGELOAD").timer.send(L,Q,O);return true};return I})();H.Namespace=s;var r=(function(){function I(J){this._namespace=J;this.PARTIALS={}}I.prototype.send=function(J,L,K){this._namespace.send(2,J,L,K)};I.prototype.start=function(J,K){this.PARTIALS[J]=[d(),K];return new w(this,J)};I.prototype.stop=function(J,L){var K;if(!this.PARTIALS[J]){B("Timer "+J+" ended without having been started");return}K=d()-this.PARTIALS[J][0];L=z(L,this.PARTIALS[J][1]);this.PARTIALS[J]=false;this.send(J,K,L)};I.prototype.annotate=function(J,K){if(!this.PARTIALS[J]){B("Timer "+J+" received annotation without having been started");return}this.PARTIALS[J][1]=K};I.prototype.time=function(M,O,N,L,P){var K=this,J=function(Q){K.stop(M,Q)};this.start(M,P);L=L?L.slice(0):[];L.splice(0,0,J);return O.apply(N,L)};I.prototype.timeSync=function(L,N,M,K,O){var J;this.start(L,O);J=N.apply(M,K);this.stop(L);return J};I.prototype.wrap=function(K,M,L,N){var O=this;var J=this;return function(){return J.timeSync(K,M,L||O,arguments,N)}};I.prototype.mark=function(J,K){this.send(J,d()-this.navigationStart(),K)};I.prototype.navigationStart=function(){return(window.performance&&window.performance.timing&&window.performance.timing.navigationStart)||k};return I})();H.NamespaceTimer=r;var w=(function(){function I(K,J){this._timer=K;this.name=J}I.prototype.stop=function(J){this._timer.stop(this.name,J)};I.prototype.annotate=function(J){this._timer.annotate(this.name,J)};return I})();H.Timer=w;function p(K,J,I){return I?function(){return u(K.apply(J,arguments))}:function(){return K.apply(J,arguments)}}function u(J){var K=(function(L){return L?K.into(L):K}),I;for(I in J){if(typeof J[I]=="function"){K[I]=p(J[I],J,I=="into"||I=="namespace")}else{K[I]=J[I]}}return K}function e(){return u(new s("",""))}H.getRootObject=e;x()})(WeppyImpl||(WeppyImpl={}));var Weppy=WeppyImpl.getRootObject();(function(a){a.Bucky=a.Weppy;if(a.define&&a.define.amd){a.define("bucky",[],function(){return a.Weppy});a.define("weppy",[],function(){return a.Weppy})}$(function(){var b=$.extend({},a.wgWeppyConfig,{context:a.wgTransactionContext});Weppy.setOptions(b);$(a).on("load",function(){setTimeout(function(){Weppy.sendPagePerformance()},0)})})})(window);define("bucky.resourceTiming",["jquery","wikia.window","wikia.log","bucky"],function(f,g,e,l){var m=0,k=/^https?:\/\/([^\/]+)(\.wikia-dev\.(us|pl|com)|\.wikia\.com|\.wikia\.nocookie\.net)\//;function b(){return("performance" in g)&&(typeof g.performance.getEntriesByType==="function")}function h(n){return k.test(n)}function j(n){var o=n.match(/\/\/([^/]+)/);return !!o&&o[1].split(".").slice(-2).join(".")}function a(o,n){e(o+": "+JSON.stringify(n),e.levels.debug,"ResourceTiming")}function d(o){var r,p,s,t,q={};function u(w){q[w]={count:0,time:0}}function v(w){if(typeof q[w]==="undefined"){u(w)}}function n(w,x){if(typeof q[w]!=="undefined"){q[w].count++;q[w].time+=x}}["total","cached","dns","dns-cached","3rdparty","css","link","iframe","img","script","xmlhttprequest"].map(function(w){u(w)});for(s=o.length;m<s;m++){t=o[m];if(h(t.name)){n(t.initiatorType,t.duration);r=t.domainLookupStart?t.domainLookupEnd-t.domainLookupStart:false;if(r!==false){if(r===0){n("dns-cached",r)}else{n("dns",r)}a("DNS",{dnsTime:r,url:t.name})}if(t.duration===0){n("cached",0)}}else{n("3rdparty",t.duration);p=j(t.name);if(p){a(p,t.duration);v("domain-"+p);n("domain-"+p,t.duration)}}n("total",t.duration)}return q}function c(o){var q,s,n,r,p;p=d(g.performance.getEntriesByType("resource")||[]);r=l("resource_timing::"+o);a("Sending stats",o);r.flush();for(q in p){for(n in p[q]){s=Math.round(p[q][n]);if(s>=0){r.store(q+"."+n,s);a(q+"."+n,s)}}}}return{isSupported:b,isWikiaAsset:h,getDomain:j,reportToBucky:c}});require(["jquery","wikia.geo","wikia.window","bucky.resourceTiming"],function(c,d,b,a){c(function(){var e=b.wgTransactionContext||{};e.country=d.getCountryCode();e.url=b.location.href.split("#")[0];e.userAgent=b.navigator.userAgent;e.os=b.navigator.platform;e.bodySize=document.getElementsByTagName("body")[0].innerHTML.length});if(!a.isSupported()){return}c(function(){a.reportToBucky("DomReady")});c(b).on("load",function(){a.reportToBucky("WindowLoad");setTimeout(function(){a.reportToBucky("AfterWindowLoad")},5000)})});define("wikia.scrollToLink",["wikia.window","wikia.querystring","wikia.history","jquery"],function(g,a,f,e){function c(h){var j=e(h).offset().top;return j|0}function b(h,j){var k=c(h);g.setTimeout(function(){g.scrollTo(g.pageXOffset,k+j)},1)}function d(h,j){j=j||0;var k=a().sanitizeHref(h),m=g.document,l;if(!!k){l=m.getElementById(k);if(!!l){b(l,j);return f.pushState({},m.title,g.location.pathname+"#"+k)}}return false}return{handleScrollTo:d,scrollToElement:b}});$(function(c){var b=Wikia.Tracker.buildTrackingFunction({action:Wikia.Tracker.ACTIONS.CLICK,category:"navigation",trackingMethod:"analytics"}),a=Wikia.Tracker.buildTrackingFunction({action:Wikia.Tracker.ACTIONS.CLICK,category:"footer",trackingMethod:"analytics"});function d(e,f){c(e).click(function(h){var g=c(h.target).closest("a, button").data("tracking-label")||false;if(g!==false){f({label:g})}})}d(".wds-global-navigation",b);d(".wds-global-footer",a)});$(function(b){var a="is-clicked";if(window.Wikia.isTouchScreen()){b("body").on("touchstart",".wds-dropdown",function(c){if(!b(this).hasClass(a)){b(this).addClass(a);c.preventDefault()}}).on("mouseleave",".wds-dropdown",function(){b(this).removeClass(a)})}});require(["wikia.scrollToLink","wikia.window","jquery","wikia.browserDetect"],function(f,c,b,a){var d=0;function e(g){if(f.handleScrollTo(c.location.hash,d)||a.isIOS7orLower()){g.preventDefault();return false}}c.GlobalNavigationScrollToElement=function(g){f.scrollToElement(g,d)};b(function(){var j=b(c),h=10,g=b("#globalNavigation").outerHeight(true);d=-(g+h);j.on("hashchange load",e)})});$(function(b){function a(){var c=this.url.replace(/.*?redirect=([^&]+).*/,"$1");window.location.href=decodeURIComponent(c)}b("#global-navigation-anon-sign-in, #global-navigation-anon-register").click(function(d){var c=d.currentTarget.href;if(d.which!==1||d.shiftKey||d.altKey||d.metaKey||d.ctrlKey){return}d.preventDefault();b(d.currentTarget).closest(".wds-dropdown").removeClass("wds-is-active");window.wikiaAuthModal.load({url:c,origin:"global-nav",onAuthSuccess:a.bind({url:c})})})});$(function(g){var c=g(".wds-global-navigation"),f=c.find(".wds-global-navigation__search-input"),e=c.find(".wds-global-navigation__search-submit"),b=f.attr("placeholder"),h="wds-search-is-active";function d(){if(!c.hasClass(h)){c.addClass(h);f.attr("placeholder",f.data("active-placeholder"));g(this).click()}}function a(){e.prop("disabled",true);c.removeClass(h);f.attr("placeholder",b).val("")}f.on("focus",d);f.on("input",function(){var j=this.value.length;if(j>0&&e.prop("disabled")){e.prop("disabled",false)}else{if(j===0){e.prop("disabled",true)}}});f.on("keydown",function(j){if(j.which===27){this.blur();a()}});c.find(".wds-global-navigation__search-close").on("click",a);if(f.is(":focus")){d()}if(f.val().length===0){e.prop("disabled",true)}});$(function(){var c=$("#searchInput"),b=$("#searchInputWrapper"),a=c.data("suggestions-url");function d(){mw.loader.using("jquery.autocomplete").then(function(){var e=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g");c.on({suggestShow:function(){b.addClass("wds-is-active")},suggestHide:function(){b.removeClass("wds-is-active")}}).autocomplete({serviceUrl:a,queryParamName:c.data("suggestions-param-name"),appendTo:".wds-global-navigation__search-input-wrapper",deferRequestBy:200,minLength:3,maxHeight:1000,onSelect:function(k,j,h){var g=encodeURIComponent(k.replace(/ /g,"_")),f=window.wgArticlePath.replace(/\$1/,g).replace(encodeURIComponent("/"),"/");window.Wikia.Tracker.track({eventName:"search_start_suggest",sterm:g,rver:0,trackingMethod:"internal"});if(h.button===1||h.metaKey||h.ctrlKey){window.open(f);return false}else{window.Wikia.Tracker.track({action:Wikia.Tracker.ACTIONS.CLICK,category:"navigation",trackingMethod:"analytics",label:c.data("suggestions-tracking-label")});window.location.href=f}},selectedClass:"wds-is-selected",skipBadQueries:true,setPosition:false,suggestionWrapperElement:"li",fnContainerMarkup:function(g,f){return'<div id="'+g+'" class="wds-dropdown__content wds-global-navigation__search-suggestions"><ul id="'+f+'" class="wds-list wds-has-ellipsis wds-is-linked"></ul></div>'},fnFormatResult:function(j,h,f){var g="("+f.replace(e,"\\$1")+")";return'<a class="wds-global-navigation__dropdown-link">'+j.replace(new RegExp(g,"gi"),"<strong>$1</strong>")+"</a>"}})})}if(a){c.one("focus",d);if(c.is(":focus")){d()}}});(function(b){var a=function(d){function c(e,f){this.$el=e;if(f){d.extend(this.settings,f)}this.cleanUp();this.render()}c.prototype={settings:{marginLeft:-3,maxLines:2,wordsHidden:1},cleanUp:function(){this.$el.find(".ellipses").remove()},render:function(){var k=this.$el.text(),l=k.split(" "),j=l.length,f,h,p=0,m=this.settings.maxLines,e,g=null,o,n;n=this;for(f=0;f<j;f++){l[f]="<span>"+l[f]+"</span>"}this.$el.html(l.join(" "));h=this.$el.find("span");for(f=0;f<h.length;f++){e=d(h[f]);o=e.offset().top;if(g===null){g=o}else{if(p===m){e.hide()}else{if(g!==o){p+=1;g=o}if(p===m){e.hide().prevUntil(":nth-child( "+(f-n.settings.wordsHidden)+" )").hide().eq(0).before('<span class="ellipses" style="">...</span>');n.trim()}}}}},trim:function(){var e,f;e=this.$el.find(".ellipses");f=e.prev("span");e.css({marginLeft:this.settings.marginLeft});if(f.text()==="-"){f.hide()}}};d.fn.ellipses=function(e){return this.each(function(){var f=d(this);f.data("ellipses",new c(f,e))})}};a(b.jQuery)})(this);var CreatePage={pageLayout:null,options:{},loading:false,context:null,wgArticlePath:mw.config.get("wgArticlePath"),redlinkParam:"",flowName:"",canUseVisualEditor:function(){return mw.libs&&mw.libs.ve?mw.libs.ve.canCreatePageUsingVE():false},checkTitle:function(b,a){$.getJSON(CreatePage.context.wgScript,{action:"ajax",rs:"wfCreatePageAjaxCheckTitle",title:b},function(c){var e;var d=(CreatePage.flowName==="")?"":"&flow="+CreatePage.flowName;if(c.result==="ok"){CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.SUCCESS,label:"open-editor"});if(CreatePage.canUseVisualEditor()&&mw.libs.ve.isInValidNamespace(b)){e=CreatePage.wgArticlePath.replace("$1",encodeURIComponent(b));location.href=e+"?veaction=edit"+CreatePage.redlinkParam+d}else{location.href=CreatePage.options[CreatePage.canUseVisualEditor()?"blank":CreatePage.pageLayout].submitUrl.replace("$1",encodeURIComponent(b))+CreatePage.redlinkParam+d}CreatePage.flowName=""}else{CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.ERROR,label:c.error});CreatePage.displayError(c.msg,a)}})},requestDialog:function(c,a){var b,d;if(Boolean(window.WikiaEnableNewCreatepage)===false){return}if(c&&c.which===2){return}if(c&&c.preventDefault){c.preventDefault()}if(CreatePage.canUseVisualEditor()&&$(c.target).hasClass("createboxButton")){CreatePage.checkTitle(a);return}if(false===CreatePage.loading){CreatePage.loading=true;if(CreatePage.canUseVisualEditor()&&a){b="wfCreatePageAjaxGetVEDialog";d=CreatePage.openVEDialog}else{b="wfCreatePageAjaxGetDialog";d=CreatePage.openDialog}$.getJSON(CreatePage.context.wgScript,{action:"ajax",rs:b,article:a},d)}},openVEDialog:function(b){var a="redlink-page-create-title-modal";require(["wikia.ui.factory"],function(c){c.init(["modal"]).then(function(e){var d={vars:{id:"CreatePageModalDialog",size:"small",title:b.title,content:b.html,classes:["modalContent"],buttons:[{vars:{value:b.addPageLabel,classes:["normal","primary"],data:[{key:"event",value:"create"}]}},{vars:{value:b.cancelLabel,classes:["normal","secondary"],data:[{key:"event",value:"cancel"}]}}]}};e.createComponent(d,function(f){CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.IMPRESSION,label:"modal"});f.bind("create",function(){CreatePage.submitDialog(a)});f.bind("cancel",function(g){g.stopPropagation();CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.CLICK,label:"cancel"});f.trigger("close")});f.$blackout.add(f.$close).on("click",function(g){if(g.target===g.delegateTarget){CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.CLOSE,label:"close"})}});CreatePage.loading=false;f.show()})})})},openDialog:function(b){var a="page-create-title-modal";require(["wikia.ui.factory"],function(c){c.init(["modal"]).then(function(e){var d={vars:{id:"CreatePageModalDialog",size:"medium",title:b.title,content:b.html,classes:["modalContent"],buttons:[{vars:{value:b.addPageLabel,classes:["normal","primary"],data:[{key:"event",value:"create"}]}}]}};e.createComponent(d,function(j){var n,m,h,g,f,l=false,k;CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.IMPRESSION,label:"modal"});k=j.$element.find(".create-page-dialog__proposals .new");if(k.length){CreatePage.track({category:"page-create-title-modal",action:Wikia.Tracker.ACTIONS.IMPRESSION,label:"redlinks"});k.on("click",function(){CreatePage.track({category:"page-create-title-modal",action:Wikia.Tracker.ACTIONS.CLICK,label:"redlink"})})}j.bind("create",function(o){o.preventDefault();l=false;CreatePage.submitDialog(a)});j.bind("cancel",function(o){o.stopPropagation();CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.CLICK,label:"cancel"});j.trigger("close")});h=function(){CreatePage.setPageLayout($(this).data("optionName"))};for(g in CreatePage.options){n=g.charAt(0).toUpperCase()+g.substring(1);m=$("#CreatePageDialog"+n+"Container");m.data("optionName",g);m.click(h)}f=b.article;if(typeof f==="number"){f=f.toString()}if(f){$("#wpCreatePageDialogTitle").val(decodeURIComponent(f))}CreatePage.setPageLayout(b.defaultOption);$("#wpCreatePageDialogTitle").focus().on("change type keypress",function(){if(!l){l=true;CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.KEYPRESS,label:"title"})}});if(CreatePage.canUseVisualEditor()){$("#CreatePageDialogChoose, #CreatePageDialogChoices").hide()}CreatePage.loading=false;j.show()})})})},submitDialog:function(a){CreatePage.track({category:a,action:Wikia.Tracker.ACTIONS.SUBMIT,label:"submit"});CreatePage.checkTitle($("#wpCreatePageDialogTitle").val(),a)},displayError:function(b,c){var a=$("#CreatePageDialogTitleErrorMsg");a.html('<span id="createPageErrorMsg">'+b+"</span>");a.find("a").click(function(){CreatePage.track({category:c,action:Wikia.Tracker.ACTIONS.CLICK,label:"conflict-link"})});a.removeClass("hiddenStructure")},setPageLayout:function(a){CreatePage.pageLayout=a;var b=a.charAt(0).toUpperCase()+a.substring(1);$("#CreatePageDialog"+b).attr("checked","checked");$("#CreatePageDialogChoices").children("li").removeClass("accent");$("#CreatePageDialog"+b+"Container").addClass("accent")},getTitleFromUrl:function(a){var b=new mw.Uri(a);return b.path.replace(CreatePage.wgArticlePath.replace("$1",""),"").replace(/_/g," ")},redLinkClick:function(f,a){var g=new mw.Title.newFromText(decodeURIComponent(a)),b=g.getNamespacePrefix().replace(":",""),d=$("html").hasClass("ve-activated"),c=CreatePage.getRedLinkFlowName();CreatePage.redlinkParam="&redlink=1";CreatePage.flowName=c;if(CreatePage.canUseVisualEditor()){CreatePage.track({category:"article",action:Wikia.Tracker.ACTIONS.CLICK,label:"ve-redlink-click"})}if(d||mw.config.get("wgNamespaceIds")[b.toLowerCase()]&&window.ContentNamespacesText&&window.ContentNamespacesText.indexOf(g[0])===-1){return false}else{CreatePage.requestDialog(f,a)}},init:function(b){CreatePage.context=b;$(".createpage").click(function(){CreatePage.trackCreatePageStart(window.wgFlowTrackingFlows.CREATE_PAGE_CONTRIBUTE_BUTTON);CreatePage.flowName=window.wgFlowTrackingFlows.CREATE_PAGE_CONTRIBUTE_BUTTON});if(window.WikiaEnableNewCreatepage){$().log("init","CreatePage");if(!window.WikiaDisableDynamicLinkCreatePagePopup){$("#dynamic-links-write-article-link, #dynamic-links-write-article-icon").click(function(d){CreatePage.requestDialog(d,null)});$('.noarticletext a[href*="redlink=1"]').click(function(d){CreatePage.requestDialog(d,CreatePage.context.wgPageName);return false})}$(".createpage").click(CreatePage.requestDialog);var a=$("#add_recipe_tab"),c;if(a.exists()){c=a.find("a");if(c.attr("href").match(/CreatePage$/)){c.click(CreatePage.requestDialog)}}$("#WikiaArticle").on("click","a.new",function(d){CreatePage.redLinkClick(d,CreatePage.getTitleFromUrl(this.href))});$(".createboxButton").bind("click",function(j){var d=$(j.target).parent(),g,h,f;if(d.attr("class")==="createboxForm"){g=d.children("input[name='prefix']").val()||"";h=d.children(".createboxInput");f=d.children("input[name='preload']");if((typeof f.val()==="undefined")||(f.val()==="")){CreatePage.flowName=window.wgFlowTrackingFlows.CREATE_PAGE_CREATE_BOX;CreatePage.requestDialog(j,g+h.val())}else{return true}}})}},getRedLinkFlowName:function(){return mw.config.get("wgNamespaceNumber")===-1?window.wgFlowTrackingFlows.CREATE_PAGE_SPECIAL_REDLINK:window.wgFlowTrackingFlows.CREATE_PAGE_ARTICLE_REDLINK},trackCreatePageStart:function(a){require(["wikia.flowTracking"],function(b){b.beginFlow(a,{})})},track:function(b){var a;if(Wikia.Tracker&&b.category){a={trackingMethod:"analytics"};$.extend(a,b);Wikia.Tracker.track(a)}}};jQuery(function(){CreatePage.init(window)});define("wikia.videoBootstrap",["wikia.loader","wikia.nirvana","wikia.log","wikia.tracker"],function videoBootstrap(b,e,c,d){var f=0;function a(k,q,h){var r=this,p=q.init,m=q.html,j=q.scripts,o=q.jsParams;this.element=k;this.clickSource=h;this.title=q.title;this.provider=q.provider;this.width=q.width;this.height=q.height;function n(){if(m&&!q.htmlPreloaded){k.innerHTML=m}}function l(){n();if(p){require([p],function(s){r.clearTimeoutTrack();s(o,r)})}}function g(){var t,s=[];for(t=0;t<j.length;t++){s.push({type:b.JS,resources:j[t]})}b.apply(b,s).done(l)}if(j){g()}else{n()}if(!p){r.timeoutTrack()}}a.prototype={reload:function(o,l,m,g){var k=this.element,h=o||this.title,j=g||this.clickSource,n=l||this.width;this.clearTimeoutTrack();e.getJson("VideoHandler","getEmbedCode",{fileTitle:h,width:n,autoplay:m?1:0}).done(function(p){return new a(k,p.embedCode,j)})},track:function(g){c("tracking "+g,3,"VideoBootstrap");d.track({action:g,category:"video-player-stats",label:this.provider,trackingMethod:"analytics",value:0},{title:this.title,clickSource:this.clickSource})},timeoutTrack:function(){var g=this;this.clearTimeoutTrack();f=setTimeout(function(){g.track("content-begin")},3000)},clearTimeoutTrack:function(){c("clearing tracking timeout",3,"VideoBootstrap");clearTimeout(f)},timeStampId:function(j){var g=document.getElementById(j),h=j+"-"+new Date().getTime();if(g){g.id=h}return h},destroy:function(){this.element.innerHTML=""}};return a});(function(c,d){var b,a,e;b={cache:{articleMedia:[],wikiPhotos:[],videosModule:[],details:{},share:{},to:0},inlineVideoLinks:d(),lightboxLoading:false,inlineVideoLoading:[],videoInstance:null,pageAds:d("#TOP_RIGHT_BOXAD"),reloadOnClose:false,lightboxSettings:{id:"LightboxModal",className:"LightboxModal",width:970,noHeadline:true,topOffset:25,height:628,videoHeight:360,onClose:function(){d(c).off(".Lightbox");Lightbox.openModal.find(".video-media").children().remove();b.lightboxLoading=false;Lightbox.updateUrlState(true);Lightbox.current.thumbs=[];Lightbox.current.thumbTypesAdded=[];Lightbox.to=b.cache.to;Lightbox.ads.adMediaProgress=[];Lightbox.ads.adMediaShown=0;Lightbox.ads.adMediaShownSinceLastAd=0;Lightbox.ads.adIsShowing=false;b.pageAds.css("visibility","visible");Lightbox.clearTrackingTimeouts();if(b.videoInstance){b.videoInstance.clearTimeoutTrack()}if(b.reloadOnClose){c.location.reload()}}},videoThumbWidthThreshold:400,init:function(l){var h=this,k,n,g,f,m,j;e=c.Bucky("LightboxLoader");e.timer.start("init");k=d("#WikiaArticle");n=d("#WikiaArticleComments");g=d("#WikiaArticleFooter");f=d(".videos-module-rail");m=d("#latest-videos-wrapper");j=d("#recommendations");d.extend(h.lightboxSettings,l);k.add(g).add(f).add(j).off(".lightbox").on("click.lightbox",".lightbox, a.image",function(r){var s=d(this),w=s.find("img").first(),t=w.attr("data-image-key")||w.attr("data-video-key"),q,o,u,v,p;if(!b.hasLightbox(s,w,r)){return}r.preventDefault();if(s.closest(m).length){q=m}else{if(s.closest(k).length){q=k}else{if(s.closest(n).length){q=n}else{if(s.closest(j).length){q=j}else{if(s.closest("#videosModule").length){q=d("#videosModule")}}}}}u={target:s,parent:q};if(s.hasClass("wikia-slideshow-popout")){v=s.parents(".wikia-slideshow-toolbar").siblings(".wikia-slideshow-images-wrapper").find("li:visible").find("img").first();t=v.attr("data-image-name")||v.attr("data-video-name")}if(!t){t=s.attr("data-image-name")||s.attr("data-video-name");t=t?t.replace(/ /g,"_"):t}if(!t){Wikia.log("No file key found on this image or video",3,"LightboxLoader");return}o=s.children(".play-circle").length;if(o&&w.width()>=h.videoThumbWidthThreshold&&!s.hasClass("force-lightbox")){p=c.wgWikiaHubType?a.clickSource.HUBS:a.clickSource.EMBED;b.displayInlineVideo(s,w,t,p);return}h.loadLightbox(t,u)});k.off(".slideshowLightbox").on("click.slideshowLightbox",".wikia-slideshow-images .thumbimage, .wikia-slideshow-images .wikia-slideshow-image",function(p){var o=d(this);if(b.hasLightbox(o,null,p)){p.preventDefault();o.closest(".wikia-slideshow-wrapper").find(".wikia-slideshow-popout").click()}});e.timer.stop("init");setTimeout(b.loadFromURL,0)},loadLightbox:function(f,g){var h,m,j,k,l;e.timer.start("loadLightbox");b.removeInlineVideos();b.lightboxLoading=true;b.pageAds.css("visibility","hidden");h=d("<div>").makeModal(b.lightboxSettings);h.find(".modalContent").startThrobbing();m={key:f,modal:h};d.extend(m,g);j=[];if(!b.assetsLoaded){j.push(d.loadMustache());k=[d.getSassCommonURL("/extensions/wikia/Lightbox/styles/Lightbox.scss"),c.wgExtensionsPath+"/wikia/Lightbox/scripts/Lightbox.js"];j.push(d.getResources(k));l=d.Deferred();d.nirvana.sendRequest({controller:"Lightbox",method:"lightboxModalContent",type:"GET",format:"html",data:{lightboxVersion:c.wgStyleVersion,userLang:c.wgUserLanguage},callback:function(n){b.templateHtml=n;l.resolve()}});j.push(l)}j.push(b.getMediaDetailDeferred({fileTitle:f}));d.when.apply(this,j).done(function(){b.assetsLoaded=true;Lightbox.initialFileDetail=arguments[arguments.length-1];Lightbox.makeLightbox(m);e.timer.stop("loadLightbox")})},displayInlineVideo:function(k,h,g,f){var j=this;if(d.inArray(g,b.inlineVideoLoading)>-1){return}b.inlineVideoLoading.push(g);b.getMediaDetail({fileTitle:g,isInline:true,height:h.height(),width:h.width()},function(n){var m=n.videoEmbedCode,l=d('<div class="inline-video"></div>').insertAfter(k.hide()),o;k.closest(".article-thumb").addClass("inline-video-playing");require(["wikia.videoBootstrap"],function(p){j.videoInstance=new p(l[0],m,f)});b.inlineVideoLinks=k.add(b.inlineVideoLinks);a.inlineVideoTrackingTimeout=setTimeout(function(){a.track(Wikia.Tracker.ACTIONS.VIEW,"video-inline",null,{title:n.title,provider:n.providerName,clickSource:f})},1000);o=d.inArray(g,b.inlineVideoLoading);b.inlineVideoLoading.splice(o,1)},true)},removeInlineVideos:function(){clearTimeout(a.inlineVideoTrackingTimeout);b.inlineVideoLinks.show().parent().removeClass("inline-video-playing").end().next().remove()},getMediaDetail:function(f,j,g){var h=f.fileTitle;if(!g&&b.cache.details[h]){j(b.cache.details[h])}else{e.timer.start("getMediaDetail.request");d.nirvana.sendRequest({controller:"Lightbox",method:"getMediaDetail",type:"get",format:"json",data:f,callback:function(k){e.timer.stop("getMediaDetail.request");if(!g){b.cache.details[h]=k}j(k)}})}},getMediaDetailDeferred:function(g){var f=d.Deferred();b.getMediaDetail(g,function(h){f.resolve(h)});return f},loadFromURL:function(){var g=c.Wikia.Querystring().getVal("file"),h=d("#LightboxModal"),f;if(g){if(h.length){b.getMediaDetail({fileTitle:g},function(j){Lightbox.current.key=j.title.replace(/ /g,"_");Lightbox.current.type=j.mediaType;Lightbox.setCarouselIndex();Lightbox.openModal.carousel.find("li").eq(Lightbox.current.index).click()})}else{f={parent:d("#WikiaArticle"),clickSource:a.clickSource.SHARE};b.loadLightbox(g,f)}}else{if(h.length){h.closeModal()}}},hasLightbox:function(f,j,h){var g=40;return !(d(c).width()<b.lightboxSettings.width+g||f.hasClass("link-internal")||f.hasClass("link-external")||j&&j.attr("data-shared-help")||f.hasClass("no-lightbox")||h.metaKey||h.ctrlKey)}};a={inlineVideoTrackingTimeout:0,track:function(j,f,h,g){Wikia.Tracker.track({action:j,category:"lightbox",label:f||"",trackingMethod:"analytics",value:h||0},g)},clickSource:{EMBED:"embed",SEARCH:"search",SV:"specialVideos",LB:"lightbox",SHARE:"share",HUBS:"hubs",OTHER:"other",VIDEOS_MODULE_RAIL:"railVideosModule",VIDEO_HOME_PAGE:"videoHomePage"}};d(function(){if(c.wgEnableLightboxExt){b.init()}});c.LightboxLoader=b;c.LightboxTracker=a})(window,jQuery);define("wikia.ImgLzy",["jquery","wikia.log","wikia.window","wikia.thumbnailer"],function(f,e,b,a){var d;function c(g){e(g,e.levels.info,"ImgLzy")}d={cache:[],timestats:0,init:function(){var h=f.proxy(this.checkAndLoad,this),g=f.throttle(250,h);this.$scroller=f(".scroller");this.createCache();this.checkAndLoad();f(window).on("scroll",g);this.$scroller.on("scroll",g);f(document).on("tablesorter_sortComplete",h);c("initialized")},relativeTop:function(g){return g.offset().top-g.parents(".scroller").offset().top},absTop:function(g){return g.offset().top},createCache:function(){var g=this;g.cache=[];f("img.lzy").each(function(){var k=f(this),j=g.$scroller.find(this),h,l;if(j.length){j=j.parents(".scroller");h=g.relativeTop}else{j=f(window);h=g.absTop}l=h(k);g.cache.push({el:this,$el:k,topCalc:h,top:l,bottom:k.height()+l,$parent:j})})},verifyCache:function(){if(!this.cache.length){return}var m=this.cache.length-1,h=Math.floor(Math.random()*m),l=[m,h],n=false,j,g,o,k;for(j in l){g=l[j];if(g in this.cache){o=this.cache[g].topCalc(this.cache[g].$el);k=Math.abs(o-this.cache[g].top);if(k>5){n=true;break}}}if(n){this.createCache()}},load:function(j){var h=f(j),g=h.data("src");j.onload="";if(g){j.src=g}h.removeClass("lzy").removeClass("lzyPlcHld")},parentVisible:function(h){if(h.$parent[0]===window){return true}var g=f(window).scrollTop()+f(window).height(),j=h.$parent.offset().top;return g>j},checkAndLoad:function(){this.verifyCache();var o=function(){this.setAttribute("class",this.getAttribute("class")+" lzyLoaded")},n,l,m,h,j,g,k;for(h in this.cache){g=this.cache[h];n=g.$parent.scrollTop();l=Math.min(n,1000)*3+200;m=n+g.$parent.height()+l;n=n-l;j=(n<g.top&&m>g.top)||(n<g.bottom&&m>g.bottom);if(j&&this.parentVisible(g)){g.$el.addClass("lzyTrns");g.el.onload=o;k=g.$el.data("src");if(k){g.el.src=k}if(g.el.complete){g.el.onload()}g.$el.removeClass("lzy");delete this.cache[h]}}}};return d});require(["jquery","wikia.ImgLzy","wikia.browserDetect","wikia.window"],function(d,b,c,a){window.ImgLzy=b;d(function(){b.init();if(c.isIPad()){a.addEventListener("pageshow",function(){a.setTimeout(d.proxy(b.checkAndLoad,b),0)})}})});(function(a,b,d){if(a.wgIsEditPage){return}var c={assetsLoaded:false,loadingAssets:false,wrapperSelector:".MiniEditorWrapper",initTime:0,initTimer:null,loadTime:0,loadTimer:null,ckeditorEnabled:false,editorSuite:"mweditorsuite",editorIsLoading:false,config:{animations:{},isMiniEditor:true,mode:"source",toolbars:{tabs:[],toolbar:["FormatMiniEditorSource","InsertMiniEditor"],rail:[]}},plugins:["MiniEditor","loadingstatus"],configure:function(){if(!this.assetsLoaded){return}if(typeof RTE!="undefined"){this.ckeditorEnabled=true;this.editorSuite="ckeditorsuite";this.config.mode=a.RTEInitMode||"wysiwyg";this.config.toolbars.toolbar=["ModeSwitch","FormatMiniEditor"].concat(this.config.toolbars.toolbar);RTE.config.contentsCss.push(b.getSassLocalURL("extensions/wikia/MiniEditor/css/core/content.scss"));RTE.overlayNode.bind("click.MiniEditor",function(){RTE.overlayNode.data("wikiaEditor").setAsActiveInstance()})}this.plugins.unshift(this.editorSuite);this.config.uiElements=a.wgEditorExtraButtons||{};GlobalTriggers.fire("MiniEditorReady")},loadAssets:function(f){var e=this;if(this.loadingAssets||this.assetsLoaded){if(b.isFunction(f)){f()}return}this.loadTimer=new Date();b().log("Start resource loading","MiniEditor");this.loadingAssets=true;b.nirvana.sendRequest({controller:"MiniEditorController",method:"makeGlobalVariables",data:{useeditor:b.getUrlVar("useeditor")},type:"POST",callback:function(j){var h=a.wgMiniEditorAssets;for(var g in j){a[g]=j[g]}if(typeof h!="undefined"&&b.isArray(h)){b.each(h,function(k,l){h[k]=a.wgResourceBasePath+l});h=a.wgMiniEditorAssets=j.wgMiniEditorAssets.concat(h)}b.getResources(h,b.proxy(function(){this.loadTime=(new Date().getTime()-this.loadTimer.getTime());b().log("End resource loading ("+this.loadTime+"ms)","MiniEditor");this.assetsLoaded=true;this.loadingAssets=false;this.configure();if(b.isFunction(f)){f()}},e),function(m,k,l){b().log(arguments,"MiniEditor")})}})},loading:function(e,f){b(e).closest(this.wrapperSelector).addClass(f?"preloading":"loading");this.editorIsLoading=true},initEditor:function(g,n,e){var k=b(g),h=k.closest(this.wrapperSelector),f=e&&e.target&&e.target!=k.get(0);if(this.loadingAssets){return}if(!this.assetsLoaded){this.loading(k,f);return this.loadAssets(b.proxy(function(){this.initEditor(g,n)},this))}var j=k.data("wikiaEditor");if(j&&j.ready){j.fire("editorActivated",(j.event=e))}else{if((j||(j=WikiaEditor.getInstance()))&&!j.ready){this.loading(k,f);j.fire("editorBeforeReady",(j.event=e))}else{this.initTimer=new Date();b().log("Start initialization","MiniEditor");n=b.extend(true,{},b.fn.miniEditor.options,n);var m=this,l=b.extend({},n.events);this.loading(k,f);l.editorReady=function(){m.editorIsLoading=false;if(b.isFunction(n.events.editorReady)){n.events.editorReady.apply(m,arguments)}};k.bind(l);if(n.content!==d){k.html(n.content)}j=WikiaEditor.create(this.plugins,b.extend(true,{},this.config,{body:k,element:h.addClass(this.editorSuite),minHeight:k.data("min-height")||200,mode:b.isArray(n.edgeCases)&&n.edgeCases.length?"source":this.config.mode,maxHeight:k.data("max-height")||400,startupFocus:!f},n.config),e);if(a.wgEnableMiniEditorLinkSuggest){if(this.config.editorSuite==="ckeditor"){j.on("ck-mode",function(){if(j.ck.mode!=="wysiwyg"){c.initLinkSuggest(h,"textarea.cke_source")}})}else{this.initLinkSuggest(h,"#"+j.instanceId)}}k.addClass("wikiaEditor").triggerHandler("editorInit",[j,e])}}},initLinkSuggest:function(f,e){mw.loader.using("ext.wikia.LinkSuggest",function(){f.find(e).linksuggest()})},getStartupMode:function(f){var e=b(f);if(e.length){var g=e.data("wikiaEditor");if(g){return g.mode}}return this.config.mode},getLoadConversionFormat:function(e){return WikiaEditor.modeToFormat(this.getStartupMode(e))=="richtext"?"richtext":""},getSaveConversionFormat:function(e){return this.getLoadConversionFormat(e)=="richtext"?"wikitext":""}};b.fn.miniEditor=function(e,f){return this.each(function(){c.initEditor(this,e,f)})};b.fn.miniEditor.options={config:{},events:{}};b(function(){if(!a.wgMiniEditorLoadOnDemand){c.assetsLoaded=true;c.configure()}});a.MiniEditor=c})(this,jQuery);(function(a,b){if(!a.wgIsArticle){return}var d=b(a),c;c={animations:{},processing:false,mostRecentCount:0,messagesLoaded:false,miniEditorEnabled:a.wgEnableMiniEditorExt,loadOnDemand:a.wgArticleCommentsLoadOnDemand,initCompleted:false,wrapperSelector:"#WikiaArticleComments",bucky:a.Bucky("ArticleComments"),init:function(){c.bucky.timer.start("init");var h=b("#article-comments"),e=b("#article-comm-fbMonit"),g=b("#fbCommentMessage"),f;mw.hook("wikipage.content").fire(h);if(!c.$wrapper){c.$wrapper=b(c.wrapperSelector)}c.$commentsList=b("#article-comments-ul");c.$actionButtons=c.$wrapper.find(".actionButton");if(c.miniEditorEnabled){f=b("#article-comm");f.bind("focus",function(){c.editorInit(this)});if(f.is(":focus")){c.editorInit(f)}}if(a.wgDisableAnonymousEditing&&!a.wgUserName){b(".article-comm-reply").hide()}else{h.on("click",".article-comm-edit",c.actionProxy(c.edit));h.on("click",".article-comm-reply",c.actionProxy(c.reply));b("#article-comm-submit").on("click",{source:"#article-comm"},c.actionProxy(c.postComment))}e.mouseenter(function(){g.fadeIn("slow")});e.mouseleave(function(){g.fadeOut("slow")});c.addHover();c.initCompleted=true;c.bucky.timer.stop("init")},actionProxy:function(e){return function(f){f.preventDefault();if(c.miniEditorEnabled&&MiniEditor.editorIsLoading){b().log("Event cancelled because editor is loading: ",f);return true}e.apply(this,arguments)}},edit:function(g){g.preventDefault();if(c.processing){return}if(c.miniEditorEnabled&&!MiniEditor.assetsLoaded){MiniEditor.loadAssets(f)}else{f()}function f(){c.bucky.timer.start("edit.makeRequest");var h=g.target.id.replace(/^comment/,""),e=b("#article-comm-textfield-"+h);b.getJSON(wgScript,{action:"ajax",article:wgArticleId,convertToFormat:c.getLoadConversionFormat(e),id:h,method:"axEdit",rs:"ArticleCommentsAjax",useskin:a.skin},function(s){if(!s.error){var k=b(g.target).closest(".buttons"),q="#article-comm-div-form-"+s.id,r="#article-comm-textfield-"+s.id,o=b("#comm-text-"+s.id).hide(),m=b(q),l=o.parent(),j=b(s.text).hide(),p=j.find(r).val(),n;if(!m.length){l.append(j.attr("id",q.substr(1)));m=b(q)}n=b(r);if(c.miniEditorEnabled){c.editorInit(n,p,s.edgeCases)}else{n.val(p)}m.show();k.hide();b("#article-comm-submit-"+s.id).bind("click",{id:s.id,emptyMsg:s.emptyMsg},c.actionProxy(c.saveEdit));b("#article-comm-edit-cancel-"+s.id).bind("click",{id:s.id,target:g.target,text:s.text},c.actionProxy(c.cancelEdit))}c.processing=false;c.bucky.timer.stop("edit.makeRequest")})}c.processing=true},cancelEdit:function(g){var f=g.data.id;g.preventDefault();if(c.miniEditorEnabled){b("#article-comm-textfield-"+f).data("wikiaEditor").fire("editorDeactivated")}b("#article-comm-div-form-"+f).hide();b(g.data.target).closest(".buttons").show();b("#comm-text-"+f).show()},saveEdit:function(m){var j,f,k,h,g,l;c.bucky.timer.start("saveEdit");m.preventDefault();if(c.processing){return}j=m.data.id;f=b("#article-comm-form-"+j);if(f.length){k=b(m.target).siblings(".throbber");h=b("#article-comm-submit-"+j);g=b("#article-comm-textfield-"+j);l=c.getContent(g);h.parent().find(".info").remove();if(b.trim(l)===""){h.after(b("<span>").addClass("info").html(m.data.emptyMsg));return}b("#article-comm-info").html("");k.css("visibility","visible");g.attr("readonly","readonly");b.postJSON(wgScript,{action:"ajax",article:wgArticleId,convertToFormat:c.getSaveConversionFormat(g),id:j,method:"axSave",rs:"ArticleCommentsAjax",title:wgPageName,wpArticleComment:l,token:a.mw.user.tokens.get("editToken")},function(n){k.css("visibility","hidden");if(!n.error){if(n.commentId&&n.commentId!==0){var q=b("#comm-"+n.commentId),p=q.find(".article-comm-text"),o=b(n.text),e=o.find(".article-comm-text");b("#article-comm-div-form-"+n.commentId).hide();if(c.miniEditorEnabled){g.data("wikiaEditor").fire("editorReset")}p.html(e.html()).show();mw.hook("wikipage.content").fire(p);q.find(".edited-by").html(o.find(".edited-by").html())}}else{b("#article-comm-info").html(n.msg)}g.removeAttr("readonly");c.processing=false;c.bucky.timer.stop("saveEdit")});c.processing=true}},reply:function(f){c.bucky.timer.start("reply");f.preventDefault();if(c.processing){return}b.getJSON(wgScript,{action:"ajax",article:wgArticleId,id:b(this).closest(".comment").attr("id").replace(/^comm-/,""),method:"axReply",rs:"ArticleCommentsAjax",title:wgPageName,useskin:a.skin},function(j){var k=b("#comm-text-"+j.id).parent(),e=k.find(".article-comm-edit-box"),h=k.find(".buttons").hide(),g;k.find(".info").remove();if(e.length){e.show()}else{if(!j.error){k.append(j.html);b("#article-comm-reply-submit-"+j.id).bind("click",{source:"#article-comm-reply-textfield-"+j.id,parentId:j.id},c.actionProxy(c.postComment))}else{if(j.error===2){k.find(".tools").after(b("<span>").addClass("info").html(j.msg))}else{require(["wikia.ui.factory"],function(l){l.init(["modal"]).then(function(m){var n={vars:{id:"general_error",size:"small",content:j.msg}};m.createComponent(n,function(o){o.show()})})})}}}g=b("#article-comm-reply-textfield-"+j.id);if(c.miniEditorEnabled){c.editorInit(g,{editorActivated:function(){k.find(".article-comm-edit-box").show()},editorDeactivated:function(l,m){if(!m.getContent()){k.find(".article-comm-edit-box").hide();h.show()}}})}else{g.focus()}c.processing=false;c.bucky.timer.stop("reply")});c.processing=true},postComment:function(m){var l,g,f,n,h,j;m.preventDefault();if(c.processing){return}l=b(m.data.source);n=c.getContent(l);if(b.trim(n)===""){return}g=b(m.target);f=g.siblings(".throbber");h=b.getUrlVar("showall");f.css("visibility","visible");l.attr("readonly","readonly");g.attr("disabled",true);j={action:"ajax",article:wgArticleId,convertToFormat:c.getSaveConversionFormat(l),method:"axPost",rs:"ArticleCommentsAjax",title:wgPageName,wpArticleComment:n,useskin:a.skin,token:a.mw.user.tokens.get("editToken")};if(m.data.parentId){j.parentId=m.data.parentId;j.page=b(".article-comments-pagination-link-active").eq(0).attr("page")}if(h){j.showall=1}function o(p){var r,q,s,e;c.bucky.timer.start("postComment.requestCallback");f.css("visibility","hidden");if(c.miniEditorEnabled){l.data("wikiaEditor").fire("editorReset")}else{l.val("")}if(!p.error){s=p.parentId;e=b(p.text);mw.hook("wikipage.content").fire(e);if(s){r=b("#comm-"+s);q=r.next();if(!q.hasClass("sub-comments")){r.after(q=b('<ul class="sub-comments"></ul>'))}q.append(e);r.find(".article-comm-edit-box").hide();r.find(".buttons").show()}else{e.prependTo(c.$commentsList)}if(a.skin==="oasis"){b("#WikiaPageHeader, #WikiaUserPagesHeader").find(".commentsbubble").html(p.counter);if(!s){c.mostRecentCount=c.mostRecentCount?c.mostRecentCount+1:c.$commentsList.children("li").length;b("#article-comments-counter-recent").html(b.msg("oasis-comments-showing-most-recent",c.mostRecentCount))}}c.addHover()}else{new BannerNotification(p.msg,"error").show()}l.removeAttr("readonly");g.removeAttr("disabled");c.processing=false;c.bucky.timer.stop("postComment.requestCallback")}function k(){b.postJSON(wgScript,j,o);c.processing=true}if(!c.messagesLoaded){b.getMessages("ArticleCommentsCounter",function(){c.messagesLoaded=true;k()})}else{k()}},setPage:function(g){c.bucky.timer.start("setPage");var f=parseInt(b(this).attr("page"));g.preventDefault();c.$commentsList.addClass("loading");b.getJSON(wgScript+"?action=ajax&rs=ArticleCommentsAjax&method=axGetComments",{article:wgArticleId,order:b("#article-comm-order").attr("value"),page:f,useskin:a.skin},function(h){c.$commentsList.removeClass("loading");if(!h.error){c.$commentsList.html(h.text);var e=b(".article-comments-pagination");if(e.exists()){e.html(h.pagination)}c.addHover()}c.processing=false;c.bucky.timer.stop("setPage")})},addHover:function(){var e=[".article-comments-pagination-link-active","#article-comments-pagination-link-prev","#article-comments-pagination-link-next"];b(".article-comments-pagination-link").bind("click",c.setPage).not(e.join(", ")).hover(function(){b(this).addClass("accent")},function(){b(this).removeClass("accent")})},editorInit:function(h,n,j,g){c.bucky.timer.start("editorInit");var m=b(h),l=m.data("wikiaEditor"),k,f;if(typeof n==="string"){g=j;j=n;n={}}f=b.isArray(g)&&g.length;function e(){n=n||{};k=n.editorActivated;n.editorActivated=function(){c.$actionButtons.removeClass("disabled").removeAttr("disabled");if(b.isFunction(k)){k.apply(this,arguments)}};m.miniEditor({config:{animations:MiniEditor.Wall.Animations,mode:f?"source":MiniEditor.config.mode},events:n})}if(l){l.fire("editorActivated");if(j!==undefined){if(f){l.ck.setMode("source")}l.setContent(j)}}else{c.$actionButtons.addClass("disabled").attr("disabled",true);if(j!==undefined){m.val(j)}if(!MiniEditor.assetsLoaded){MiniEditor.loading(m);MiniEditor.loadAssets(e)}else{e()}}c.bucky.timer.stop("editorInit")},getContent:function(e){return c.miniEditorEnabled?e.data("wikiaEditor").getContent():e.val()},getLoadConversionFormat:function(e){return c.miniEditorEnabled?MiniEditor.getLoadConversionFormat(e):""},getSaveConversionFormat:function(e){return c.miniEditorEnabled?MiniEditor.getSaveConversionFormat(e):""},scrollToElement:function(g){var f=b(g),j=d.scrollTop(),h=j+d.height(),e=f.offset().top;f.find("blockquote").addClass("current");if(b("#globalNavigation").css("position")==="fixed"){a.GlobalNavigationScrollToElement(g)}else{if(e<j||e>h){b("html, body").animate({scrollTop:e},1)}}},showMoreComments:function(){var f=this.$wrapper.find(".comments").children().slice(3),e=b(".article-comments-pagination",this.$wrapper),g=this.$wrapper.find(".comments-show-more");if(f.length===0){return}f.hide();e.hide();g.css("display","block");g.click(function(){f.show();e.show();g.hide()})}};if(c.loadOnDemand){b(function(){var f,j,h,e=[],g,k;c.$wrapper=b(c.wrapperSelector);if(!c.$wrapper.length){return}j=a.location.hash;h=/^#comm-/.test(j);e.push(b.getSassCommonURL("skins/oasis/css/core/ArticleComments.scss"));g=function(){return c.$wrapper.offset().top>=(d.scrollTop()+d.height())};if(c.miniEditorEnabled){e.push(b.getSassCommonURL("extensions/wikia/MiniEditor/css/MiniEditor.scss"));e.push(b.getSassCommonURL("extensions/wikia/MiniEditor/css/ArticleComments/ArticleComments.scss"))}k=function(){c.bucky.timer.start("loadAssets");b.when(b.getResources(e),b.nirvana.sendRequest({controller:"ArticleCommentsController",method:"Content",format:"html",type:"GET",data:{articleId:a.wgArticleId,page:c.$wrapper.data("page"),useskin:a.skin},callback:function(l){f=l}})).then(function(){c.$wrapper.removeClass("loading").html(f);c.init();if(h){c.scrollToElement(j)}c.bucky.timer.stop("loadAssets")})};if(!h&&g()){d.on("scrollstop.ArticleCommentsLoadOnDemand",function(){if(!g()){c.$wrapper.addClass("loading");d.off("scrollstop.ArticleCommentsLoadOnDemand");k()}})}else{k()}})}else{wgAfterContentAndJS.push(c.init)}a.ArticleComments=c})(this,jQuery);var GlobalModal={init:function(){var a=$.getUrlVar("modal");if(a){var b=GlobalModal["show"+a];if(typeof b==="function"){b()}}},showUploadImage:function(){if(!wgUserName){$(".ajaxLogin").trigger("click")}else{$(".upphotos").trigger("click")}},showAddPage:function(){if(!wgUserName){$(".ajaxLogin").trigger("click")}else{$(".createpage").trigger("click")}},showLogin:function(){if(!wgUserName){$(".ajaxLogin").trigger("click")}},showAdopt:function(){$.when($.getResources([$.getSassCommonURL("/extensions/wikia/AutomaticWikiAdoption/css/AutomaticWikiAdoption.scss")]),$.nirvana.sendRequest({controller:"AutomaticWikiAdoption",method:"AdoptWelcomeDialog",format:"html",type:"get",data:{cb:wgCurRevisionId}})).then(function(c,a){var b=a[0];$(b).makeModal({width:500,height:400})})}};$(function(){GlobalModal.init()});(function(){var a={forceLoggedIn:false,refreshIfAfterForceLogin:function(){if(this.forceLoggedIn){Wikia.Querystring().addCb().goTo()}},rteForceLogin:function(){window.onbeforeunload=function(){};window.wikiaAuthModal.load({forceLogin:true,origin:"editor",onAuthSuccess:function(){if(window.WikiaEditor){WikiaEditor.reloadEditor()}}})},isForceLogIn:function(){if(window.wgUserName===null){window.onbeforeunload=function(){};window.wikiaAuthModal.load({forceLogin:true,origin:"editor"});return true}return false}};window.UserLogin=a})();var WikiaBar={WIKIA_BAR_STATE_ANON_ML_KEY:"AnonMainLangWikiaBar_0.0001",WIKIA_BAR_STATE_ANON_NML_KEY:"AnonNotMainLangWikiaBar_0.0001",WIKIA_BAR_HIDDEN_ANON_ML_TTL:24*60*1000,WIKIA_BAR_HIDDEN_ANON_NML_TTL:180*24*60*1000,WIKIA_BAR_STATE_USER_KEY_SUFFIX:"UserWikiaBar_1.0004",WIKIA_BAR_MAX_MESSAGE_PARTS:5,WIKIA_BAR_SAMPLING_RATIO:10,WIKIA_BAR_SHOWN_STATE_VALUE:"shown",WIKIA_BAR_HIDDEN_STATE_VALUE:"hidden",cutMessagePrecision:20,messageConfig:{index:0,container:null,attributeName:"wikiabarcontent",content:null,speed:500,delay:10000,prevMsgNumber:-1,doTrackImpression:false},wikiaBarHidden:true,wikiaBarWrapperObj:null,wikiaBarCollapseWrapperObj:null,isSampledEvent:function(){return this.WIKIA_BAR_SAMPLING_RATIO>=Math.floor((Math.random()*100+1))},bindTracking:function(){this.wikiaBarWrapperObj.click($.proxy(this.clickTrackingHandler,this));this.wikiaBarCollapseWrapperObj.click($.proxy(this.clickTrackingHandler,this))},init:function(){this.$window=$(window);this.wikiaBarWrapperObj=$("#WikiaBarWrapper");this.wikiaBarCollapseWrapperObj=$(".WikiaBarCollapseWrapper");this.bindTracking();var a=this.wikiaBarWrapperObj.find(".arrow");a.click($.proxy(this.onShownClick,this));this.wikiaBarCollapseWrapperObj.find(".wikia-bar-collapse").click($.proxy(this.onHiddenClick,this));if(!this.isUserAnon()){this.handleLoggedInUsersWikiaBar()}else{if(this.isUserAnon()&&this.hasAnonHiddenWikiaBar()===false){this.handleLoggedOutUsersWikiaBar()}}a.popover({placement:"wikiaBar",content:a.data("tooltip")});$(".wikia-bar-collapse").popover({placement:"wikiaBar",content:a.data("tooltipshow")});this.$window.triggerHandler("WikiaBarReady");return true},getAdIfNeeded:function(){var a=window.ads&&window.ads.context&&window.ads.context.opts&&window.ads.context.opts.showAds&&window.wgEnableWikiaBarAds;if(a){window.Wikia.reviveQueue=window.Wikia.reviveQueue||[];window.Wikia.reviveQueue.push({zoneId:28,slotName:"WIKIA_BAR_BOXAD_1"})}},cutMessageIntoSmallPieces:function(l,a,j){var k=[],g,c,f,h,b=0;for(var e=0,d=l.length;e<d;e++){h=l[e].text;if(typeof h=="string"){c=h.split("");do{g=this.checkMessageWidth(c,a,j);f=c.slice(g.length,c.length);k.push({anchor:$.trim(g.join("")),href:l[e].href,messageNumber:e});c=f;b++}while(f.length>0&&b<this.WIKIA_BAR_MAX_MESSAGE_PARTS)}}a.text("");return k},checkMessageWidth:function(h,a,g){var k="",l,e,f=-1;for(var c=0,b=h.length;c<b;c+=g){k=k+h.join("").substr(c,g);l=$("<span></span>").text(k);a.html(l);if(l.width()>=this.messageConfig.container.width()){f=c-g;break}}if(f==-1){e=h}else{e=h.slice(0,f);var d=e.lastIndexOf(" ");if((d>-1)&&(d<f)){e=h.slice(0,d)}}return e},messageFadeIn:function(){var a=this.messageConfig.index,b=this.messageConfig;if(a==(b.content.length-1)){this.messageConfig.index=0}else{this.messageConfig.index++}setTimeout($.proxy(this.messageSlideShow,this),b.delay);return true},messageSlideShow:function(){var b=this.messageConfig.content[this.messageConfig.index],c=this.messageConfig.container,a=$("<a></a>").attr("href",b.href).data("index",b.messageNumber).text(b.anchor);c.fadeOut(this.messageConfig.speed,$.proxy(function(){c.html(a);if(this.messageConfig.prevMsgNumber!=b.messageNumber){this.messageConfig.prevMsgNumber=b.messageNumber;this.messageConfig.doTrackImpression=true}else{this.messageConfig.doTrackImpression=false}c.fadeIn(this.messageConfig.speed,$.proxy(this.messageFadeIn,this))},this));return true},startSlideShow:function(){this.messageConfig.content=this.cutMessageIntoSmallPieces(this.messageConfig.container.data(this.messageConfig.attributeName),this.messageConfig.container,this.cutMessagePrecision);if(typeof this.messageConfig.content=="object"){this.messageConfig.container.popover({placement:"wikiaBarMessage",content:this.messageConfig.container.data("messagetooltip")});this.messageSlideShow()}},show:function(){$("#WikiaNotifications").removeClass("hidden");this.wikiaBarCollapseWrapperObj.addClass("hidden");this.wikiaBarWrapperObj.removeClass("hidden");this.wikiaBarHidden=false;this.toggleVisibilityClassOnBody(true)},hide:function(){$("#WikiaNotifications").addClass("hidden");this.wikiaBarCollapseWrapperObj.removeClass("hidden");this.wikiaBarWrapperObj.addClass("hidden");this.wikiaBarHidden=true;this.toggleVisibilityClassOnBody(false)},isWikiaBarHidden:function(){return this.wikiaBarHidden},showContainer:function(){$("#WikiaBar").show();this.toggleVisibilityClassOnBody(true)},hideContainer:function(){$("#WikiaBar").hide();this.toggleVisibilityClassOnBody(false)},toggleVisibilityClassOnBody:function(a){if(this.wikiaBarWrapperObj.length){$("body").toggleClass("wikia-bar-visible",a)}},isContainerHidden:function(){return $("#WikiaBar").is(":visible")},onShownClick:function(a){this.changeBarStateData();a.preventDefault()},onHiddenClick:function(a){this.changeBarStateData();a.preventDefault()},changeBarStateData:function(){if(this.isUserAnon()){this.changeAnonBarStateData()}else{this.changeLoggedInUserStateBar()}this.$window.triggerHandler("WikiaBarStateChanged")},changeAnonBarStateData:function(){var a=this.hasAnonHiddenWikiaBar();if(a===false){this.setCookieData(true);this.hide()}else{this.setCookieData(false);this.getAdIfNeeded();this.show()}},hasAnonHiddenWikiaBar:function(){return this.getAnonData()},handleLoggedOutUsersWikiaBar:function(){this.show();this.messageConfig.container=this.wikiaBarWrapperObj.find(".message");var a=this.messageConfig.container.data(this.messageConfig.attributeName);if(this.messageConfig.container.exists()&&a&&(typeof a=="object")&&(a.length>0)){this.startSlideShow()}this.getAdIfNeeded()},handleLoggedInUsersWikiaBar:function(){var a=this.getLocalStorageData();if(a===null){this.getLoggedInUserStateBarAndChangeLocalStorage()}else{this.doWikiaBarAnimationDependingOnState(a)}},getLoggedInUserStateBarAndChangeLocalStorage:function(){$.nirvana.sendRequest({controller:"WikiaUserPropertiesController",method:"performPropertyOperation",data:{handlerName:"WikiaBarUserPropertiesHandler",methodName:"getWikiaBarState"},type:"get",format:"json",callback:$.proxy(this.onGetLoggedInUserStateBarAndChangeLocalStorage,this),onErrorCallback:$.proxy(this.onGetLoggedInUserStateBarAndChangeLocalStorageError,this)})},changeLoggedInUserStateBar:function(){var a=this.isWikiaBarHidden()?this.WIKIA_BAR_SHOWN_STATE_VALUE:this.WIKIA_BAR_HIDDEN_STATE_VALUE;this.doWikiaBarAnimationDependingOnState(a);this.setLocalStorageData(a);$.nirvana.sendRequest({controller:"WikiaUserPropertiesController",method:"performPropertyOperation",data:{handlerName:"WikiaBarUserPropertiesHandler",methodName:"changeWikiaBarState",callParams:{changeTo:a}},type:"post",format:"json"})},onGetLoggedInUserStateBarAndChangeLocalStorage:function(a){var b=a.results.propertyValue||this.WIKIA_BAR_SHOWN_STATE_VALUE;this.setLocalStorageData(b);this.doWikiaBarAnimationDependingOnState(b)},onGetLoggedInUserStateBarAndChangeLocalStorageError:function(){},doWikiaBarAnimationDependingOnState:function(c){if(c===this.WIKIA_BAR_SHOWN_STATE_VALUE){this.show()}else{this.hide()}if(window.wgAction=="edit"&&!window.wgEnableCodePageEditor){var b=window.WikiaEditor=window.WikiaEditor||(new Observable()),a=b.getInstance();if(typeof(a)!=="undefined"){a.fire("sizeChanged")}}},getLocalStorageDataKey:function(){var a=undefined;if(window.wgUserName){a=window.wgUserName+"_"+this.WIKIA_BAR_STATE_USER_KEY_SUFFIX}else{$().log("WikiaBar notice: No user name found")}return a},getLocalStorageData:function(){return $.storage.get(this.getLocalStorageDataKey())},setLocalStorageData:function(a){$.storage.set(this.getLocalStorageDataKey(),a)},getAnonData:function(a){var b=this.getCookieKey(),d=$.cookie(b),c=null;if(d===null&&!this.isMainWikiaBarLang()){c=(typeof a!=="undefined")?a:true}else{if(d===null&&this.isMainWikiaBarLang()){c=(typeof a!=="undefined")?a:false}else{c=(d==="true")}}return c},setCookieData:function(e){var d=this.getCookieKey(),c=new Date(),a=new Date(c.getTime()+this.WIKIA_BAR_HIDDEN_ANON_ML_TTL),b={expires:a,path:"/",domain:window.wgCookieDomain};if(this.isUserAnon()&&!this.isMainWikiaBarLang()){b.expires=this.WIKIA_BAR_HIDDEN_ANON_NML_TTL}else{if(!this.isUserAnon){b.expires=this.WIKIA_BAR_HIDDEN_USER_TTL}}$.cookie(d,e,b)},getCookieKey:function(){var a=this.WIKIA_BAR_STATE_ANON_ML_KEY;if(this.isUserAnon()&&!this.isMainWikiaBarLang()){a=this.WIKIA_BAR_STATE_ANON_NML_KEY}return a},isUserAnon:function(){return(window.wgUserName===null)},isMainWikiaBarLang:function(){var a=-1;if(window.wgContentLanguage&&window.wgWikiaBarMainLanguages){a=$.inArray(window.wgContentLanguage,window.wgWikiaBarMainLanguages)}return(a>=0)},getWikiaBarOffset:function(){var a=$("#WikiaBarWrapper").outerHeight(true)||0;return(this.wikiaBarHidden)?0:a},trackClick:function(c,e,a,d,f,b){if(this.isSampledEvent()){Wikia.Tracker.track({action:e,category:c,label:a,trackingMethod:"analytics",value:d},f)}},clickTrackingHandler:function(g){var d=$(g.target),c=d.parent(),b=new Date();if(d.hasClass("arrow")){this.trackClick("wikia-bar",Wikia.Tracker.ACTIONS.CLICK_LINK_BUTTON,"arrow-hide",null,{},g)}else{if(d.hasClass("wikia-bar-collapse")){this.trackClick("wikia-bar",Wikia.Tracker.ACTIONS.CLICK_LINK_BUTTON,"arrow-show",null,{},g)}else{if(c.hasClass("wikiabar-button")){var f=c.data("index");this.trackClick("wikia-bar",Wikia.Tracker.ACTIONS.CLICK_LINK_BUTTON,"wikiabar-button-"+f,null,{},g)}else{if(c.hasClass("message")){var a=d.data("index");this.trackClick("wikia-bar",Wikia.Tracker.ACTIONS.CLICK_LINK_TEXT,"message-"+a+"-clicked",null,{},g)}}}}$().log("tracking took "+(new Date()-b)+" ms")}};if(window.wgEnableWikiaBarExt){$(function(){WikiaBar.init()})}var ChatWidget={loading:false,chatLaunchModal:null,bindComplete:false,isWideChat:null,widgetUserElementTemplate:"",wideChatThreshold:280,resizeDebounceTime:1000,init:function(){if(!ChatWidget.bindComplete){$("body").on("click",".WikiaChatLink, .chat-module .start-a-chat-button, .chat-module .more-users-count",this.openChat);ChatWidget.bindComplete=true}if($(".chat-module").length){if(!ChatWidget.loading){ChatWidget.loading=true;ChatWidget.loadDataAndInitializeModules()}}},openChat:function(a){a.preventDefault();a.stopPropagation();ChatWidget.onClickChatButton(this.href)},loadDataAndInitializeModules:function(){$.when(ChatWidget.loadChatUsers(),ChatWidget.loadWidgetUserElementTemplate()).then(function(c,a){if(c[1]==="success"&&a[1]==="success"){var d=c[0].users,b=c[0].hasUsers;ChatWidget.widgetUserElementTemplate=a[0].mustache[0];if(d.length){ChatWidget.updateUsersList(d,b)}ChatWidget.users=d}ChatWidget.initializeChatModules()})},loadChatUsers:function(){return $.nirvana.sendRequest({controller:"ChatRailController",method:"GetUsers",type:"GET",format:"json"})},loadWidgetUserElementTemplate:function(){return Wikia.getMultiTypePackage({mustache:"extensions/wikia/Chat2/templates/widgetUserElement.mustache"})},updateUsersList:function(d,c){var a=Mustache.render(ChatWidget.widgetUserElementTemplate,{viewedUsersInfo:d,hasUsers:c,blankImageUrl:window.wgBlankImageUrl}),b=$(".chat-module");if(c){b.find(".chat-contents.chat-room-empty").each(function(){$(this).eq(0).removeClass("chat-room-empty").addClass("chat-room-active")})}b.find(".wds-avatar-stack").each(function(){$(this).get(0).innerHTML=a})},initializeChatModules:function(){$(".ChatModuleUninitialized").each(function(){var a=$(this);ChatWidget.isWideChat=ChatWidget.computeIsWideChat(a.width());ChatWidget.processModuleTemplate(a);a.removeClass("ChatModuleUninitialized");$(window).resize($.debounce(ChatWidget.resizeDebounceTime,function(){ChatWidget.afterResize(a)}))})},afterResize:function(b){var a=ChatWidget.computeIsWideChat(b.width());if(a!==ChatWidget.isWideChat){ChatWidget.isWideChat=a;ChatWidget.processModuleTemplate(b)}},computeIsWideChat:function(a){return a>ChatWidget.wideChatThreshold},processModuleTemplate:function(a){ChatWidget.initPopover(a);a.find("[data-msg-id]").each(function(){var b=$(this);b.text(mw.message(b.data("msg-id"),b.data("msg-param")).text())})},initPopover:function(b){var c=0;function a(d){c=setTimeout(function(){d.popover("hide")},300)}b.find(".chatter").popover({trigger:"manual",placement:"bottom",content:function(){var d=b.find(".UserStatsMenu").eq($(this).index());return d.clone().wrap("<div>").parent().html()}}).on("mouseenter",function(){clearTimeout(c);$(".popover").remove();b.find(".UserStatsMenu img[data-src]").each(function(){var d=$(this);d.attr("src",d.attr("data-src")).removeAttr("data-src")});$(this).popover("show")}).on("mouseleave",function(){var d=$(this);a(d);$(".popover").mouseenter(function(){clearTimeout(c)}).mouseleave(function(){a(d)})})},onClickChatButton:function(a){if(window.wgUserName){window.open(a,"wikiachat",window.wgWikiaChatWindowFeatures)}else{window.wikiaAuthModal.load({forceLogin:true,origin:"chat",onAuthSuccess:ChatWidget.onSuccessfulLogin})}},onSuccessfulLogin:function(){$.nirvana.sendRequest({controller:"ChatRail",method:"AnonLoginSuccess",type:"GET",format:"html",callback:ChatWidget.onJoinChatFormLoaded})},onJoinChatFormLoaded:function(a){require(["wikia.ui.factory"],function(b){b.init("modal").then(function(c){var d={vars:{id:"JoinChatModal",size:"small",content:a,title:mw.message("chat-start-a-chat").escaped()}};c.createComponent(d,function(e){e.bind("chat",function(f){ChatWidget.launchChatWindow(f,e)});e.bind("close",function(){ChatWidget.reloadPage()});e.show()})})})},reloadPage:function(){Wikia.Querystring().addCb().goTo()},launchChatWindow:function(c,b){var a=$("#modal-join-chat-button").data("chat-page");window.open(a,"wikiachat",window.wgWikiaChatWindowFeatures);if(b){b.trigger("close")}ChatWidget.reloadPage()}};if(typeof wgWikiaChatUsers!=="undefined"){$(function(){ChatWidget.init()})}(function(d,f){if(d.vetLoader){return}var b=false,e=false,g={},c="";function a(){var h=[];h.push(f.nirvana.sendRequest({controller:"VideoEmbedToolController",method:"modal",type:"get",format:"html"}));h.push(f.getResources([f.getAssetManagerGroupUrl("VET_js"),f.getSassCommonURL("/extensions/wikia/VideoEmbedTool/css/VET.scss"),f.getSassCommonURL("/extensions/wikia/WikiaStyleGuide/css/Dropdown.scss")]));h.push(f.getMessages("VideoEmbedTool"));return h}g.load=function(j,h){var k=[];h=h||f();if(d.wgUserName===null&&!d.UserLogin.forceLoggedIn&&d.wgAction==="edit"){d.UserLogin.rteForceLogin();h.stopThrobbing();return}else{if(d.wgUserName===null&&!d.UserLogin.forceLoggedIn){d.wikiaAuthModal.load({forceLogin:true,origin:"vet",onAuthSuccess:function(){d.UserLogin.forceLoggedIn=true;g.load(j)}});h.stopThrobbing();return}}if(e){h.stopThrobbing();return}e=true;if(!b){k=a()}f.when.apply(f,k).done(function(l){if(!b){c=l[0]}h.stopThrobbing();require(["wikia.vet"],function(m){g.modal=f(c).makeModal({width:939,onClose:function(){m.close()},onAfterClose:function(){e=false}});m.show(j);b=true})})};f.fn.addVideoButton=function(h){f.preloadThrobber();return this.each(function(){var j=f(this);j.off("click.VETLoader").on("click.VETLoader",function(k){k.preventDefault();j.startThrobbing();g.load(h,j)})})};d.vetLoader=g})(window,jQuery);(function(a,b){if(!a.wgEditorSurveyEnabled){return}var c={init:function(){mw.hook("ve.activationComplete").add(function(){c.bindUnload()});mw.hook("postEdit").add(function(){c.handleSuccess()});mw.hook("ve.deactivationComplete").add(function(){setTimeout(function(){c.getSurvey()},1000)});mw.hook("ve.cancelButton").add(function(){c.handleFailure()});c.getSurvey()},getEditorAbbreviation:function(){var d;if(a.WikiaEditor){d="ck"}else{if(a.ve){d="ve"}}return d},bindUnload:function(){b(a).on("beforeunload.EditorSurvey",function(){c.handleFailure()})},unbindUnload:function(){b(a).off("beforeunload.EditorSurvey")},surveyHasBeenSeen:function(){return b.cookie("editorsurvey")==="seen"?true:false},handleSuccess:function(){c.unbindUnload();if(!c.surveyHasBeenSeen()){c.setCookie(c.getEditorAbbreviation()+"-success")}},handleFailure:function(){if(!c.surveyHasBeenSeen()){c.setCookie(c.getEditorAbbreviation()+"-fail")}},getSurvey:function(){var d=b.cookie("editorsurvey");if(d&&d!=="seen"){b.nirvana.sendRequest({format:"json",controller:"EditorSurvey",method:"index",data:{type:d},callback:function(e){var f;c.unbindUnload();if(e.wam_rank<=100){c.setCookie(null);return}f=b(e.html).makeModal({escapeToClose:false,onAfterClose:function(){c.setCookie("seen")}});f.on("click",".primary, .secondary",function(){f.closeModal()})}})}},setCookie:function(e){var d={domain:wgCookieDomain};if(e){d.expires=e==="seen"?3650:2}b.cookie("editorsurvey",e,d)}};b(c.init);a.EditorSurvey=c})(window,jQuery);define("thumbnails.templates.mustache",[],function(){return{Thumbnail_articleBlock:'<figure class="article-thumb {{figureClass}}" style="width: {{width}}px">{{{thumbnail}}}<figcaption><a href="{{url}}" class="sprite details" title="{{thumbnailMore}}"></a>{{#title}}<p class="title">{{title}}</p>{{/title}}{{#caption}}<p class="caption">{{{caption}}}</p>{{/caption}}{{#addedBy}}<p class="attribution">{{{addedBy}}}</p>{{/addedBy}}</figcaption></figure>',Thumbnail_title:'{{{thumbnail}}}<div class="title" title="{{title}}"><a href="{{url}}">{{title}}</a></div>',done:"true"}});window.JSSnippets=(function(){var g,a=new RegExp("^(http|https):\\/\\/","i"),l=new RegExp("\\.([^.]+)$"),b=new RegExp("\\?cb=[0-9]+$","i"),e=new RegExp("^\\/"),o=window.mw&&mw.config?mw.config.get("debug"):window.debug;function k(){if(!window.JSSnippetsStack||!JSSnippetsStack.length){window.JSSnippetsStack=[];m();return}g=JSSnippetsStack;var u=[],t={},r={},s,q,p=g.length;for(q=0;q<p;q++){s=g[q];if(s.dependencies){f(u,s)}if(typeof s.getLoaders==="function"){n(u,s)}if(u.length===0){continue}if(typeof s.callback==="function"){t[s.id]=s.callback;r[s.id]=r[s.id]||[];r[s.id].push(s.options)}}if(u.length===0){m();return}u=d(u);require(["wikia.loader","wikia.log"],function(v,w){v.apply(v,u).done(function(){try{for(var y in t){for(q=0,p=r[y].length;q<p;q++){t[y](r[y][q])}}}catch(x){w("Skipping running callback, cause: "+x,w.levels.error)}})});m()}function m(){c();j()}function d(s){var t=[],r=s.length,u,p,w,q,v;for(p=0;p<r;p++){u=undefined;v=s[p].url||s[p];for(w=0,q=t.length;w<q;w++){if(v===(t[w].url?t[w].url:t[w])){u=true;break}}if(!u){t.push(s[p])}}return t}function c(){window.JSSnippetsStack.length=0}function j(){window.JSSnippetsStack.push=function(p){Array.prototype.push.apply(JSSnippetsStack,[p]);k()}}function h(p){var q;if(a.test(p)||b.test(p)){return p}q=p.match(l);if(q&&q.length>0){if(q[1]==="scss"){p=$.getSassCommonURL(p)}else{if(e.test(p)){if(o){p=wgResourceBasePath+p}else{p=wgCdnRootUrl+wgAssetsManagerQuery.replace("%1$s","one").replace("%2$s",p.replace(e,"")).replace("%3$s","-").replace("%4$d",wgStyleVersion)}}}}return p}function f(s,r){var q,t,p=r.dependencies.length;for(t=0;t<p;t++){q=r.dependencies[t];if(typeof q==="string"&&q!==""){q=h(q)}s.push(q)}}function n(t,s){var q=s.getLoaders(),r,u,p=q.length;for(u=0;u<p;u++){r=q[u];if(typeof r==="function"){t.push(r)}}}$(k);return{init:k,clear:c}})();(function(a){function b(e){var f=["json","html","jsonp"];function c(p){var k=p.data||{},n=(p.format||"json").toLowerCase(),l,o,m={},j=[],h,g=p.scriptPath||a.wgServer+a.wgScriptPath;if((typeof p.controller==="undefined")||(typeof p.method==="undefined")){throw"controller and method are required"}h={controller:p.controller.replace(/Controller$/,""),method:p.method};if(typeof k==="string"){k+="&format="+n}else{k.format=n}if(typeof k!=="string"){for(o in k){j[j.length]=o}j.sort();for(l=0;l<j.length;l++){m[j[l]]=k[j[l]]}k=e.param(m)}return g+"/wikia.php?"+e.param(h)+"&"+k}function d(g){var k=(g.type||"POST").toUpperCase(),n=(g.format||"json").toLowerCase(),m={},o=g.callback||function(){},l=g.onErrorCallback||function(){},h;if(f.indexOf(n)===-1){throw"Only Json,Jsonp and Html format are allowed"}if(k==="POST"&&typeof g.data!=="undefined"){m=g.data;delete g.data}h=c(g);var j={url:h,dataType:n,type:k,data:m,success:o,error:l};if(typeof g.contentType!="undefined"){j.contentType=g.contentType}if(typeof g.processData!="undefined"){j.processData=g.processData}return e.ajax(j)}return{sendRequest:d,getUrl:c,getJson:function(g,l,j,k,h){if(typeof j==="function"){h=k;k=j;j={}}return d({controller:g,method:l,data:j,type:"GET",callback:k,onErrorCallback:h})},postJson:function(g,l,j,k,h){if(typeof j==="function"){h=k;k=j;j={}}return d({controller:g,method:l,data:j,callback:k,onErrorCallback:h})}}}if(a.define&&a.define.amd){a.define("wikia.nirvana",["jquery"],b)}if(a.jQuery){a.jQuery.nirvana=b(a.jQuery)}}(this));define("wikia.ui.factory",["wikia.nirvana","wikia.window","wikia.loader","wikia.ui.component","jquery"],function uifactory(f,c,g,d,b){function a(l){var k=new b.Deferred(),m={components:l,cb:c.wgStyleVersion};f.getJson("Wikia\\UI\\UIFactoryApi","getComponentsConfig",m,function(n){k.resolve(n)},function(n){k.reject(JSON.parse(n.responseText))});return k.promise()}function h(){return new d()}function e(n){var m={},l=[],k;for(k=0;k<n.length;k++){if(m.hasOwnProperty(n[k])){continue}l.push(n[k]);m[n[k]]=1}return l}function j(k){var l=new b.Deferred(),n=[],m={};if(!(k instanceof Array)){k=[k]}a(k).done(function(q){var o=[],s=[],p=function(w){var u=h(),z=w.templateVarsConfig,x=w.assets,v=w.templates,y=w.dependencies,t={};if(typeof y==="object"){y.forEach(function(A){if(typeof m[A]!=="undefined"){t[A]=m[A]}else{l.reject();throw new Error("Sub component "+A+" not found")}})}if(x){o=o.concat(x.js);s=s.concat(x.css)}if(z&&v){u.setComponentsConfig({name:w.name,jsWrapperModule:w.jsWrapperModule,templates:v,templateVarsConfig:z,dependencies:t})}return u};if(q.dependencies){Object.keys(q.dependencies).forEach(function(t){m[t]=p(q.dependencies[t])})}q.components.forEach(function(t){n.push(p(t))});o=e(o);s=e(s);g({type:g.CSS,resources:s});function r(){l.resolve.apply(null,n)}if(o.length>0){g({type:g.JS,resources:o}).done(r)}else{r()}}).fail(function(o){if(o.error){throw new Error(o.error+": "+o.message)}l.reject()});return l.promise()}return{init:j}});define("wikia.ui.component",["wikia.mustache"],function uicomponent(b){function c(e,f,h){var j=e.templates,k,d,g=[];if(!j.hasOwnProperty(f)){throw new Error("Requested component type is not supported!")}d=e.templateVarsConfig[f].required;g=[];d.forEach(function(l){if(!h.hasOwnProperty(l)){g.push(l)}});if(g.length>0){k=g.join(", ");throw new Error("Missing required mustache variables: "+k+"!")}}function a(){if(!(this instanceof a)){return new a()}var d={},e,f;this.render=function(g){e=g.type;f=g.vars;c(d,e,f);return b.render(d.templates[e],f)};this.setComponentsConfig=function(g){d=g};this.createComponent=function(h,j){var g=this;if(d.jsWrapperModule){require([d.jsWrapperModule],function(k){j(k.createComponent(h,g))})}else{j(g,h)}};this.getSubComponent=function(g){if(typeof d.dependencies[g]!=="undefined"){return d.dependencies[g]}throw new Error("Dependency "+g+" not found.")}}return a});


(function(){'use strict';var tracker,QueryString,uiFactory,FacebookLogin,bannerNotification;FacebookLogin={modal:false,form:false,callbacks:{},initialized:false,origins:{DROPDOWN:1,PAGE:2,MODAL:3},actions:{},track:false,bucky:window.Bucky('UserLoginFacebook'),log:function(msg){$().log(msg,'UserLoginFacebook');},init:function(origin){var self=this;if(this.initialized||window.wgUserName){return;}
this.bucky.timer.start('init');require(['wikia.tracker','wikia.querystring','wikia.ui.factory','BannerNotification'],function(t,qs,uf,BannerNotification){tracker=t;QueryString=qs;uiFactory=uf;bannerNotification=new BannerNotification().setType('error');self.actions=tracker.ACTIONS;self.track=tracker.buildTrackingFunction({category:'user-sign-up',value:origin||0,trackingMethod:'analytics'});self.initialized=true;self.bindEvents();$.loadFacebookSDK();self.log('init');self.bucky.timer.stop('init');});},bindEvents:function(){var self=this;this.bucky.timer.start('loginSetup');$('body').off('fb').on('click.fb','.sso-login-facebook',function(ev){ev.preventDefault();window.FB.login($.proxy(self.onFBLogin,self),{scope:'email'});if(UserLoginModal.$modal){UserLoginModal.$modal.trigger('close');}});this.bucky.timer.stop('loginSetup');},onFBLogin:function(response){var pageUrl,returnToURL,returnToQuery;if(typeof response!=='object'){this.track({action:this.actions.ERROR,label:'facebook-login'});}else if(response.authResponse){this.log('FB.login successful');this.track({action:this.actions.SUCCESS,label:'facebook-login'});this.bucky.timer.start('loginCallbackAjax');pageUrl=new QueryString();returnToURL=pageUrl.getVal('returnto');if(returnToURL){returnToQuery=pageUrl.getVal('returntoquery');}else{returnToURL=window.wgPageName;returnToQuery=window.location.search.substring(1);}
$.nirvana.postJson('FacebookSignupController','index',{returnto:returnToURL,returntoquery:returnToQuery},$.proxy(this.checkAccountCallback,this));}else{this.track({action:this.actions.SUCCESS,label:'facebook-login-not-auth'});}},checkAccountCallback:function(response){this.bucky.timer.stop('loginCallbackAjax');this.loginCallback=typeof this.callbacks['login-success']==='function'?this.callbacks['login-success']:false;if(response.loggedIn){if(this.loginCallback){this.loginCallback();}else{window.location=response.returnUrl;}}else if(response.loginAborted){bannerNotification.setContent(response.errorMsg).show();}else if(response.unconfirmed){$.get(wgScriptPath+'/wikia.php',{controller:'UserLoginSpecial',method:'getUnconfirmedUserRedirectUrl',format:'json',username:response.userName},function(json){window.location=json.redirectUrl;});}else{this.setupModal(response);}},setupModal:function(response){if(!response.modal){bannerNotification.setContent($.msg('oasis-generic-error')).show();return;}
this.bucky.timer.start('loggedOutCallback');$.when(uiFactory.init('modal'),$.getResources([$.getSassCommonURL('extensions/wikia/UserLogin/css/UserLoginFacebook.scss')])).then(this.buildModal.bind(this,response));},buildModal:function(response,uiModal){var self=this,modalConfig={vars:{id:'FacebookSignUp',size:'medium',content:response.modal,htmlTitle:response.htmlTitle,classes:['facebook-signup-modal']}};uiModal.createComponent(modalConfig,function(facebookSignupModal){var $modal=facebookSignupModal.$element;self.modal=facebookSignupModal;facebookSignupModal.bind('beforeClose',function(){self.track({action:self.actions.CLOSE,label:'facebook-login-modal'});});self.createSignupForm($modal);self.createLoginForm($modal);$modal.on('click','.extiw',function(event){self.track({action:tracker.ACTIONS.CLICK_LINK_TEXT,browserEvent:event,href:$(event.target).attr('href'),label:'wikia-terms-of-use'});});self.track({action:self.actions.OPEN,label:'facebook-login-modal'});facebookSignupModal.show();self.bucky.timer.stop('loggedOutCallback');});},createSignupForm:function($modal){var self=this;this.signupForm=new window.FacebookFormCreateUser($modal.find('.UserLoginFacebookLeft'),{ajaxLogin:true,skipFocus:true,callback:function(){self.track({action:self.actions.SUBMIT,label:'facebook-signup-modal'});if(self.loginCallback){self.loginCallback();}else{window.location.href=this.returnToUrl;}}});this.initSignupFormValidation();},initSignupFormValidation:function(){var validator,wikiaForm=this.signupForm.wikiaForm,inputs=wikiaForm.inputs,inputsToValidate=['username','password'],$filteredInputs=$();if(inputs.email){inputsToValidate.push('email');}
validator=new UserSignupAjaxValidation({wikiaForm:wikiaForm,submitButton:inputs.submit});inputsToValidate.forEach(function(inputName){$filteredInputs=$filteredInputs.add(inputs[inputName]);});$filteredInputs.on('blur',validator.validateInput.bind(validator));},createLoginForm:function($modal){var self=this;this.loginForm=new window.FacebookFormConnectUser($modal.find('.UserLoginFacebookRight'),{ajaxLogin:true,skipFocus:true,callback:function(){self.track({action:self.actions.SUBMIT,label:'facebook-login-modal'});if(self.loginCallback){self.loginCallback();}else{window.location.href=this.returnToUrl;}}});},closeSignupModal:function(){var modal=this.modal;if(modal){modal.trigger('close');}}};window.FacebookLogin=FacebookLogin;})();;define('usersignup.marketingOptIn',['wikia.geo'],function(geo){'use strict';function init(wikiaForm){var $optInField=wikiaForm.inputs.wpMarketingOptIn,$optInGroup=wikiaForm.getInputGroup('wpMarketingOptIn'),isEurope=geo.getContinentCode()==='EU',isCanada=geo.getCountryCode()==='CA',isJapan=geo.getCountryCode()==='JP';if(!$optInField.length||!$optInGroup.length){throw'Wikia Form must contain a field called wpMarketingOptIn';}
if(!isCanada&&!isJapan){$optInField.attr('checked',true);}
if(isEurope||isCanada||isJapan){$optInGroup.add($optInField).removeClass('hidden');}}
return{init:init};});;(function(){'use strict';var UserBaseAjaxForm=function(el,options){if(!(el instanceof HTMLElement||el instanceof jQuery||typeof el==='string')){throw new Error('This module requires an element or selector as its first argument');}
this.el=$(el);this.options=options||{};this.init();};UserBaseAjaxForm.prototype.init=function(){this.wikiaForm=new WikiaForm(this.el.find('form'));this.inputs=this.wikiaForm.inputs;this.cacheDOM();this.bindEvents();if(!this.options.skipFocus){this.inputs.username.focus();}};UserBaseAjaxForm.prototype.cacheDOM=function(){this.form=this.wikiaForm.form;this.forgotPasswordLink=this.form.find('.forgot-password');this.submitButton=this.el.find('input[type=submit]');};UserBaseAjaxForm.prototype.bindEvents=function(){this.form.on('submit',this.submitLogin.bind(this));};UserBaseAjaxForm.prototype.submitLogin=function(e){$(window).trigger('UserLoginSubmit');this.submitButton.attr('disabled','disabled');if(this.options.ajaxLogin){e.preventDefault();this.ajaxLogin();}};UserBaseAjaxForm.prototype.ajaxLogin=function(){$.nirvana.postJson('UserLoginSpecial','login',{loginToken:this.loginToken,username:this.inputs.username.val(),password:this.inputs.password.val(),keeploggedin:this.inputs.keeploggedin.is(':checked')},this.submitLoginHandler.bind(this));};UserBaseAjaxForm.prototype.submitLoginHandler=function(json){this.resetValidation();if(json.result==='ok'){this.onOkayResponse(json);}else if(json.result==='error'){this.onErrorResponse(json);}else if(json.result==='unconfirm'){this.onUnconfirmedEmailResponse();}};UserBaseAjaxForm.prototype.resetValidation=function(){this.form.find('.error-msg').remove();this.form.find('.input-group').removeClass('error');};UserBaseAjaxForm.prototype.onOkayResponse=function(json){var callback=this.options.callback||'';window.wgUserName=json.wgUserName;if(callback&&typeof callback==='function'){callback.bind(this,json)();}else{this.reloadPage();}};UserBaseAjaxForm.prototype.onErrorResponse=function(json){this.submitButton.removeAttr('disabled');this.errorValidation(json);};UserBaseAjaxForm.prototype.onUnconfirmedEmailResponse=function(){$.get(window.wgScriptPath+'/wikia.php',{controller:'UserLoginSpecial',method:'getUnconfirmedUserRedirectUrl',format:'json',username:this.inputs.username.val()},function(json){window.location=json.redirectUrl;});};UserBaseAjaxForm.prototype.errorValidation=function(json){if(json.errParam){this.wikiaForm.showInputError(json.errParam,json.msg);}else{this.wikiaForm.showGenericError(json.msg);}};UserBaseAjaxForm.prototype.reloadPage=function(){require(['wikia.querystring'],function(QuerySring){var qs=new QuerySring();qs.addCb().goTo();});};window.UserBaseAjaxForm=UserBaseAjaxForm;})();;(function(){'use strict';var UserSignupMixin=function(){this.initOptIn=function(wikiaForm){require(['usersignup.marketingOptIn'],function(optIn){optIn.init(wikiaForm);});};this.setCountryValue=function(wikiaForm){var country=Wikia.geo.getCountryCode();wikiaForm.inputs.wpRegistrationCountry.val(country);};};window.UserSignupMixin=UserSignupMixin;})();;(function(){'use strict';var UserSignupAjaxValidation=function(options){this.wikiaForm=options.wikiaForm;this.submitButton=$(options.submitButton);this.deferred=false;this.passwordInputName=options.passwordInputName||'password';};UserSignupAjaxValidation.prototype.validateInput=function(e){var $el=$(e.target),data={},inputName=$el.attr('name'),value=$el.val(),usernameAlias='userloginext01';if(inputName===this.passwordInputName){this.validatePassword(value);}else{if(inputName==='username'){data.field=usernameAlias;data[usernameAlias]=value;}else{data.field=inputName;data[inputName]=value;}
this.sendValidationRequest(data).done(this.validationHandler.bind(this,inputName));}};UserSignupAjaxValidation.prototype.validatePassword=function(password){var pwLength=password.length,msg='',inputName=this.passwordInputName,response={};if(pwLength<wgMinimalPasswordLength){msg=mw.message('userlogin-error-wrongpasswordempty').escaped();}else if(pwLength>wgWikiaMaxNameChars){msg=mw.message('usersignup-error-password-length').escaped();}
if(msg!==''){response.msg=msg;response.result='error';}else{response.result='ok';}
this.validationHandler(inputName,response);};UserSignupAjaxValidation.prototype.validateBirthdate=function(e){var $el,inputName,data;if(this.deferred&&typeof this.deferred.reject==='function'){this.deferred.reject();}
$el=$(e.target);inputName=$el.attr('name');data={field:'birthdate',birthyear:this.wikiaForm.inputs.birthyear.val(),birthmonth:this.wikiaForm.inputs.birthmonth.val(),birthday:this.wikiaForm.inputs.birthday.val()};this.deferred=this.sendValidationRequest(data).done(this.validationHandler.bind(this,inputName));};UserSignupAjaxValidation.prototype.validationHandler=function(inputName,response){if(response.result==='ok'){this.wikiaForm.clearInputError(inputName);}else{this.wikiaForm.showInputError(inputName,response.msg);}};UserSignupAjaxValidation.prototype.sendValidationRequest=function(data){return $.nirvana.sendRequest({controller:'UserSignupSpecial',method:'formValidation',type:'GET',data:data});};window.UserSignupAjaxValidation=UserSignupAjaxValidation;})();;(function(){'use strict';var FacebookFormCreateUser=function(el,options){UserBaseAjaxForm.call(this,el,options);};FacebookFormCreateUser.prototype=Object.create(UserBaseAjaxForm.prototype);UserSignupMixin.call(FacebookFormCreateUser.prototype);FacebookFormCreateUser.prototype.init=function(){UserBaseAjaxForm.prototype.init.call(this);this.initOptIn(this.wikiaForm);this.setCountryValue(this.wikiaForm);};FacebookFormCreateUser.prototype.ajaxLogin=function(){var formData=this.wikiaForm.form.serialize();this.returnToUrl=this.inputs.returntourl.val();$.nirvana.postJson('FacebookSignupController','signup',formData,this.submitLoginHandler.bind(this));};FacebookFormCreateUser.prototype.submitLoginHandler=function(response){if(response.result==='ok'){window.Wikia.Tracker.track({category:'user-sign-up',trackingMethod:'analytics',action:window.Wikia.Tracker.ACTIONS.SUCCESS,label:'facebook-signup'});}
UserBaseAjaxForm.prototype.submitLoginHandler.call(this,response);};window.FacebookFormCreateUser=FacebookFormCreateUser;})();;(function(){'use strict';var FacebookFormConnectUser=function(el,options){UserBaseAjaxForm.call(this,el,options);};FacebookFormConnectUser.prototype=Object.create(UserBaseAjaxForm.prototype);FacebookFormConnectUser.prototype.ajaxLogin=function(){var formData=this.wikiaForm.form.serialize();this.returnToUrl=this.inputs.returntourl.val();$.nirvana.postJson('FacebookSignupController','login',formData,this.submitLoginHandler.bind(this));};window.FacebookFormConnectUser=FacebookFormConnectUser;})();;(function(){'use strict';var UserLoginAjaxForm=function(el,options){UserBaseAjaxForm.call(this,el,options);};UserLoginAjaxForm.prototype=Object.create(UserBaseAjaxForm.prototype);UserLoginAjaxForm.prototype.init=function(){UserBaseAjaxForm.prototype.init.call(this);this.retrieveLoginToken();};UserLoginAjaxForm.prototype.submitLoginHandler=function(json){var result=json.result;UserBaseAjaxForm.prototype.submitLoginHandler.call(this,json);if(result==='resetpass'){this.onResetPasswordResponse(json);}else if(result==='closurerequested'){this.onAccountClosureRequestResponse();}else{this.onErrorResponse();}};UserLoginAjaxForm.prototype.onResetPasswordResponse=function(){$.nirvana.sendRequest({controller:'UserLoginSpecial',method:'changePassword',format:'html',data:{username:this.inputs.username.val(),password:this.inputs.password.val(),loginToken:this.inputs.loginToken.val(),returnto:this.inputs.returnto.val(),fakeGet:1},callback:this.setupChangePasswordForm.bind(this)});};UserLoginAjaxForm.prototype.setupChangePasswordForm=function(html){var content,form,heading,modal,contentBlock,duration;content=$('<div>').hide().append(html);duration=400;if(this.options.modal){heading=content.find('h1');modal=this.options.modal;contentBlock=modal.$element.find('.UserLoginModal');modal.setTitle(heading.text());heading.remove();contentBlock.slideUp(duration,function(){contentBlock.html('').html(content);content.show();contentBlock.slideDown(duration);});}else{form=this.form;form.slideUp(duration,(function(){var newForm=content.find('form');form.replaceWith(content);content.slideDown(duration);newForm.on('submit',this.submitLoginAfterResetPass.bind(this));this.wikiaForm=new WikiaForm(newForm);this.inputs=this.wikiaForm.inputs;}).bind(this));}};UserLoginAjaxForm.prototype.onAccountClosureRequestResponse=function(){$.post(wgScriptPath+'/wikia.php',{controller:'UserLoginSpecial',method:'getCloseAccountRedirectUrl',format:'json'},function(data){window.location=data.redirectUrl;});};UserLoginAjaxForm.prototype.retrieveLoginToken=function(params){params=params||{};if(!this.loginToken||params.clearCache){this.loginToken='retrieving';$.nirvana.postJson('UserLoginSpecial','retrieveLoginToken',function(res){this.loginToken=res.loginToken;this.inputs.loginToken.val(res.loginToken);}.bind(this));}};UserLoginAjaxForm.prototype.submitLoginAfterResetPass=function(e){this.submitButton.attr('disabled','disabled');if(this.options.ajaxLogin){e.preventDefault();this.ajaxLoginAfterResetPass();}};UserLoginAjaxForm.prototype.ajaxLoginAfterResetPass=function(){$.nirvana.postJson('UserLoginSpecial','loginForm',{loginToken:this.loginToken,username:this.inputs.username.val(),password:this.inputs.password.val(),newpassword:this.inputs.newpassword.val(),retype:this.inputs.retype.val(),action:this.inputs.action.val(),editToken:this.inputs.editToken.val()},this.submitLoginHandler.bind(this));};window.UserLoginAjaxForm=UserLoginAjaxForm;})();;(function(){'use strict';var UserLoginModal={loginAjaxForm:false,isInitializationStarted:false,uiFactory:false,packagesData:false,$modal:false,bucky:window.Bucky('UserLoginModal'),initModal:function(options){var self=this;this.bucky.timer.start('initModal');require(['wikia.tracker'],function(tracker){self.trackerActions=tracker.ACTIONS;self.track=tracker.buildTrackingFunction({category:'force-login-modal',trackingMethod:'analytics'});});$.when(Wikia.getMultiTypePackage({templates:[{controller:'UserLoginSpecial',method:'modal',params:{uselang:window.wgUserLanguage}}],styles:'/extensions/wikia/UserLogin/css/UserLoginModal.scss',messages:'UserLogin'})).done(function(packagesData){require(['wikia.ui.factory','wikia.loader'],function(uiFactory,loader){loader.processStyle(packagesData.styles);self.uiFactory=uiFactory;self.packagesData=packagesData;self.buildModal(options);self.bucky.timer.stop('initModal');});});},buildModal:function(options){var self=this,origin='',clickAction=this.trackerActions.CLICK;this.bucky.timer.start('buildModal');this.uiFactory.init('modal').then(function(uiModal){var modalTemplateName='UserLoginSpecial_modal',modalConfig={type:'default',vars:{id:'userForceLoginModal',size:'medium',content:self.packagesData.templates[modalTemplateName],title:$.msg('userlogin-login-heading'),closeButton:true}};uiModal.createComponent(modalConfig,function(loginModal){UserLoginModal.$modal=loginModal;var $loginModal=loginModal.$element;if(window.FacebookLogin){$.loadFacebookSDK();window.FacebookLogin.init(window.FacebookLogin.origins.MODAL);}
UserLoginModal.loginAjaxForm=new window.UserLoginAjaxForm($loginModal,{ajaxLogin:true,modal:loginModal,callback:function(res){window.wgUserName=res.username;var callback=options.callback;if(callback&&typeof callback==='function'){if(!options.persistModal){UserLoginModal.$modal.trigger('close');}
callback();}else{this.reloadPage();}}});if(options.modalInitCallback&&typeof options.modalInitCallback==='function'){options.modalInitCallback();}
if(options.origin){origin=options.origin;}
self.track({action:self.trackerActions.OPEN,label:'from-'+origin});$loginModal.on('click','.forgot-password',function(){self.track({action:clickAction,label:'forgot-password'});}).on('click','input.keep-logged-in',function(){self.track({action:clickAction,label:'keep-me-logged-in'});}).on('click','.get-account a',function(){self.track({action:clickAction,label:'sign-up-from-'+origin});}).on('click','.sso-login-facebook',function(){self.track({action:clickAction,label:'facebook-connect'});}).on('click','input.login-button',function(){self.track({action:clickAction,label:'login-from-'+origin});});self.bucky.timer.stop('buildModal');});});},show:function(options){options=options||{};options.modalInitCallback=$.proxy(function(){this.$modal.show();},this);this.initModal(options);return true;},isPreventingForceLogin:function(element){if(!(element.closest('span').hasClass('drop'))&&!(element.closest('ul').hasClass('WikiaMenuElement'))){return false;}
return true;},init:function(){var editpromptable=$('#te-editanon, .loginToEditProtectedPage, .upphotoslogin');if(window.wgDisableAnonymousEditing){editpromptable=editpromptable.add('.editsection');}
editpromptable.click($.proxy(function(ev){ev.stopPropagation();if(!this.isPreventingForceLogin($(ev.target))&&window.UserLogin.isForceLogIn()){ev.preventDefault();}},this));$('body').delegate('.ajaxLogin','click',function(e){UserLoginModal.show();e.preventDefault();});}};window.UserLoginModal=UserLoginModal;$(function(){UserLoginModal.init();});})();;var LatestActivity={wikiaRecentActivityContainer:null,init:function(){this.wikiaRecentActivityContainer=$('#wikia-recent-activity');if(this.wikiaRecentActivityContainer.exists()){this.lazyLoadContent();}},lazyLoadContent:function(){$.nirvana.sendRequest({controller:'LatestActivity',method:'Index',format:'html',type:'GET',callback:$.proxy(function(html){if($.browser.msie){this.wikiaRecentActivityContainer.empty().append($(html).children());}else{this.wikiaRecentActivityContainer.replaceWith(html);}},this)});}};$(window).load(function(){$('.WikiaRail').on('afterLoad.rail',function(){LatestActivity.init();});});;


define('wikia.browserDetect',['wikia.window'],function(win){'use strict';var appName=win.navigator.appName,userAgent=win.navigator.userAgent,browser=null,operatingSystem=null;function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);}
function isIE(){var bool=false;if(appName==='Microsoft Internet Explorer'||(appName==='Netscape'&&userAgent.indexOf('Trident/')!==-1)){bool=true;}
return bool;}
function isEdge(){return userAgent.indexOf('Edge')!==-1;}
function isFirefox(){return userAgent.toLowerCase().indexOf('firefox')>-1;}
function isIPad(){var bool=false;if(userAgent.match(/iPad/i)!==null){bool=true;}
return bool;}
function isIOS7orLower(){return!!userAgent.match(/iPad.+OS.[6,7].\d.+like.Mac.OS.+Safari/i);}
function isAndroid(){return userAgent.toLowerCase().indexOf('android')>-1;}
function getOS(){if(null!==operatingSystem){return operatingSystem;}
operatingSystem='unknown';if(userAgent.indexOf('Win')!==-1){operatingSystem='Windows';}
if(userAgent.indexOf('Mac')!==-1){operatingSystem='OSX';}
if(userAgent.indexOf('Linux')!==-1){operatingSystem='Linux';}
if(userAgent.indexOf('Android')!==-1){operatingSystem='Android';}
if(userAgent.indexOf('like Mac')!==-1){operatingSystem='iOS';}
return operatingSystem;}
function getBrowser(){if(null!==browser){return browser;}
var appVersion=win.navigator.appVersion,temp,matches=userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(matches[1])){temp=/\brv[ :]+(\d+)/g.exec(userAgent)||[];browser='IE '+(temp[1]||'');return browser;}
if(matches[1]==='Chrome'){temp=userAgent.match(/\b(OPR|Edge)\/(\d+)/);if(temp!==null){browser=temp.slice(1).join(' ').replace('OPR','Opera');return browser;}}
matches=matches[2]?[matches[1],matches[2]]:[appName,appVersion,'-?'];temp=userAgent.match(/version\/(\d+)/i);if(temp!==null){matches.splice(1,1,temp[1]);}
browser=matches.join(' ');return browser;}
function getBrowserVersion(){var browserStringParts=getBrowser().split(' ');return parseInt(browserStringParts[1],10);}
return{getBrowser:getBrowser,getBrowserVersion:getBrowserVersion,getOS:getOS,isIE:isIE,isFirefox:isFirefox,isIPad:isIPad,isIOS7orLower:isIOS7orLower,isAndroid:isAndroid,isMobile:isMobile,isEdge:isEdge};});;define('wikia.iframeWriter',['wikia.document','wikia.log'],function(doc,log){'use strict';var logGroup='wikia.iframeWriter',iframeStyle='<style>* {margin: 0; padding: 0;}</style>',iframeHeader='<html><body>',iframeFooter='</body></html>';function getIframe(params){log(['getIframe',params],'debug',logGroup);var code=iframeHeader+iframeStyle+params.code+iframeFooter,loaded=false,iframe=doc.createElement('iframe');iframe.frameBorder='no';iframe.scrolling='no';iframe.width=params.width;iframe.height=params.height;if(params.classes){iframe.className=params.classes;}
iframe.onload=function(){if(loaded){return;}
loaded=true;iframe.contentWindow.document.write(code);iframe.contentWindow.document.close();};return iframe;}
return{getIframe:getIframe};});;define('wikia.scriptwriter',['wikia.document','wikia.lazyqueue','wikia.log','wikia.window','wikia.loader'],function(doc,lazyQueue,log,win,loader){'use strict';var logGroup='wikia.scriptwriter',library='ghostwriter',queue=[],loading=false;function gwFlushLoadHandlersAndCall(callback){return function(){win.ghostwriter.flushloadhandlers();callback();};}
function noop(){return;}
function processItem(params){log(['processItem',library,params],'debug',logGroup);var text=params.gwScriptText||'document.write('+JSON.stringify(params.html)+');';win.ghostwriter(params.element,{insertType:'append',script:{text:text},done:gwFlushLoadHandlersAndCall(params.callback)});}
function processQueue(){log('processQueue','debug',logGroup);lazyQueue.makeQueue(queue,processItem);queue.start();}
function loadLibrary(){var url;if(loading){return;}
loading=true;log(['loadLibrary',library],'debug',logGroup);url='/resources/wikia/libraries/ghostwriter/gw.min.js';loader(url).done(processQueue);}
function getElement(elementOrElementId){if(elementOrElementId&&elementOrElementId.getElementsByTagName){return elementOrElementId;}
if(typeof elementOrElementId==='string'){var el=doc.getElementById(elementOrElementId);if(el){return el;}}
throw'wikia.scriptwriter: Not a valid element or element id '+elementOrElementId;}
function queueHtmlInjection(params){log(['queueHtmlInjection',params],'debug',logGroup);queue.push(params);loadLibrary();}
function escapeHtml(str){return str.replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function injectHtml(elementOrElementId,html,callback){queueHtmlInjection({element:getElement(elementOrElementId),html:html,callback:callback||noop});}
function injectScriptByUrl(elementOrElementId,url,callback){queueHtmlInjection({element:getElement(elementOrElementId),html:'<script src="'+escapeHtml(url)+'"></script>',callback:callback||noop});}
function injectScriptByText(elementOrElementId,text,callback){queueHtmlInjection({element:getElement(elementOrElementId),html:'<script src="data:text/javascript,'+encodeURIComponent(text)+'"></script>',gwScriptText:text,callback:callback||noop});}
return{injectHtml:injectHtml,injectScriptByUrl:injectScriptByUrl,injectScriptByText:injectScriptByText};});;define('ext.wikia.adEngine.adDecoratorLegacyParamFormat',['wikia.log'],function(log){'use strict';var logGroup='ext.wikia.adEngine.adDecoratorLegacyParamFormat';function convertSimpleParamsForFillInSlot(slot){if(slot instanceof Array){slot=slot[0];}
if(typeof slot==='string'){slot={slotName:slot};}
if(slot&&slot.slotName){return slot;}}
function decorator(fillInSlot){function enhancedFillInSlot(slot){var param=convertSimpleParamsForFillInSlot(slot);if(param){fillInSlot(param);}else{log(['Incorrect fillInSlot param:',param],'error',logGroup);}}
return enhancedFillInSlot;}
return decorator;});;define('ext.wikia.adEngine.adDecoratorPageDimensions',['ext.wikia.adEngine.adLogicPageDimensions','wikia.log'],function(adLogicPageDimensions,log){'use strict';var logGroup='ext.wikia.adEngine.adDecoratorPageDimensions';function decorator(fillInSlot){log(['decorator',fillInSlot],'debug',logGroup);return function(slot){log(['decorated',slot],'debug',logGroup);var slotname=slot.slotName;if(adLogicPageDimensions.isApplicable(slotname)){adLogicPageDimensions.addSlot(slotname,function(){fillInSlot(slot);});log(['decorated',slot,'deferred'],'debug',logGroup);return function(){return;};}
log(['decorated',slot,'return same'],'debug',logGroup);return fillInSlot(slot);};}
return decorator;});;define('ext.wikia.adEngine.adEngine',['ext.wikia.adEngine.adDecoratorLegacyParamFormat','ext.wikia.adEngine.utils.eventDispatcher','ext.wikia.adEngine.slot.adSlot','ext.wikia.adEngine.slot.service.slotRegistry','ext.wikia.adEngine.slotTracker','ext.wikia.adEngine.slotTweaker','ext.wikia.adEngine.utils.hooks','wikia.document','wikia.lazyqueue','wikia.log'],function(adDecoratorLegacyParamFormat,eventDispatcher,adSlot,slotRegistry,slotTracker,slotTweaker,registerHooks,doc,lazyQueue,log){'use strict';var logGroup='ext.wikia.adEngine.adEngine';function decorate(func,decorators){log(['decorate',func,decorators],log.levels.debug,logGroup);var i,len;if(decorators&&decorators.length){for(i=0,len=decorators.length;i<len;i+=1){func=decorators[i](func);}}
return func;}
function cleanProviderContainers(slotName){var slotContainer=doc.getElementById(slotName),containers,i;if(!slotContainer){return;}
containers=slotContainer.childNodes;for(i=containers.length-1;i>=0;i-=1){if(containers[i].tagName!=='SCRIPT'){slotContainer.removeChild(containers[i]);}}}
function prepareAdProviderContainer(providerName,slotName){var providerContainerId=providerName+'_'+slotName.split('.')[0],adContainer=doc.getElementById(slotName),providerContainer=doc.getElementById(providerContainerId);if(!providerContainer&&adContainer){providerContainer=doc.createElement('div');providerContainer.classList.add('provider-container');providerContainer.id=providerContainerId;adContainer.appendChild(providerContainer);}
log(['prepareAdProviderContainer',providerName,slotName,providerContainer],log.levels.debug,logGroup);return providerContainer;}
function initializeProviderOnce(provider){if(!provider.fillInSlotQueue){provider.fillInSlotQueue=[];lazyQueue.makeQueue(provider.fillInSlotQueue,function(args){provider.fillInSlot.apply(provider,args);});if(provider.initialize){provider.initialize(provider.fillInSlotQueue.start);}else{provider.fillInSlotQueue.start();}}}
function createSlot(queuedSlot,container,callbacks){var slot=adSlot.create(queuedSlot.slotName,container,callbacks);registerHooks(slot,['success','collapse','hop','renderEnded','viewed']);slot.post('success',queuedSlot.onSuccess);return slot;}
function run(adConfig,adslots,queueName){log(['run',adslots,queueName],log.levels.debug,logGroup);function fillInSlotUsingProvider(queuedSlot,provider,nextProvider){log(['fillInSlotUsingProvider',provider.name,queuedSlot],log.levels.debug,logGroup);var slotName=queuedSlot.slotName,container=prepareAdProviderContainer(provider.name,slotName),tracker=slotTracker(provider.name,slotName,queueName),slot=createSlot(queuedSlot,container,{success:function(adInfo){log(['success',provider.name,slotName,adInfo],log.levels.debug,logGroup);slotTweaker.show(slotName);eventDispatcher.dispatch('adengine.slot.status',{slot:slot,status:'success',adInfo:adInfo});tracker.track('success',adInfo);slot.container.setAttribute('data-slot-result','success');},collapse:function(adInfo){log(['collapse',provider.name,slotName,adInfo],log.levels.debug,logGroup);slotTweaker.hide(slotName);eventDispatcher.dispatch('adengine.slot.status',{slot:slot,status:'collapse',adInfo:adInfo});tracker.track('collapse',adInfo);slot.container.setAttribute('data-slot-result','collapse');},hop:function(adInfo){log(['hop',provider.name,slotName,adInfo],log.levels.debug,logGroup);slotTweaker.hide(container.id);eventDispatcher.dispatch('adengine.slot.status',{slot:slot,status:'hop',adInfo:adInfo});tracker.track('hop',adInfo);slot.container.setAttribute('data-slot-result','hop');nextProvider();},renderEnded:function(){log(['renderEnded',provider.name,slotName],log.levels.debug,logGroup);slot.container.setAttribute('data-slot-result','loading');},viewed:function(){log(['viewed',provider.name,slotName],log.levels.debug,logGroup);slot.container.setAttribute('data-slot-viewed','true');}});slot.post('viewed',function(){slot.isViewed=true;});if(slotTweaker.isTopLeaderboard(slotName)){slot.pre('collapse',function(){slotTweaker.hide('TOP_BUTTON_WIDE');});}
slotRegistry.add(slot,provider.name);initializeProviderOnce(provider);provider.fillInSlotQueue.push([slot]);}
function fillInSlot(slot){log(['fillInSlot',slot],log.levels.debug,logGroup);var slotName=slot.slotName,providerList=adConfig.getProviderList(slotName).slice();log(['fillInSlot',slot,'provider list',JSON.stringify(providerList)],log.levels.debug,logGroup);function handleNoAd(){log(['handleNoAd',slot],log.levels.debug,logGroup);slotTweaker.hide(slotName);if(typeof slot.onError==='function'){slot.onError(slot);}}
function nextProvider(){var provider;do{provider=providerList.shift();if(!provider){handleNoAd();return;}
if(provider.canHandleSlot(slotName)){fillInSlotUsingProvider(slot,provider,nextProvider);return;}
log(['fillInSlot',slot,'skipping provider, cannot handle slot',provider],log.levels.debug,logGroup);}while(provider);}
slotRegistry.reset(slotName);cleanProviderContainers(slotName);nextProvider();}
var decorators=adConfig.getDecorators()||[];if(adDecoratorLegacyParamFormat){decorators.push(adDecoratorLegacyParamFormat);}
log(['run','initializing lazyQueue on the queue'],log.levels.debug,logGroup);lazyQueue.makeQueue(adslots,decorate(fillInSlot,decorators));log(['run','launching queue on adslots ('+adslots.length+')'],log.levels.debug,logGroup);adslots.start();log(['run','initial queue handled'],log.levels.debug,logGroup);}
return{run:run};});;define('ext.wikia.adEngine.adEngineRunner',['ext.wikia.adEngine.adEngine','ext.wikia.adEngine.adTracker','wikia.instantGlobals','wikia.log','wikia.window',require.optional('ext.wikia.adEngine.lookup.amazonMatch'),require.optional('ext.wikia.adEngine.lookup.rubicon.rubiconFastlane'),require.optional('ext.wikia.aRecoveryEngine.adBlockRecovery'),require.optional('ext.wikia.adEngine.lookup.prebid')],function(adEngine,adTracker,instantGlobals,log,win,amazonMatch,rubiconFastlane,adBlockRecovery,prebid){'use strict';var logGroup='ext.wikia.adEngine.adEngineRunner',supportedModules=[amazonMatch,rubiconFastlane,adBlockRecovery,prebid],timeout=instantGlobals.wgAdDriverDelayTimeout||2000;function delayRun(runAdEngine){var modulesQueue=[],enabledModules=[],startedByModules=false;function markModule(name){log(name+' responded',log.levels.debug,logGroup);if(modulesQueue.indexOf(name)===-1){modulesQueue.push(name);}
if(modulesQueue.length===enabledModules.length){log('All modules responded',log.levels.info,logGroup);startedByModules=true;adTracker.measureTime('adengine_runner/modules_responded',modulesQueue.join(',')).track();runAdEngine();}}
function registerModules(){log(['Register modules',enabledModules.length],log.levels.debug,logGroup);enabledModules.forEach(function(module){var name=module.getName();module.addResponseListener(function(){markModule(name);});});}
function getTimeoutModules(){var timeoutModules=[];enabledModules.forEach(function(enabledModule){var enabledModuleName=enabledModule.getName();if(modulesQueue.indexOf(enabledModuleName)===-1){timeoutModules.push(enabledModuleName);}});return timeoutModules.join(',');}
supportedModules.forEach(function(module){if(module&&module.wasCalled()){enabledModules.push(module);}});if(enabledModules.length===0){log('All modules are disabled',log.levels.info,logGroup);runAdEngine();}else{registerModules();win.setTimeout(function(){if(!startedByModules){log(['Timeout exceeded',timeout],log.levels.info,logGroup);adTracker.measureTime('adengine_runner/modules_timeout',getTimeoutModules()).track();runAdEngine();}},timeout);}}
function run(config,slots,queueName,delayEnabled){var engineStarted=false;function runAdEngine(){if(engineStarted){return;}
engineStarted=true;log('Running AdEngine',log.levels.info,logGroup);adTracker.measureTime('adengine.init',queueName).track();adEngine.run(config,slots,queueName);}
if(delayEnabled){delayRun(runAdEngine);}else{log('Run AdEngine without delay',log.levels.info,logGroup);runAdEngine();}}
return{run:run};});;define('ext.wikia.adEngine.adInfoTracker',['ext.wikia.adEngine.adInfoTrackerHelper','ext.wikia.adEngine.adTracker','ext.wikia.adEngine.adContext','wikia.log','wikia.window',require.optional('ext.wikia.adEngine.mobile.mercuryListener')],function(adInfoTrackerHelper,adTracker,adContext,log,win,mercuryListener){'use strict';var logGroup='ext.wikia.adEngine.adInfoTracker',enabledSlots={TOP_LEADERBOARD:true,TOP_RIGHT_BOXAD:true,PREFOOTER_LEFT_BOXAD:true,PREFOOTER_MIDDLE_BOXAD:true,PREFOOTER_RIGHT_BOXAD:true,LEFT_SKYSCRAPER_2:true,LEFT_SKYSCRAPER_3:true,INCONTENT_BOXAD_1:true,INCONTENT_PLAYER:true,BOTTOM_LEADERBOARD:true,MOBILE_TOP_LEADERBOARD:true,MOBILE_BOTTOM_LEADERBOARD:true,MOBILE_IN_CONTENT:true,MOBILE_PREFOOTER:true};function logSlotInfo(data){log(['logSlotInfo',data],log.levels.debug,logGroup);adTracker.trackDW(data,'adengadinfo');}
function isEnabled(){return adContext.getContext().opts.enableAdInfoLog;}
function setAdEnginePvUID(){win.adEnginePvUID=win.adEnginePvUID||adInfoTrackerHelper.generateUUID();}
function run(){setAdEnginePvUID();if(mercuryListener){mercuryListener.onEveryPageChange(function(){win.adEnginePvUID=adInfoTrackerHelper.generateUUID();});}
if(isEnabled()){log('run',log.levels.debug,logGroup);win.addEventListener('adengine.slot.status',function(event){var data,slot=event.detail.slot;if(adInfoTrackerHelper.shouldHandleSlot(slot,enabledSlots)){data=adInfoTrackerHelper.prepareData(slot,event.detail.status);log(['adengine.slot.status',event],log.levels.debug,logGroup);if(data){logSlotInfo(data);}}});}}
return{run:run};});;define('ext.wikia.adEngine.adInfoTrackerHelper',['ext.wikia.adEngine.lookup.services','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.log','wikia.window'],function(lookupServices,adBlockDetection,log,win){'use strict';var logGroup='ext.wikia.adEngine.adInfoTrackerHelper';function shouldHandleSlot(slot,enabledSlots){var dataGptDiv=slot.container.firstChild;return(enabledSlots[slot.name]&&dataGptDiv&&dataGptDiv.dataset.gptPageParams&&!adBlockDetection.isBlocking());}
function prepareData(slot,status){log(['prepareData',slot,status],log.levels.debug,logGroup);var data,slotFirstChildData=slot.container.firstChild.dataset,pageParams=JSON.parse(slotFirstChildData.gptPageParams),slotParams=JSON.parse(slotFirstChildData.gptSlotParams),slotPricesIgnoringTimeout=lookupServices.getCurrentSlotPrices(slot.name),realSlotPrices=lookupServices.getDfpSlotPrices(slot.name),slotSize=JSON.parse(slotFirstChildData.gptCreativeSize);data={'pv':pageParams.pv||'','pv_unique_id':win.adEnginePvUID,'country':pageParams.geo||'','time_bucket':(new Date()).getHours(),'slot_size':slotSize&&slotSize.length?slotSize.join('x'):'','kv_s0':pageParams.s0||'','kv_s1':pageParams.s1||'','kv_s2':pageParams.s2||'','kv_s0v':pageParams.s0v||'','kv_pos':slotParams.pos||'','kv_rv':slotParams.rv||'','kv_wsi':slotParams.wsi||'','kv_lang':pageParams.lang||'','kv_skin':pageParams.skin||'','kv_esrb':pageParams.esrb||'','kv_ref':pageParams.ref||'','kv_top':pageParams.top||'','kv_ah':pageParams.ah||'','bidder_won':slotParams.hb_bidder||'','bidder_1':transformBidderPrice('indexExchange',realSlotPrices,slotPricesIgnoringTimeout),'bidder_2':transformBidderPrice('appnexus',realSlotPrices,slotPricesIgnoringTimeout),'bidder_3':transformBidderPrice('fastlane',realSlotPrices,slotPricesIgnoringTimeout),'bidder_4':transformBidderPrice('rubicon',realSlotPrices,slotPricesIgnoringTimeout),'bidder_5':transformBidderPrice('fastlane_private',realSlotPrices,slotPricesIgnoringTimeout),'bidder_6':transformBidderPrice('aol',realSlotPrices,slotPricesIgnoringTimeout),'bidder_7':transformBidderPrice('audienceNetwork',realSlotPrices,slotPricesIgnoringTimeout),'bidder_8':transformBidderPrice('veles',realSlotPrices,slotPricesIgnoringTimeout),'bidder_9':transformBidderPrice('openx',realSlotPrices,slotPricesIgnoringTimeout),'product_chosen':'','product_lineitem_id':slotFirstChildData.gptLineItemId||'','product_label':''};return data;}
function transformBidderPrice(bidderName,realSlotPrices,slotPricesIgnoringTimeout){if(realSlotPrices[bidderName]){return realSlotPrices[bidderName];}
if(slotPricesIgnoringTimeout[bidderName]){return slotPricesIgnoringTimeout[bidderName]+'not_used';}
return'';}
function generateUUID(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});}
return{generateUUID:generateUUID,prepareData:prepareData,shouldHandleSlot:shouldHandleSlot};});;define('ext.wikia.adEngine.adLogicDartSubdomain',['wikia.geo'],function(Geo){'use strict';function getSubdomain(){switch(Geo.getContinentCode()){case'AF':case'EU':return'ad-emea';case'AS':switch(Geo.getCountryCode()){case'AE':case'CY':case'BH':case'IL':case'IQ':case'IR':case'JO':case'KW':case'LB':case'OM':case'PS':case'QA':case'SA':case'SY':case'TR':case'YE':return'ad-emea';default:return'ad-apac';}
case'OC':return'ad-apac';default:return'ad';}}
return{getSubdomain:getSubdomain};});;define('ext.wikia.adEngine.adLogicPageDimensions',['ext.wikia.adEngine.slotTweaker','wikia.document','wikia.log','wikia.throttle','wikia.window'],function(slotTweaker,doc,log,throttle,win){'use strict';var logGroup='ext.wikia.adEngine.adLogicPageDimensions',initCalled=false,wrappedAds={},preFootersThreshold=1500,slotsOnlyOnLongPages={LEFT_SKYSCRAPER_2:2400,LEFT_SKYSCRAPER_3:4000,PREFOOTER_LEFT_BOXAD:preFootersThreshold,PREFOOTER_MIDDLE_BOXAD:preFootersThreshold,PREFOOTER_RIGHT_BOXAD:preFootersThreshold},pageHeight,slotsToHideOnMediaQuery={TOP_BUTTON_WIDE:'noTopButton','TOP_BUTTON_WIDE.force':'noTopButton',TOP_RIGHT_BOXAD:'oneColumn',LEFT_SKYSCRAPER_2:'oneColumn',LEFT_SKYSCRAPER_3:'oneColumn',INCONTENT_BOXAD_1:'oneColumn',PREFOOTER_MIDDLE_BOXAD:'noMiddlePrefooter'},mediaQueriesToCheck={twoColumns:'screen and (min-width: 1024px)',oneColumn:'screen and (max-width: 1023px)',noTopButton:'screen and (max-width: 1063px)',noMiddlePrefooter:'screen and (max-width: 1083px)'},mediaQueriesMet,matchMedia;function matchMediaMoz(query){return win.matchMedia(query).matches;}
function matchMediaIe(query){return win.styleMedia.matchMedium(query);}
matchMedia=win.matchMedia&&matchMediaMoz;matchMedia=matchMedia||(win.styleMedia&&win.styleMedia.matchMedium&&matchMediaIe);matchMedia=matchMedia||(win.media&&win.media.matchMedium);if(!matchMedia){log('No working matchMedia implementation found','user',logGroup);}
function shouldBeShown(slotname){var longEnough=false,wideEnough=false,conflictingMediaQuery;if(pageHeight){longEnough=!slotsOnlyOnLongPages[slotname]||pageHeight>slotsOnlyOnLongPages[slotname];}
if(mediaQueriesMet){if(slotsToHideOnMediaQuery[slotname]){conflictingMediaQuery=slotsToHideOnMediaQuery[slotname];wideEnough=!mediaQueriesMet[conflictingMediaQuery];}else{wideEnough=true;}}
if(!longEnough||!wideEnough){return false;}
return true;}
function refresh(ad){if(shouldBeShown(ad.slotname)){if(ad.state==='none'||ad.state==='ready'){log(['Loading ad in slot '+ad.slotname,ad],'info',logGroup);slotTweaker.show(ad.slotname,true);ad.loadCallback();ad.state='shown';}else if(ad.state==='hidden'){log(['Reshowing slot '+ad.slotname,ad],'info',logGroup);slotTweaker.show(ad.slotname,true);ad.state='shown';}}else{if(ad.state==='none'){log(['Hiding empty slot '+ad.slotname,ad],'info',logGroup);slotTweaker.hide(ad.slotname);slotTweaker.hackChromeRefresh(ad.slotname);ad.state='ready';}else if(ad.state==='shown'){log(['Hiding slot '+ad.slotname,ad],'info',logGroup);slotTweaker.hide(ad.slotname);slotTweaker.hackChromeRefresh(ad.slotname);ad.state='hidden';}}}
function updateVars(){var mediaQueryIndex;pageHeight=doc.documentElement.scrollHeight;if(win.wgOasisResponsive||win.wgOasisBreakpoints){if(matchMedia){mediaQueriesMet={};for(mediaQueryIndex in mediaQueriesToCheck){if(mediaQueriesToCheck.hasOwnProperty(mediaQueryIndex)){mediaQueriesMet[mediaQueryIndex]=matchMedia(mediaQueriesToCheck[mediaQueryIndex]);}}}}else{mediaQueriesMet={};for(mediaQueryIndex in mediaQueriesToCheck){if(mediaQueriesToCheck.hasOwnProperty(mediaQueryIndex)){mediaQueriesMet[mediaQueryIndex]=false;}}}}
function refreshAll(){var slotname;for(slotname in wrappedAds){if(wrappedAds.hasOwnProperty(slotname)){refresh(wrappedAds[slotname]);}}}
function onResize(){updateVars();refreshAll();}
function init(){log('init','debug',logGroup);if(win.addEventListener){win.addEventListener('orientationchange',throttle(onResize,100));win.addEventListener('resize',throttle(onResize,100));}else{log('No support for addEventListener. No dimension-dependent ads will be shown','error',logGroup);}
initCalled=true;}
function add(slotname,loadCallback){log(['add',slotname,loadCallback],'debug',logGroup);if(!initCalled){init();}
updateVars();wrappedAds[slotname]={slotname:slotname,state:'none',loadCallback:loadCallback};refresh(wrappedAds[slotname]);}
function isApplicable(slotname){log(['isApplicable',slotname],'debug',logGroup);return!!(slotsOnlyOnLongPages[slotname]||slotsToHideOnMediaQuery[slotname]);}
return{addSlot:add,isApplicable:isApplicable,shouldBeShown:shouldBeShown};});;define('ext.wikia.adEngine.adLogicPageParams',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageViewCounter','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.document','wikia.geo','wikia.location','wikia.log','wikia.window',require.optional('wikia.abTest'),require.optional('wikia.krux')],function(adContext,pvCounter,zoneParams,doc,geo,loc,log,win,abTest,krux){'use strict';var context={},logGroup='ext.wikia.adEngine.adLogicPageParams',runtimeParams={},skin=adContext.getContext().targeting.skin;function updateContext(){context=adContext.getContext();}
function getAb(){var experiments,experimentsNumber,i,ab=[];if(abTest){experiments=abTest.getExperiments();experimentsNumber=experiments.length;for(i=0;i<experimentsNumber;i+=1){ab.push(experiments[i].id+'_'+experiments[i].group.id);}}
return ab;}
function extend(target,obj){var key;for(key in obj){if(obj.hasOwnProperty(key)){target[key]=obj[key];}}
return target;}
function addParam(key,value){runtimeParams[key]=value;}
function decodeLegacyDartParams(dartString){var params={},kvs,kv,key,value,i,len;log(['decodeLegacyDartParams',dartString],9,logGroup);if(typeof dartString==='string'){kvs=dartString.split(';');for(i=0,len=kvs.length;i<len;i+=1){kv=kvs[i].split('=');key=kv[0];value=kv[1];if(key&&value&&key!=='esrb'){params[key]=params[key]||[];params[key].push(value);}}}
return params;}
function getRefParam(){var hostnameMatch,ref=doc.referrer,refHostname,searchDomains=/(google|search\.yahooo|bing|baidu|ask|yandex)/,wikiDomains=['wikia.com','ffxiclopedia.org','jedipedia.de','memory-alpha.org','uncyclopedia.org','websitewiki.de','wowwiki.com','yoyowiki.org'],wikiDomainsRegex=new RegExp('(^|\\.)('+wikiDomains.join('|').replace(/\./g,'\\.')+')$');if(!ref||typeof ref!=='string'){return'direct';}
refHostname=ref.match(/\/\/([^\/]+)\//);if(refHostname){refHostname=refHostname[1];}
hostnameMatch=refHostname===loc.hostname;if(hostnameMatch&&ref.indexOf('search=')>-1){return'wiki_search';}
if(hostnameMatch){return'wiki';}
hostnameMatch=wikiDomainsRegex.test(refHostname);if(hostnameMatch&&ref.indexOf('search=')>-1){return'wikia_search';}
if(hostnameMatch){return'wikia';}
if(searchDomains.test(refHostname)){return'external_search';}
return'external';}
function getAspectRatio(){return win.innerWidth>win.innerHeight?'4:3':'3:4';}
function getPageLevelParams(options){log('getPageLevelParams',9,logGroup);var params,targeting=context.targeting,pvs=pvCounter.get();options=options||{};params={s0:zoneParams.getSite(),s0v:zoneParams.getVertical(),s0c:zoneParams.getWikiCategories(),s1:zoneParams.getName(),s2:zoneParams.getPageType(),ab:getAb(),ar:getAspectRatio(),artid:targeting.pageArticleId&&targeting.pageArticleId.toString(),cat:zoneParams.getPageCategories(),dmn:zoneParams.getDomain(),hostpre:zoneParams.getHostnamePrefix(),skin:targeting.skin,lang:zoneParams.getLanguage(),wpage:targeting.pageName&&targeting.pageName.toLowerCase(),ref:getRefParam(),esrb:targeting.esrbRating,geo:geo.getCountryCode()||'none'};if(pvs){params.pv=pvs.toString();}
if(options.includeRawDbName){params.rawDbName=zoneParams.getRawDbName();}
if(krux&&targeting.enableKruxTargeting){params.u=krux.getUser();params.ksgmnt=krux.getSegments();}
if(targeting.wikiIsTop1000){params.top='1k';}
extend(params,decodeLegacyDartParams(targeting.wikiCustomKeyValues));extend(params,runtimeParams);log(params,9,logGroup);return params;}
if(skin&&skin!=='mercury'){pvCounter.increment();}
updateContext();adContext.addCallback(updateContext);return{add:addParam,getPageLevelParams:getPageLevelParams};});;define('ext.wikia.adEngine.adLogicPageViewCounter',['wikia.cache','wikia.window'],function(cache,window){'use strict';var cacheKey='adEngine_pageViewCounter',cacheTtl=24*3600*1000,now=window.wgNow||new Date(),initialValue={since:now.getTime(),pvs:0};function isValidValue(val){if(!val||isNaN(val.since)||isNaN(val.pvs)){return false;}
var pvs=val.pvs,age=now.getTime()-val.since;if(pvs<0||age<0||age>cacheTtl){return false;}
return true;}
function get(){var val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
return val.pvs;}
function increment(){var val,age,ttlLeft;val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
age=now.getTime()-val.since;ttlLeft=cacheTtl-age;val.pvs+=1;cache.set(cacheKey,val,ttlLeft,now);}
return{get:get,increment:increment};});;define('ext.wikia.adEngine.customAdsLoader',['wikia.log'],function(log){'use strict';var logGroup='ext.wikia.adEngine.customAdsLoader';function loadCustomAd(params){log('loadCustomAd','debug',logGroup);var adModule='ext.wikia.adEngine.template.'+params.type;log('loadCustomAd: loading '+adModule,'debug',logGroup);require([adModule],function(adTemplate){log('loadCustomAd: module '+adModule+' required','debug',logGroup);adTemplate.show(params);});}
return{loadCustomAd:loadCustomAd};});;define('ext.wikia.adEngine.utils.sampler',['wikia.querystring'],function(QueryString){'use strict';var qs=new QueryString(),queryStringParam='ignored_samplers';function samplerIsIgnored(name){var ignored=qs.getVal(queryStringParam,'').split(',');return ignored.indexOf(name)>-1;}
function sample(name,partToSample,all){return samplerIsIgnored(name)?true:getRandomInt(0,all)<partToSample;}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min))+min;}
return{sample:sample};});;define('ext.wikia.adEngine.adContext',['wikia.abTest','wikia.cookies','wikia.document','wikia.geo','wikia.instantGlobals','ext.wikia.adEngine.utils.sampler','wikia.window','wikia.querystring'],function(abTest,cookies,doc,geo,instantGlobals,sampler,w,Querystring){'use strict';instantGlobals=instantGlobals||{};var context,callbacks=[],qs=new Querystring();function getContext(){return context;}
function getMercuryCategories(){if(!context.targeting.mercuryPageCategories){return;}
return context.targeting.mercuryPageCategories.map(function(item){return item.title;});}
function isUrlParamSet(param){return!!parseInt(qs.getVal(param,'0'),10);}
function isPageType(pageType){return context.targeting.pageType===pageType;}
function isPageFairDetectionEnabled(){var isSupportedGeo=geo.isProperGeo(instantGlobals.wgAdDriverPageFairDetectionCountries);return isUrlParamSet('pagefairdetection')||(isSupportedGeo&&sampler.sample('pageFairDetection',1,10));}
function isSourcePointDetectionDesktopEnabled(context){return context.opts.sourcePointDetectionUrl&&context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionCountries);}
function isSourcePointDetectionMobileEnabled(context){return context.opts.sourcePointDetectionUrl&&context.targeting.skin==='mercury'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionMobileCountries);}
function updateDetectionServicesAdContext(context,noExternals){context.opts.sourcePointDetection=!noExternals&&isSourcePointDetectionDesktopEnabled(context);context.opts.sourcePointDetectionMobile=!noExternals&&isSourcePointDetectionMobileEnabled(context);context.opts.pageFairDetection=!noExternals&&isPageFairDetectionEnabled();}
function updateAdContextRecoveryServices(context,noExternals){var isRecoveryServiceAlreadyEnabled=false,serviceCanBeEnabled=!noExternals&&context.opts.showAds!==false;context.opts.pageFairRecovery=serviceCanBeEnabled&&!isRecoveryServiceAlreadyEnabled&&context.opts.pageFairRecovery&&geo.isProperGeo(instantGlobals.wgAdDriverPageFairRecoveryCountries);isRecoveryServiceAlreadyEnabled|=context.opts.pageFairRecovery;context.opts.sourcePointRecovery=serviceCanBeEnabled&&!isRecoveryServiceAlreadyEnabled&&context.opts.sourcePointRecovery&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointRecoveryCountries);isRecoveryServiceAlreadyEnabled|=context.opts.sourcePointRecovery;context.opts.sourcePointMMS=serviceCanBeEnabled&&!isRecoveryServiceAlreadyEnabled&&context.opts.sourcePointMMS;context.opts.sourcePointBootstrap=context.opts.sourcePointMMS||context.opts.sourcePointRecovery;}
function enableAdMixExperiment(context){var group=abTest.getGroup('AD_MIX')||'';context.opts.adMixExperimentEnabled=!!(group.indexOf('AD_MIX_')===0&&isPageType('article')&&context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverAdMixCountries));context.opts.adMix1Enabled=context.opts.adMixExperimentEnabled&&abTest.getGroup('AD_MIX').indexOf('AD_MIX_1')===0;context.opts.adMix3Enabled=context.opts.adMixExperimentEnabled&&abTest.getGroup('AD_MIX').indexOf('AD_MIX_3')===0;context.slots.adMixToUnblock=['INCONTENT_BOXAD_1'];if(context.opts.adMix3Enabled){context.slots.adMixToUnblock.push('BOTTOM_LEADERBOARD');}}
function referrerIsSonySite(){return doc&&doc.referrer&&doc.referrer.match(/info\.tvsideview\.sony\.net/);}
function setContext(newContext){var i,len,noExternals=w.wgNoExternals||isUrlParamSet('noexternals');context=newContext;context.opts=context.opts||{};context.slots=context.slots||{};context.targeting=context.targeting||{};context.providers=context.providers||{};context.forcedProvider=qs.getVal('forcead',null)||context.forcedProvider||null;context.opts.noExternals=noExternals;if(referrerIsSonySite()){context.opts.showAds=false;}
if(geo.isProperGeo(instantGlobals.wgAdDriverDelayCountries)){context.opts.delayEngine=true;}
context.opts.premiumOnly=context.targeting.hasFeaturedVideo&&geo.isProperGeo(instantGlobals.wgAdDriverSrcPremiumCountries);updateDetectionServicesAdContext(context,noExternals);updateAdContextRecoveryServices(context,noExternals);if(cookies.get('mock-ads')==='NlfdjR5xC0'){context.opts.showcase=true;}
if(context.targeting.enablePageCategories){context.targeting.pageCategories=w.wgCategories||getMercuryCategories();}
if(context.providers.evolve2){context.providers.evolve2=geo.isProperGeo(instantGlobals.wgAdDriverEvolve2Countries);}
if(geo.isProperGeo(instantGlobals.wgAdDriverTurtleCountries)){context.providers.turtle=true;}
if(context.providers.rubiconFastlane){context.providers.rubiconFastlane=geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneCountries)&&geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneProviderCountries);}
context.opts.enableRemnantNewAdUnit=geo.isProperGeo(instantGlobals.wgAdDriverMEGACountries);context.opts.enableKILOAdUnit=geo.isProperGeo(instantGlobals.wgAdDriverKILOCountries);context.slots.invisibleHighImpact=(context.slots.invisibleHighImpact&&geo.isProperGeo(instantGlobals.wgAdDriverHighImpactSlotCountries))||isUrlParamSet('highimpactslot');context.opts.enableAdInfoLog=geo.isProperGeo(instantGlobals.wgAdDriverKikimoraTrackingCountries);context.opts.playerTracking=geo.isProperGeo(instantGlobals.wgAdDriverKikimoraPlayerTrackingCountries);context.targeting.enableKruxTargeting=!!(context.targeting.enableKruxTargeting&&geo.isProperGeo(instantGlobals.wgAdDriverKruxCountries)&&!instantGlobals.wgSitewideDisableKrux);context.opts.floatingMedrec=!!(context.opts.showAds&&context.opts.adsInContent&&(isPageType('article')||isPageType('search'))&&!context.targeting.wikiIsCorporate);context.opts.overridePrefootersSizes=!!(context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverOverridePrefootersCountries)&&!isPageType('home'));enableAdMixExperiment(context);context.opts.openXRemnantEnabled=geo.isProperGeo(instantGlobals.wgAdDriverOpenXBidderCountriesRemnant);if(w.ads&&w.ads.context){w.ads.context=context;}
for(i=0,len=callbacks.length;i<len;i+=1){callbacks[i](context);}}
function addCallback(callback){callbacks.push(callback);}
setContext(w.ads?w.ads.context:{});return{addCallback:addCallback,getContext:getContext,setContext:setContext};});;define('ext.wikia.adEngine.context.slotsContext',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.document','wikia.geo','wikia.instantGlobals','wikia.log'],function(adContext,params,doc,geo,instantGlobals,log){'use strict';var logGroup='ext.wikia.adEngine.context.slotsContext',slots={};function setStatus(slotName,status){slots[slotName]=!!status;}
function isInContentApplicable(){var header=doc.querySelectorAll('#mw-content-text > h2')[1];return header&&header.offsetWidth>=header.parentNode.offsetWidth;}
function setupSlots(){var context=adContext.getContext(),isHome=params.getPageType()==='home',isOasis=context.targeting.skin==='oasis';setStatus('PREFOOTER_MIDDLE_BOXAD',isHome);setStatus('TOP_LEADERBOARD',true);setStatus('TOP_RIGHT_BOXAD',true);setStatus('LEFT_SKYSCRAPER_2',!isHome);setStatus('LEFT_SKYSCRAPER_3',!isHome);setStatus('INCONTENT_BOXAD_1',!isHome);setStatus('INVISIBLE_HIGH_IMPACT_2',geo.isProperGeo(instantGlobals.wgAdDriverHighImpact2SlotCountries));setStatus('PREFOOTER_RIGHT_BOXAD',!context.opts.overridePrefootersSizes);setStatus('INCONTENT_PLAYER',!isHome&&isOasis&&isInContentApplicable());log(['Disabled slots:',slots],'info',logGroup);}
function isApplicable(slotName){return slots[slotName]!==false;}
function filterSlotMap(slotMap){var map={};if(!slotMap){return map;}
Object.keys(slotMap).forEach(function(slotName){if(isApplicable(slotName)){map[slotName]=slotMap[slotName];}});return map;}
setupSlots();adContext.addCallback(function(){setupSlots();});return{filterSlotMap:filterSlotMap,isApplicable:isApplicable};});;define('ext.wikia.adEngine.context.uapContext',['ext.wikia.adEngine.utils.eventDispatcher','wikia.log'],function(eventDispatcher,log){'use strict';var context={},logGroup='ext.wikia.adEngine.context.uapContext',mainSlotName='TOP_LEADERBOARD';function setUapId(uap){context.uapId=uap;}
function getUapId(){return context.uapId;}
function isUapLoaded(){return!!context.uapId;}
function reset(){context={};}
function shouldDispatchEvent(slotName){return!context.eventDispatched&&slotName.indexOf(mainSlotName)!==-1;}
function dispatchEvent(){var eventName=isUapLoaded()?'wikia.uap':'wikia.not_uap';eventDispatcher.dispatch(eventName);context.eventDispatched=true;log(['dispatchEvent',eventName],'info',logGroup);}
return{dispatchEvent:dispatchEvent,getUapId:getUapId,isUapLoaded:isUapLoaded,reset:reset,setUapId:setUapId,shouldDispatchEvent:shouldDispatchEvent};});;define('ext.wikia.adEngine.dartUrl',function(){'use strict';var logGroup='DartUrlUtils';function trimParam(kvs,limit){if(!limit||limit===true){limit=500;}
kvs=kvs||'';kvs=kvs.substr(0,limit).replace(/;[^;]*$/,';');if(!kvs.match(/;$/)){kvs='';}
return kvs;}
function decorateParam(key,value){var ret='',i;if(value){if(!(value instanceof Array)){value=[value];}
for(i=0;i<value.length;i+=1){if(value[i]){ret+=key+'='+encodeURIComponent(value[i]+'')+';';}}}
return ret;}
function urlBuilder(domain,path){var params='';function toString(){return'http://'+domain+'/'+path+';'+params;}
function addString(str,limit){if(limit){str=trimParam(str,limit);}
params+=str;}
function addParam(key,value,limit){addString(decorateParam(key,value),limit);}
return{addParam:addParam,addString:addString,toString:toString};}
return{decorateParam:decorateParam,trimParam:trimParam,urlBuilder:urlBuilder};});;define('ext.wikia.adEngine.domElementTweaker',['wikia.log','wikia.window'],function(log,win){'use strict';var hiddenElementClass='hidden',logGroup='ext.wikia.adEngine.domElementTweaker';function hide(element,useInline){if(element&&useInline){element.style.display='none';}else if(element){element.classList.add(hiddenElementClass);}}
function show(element,useInline){if(element&&useInline){element.style.display='block';}else if(element){element.classList.remove(hiddenElementClass);}}
function addClass(element,cls){log(['addClass '+cls,element],8,logGroup);element.classList.add(cls);}
function removeClass(element,cls){log(['removeClass '+cls,element],8,logGroup);element.classList.remove(cls);}
function isElement(obj){return obj instanceof win.HTMLElement;}
function rewriteStylesToElement(computedStyles,targetElement){var i,styleName;for(i=0;i<computedStyles.length;i++){styleName=computedStyles[i];targetElement.style[styleName]=computedStyles[styleName];}}
function moveStylesToInline(sourceElement,targetElement,ignoredStyles){var computedStyles,tmpStyles={};if(!isElement(sourceElement)){log(['Can\'t copy styles because parameter isn\'t element',sourceElement],4,logGroup);return;}
computedStyles=document.defaultView.getComputedStyle(sourceElement,'');ignoredStyles.forEach(function(styleName){tmpStyles[styleName]=targetElement.style[styleName];});if(win.CSS2Properties!==undefined&&computedStyles instanceof win.CSS2Properties){rewriteStylesToElement(computedStyles,targetElement);}else if(win.CSSStyleDeclaration!==undefined&&computedStyles instanceof win.CSSStyleDeclaration){targetElement.style.cssText=computedStyles.cssText;}else{log(['Can\'t copy styles from element',computedStyles.cssText],4,logGroup);return;}
Object.keys(tmpStyles).forEach(function(key){targetElement.style[key]=tmpStyles[key];});}
function forceRepaint(domElement){return domElement.offsetWidth;}
return{addClass:addClass,forceRepaint:forceRepaint,hide:hide,isElement:isElement,moveStylesToInline:moveStylesToInline,removeClass:removeClass,show:show};});;define('ext.wikia.adEngine.lookup.services',['wikia.log',require.optional('ext.wikia.adEngine.lookup.prebid'),require.optional('ext.wikia.adEngine.lookup.amazonMatch'),require.optional('ext.wikia.adEngine.lookup.openXBidder'),require.optional('ext.wikia.adEngine.lookup.rubicon.rubiconFastlane')],function(log,prebid,amazonMatch,oxBidder,rubiconFastlane){'use strict';var logGroup='ext.wikia.adEngine.lookup.services',bidders=[amazonMatch,oxBidder,rubiconFastlane,prebid],bidIndex={'rubicon_fastlane':{pos:0,char:'R'},'ox_bidder':{pos:1,char:'O'},amazon:{pos:2,char:'A'},prebid:{pos:4,char:'P'}},bidMarker=['x','x','x','x','x'],realSlotPrices={};function addParameters(providerName,slotName,slotTargeting){var params={};if(!Object.keys){return;}
bidders.forEach(function(bidder){if(bidder&&bidder.wasCalled()){params=bidder.getSlotParams(slotName);bidder.trackState(providerName,slotName,params);Object.keys(params).forEach(function(key){slotTargeting[key]=params[key];});if(bidder.hasResponse()){bidMarker=updateBidderMarker(bidder.getName(),bidMarker);}}});slotTargeting.bid=bidMarker.join('');}
function updateBidderMarker(bidderName,bidMarker){var bidder;if(!bidIndex[bidderName]){return bidMarker;}
bidder=bidIndex[bidderName];bidMarker[bidder.pos]=bidder.char;return bidMarker;}
function extendSlotTargeting(slotName,slotTargeting,providerName){log(['extendSlotTargeting',slotName,slotTargeting],'debug',logGroup);providerName=providerName.toLowerCase().replace('gpt','');addParameters(providerName,slotName,slotTargeting);}
function getCurrentSlotPrices(slotName){var slotPrices={};bidders.forEach(function(bidder){if(bidder&&bidder.isSlotSupported(slotName)){var priceFromBidder=bidder.getBestSlotPrice(slotName);Object.keys(priceFromBidder).forEach(function(bidderName){slotPrices[bidderName]=priceFromBidder[bidderName];});}});return slotPrices;}
function storeRealSlotPrices(slotName){realSlotPrices[slotName]=getCurrentSlotPrices(slotName);}
function getDfpSlotPrices(slotName){return realSlotPrices[slotName]||{};}
return{extendSlotTargeting:extendSlotTargeting,getCurrentSlotPrices:getCurrentSlotPrices,storeRealSlotPrices:storeRealSlotPrices,getDfpSlotPrices:getDfpSlotPrices};});;define('ext.wikia.adEngine.messageListener',['ext.wikia.adEngine.adContext','wikia.log','wikia.window'],function(adContext,log,window){'use strict';var logGroup='ext.wikia.adEngine.messageListener',callbacks=[],unhandledMessages=[];function isInterestingMessage(msg){try{return!!JSON.parse(msg.data).hasOwnProperty('AdEngine');}catch(e){return false;}}
function eventMatch(match,msg){var matching=true,matchingFrame=false,msgFrame;if(match.dataKey){matching=JSON.parse(msg.data).AdEngine.hasOwnProperty(match.dataKey);}
if(match.source){for(msgFrame=msg.source;msgFrame!==window;msgFrame=msgFrame.parent){if(msgFrame===match.source){matchingFrame=true;}}
matching=matching&&matchingFrame;}
return matching;}
function processMessage(msg){var i,len,callback;log(['Received message',msg.data],'debug',logGroup);for(i=0,len=callbacks.length;i<len;i+=1){callback=callbacks[i];if(eventMatch(callback.match,msg)){log(['Event matching',msg,callback],'debug',logGroup);callback.fn(JSON.parse(msg.data).AdEngine);if(!callback.match.infinite){callbacks.splice(i,1);}
return;}}
log(['Event not matching (pushed to unhandled messages)',msg],'debug',logGroup);unhandledMessages.push(msg);}
function receiveMessage(msg){if(isInterestingMessage(msg)){processMessage(msg);}}
function init(){log('Initialized ads message listener','debug',logGroup);window.addEventListener('message',receiveMessage);}
function register(match,callback){var i,len,msg;log(['Register callback',match,callback],'debug',logGroup);for(i=0,len=unhandledMessages.length;i<len;i+=1){msg=unhandledMessages[i];if(eventMatch(match,msg)){unhandledMessages.splice(i,1);log(['Some event matches',msg,callback],'debug',logGroup);callback(JSON.parse(msg.data).AdEngine);return;}}
log(['No events matching (pushing to callbacks)',callback],'debug',logGroup);callbacks.push({match:match,fn:callback});}
adContext.addCallback(function(){callbacks=[];unhandledMessages=[];});return{init:init,register:register};});;define('ext.wikia.adEngine.slotTracker',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker'],function(adContext,adTracker){'use strict';var timeCheckpoints=[2.0,5.0,8.0,20.0],context=adContext.getContext(),stats={allEvents:0,interestingEvents:0},slotTypes={INCONTENT_BOXAD_1:'medrec',INCONTENT_PLAYER:'incontent',INVISIBLE_SKIN:'pixel',LEFT_SKYSCRAPER_2:'skyscraper',LEFT_SKYSCRAPER_3:'skyscraper',MOBILE_IN_CONTENT:'mobile_content',MOBILE_PREFOOTER:'mobile_prefooter',MOBILE_TOP_LEADERBOARD:'mobile_leaderboard',MODAL_INTERSTITIAL:'interstitial',MODAL_INTERSTITIAL_1:'interstitial',MODAL_INTERSTITIAL_2:'interstitial',MODAL_INTERSTITIAL_3:'interstitial',MODAL_INTERSTITIAL_4:'interstitial',MODAL_INTERSTITIAL_5:'interstitial',PREFOOTER_LEFT_BOXAD:'prefooter',PREFOOTER_MIDDLE_BOXAD:'prefooter',PREFOOTER_RIGHT_BOXAD:'prefooter',TOP_BUTTON_WIDE:'button',TOP_LEADERBOARD:'leaderboard',TOP_RIGHT_BOXAD:'medrec',WIKIA_BAR_BOXAD_1:'wikiabar'};function isInteresting(eventName,data){if(data.provider==='Null'||data.provider==='Later'){return false;}
if(data.slotname.match(/_FLUSH$/)){return false;}
if(data.slotname==='TOP_BUTTON_WIDE'){return false;}
if(!context.opts.trackSlotState&&eventName.match(/^state/)){return false;}
return true;}
function trackEvent(eventName,data,value){var slotname=data.slotname,slotType=slotTypes[slotname]||'other',extraParams=data.extraParams||{},forcedLabel=data.state,productChosen=[eventName,data.provider,slotType].join('/');extraParams.pos=data.slotname;stats.allEvents+=1;if(isInteresting(eventName,data)){stats.interestingEvents+=1;adTracker.track(productChosen,extraParams,value,forcedLabel);}}
function slotTracker(provider,slotname,source){var timeStart=new Date().getTime(),eventsTracked=[],lastEventTime,i,len;function trackState(timeCheckPoint){var eventName='state/'+timeCheckPoint+'s';setTimeout(function(){trackEvent(eventName,{provider:provider,slotname:slotname,state:eventsTracked.join(',')},lastEventTime*1000);},timeCheckPoint*1000);}
function track(eventName,extraParams){var timeEnd=new Date().getTime(),timeElapsed=(timeEnd-timeStart)/1000;eventsTracked.push(eventName);lastEventTime=timeElapsed;trackEvent(eventName,{provider:provider,slotname:slotname,extraParams:extraParams},timeElapsed*1000);}
track('register',{source:source});for(i=0,len=timeCheckpoints.length;i<len;i+=1){trackState(timeCheckpoints[i]);}
return{track:track};}
function getStats(){return stats;}
slotTracker.getStats=getStats;return slotTracker;});;define('ext.wikia.adEngine.slotTweaker',['ext.wikia.adEngine.domElementTweaker','ext.wikia.adEngine.slot.adSlot','wikia.document','wikia.log','wikia.window'],function(DOMElementTweaker,adSlot,doc,log,win){'use strict';var logGroup='ext.wikia.adEngine.slotTweaker',defaultHeightClass='default-height',standardLeaderboardSizeClass='standard-leaderboard';function hide(slotname,useInline){log('hide '+slotname+' using class hidden',6,logGroup);DOMElementTweaker.hide(doc.getElementById(slotname),useInline);}
function show(slotname){log('show '+slotname+' removing class hidden',6,logGroup);var slot=doc.getElementById(slotname);if(slot){DOMElementTweaker.removeClass(slot,'hidden');}}
function removeDefaultHeight(slotname){var slot=doc.getElementById(slotname);log('removeDefaultHeight '+slotname,6,logGroup);if(slot){DOMElementTweaker.removeClass(slot,defaultHeightClass);}}
function isTopLeaderboard(slotname){return slotname.indexOf('TOP_LEADERBOARD')!==-1;}
function isStandardLeaderboardSize(slotname){var slot=doc.getElementById(slotname),isStandardSize;if(slot){isStandardSize=slot.offsetHeight>=90&&slot.offsetHeight<=95&&slot.offsetWidth<=728;log(['isStandardLeaderboardSize',slotname,slot.offsetWidth+'x'+slot.offsetHeight,isStandardSize],3,logGroup);return isStandardSize;}
log('isStandardLeaderboardSize: '+slotname+' missing',3,logGroup);}
function addDefaultHeight(slotname){var slot=doc.getElementById(slotname);log('addDefaultHeight '+slotname,6,logGroup);if(slot){slot.className+=' '+defaultHeightClass;}}
function adjustLeaderboardSize(slotname){var slot=doc.getElementById(slotname);if(isTopLeaderboard(slotname)&&isStandardLeaderboardSize(slotname)){slot.className+=' '+standardLeaderboardSizeClass;}}
function removeTopButtonIfNeeded(slotname){if(isTopLeaderboard(slotname)&&isStandardLeaderboardSize(slotname)){win.Wikia.reviveQueue=win.Wikia.reviveQueue||[];win.Wikia.reviveQueue.push({zoneId:27,slotName:'TOP_BUTTON_WIDE'});}}
function onReady(slotName,callback){var iframe=adSlot.getIframe(slotName);if(!iframe){log('onIframeReady - iframe does not exist','debug',logGroup);return;}
if(iframe.contentWindow.document.readyState==='complete'){callback(iframe);}else{iframe.addEventListener('load',function(){callback(iframe);});}}
function isBlockedElement(original){return original.style.display==='none';}
function tweakRecoveredSlot(originalIframe,iframe){var original=originalIframe,target=iframe;while(isBlockedElement(original)){DOMElementTweaker.moveStylesToInline(original,target,['paddingBottom','opacity']);target.style.display='block';original=original.parentNode;target=target.parentNode;}}
function makeResponsive(slotName,aspectRatio){var slot=doc.getElementById(slotName),providerContainer=adSlot.getProviderContainer(slotName);log(['makeResponsive',slotName,aspectRatio],'info',logGroup);slot.classList.add('slot-responsive');onReady(slotName,function(iframe){log(['makeResponsive',slotName],'debug',logGroup);if(!aspectRatio){var height=iframe.contentWindow.document.body.scrollHeight,width=iframe.contentWindow.document.body.scrollWidth;aspectRatio=width/height;}
log(['Slot ratio',aspectRatio],'debug',logGroup);providerContainer.style.paddingBottom=100/aspectRatio+'%';});}
function adjustIframeByContentSize(slotName){onReady(slotName,function(iframe){var height=iframe.contentWindow.document.body.scrollHeight,width=iframe.contentWindow.document.body.scrollWidth;iframe.width=width;iframe.height=height;log(['adjustIframeByContentSize',slotName,width,height],'debug',logGroup);});}
function collapse(slotName){var slot=doc.getElementById(slotName);slot.style.maxHeight=2*slot.scrollHeight+'px';DOMElementTweaker.forceRepaint(slot);DOMElementTweaker.addClass(slot,'slot-animation');slot.style.maxHeight='0';}
function expand(slotName){var slot=doc.getElementById(slotName);slot.style.maxHeight=slot.offsetHeight+'px';DOMElementTweaker.removeClass(slot,'hidden');DOMElementTweaker.addClass(slot,'slot-animation');slot.style.maxHeight=2*slot.scrollHeight+'px';}
function hackChromeRefresh(slotId){var slot=doc.getElementById(slotId),parent=slot&&slot.parentElement;if(parent&&slotId.match(/^INCONTENT/)){parent.style.display='none';DOMElementTweaker.forceRepaint(parent);parent.style.display='';}}
return{addDefaultHeight:addDefaultHeight,adjustIframeByContentSize:adjustIframeByContentSize,adjustLeaderboardSize:adjustLeaderboardSize,collapse:collapse,expand:expand,hackChromeRefresh:hackChromeRefresh,hide:hide,isTopLeaderboard:isTopLeaderboard,makeResponsive:makeResponsive,onReady:onReady,removeDefaultHeight:removeDefaultHeight,removeTopButtonIfNeeded:removeTopButtonIfNeeded,show:show,tweakRecoveredSlot:tweakRecoveredSlot};});;define('ext.wikia.adEngine.sourcePointDetection',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','wikia.document','wikia.window','wikia.krux','wikia.log'],function(adContext,adTracker,doc,win,krux,log){'use strict';var logGroup='ext.wikia.adEngine.sourcePointDetection',statusTracked=false,detectionInitialized=false,spDetectionTime;function getClientId(){log('getClientId','info',logGroup);return'rMbenHBwnMyAMhR';}
function sendKruxEvent(value){var eventId='KEa0tIof';if(krux.sendEvent(eventId,{blocking:value})){log(['sendKruxEvent',eventId,value],'debug',logGroup);}}
function trackStatusOnce(value){if(statusTracked){return;}
statusTracked=true;sendKruxEvent(value);spDetectionTime.measureDiff({},'end').track();}
function loadLibrary(context){var detectionScript=doc.createElement('script'),node=doc.getElementsByTagName('script')[0];detectionScript.async=true;detectionScript.type='text/javascript';detectionScript.src=context.opts.sourcePointDetectionUrl;detectionScript.setAttribute('data-client-id',getClientId());log('Appending detection script to head','debug',logGroup);node.parentNode.insertBefore(detectionScript,node);detectionInitialized=true;}
function initDetection(){var context=adContext.getContext();if(!context.opts.sourcePointDetection&&!context.opts.sourcePointDetectionMobile){log(['init','SourcePoint detection disabled'],'debug',logGroup);return;}
if(detectionInitialized){log(['init','SourcePoint detection already initialized'],'debug',logGroup);return;}
spDetectionTime=adTracker.measureTime('spDetection',{},'start');spDetectionTime.track();log('init','debug',logGroup);win.ads.runtime=win.ads.runtime||{};win.ads.runtime.sp=win.ads.runtime.sp||{};win._sp_=win._sp_||{};win._sp_.config=win._sp_.config||{};win._sp_.config.account_id=win._sp_.config.account_id||106;doc.addEventListener('sp.blocking',function(){win.ads.runtime.sp.blocking=true;trackStatusOnce('yes');log('sp.blocking','info',logGroup);});doc.addEventListener('sp.not_blocking',function(){win.ads.runtime.sp.blocking=false;trackStatusOnce('no');log('sp.not_blocking','info',logGroup);});if(!context.opts.sourcePointBootstrap){loadLibrary(context);}}
return{initDetection:initDetection,getClientId:getClientId};});;define('ext.wikia.adEngine.pageFairDetection',['ext.wikia.adEngine.utils.scriptLoader','wikia.browserDetect','wikia.document','wikia.log','wikia.window'],function(scriptLoader,browserDetect,doc,log,win){'use strict';var context=null,logGroup='ext.wikia.adEngine.pageFairDetection';function isMobileSkin(){return context.targeting.skin==='mercury';}
function getWebsiteCode(){var websiteKeys={mobile:'EFB8C00E91C84764',desktop:'954076792F3C4693'};return isMobileSkin()||browserDetect.isMobile()?websiteKeys.mobile:websiteKeys.desktop;}
function dispatchDetectionEvent(eventName){var event=doc.createEvent('Event');event.initEvent(eventName,true,false);doc.dispatchEvent(event);}
function setRuntimeParams(isAdBlockDetected){win.ads.runtime=win.ads.runtime||{};win.ads.runtime.pf=win.ads.runtime.pf||{};win.ads.runtime.pf.blocking=isAdBlockDetected;}
function detector(isAdBlockDetected){var eventName=isAdBlockDetected?'pf.blocking':'pf.not_blocking';if(!context.opts.pageFairDetection){log('PageFair disabled','debug',logGroup);return null;}
log(['PageFair detection, adBlock detected:',isAdBlockDetected],'debug',logGroup);setRuntimeParams(isAdBlockDetected);dispatchDetectionEvent(eventName);}
function initDetection(injectedContext){var node=doc.getElementsByTagName('script')[0];context=injectedContext;win.bm_website_code=getWebsiteCode();win.pf_notify=detector;scriptLoader.loadAsync(context.opts.pageFairDetectionUrl,node);}
return{initDetection:initDetection};});;define('ext.wikia.adEngine.dartHelper',['wikia.log','ext.wikia.adEngine.adLogicPageParams','ext.wikia.adEngine.dartUrl','ext.wikia.adEngine.adLogicDartSubdomain'],function(log,adLogicPageParams,dartUrl,adLogicDartSubdomain){'use strict';var logGroup='ext.wikia.adEngine.dartHelper',getUrl,ord=Math.round(Math.random()*23456787654),tile=1,categoryStrMaxLength=300;getUrl=function(params){var slotname=params.slotname,size=params.slotsize,adType=params.adType||'adj',src=params.src||'driver',localTile,localOrd=params.ord||ord,url,subdomain=params.subdomain||(adLogicDartSubdomain&&adLogicDartSubdomain.getSubdomain()),pageParams=adLogicPageParams.getPageLevelParams(),name,value;if(adType==='jwplayer'){adType='pfadx';}
if(params.tile){localTile=params.tile;}else{localTile=tile;tile+=1;}
log(['getUrl',slotname,size],5,logGroup);url=dartUrl.urlBuilder(subdomain+'.doubleclick.net',adType+'/'+'wka.'+pageParams.s0+'/'+pageParams.s1+'/'+pageParams.s2);for(name in pageParams){if(pageParams.hasOwnProperty(name)){value=pageParams[name];if(value){if(name==='cat'){url.addParam(name,value,categoryStrMaxLength);}else if(name==='ksgmnt'){url.addParam(name,value,true);}else{url.addParam(name,value);}}}}
url.addParam('src',src);url.addString('mtfIFPath=/extensions/wikia/AdEngine/;');url.addParam('mtfInline','true');url.addParam('pos',params.slotname);url.addParam('loc',params.loc);url.addParam('dcopt',params.dcopt);url.addParam('sz',size);url.addParam('tile',localTile);url.addString('endtag=$;');url.addString('ord='+localOrd+'?');log(url.toString(),5,logGroup);return url.toString();};return{getUrl:getUrl};});;define('ext.wikia.adEngine.config.desktop',['wikia.log','wikia.window','wikia.instantGlobals','wikia.geo','ext.wikia.adEngine.adContext','ext.wikia.adEngine.adDecoratorPageDimensions','ext.wikia.adEngine.provider.directGpt','ext.wikia.adEngine.provider.evolve2','ext.wikia.adEngine.provider.remnantGpt','ext.wikia.adEngine.provider.rubiconFastlane','ext.wikia.adEngine.provider.turtle'],function(log,window,instantGlobals,geo,adContext,adDecoratorPageDimensions,adProviderDirectGpt,adProviderEvolve2,adProviderRemnantGpt,adProviderRubiconFastlane,adProviderTurtle){'use strict';var logGroup='ext.wikia.adEngine.adConfigLate',context=adContext.getContext(),gptEnabled=!instantGlobals.wgSitewideDisableGpt,forcedProviders={evolve2:[adProviderEvolve2],rpfl:[adProviderRubiconFastlane],turtle:[adProviderTurtle]};function getDecorators(){return[adDecoratorPageDimensions];}
function getProviderList(slotName){var providerList=[];log('getProvider',5,logGroup);log(slotName,5,logGroup);if(!context.opts.showAds){return[];}
if(context.forcedProvider&&!!forcedProviders[context.forcedProvider]){log(['getProvider',slotName,context.forcedProvider+' (wgAdDriverForcedProvider)'],'info',logGroup);return forcedProviders[context.forcedProvider];}
if(context.providers.turtle&&adProviderTurtle.canHandleSlot(slotName)){providerList.push(adProviderTurtle);}else if(context.providers.evolve2&&adProviderEvolve2.canHandleSlot(slotName)){providerList.push(adProviderEvolve2);}else if(gptEnabled){providerList.push(adProviderDirectGpt);if(context.opts.premiumOnly){return providerList;}}
if(gptEnabled){providerList.push(adProviderRemnantGpt);}
if(context.providers.rubiconFastlane&&adProviderRubiconFastlane.canHandleSlot(slotName)){providerList.push(adProviderRubiconFastlane);}
return providerList;}
return{getDecorators:getDecorators,getProviderList:getProviderList};});;define('ext.wikia.adEngine.provider.btfBlocker',['ext.wikia.adEngine.adContext','wikia.lazyqueue','wikia.log','wikia.window'],function(adContext,lazyQueue,log,win){'use strict';var logGroup='ext.wikia.adEngine.provider.btfBlocker',unblockedSlots=[];win.ads=win.ads||{};win.ads.runtime=win.ads.runtime||{};win.ads.runtime.disableBtf=false;win.ads.runtime.unblockHighlyViewableSlots=false;function unblock(slotName){unblockedSlots.push(slotName);}
function decorate(fillInSlot,config){var btfQueue=[],btfQueueStarted=false,pendingAtfSlots=[];adContext.addCallback(function(){btfQueue=[];btfQueueStarted=false;pendingAtfSlots=[];win.ads.runtime.disableBtf=false;win.ads.runtime.unblockHighlyViewableSlots=false;unblockedSlots=[];});function processBtfSlot(slot){log(['processBtfSlot',slot.name],'debug',logGroup);if(win.ads.runtime.unblockHighlyViewableSlots&&config.highlyViewableSlots){config.highlyViewableSlots.map(unblock);}
if(unblockedSlots.indexOf(slot.name)>-1||!win.ads.runtime.disableBtf){fillInSlot(slot);return;}
slot.collapse({adType:'blocked'});}
function startBtfQueue(){var context=adContext.getContext();log('startBtfQueue','debug',logGroup);if(btfQueueStarted){return;}
if(context.opts.adMixExperimentEnabled){win.ads.runtime.disableBtf=true;context.slots.adMixToUnblock.map(unblock);}
lazyQueue.makeQueue(btfQueue,processBtfSlot);btfQueue.start();btfQueueStarted=true;}
function onSlotResponse(slotName){log(['onSlotResponse',slotName],'debug',logGroup);var index=pendingAtfSlots.indexOf(slotName);if(index>-1){pendingAtfSlots.splice(index,1);log(['remove from pendingAtfSlots',pendingAtfSlots,slotName],log.levels.debug,logGroup);if(pendingAtfSlots.length===0){startBtfQueue();}}}
function fillInSlotWithDelay(slot){log(['fillInSlotWithDelay',slot.name],'debug',logGroup);function fillInSlotOnResponse(){onSlotResponse(slot.name);}
if(!adContext.getContext().opts.delayBtf){fillInSlot(slot);return;}
if(config.atfSlots.indexOf(slot.name)>-1){pendingAtfSlots.push(slot.name);slot.pre('renderEnded',fillInSlotOnResponse);slot.pre('collapse',fillInSlotOnResponse);slot.pre('hop',fillInSlotOnResponse);slot.pre('success',fillInSlotOnResponse);fillInSlot(slot);return;}
btfQueue.push(slot);}
return fillInSlotWithDelay;}
return{decorate:decorate,unblock:unblock};});;define('ext.wikia.adEngine.provider.directGpt',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.uapContext','ext.wikia.adEngine.provider.factory.wikiaGpt','ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.service.kiloAdUnitBuilder','ext.wikia.adEngine.slotTweaker',require.optional('ext.wikia.adEngine.lookup.openx.openXBidderHelper'),require.optional('ext.wikia.aRecoveryEngine.pageFair.recovery'),require.optional('ext.wikia.aRecoveryEngine.sourcePoint.recovery')],function(adContext,uapContext,factory,adUnitBuilder,kiloAdUnitBuilder,slotTweaker,openXHelper,pageFair,sourcePoint){'use strict';return factory.createProvider('ext.wikia.adEngine.provider.directGpt','DirectGpt','gpt',{BOTTOM_LEADERBOARD:{size:'728x90',loc:'footer'},GPT_FLUSH:{flushOnly:true},INCONTENT_BOXAD_1:{size:'120x600,160x600,300x250,300x600',loc:'hivi'},INCONTENT_PLAYER:{size:'1x1',loc:'middle'},INVISIBLE_HIGH_IMPACT_2:{loc:'hivi'},INVISIBLE_SKIN:{size:'1000x1000,1x1',loc:'top'},LEFT_SKYSCRAPER_2:{size:'120x600,160x600,300x250,300x600,300x1050',loc:'middle'},LEFT_SKYSCRAPER_3:{size:'120x600,160x600,300x250,300x600',loc:'footer'},MODAL_INTERSTITIAL_1:{size:'300x250,600x400,800x450,550x480',loc:'modal'},MODAL_INTERSTITIAL_2:{size:'300x250,600x400,800x450,550x480',loc:'modal'},MODAL_INTERSTITIAL_3:{size:'300x250,600x400,800x450,550x480',loc:'modal'},MODAL_INTERSTITIAL_4:{size:'300x250,600x400,800x450,550x480',loc:'modal'},MODAL_INTERSTITIAL_5:{size:'300x250,300x600,728x90,970x250,160x600',loc:'modal'},MODAL_INTERSTITIAL:{size:'300x250,600x400,800x450,550x480',loc:'modal'},PREFOOTER_LEFT_BOXAD:{size:'300x250',loc:'footer'},PREFOOTER_MIDDLE_BOXAD:{size:'300x250',loc:'footer'},PREFOOTER_RIGHT_BOXAD:{size:'300x250',loc:'footer'},TOP_LEADERBOARD:{size:'728x90,1030x130,1030x65,1030x250,970x365,970x250,970x90,970x66,970x180,980x150,1024x416,1440x585',loc:'top'},TOP_RIGHT_BOXAD:{size:'300x250,300x600,300x1050',loc:'top'}},{beforeSuccess:function(slotName){slotTweaker.removeDefaultHeight(slotName);if(!uapContext.isUapLoaded()){slotTweaker.removeTopButtonIfNeeded(slotName);slotTweaker.adjustLeaderboardSize(slotName);}},beforeHop:function(slotName){openXHelper&&openXHelper.addOpenXSlot(slotName);},isPageFairRecoverable:pageFair?pageFair.isSlotRecoverable:false,isSourcePointRecoverable:sourcePoint?sourcePoint.isSlotRecoverable:false,sraEnabled:true,atfSlots:['INVISIBLE_SKIN','TOP_LEADERBOARD','TOP_RIGHT_BOXAD','GPT_FLUSH'],adUnitBuilder:adContext.getContext().opts.enableKILOAdUnit?kiloAdUnitBuilder:adUnitBuilder,highlyViewableSlots:['INCONTENT_BOXAD_1','INCONTENT_PLAYER','INVISIBLE_HIGH_IMPACT_2']});});;define('ext.wikia.adEngine.provider.factory.wikiaGpt',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.provider.btfBlocker','ext.wikia.adEngine.provider.gpt.helper','ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.service.passbackHandler','ext.wikia.adEngine.slot.service.slotRegistry','wikia.log',require.optional('ext.wikia.adEngine.lookup.services')],function(adContext,btfBlocker,gptHelper,adUnitBuilder,passbackHandler,slotRegistry,log,lookups){'use strict';function overrideSizes(slotMap){var context=adContext.getContext();if(context.opts.overridePrefootersSizes){slotMap.PREFOOTER_LEFT_BOXAD.size='300x250,468x60,728x90';delete slotMap.PREFOOTER_RIGHT_BOXAD;}}
function createProvider(logGroup,providerName,src,slotMap,extra){extra=extra||{};overrideSizes(slotMap);function canHandleSlot(slotName){log(['canHandleSlot',slotName],'debug',logGroup);var ret=!!slotMap[slotName];log(['canHandleSlot',slotName,ret],'debug',logGroup);return ret;}
function addHook(slot,hookName,callback){log([hookName,slot.name],'debug',logGroup);slot.pre(hookName,function(adInfo){if(typeof callback==='function'){callback(slot.name,adInfo);}});}
function getAdUnit(slot){if(extra.adUnitBuilder){return extra.adUnitBuilder.build(slot.name,src,passbackHandler.get(slot.name));}
return adUnitBuilder.build(slot.name,src);}
function fillInSlot(slot){log(['fillInSlot',slot.name],'debug',logGroup);var slotPath=getAdUnit(slot),slotTargeting=JSON.parse(JSON.stringify(slotMap[slot.name]));addHook(slot,'success',extra.beforeSuccess);addHook(slot,'collapse',extra.beforeCollapse);addHook(slot,'hop',extra.beforeHop);addHook(slot,'renderEnded',extra.onSlotRendered);slotTargeting.pos=slotTargeting.pos||slot.name;slotTargeting.src=src;slotTargeting.rv=slotRegistry.getRefreshCount(slot.name).toString();if(lookups){lookups.storeRealSlotPrices(slot.name);lookups.extendSlotTargeting(slot.name,slotTargeting,providerName);}
gptHelper.pushAd(slot,slotPath,slotTargeting,{sraEnabled:extra.sraEnabled,isPageFairRecoverable:extra.isPageFairRecoverable?extra.isPageFairRecoverable(slot.name):false,isSourcePointRecoverable:extra.isSourcePointRecoverable?extra.isSourcePointRecoverable(slot.name):false});log(['fillInSlot',slot.name,'done'],'debug',logGroup);}
return{name:providerName,canHandleSlot:canHandleSlot,fillInSlot:extra.atfSlots?btfBlocker.decorate(fillInSlot,extra):fillInSlot};}
return{createProvider:createProvider};});;define('ext.wikia.adEngine.provider.gpt.adDetect',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.uapContext','ext.wikia.adEngine.messageListener','ext.wikia.adEngine.slotTweaker','wikia.log','wikia.window'],function(adContext,uapContext,messageListener,slotTweaker,log,win){'use strict';var logGroup='ext.wikia.adEngine.provider.gpt.adDetect',specialAdSelector=['script[src*="/ads.saymedia.com/"]','script[src*="/native.sharethrough.com/"]','.celtra-ad-v3, script[src$="/mmadlib.js"]'].join(',');function isMobile(){var skin=adContext.getContext().targeting.skin;return(skin==='wikiamobile'||skin==='mercury');}
function isImagePresent(document){var imgs,i,len,w,h;imgs=document.querySelectorAll('img[width], img[height]');for(i=0,len=imgs.length;i<len;i+=1){w=imgs[i].getAttribute('width');h=imgs[i].getAttribute('height');if(w>1||h>1){log(['findAdImage','found non-1x1 img'],'info',logGroup);return true;}}
return false;}
function findAdInIframe(slotName,iframe,adCallback,noAdCallback){var iframeHeight,iframeContentHeight,iframeDoc;try{iframeDoc=iframe.contentWindow.document;}catch(e){log(['findAdInIframe',slotName,'ad iframe not accessible (or not found): assuming success'],'error',logGroup);return adCallback();}
iframeHeight=iframe.height;iframe.height=0;iframeContentHeight=iframeDoc.body.offsetHeight;iframe.height=iframeHeight;log(['findAdInIframe',slotName,'height (iframe content)',iframeContentHeight],'info',logGroup);if(iframeContentHeight>1){log(['findAdInIframe',slotName,'height > 1, launching adCallback'],'info',logGroup);return adCallback();}
if(isImagePresent(iframeDoc)){log(['findAdInIframe',slotName,'image, launching adCallback'],'info',logGroup);return adCallback();}
log(['findAdInIframe',slotName,'launching noAdCallback'],'info',logGroup);noAdCallback();}
function inspectIframe(slotName,iframe,adCallback,noAdCallback){if(iframe.contentWindow.document.readyState==='complete'){log(['onAdLoad',slotName,'iframe state complete'],'info',logGroup);setTimeout(function(){findAdInIframe(slotName,iframe,adCallback,noAdCallback);},0);}else{log(['onAdLoad',slotName,'binding to iframe onload'],'info',logGroup);iframe.contentWindow.addEventListener('load',function(){findAdInIframe(slotName,iframe,adCallback,noAdCallback);});}}
function getAdType(slotName,gptEvent,iframe){var status,height,gptEmpty,iframeOk=false;log(['getAdType',slotName],'info',logGroup);try{iframeOk=!!iframe.contentWindow.document.querySelector;}catch(e){log(['getAdType',slotName,'ad iframe not accessible (or not found)'],'error',logGroup);}
if(iframeOk&&iframe.contentWindow.AdEngine_adType){log(['getAdType',slotName,'iframe AdEngine_adType = ',iframe.contentWindow.AdEngine_adType],'info',logGroup);return iframe.contentWindow.AdEngine_adType;}
status=win.adDriver2ForcedStatus&&win.adDriver2ForcedStatus[slotName];if(status==='success'){return'forced_success';}
height=gptEvent.size&&gptEvent.size[1];gptEmpty=gptEvent.isEmpty;if(gptEvent.slot&&gptEvent.slot.getOutOfPage&&gptEvent.slot.getOutOfPage()){log(['getAdType',slotName,'out of page ad','always_success'],'info',logGroup);return'always_success';}
if(gptEmpty||height<=1){log(['getAdType',slotName,'ad is empty (GPT event)','empty'],'info',logGroup);return'empty';}
if(!isMobile()){log(['getAdType',slotName,'not mobile','always_success'],'info',logGroup);return'always_success';}
if(!iframeOk){log(['getAdType',slotName,'running ad callback (!iframeOk)','always_success'],'info',logGroup);return'always_success';}
if(gptEvent.creativeId===null&&gptEvent.lineItemId===null){log(['getAdType',slotName,'creativeId and lineItemId are null','always_success'],'error',logGroup);return'always_success';}
if(iframe.contentWindow.document.querySelector(specialAdSelector)){log(['getAdType',slotName,'special ad'],'info',logGroup);return'always_success';}
log(['getAdType',slotName,'inspect_iframe'],'info',logGroup);return'inspect_iframe';}
function isPartnerAdType(adType){return(/^partner\/[a-zA-Z0-9]{1,30}$/).test(adType);}
function onAdLoad(slot,gptEvent,iframe,forcedAdType){var adType=forcedAdType||getAdType(slot.name,gptEvent,iframe),isCollapsed=false,shouldPollForSuccess=false,expectAsyncCollapse=false,expectAsyncHop=false,expectAsyncHopWithSlotName=false,expectAsyncSuccessWithSlotName=false,expectAsyncSuccess=false,successTimer;function noop(){return;}
function callAdCallback(adInfo){adInfo=adInfo||{};adInfo.adType=adType;clearTimeout(successTimer);slot.success(adInfo);}
function callCollapseAdCallback(adInfo){adInfo=adInfo||{};adInfo.adType=adType;isCollapsed=true;clearTimeout(successTimer);slot.collapse(adInfo);}
function callNoAdCallback(adInfo){adInfo=adInfo||{};adInfo.adType=adType;clearTimeout(successTimer);slot.hop(adInfo);}
function pollForSuccess(){if(isCollapsed){return;}
successTimer=setTimeout(function(){log(['pollForSuccess',slot.name],'info',logGroup);pollForSuccess();findAdInIframe(slot.name+' (poll)',iframe,callAdCallback,noop);},500);}
function handleAsyncMessage(status,isExpected,callback){if(isExpected){callback();}else{log(['msgCallback',slot.name,status,'Got asynchronous message, while not expecting it'],'error',logGroup);}}
function msgCallback(data){log(['msgCallback',slot.name,'caught message',data],'info',logGroup);switch(data.status){case'success':handleAsyncMessage('success',expectAsyncSuccess||expectAsyncSuccessWithSlotName,function(){callAdCallback(data.extra);});break;case'collapse':handleAsyncMessage('collapse',expectAsyncCollapse,function(){callCollapseAdCallback(data.extra);});break;case'hop':handleAsyncMessage('hop',expectAsyncHop||expectAsyncHopWithSlotName,function(){callNoAdCallback(data.extra);});break;}}
if(uapContext.shouldDispatchEvent(slot.name)){uapContext.dispatchEvent();}
if(adType==='manual'){return;}
if(['openx','rubicon','saymedia','turtle','evolve2'].indexOf(adType)!==-1||isPartnerAdType(adType)){shouldPollForSuccess=true;expectAsyncCollapse=true;expectAsyncHop=true;}
if(adType==='async'){expectAsyncHop=true;expectAsyncSuccess=true;}
if(adType==='gumgum'){expectAsyncHopWithSlotName=true;shouldPollForSuccess=true;}
if(adType==='highimpact'){expectAsyncHopWithSlotName=true;expectAsyncSuccessWithSlotName=true;}
log(['onAdLoad',slot.name,'adType',adType],'info',logGroup);if(adType==='forced_success'||adType==='always_success'){return callAdCallback();}
if(adType==='collapse'){return callCollapseAdCallback();}
if(adType==='empty'){return callNoAdCallback();}
if(adType==='inspect_iframe'){return inspectIframe(slot.name,iframe,callAdCallback,callNoAdCallback);}
if(shouldPollForSuccess){slotTweaker.onReady(slot.name,pollForSuccess);}
if(expectAsyncHop||expectAsyncSuccess||expectAsyncCollapse){messageListener.register({source:iframe.contentWindow,dataKey:'status'},msgCallback);}
if(expectAsyncHopWithSlotName||expectAsyncSuccessWithSlotName){messageListener.register({dataKey:'slot_'+slot.name},msgCallback);}
if(expectAsyncHop||expectAsyncHopWithSlotName){if(shouldPollForSuccess||expectAsyncSuccess||expectAsyncSuccessWithSlotName){return;}}
log(['onAdLoad','Unknown ad type (launching starting ad callback)',adType],'error',logGroup);adType='unknown';return callAdCallback();}
return{onAdLoad:onAdLoad};});;define('ext.wikia.adEngine.provider.gpt.adElement',['wikia.document','wikia.log','ext.wikia.adEngine.provider.gpt.adSizeConverter','ext.wikia.adEngine.provider.gpt.adSizeFilter'],function(doc,log,adSizeConverter,adSizeFilter){'use strict';var logGroup='ext.wikia.adEngine.provider.gpt.adElement';function AdElement(slotName,slotPath,slotTargeting){this.id='wikia_gpt'+slotPath;this.node=doc.getElementById(this.id);this.slotPath=slotPath;this.slotName=slotName;this.slotContainerId=this.id;if(!this.node){this.node=doc.createElement('div');this.node.id=this.id;}
if(slotTargeting.size){this.sizes=adSizeConverter.convert(slotTargeting.size);this.sizes=adSizeFilter.filter(slotName,this.sizes);delete slotTargeting.size;this.node.setAttribute('data-gpt-slot-sizes',JSON.stringify(this.sizes));}else{this.node.setAttribute('data-gpt-slot-type','out-of-page');}
this.slotTargeting=slotTargeting;log(['AdElement',this],'debug',logGroup);}
AdElement.prototype.getId=function(){return this.id;};AdElement.prototype.getSlotContainerId=function(){return this.slotContainerId;};AdElement.prototype.setSlotContainerId=function(slotContainerId){this.slotContainerId=slotContainerId;};AdElement.prototype.getSlotName=function(){return this.slotName;};AdElement.prototype.setSlotName=function(slotName){this.slotName=slotName;};AdElement.prototype.getNode=function(){return this.node;};AdElement.prototype.getSlotPath=function(){return this.slotPath;};AdElement.prototype.getSizes=function(){return this.sizes;};AdElement.prototype.configureSlot=function(slot){var name,value;for(name in this.slotTargeting){if(this.slotTargeting.hasOwnProperty(name)){value=this.slotTargeting[name];if(value){log(['setSlot','slot.setTargeting',name,value],'debug',logGroup);slot.setTargeting(name,value);}}}
log(['setSlot',slot],'debug',logGroup);this.node.setAttribute('data-gpt-slot-params',JSON.stringify(this.slotTargeting));};AdElement.prototype.setPageLevelParams=function(pageLevelParams){log(['setPageLevelParams',pageLevelParams],'debug',logGroup);this.node.setAttribute('data-gpt-page-params',JSON.stringify(pageLevelParams));};AdElement.prototype.updateDataParams=function(event){this.node.setAttribute('data-gpt-line-item-id',JSON.stringify(event.lineItemId));this.node.setAttribute('data-gpt-creative-id',JSON.stringify(event.creativeId));this.node.setAttribute('data-gpt-creative-size',JSON.stringify(event.size));};return AdElement;});;define('ext.wikia.adEngine.provider.gpt.adSizeFilter',['ext.wikia.adEngine.adContext','wikia.abTest','wikia.document','wikia.log',require.optional('wikia.breakpointsLayout')],function(adContext,abTest,doc,log,breakpointsLayout){'use strict';var logGroup='ext.wikia.adEngine.provider.gpt.adSizeFilter',context=adContext.getContext(),maxAdSize=704,minSkinWidth=1240;function isLargeBreakpoints(){return breakpointsLayout&&doc.getElementById('WikiaPageBackground').offsetWidth>=breakpointsLayout.getLargeContentWidth();}
function getNewSizes(sizes,maxWidth,fallbackSizes){var goodSizes=[];for(var i=0;i<sizes.length;i+=1){if(sizes[i][0]<=maxWidth){goodSizes.push(sizes[i]);}}
log(['getNewSizes','sizes: ',sizes,'goodSizes: ',goodSizes],'debug',logGroup);return goodSizes.length?goodSizes:fallbackSizes;}
function filterSizes(slotName,slotSizes){var footerSize;log(['filterSizes',slotName,slotSizes],'debug',logGroup);switch(true){case slotName.indexOf('TOP_LEADERBOARD')>-1:return getNewSizes(slotSizes,doc.documentElement.offsetWidth,[[728,90]]);case slotName==='INVISIBLE_SKIN':return doc.documentElement.offsetWidth>=minSkinWidth?slotSizes:[[1,1]];case slotName==='PREFOOTER_LEFT_BOXAD'&&context.opts.overridePrefootersSizes:return isLargeBreakpoints()?slotSizes:getNewSizes(slotSizes,maxAdSize,[[300,250]]);case slotName==='BOTTOM_LEADERBOARD'&&context.opts.adMix3Enabled:footerSize=doc.getElementById('WikiaFooter').offsetWidth;return getNewSizes([[970,250],[728,90]],footerSize,[[728,90]]);case slotName==='BOTTOM_LEADERBOARD':footerSize=doc.getElementById('WikiaFooter').offsetWidth;return getNewSizes(slotSizes,footerSize,[[728,90]]);case slotName==='INCONTENT_BOXAD_1'&&context.opts.adMix1Enabled:case slotName==='TOP_RIGHT_BOXAD'&&context.opts.adMix1Enabled:return[[300,250]];default:return slotSizes;}}
return{filter:filterSizes};});;define('ext.wikia.adEngine.provider.gpt.adSizeConverter',['wikia.log'],function(log){'use strict';var logGroup='ext.wikia.adEngine.provider.gpt.adSizeConverter';function convertSize(slotSizes){log(['convertSizeToGpt',slotSizes],'debug',logGroup);var tmp1=slotSizes.split(','),sizes=[],tmp2,i;for(i=0;i<tmp1.length;i+=1){tmp2=tmp1[i].split('x');sizes.push([parseInt(tmp2[0],10),parseInt(tmp2[1],10)]);}
log(['convertSize',slotSizes,sizes],'debug',logGroup);return sizes;}
return{convert:convertSize};});;define('ext.wikia.adEngine.provider.gpt.googleTag',['ext.wikia.adEngine.provider.gpt.googleSlots','ext.wikia.adEngine.slot.adSlot','ext.wikia.adEngine.slot.service.slotRegistry','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.document','wikia.log','wikia.window',require.optional('ext.wikia.aRecoveryEngine.pageFair.recovery')],function(googleSlots,adSlot,slotRegistry,adBlockDetection,doc,log,win,pageFair){'use strict';var logGroup='ext.wikia.adEngine.provider.gpt.googleTag',slotQueue=[],pageLevelParams,initialized=false;win.googletag=win.googletag||{};win.googletag.cmd=win.googletag.cmd||[];function dispatchEvent(event,methodName){var slot,slotName=adSlot.getShortSlotName(event.slot.getName());log(['dispatchEvent',event],log.levels.info,logGroup);slot=slotRegistry.get(slotName);if(slot&&slot[methodName]){slot[methodName](event);}else{log(['dispatchEvent',event,'Slot not registered'],log.levels.error,logGroup);}}
function push(callback){win.googletag.cmd.push(callback);}
function enableServices(){log(['enableServices','push'],log.levels.info,logGroup);push(function(){win.googletag.pubads().collapseEmptyDivs();win.googletag.pubads().enableSingleRequest();win.googletag.pubads().disableInitialLoad();win.googletag.pubads().addEventListener('slotRenderEnded',function(event){dispatchEvent(event,'renderEnded');});win.googletag.pubads().addEventListener('impressionViewable',function(event){dispatchEvent(event,'viewed');});win.googletag.enableServices();log(['enableServices','push','done'],log.levels.debug,logGroup);});}
function canGptBeLoaded(){var userIsBlockingAds=adBlockDetection.isBlocking(),pageFairRecoveryEnabled=pageFair&&pageFair.isEnabled();if(win.googletag.apiReady){return false;}
return!userIsBlockingAds||pageFairRecoveryEnabled;}
function init(){log('init',log.levels.debug,logGroup);var gads=doc.createElement('script'),node=doc.getElementsByTagName('script')[0];if(canGptBeLoaded()){gads.async=true;gads.type='text/javascript';gads.src='//www.googletagservices.com/tag/js/gpt.js';log('Appending GPT script to head',log.levels.debug,logGroup);node.parentNode.insertBefore(gads,node);}
initialized=true;enableServices();}
function isInitialized(){log(['isInitialized',initialized],log.levels.debug,logGroup);return initialized;}
function setPageLevelParams(params){push(function(){var name,value;pageLevelParams=params;for(name in pageLevelParams){if(pageLevelParams.hasOwnProperty(name)){value=pageLevelParams[name];if(value){log(['setPageLevelParams','pubAds.setTargeting',name,value],log.levels.debug,logGroup);win.googletag.pubads().setTargeting(name,value);}}}});}
function flush(){if(!isInitialized()){log(['flush','done','No slots to flush'],log.levels.info,logGroup);return;}
push(function(){log(['flush','start'],log.levels.info,logGroup);log(['flush','refresh',slotQueue],log.levels.debug,logGroup);if(slotQueue.length){win.googletag.pubads().refresh(slotQueue,{changeCorrelator:false});slotQueue=[];}
log(['flush','done'],log.levels.info,logGroup);});}
function addSlot(adElement){var sizes=adElement.getSizes(),slotId=adElement.getId(),slot=googleSlots.getSlot(slotId);log(['addSlot',adElement],log.levels.debug,logGroup);adElement.setPageLevelParams(pageLevelParams);if(!slot){slot=sizes?win.googletag.defineSlot(adElement.getSlotPath(),sizes,slotId):win.googletag.defineOutOfPageSlot(adElement.getSlotPath(),slotId);slot.addService(win.googletag.pubads());win.googletag.display(slotId);googleSlots.addSlot(slot);}
adElement.configureSlot(slot);slotQueue.push(slot);return slot;}
function refreshSlot(slot){win.googletag.pubads().refresh([slot]);}
function onAdLoad(slotName,element,gptEvent,onAdLoadCallback){log(['onAdLoad',slotName],log.levels.info,logGroup);var iframe=adSlot.getIframe(slotName);onAdLoadCallback(element.getId(),gptEvent,iframe);}
function destroySlots(slotsNames){var allSlots,slotsToDestroy=[],success;if(!isInitialized()){return;}
allSlots=win.googletag.pubads().getSlots();if(!slotsNames){slotsToDestroy=allSlots;}else{allSlots.forEach(function(slot){var slotsPositionTargeting=slot.getTargeting('pos');if(!slotsPositionTargeting.length){log(['destroySlots','getTargeting doesn\'t return pos',slotsPositionTargeting,slot],log.levels.error,logGroup);}else{if(slotsNames.indexOf(slotsPositionTargeting[0])>-1){slotsToDestroy.push(slot);}}});}
if(slotsToDestroy.length){push(function(){log(['destroySlots',slotsNames,slotsToDestroy],log.levels.debug,logGroup);success=win.googletag.destroySlots(slotsToDestroy);if(!success){log(['destroySlots',slotsNames,slotsToDestroy,'failed'],log.levels.error,logGroup);}
googleSlots.removeSlots(slotsToDestroy);});}else{log(['destroySlots','no slots returned to destroy',allSlots,slotsNames],log.levels.debug,logGroup);}}
function updateCorrelator(){push(function(){win.googletag.pubads().updateCorrelator();});}
return{addSlot:addSlot,destroySlots:destroySlots,flush:flush,init:init,isInitialized:isInitialized,onAdLoad:onAdLoad,push:push,refreshSlot:refreshSlot,setPageLevelParams:setPageLevelParams,updateCorrelator:updateCorrelator};});;define('ext.wikia.adEngine.provider.gpt.googleSlots',['ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.window'],function(adUnitBuilder,adBlockDetection,win){'use strict';var slots={};function addSlot(slot){var slotId=slot.getSlotElementId();slots[slotId]=slot;}
function removeSlots(slotsToRemove){slotsToRemove.forEach(function(slot){slots[slot.getSlotElementId()]=undefined;});}
function getSlot(id){var slotId=id;if(adBlockDetection.isBlocking()&&win._sp_.getElementId){slotId=win._sp_.getElementId(slotId);}
return slots[slotId];}
function getSlotByName(slotName){var adUnit=adUnitBuilder.build(slotName,'gpt');return getSlot('wikia_gpt'+adUnit);}
return{addSlot:addSlot,getSlot:getSlot,getSlotByName:getSlotByName,removeSlots:removeSlots};});;define('ext.wikia.adEngine.provider.gpt.helper',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams','ext.wikia.adEngine.context.uapContext','ext.wikia.adEngine.provider.gpt.adDetect','ext.wikia.adEngine.provider.gpt.adElement','ext.wikia.adEngine.provider.gpt.googleTag','ext.wikia.adEngine.slot.slotTargeting','ext.wikia.aRecoveryEngine.sourcePoint.recovery','ext.wikia.aRecoveryEngine.adBlockDetection','ext.wikia.aRecoveryEngine.adBlockRecovery','ext.wikia.adEngine.slotTweaker','wikia.log',require.optional('ext.wikia.adEngine.provider.gpt.sraHelper'),require.optional('ext.wikia.aRecoveryEngine.pageFair.recovery')],function(adContext,adLogicPageParams,uapContext,adDetect,AdElement,googleTag,slotTargeting,sourcePoint,adBlockDetection,adBlockRecovery,slotTweaker,log,sraHelper,pageFair){'use strict';var logGroup='ext.wikia.adEngine.provider.gpt.helper',hiddenSlots=['INCONTENT_PLAYER'];function isHiddenOnStart(slotName){return hiddenSlots.indexOf(slotName)!==-1;}
function pushAd(slot,slotPath,slotTargetingData,extra){extra=extra||{};var element,isBlocking=adBlockDetection.isBlocking(),isRecoveryEnabled=adBlockRecovery.isEnabled(),adIsRecoverable=extra.isPageFairRecoverable||extra.isSourcePointRecoverable,adShouldBeRecovered=isRecoveryEnabled&&isBlocking&&adIsRecoverable,shouldPush=!isBlocking||adShouldBeRecovered,slotName=slot.name,uapId=uapContext.getUapId();log(['isRecoveryEnabled, isBlocking, adIsRecoverable',isRecoveryEnabled,isBlocking,adIsRecoverable],log.levels.debug,logGroup);slotTargetingData=JSON.parse(JSON.stringify(slotTargetingData));if(isHiddenOnStart(slotName)){slotTweaker.hide(slotName);slot.pre('success',function(){slotTweaker.show(slotName);});}
setAdditionalTargeting(slotTargetingData);element=new AdElement(slotName,slotPath,slotTargetingData);if(pageFair&&extra.isPageFairRecoverable){log(['Adding adonis-marker to slot',slot],log.levels.debug,logGroup);pageFair.addMarker(element.node);}
function queueAd(){log(['queueAd',slotName,element],log.levels.debug,logGroup);slot.container.appendChild(element.getNode());googleTag.addSlot(element);}
function shouldSetSrcPremium(){return adContext.getContext().opts.premiumOnly;}
function setAdditionalTargeting(slotTargetingData){var abId;if(shouldSetSrcPremium()){slotTargetingData.src='premium';}else if(adShouldBeRecovered){slotTargetingData.src='rec';}
slotTargetingData.wsi=slotTargeting.getWikiaSlotId(slotName,slotTargetingData.src);slotTargetingData.hb_si=slotTargeting.getPrebidSlotId(slotTargetingData);slotTargetingData.uap=uapId?uapId.toString():'none';abId=slotTargeting.getAbTestId(slotTargetingData);if(abId){slotTargetingData.abi=abId;}}
function onAdLoadCallback(slotElementId,gptEvent,iframe){setTimeout(function(){log(['onAdLoadCallback',slotElementId],log.levels.info,logGroup);adDetect.onAdLoad(slot,gptEvent,iframe,extra.forcedAdType);},0);}
function gptCallback(gptEvent){log(['gptCallback',element.getId(),gptEvent],log.levels.info,logGroup);element.updateDataParams(gptEvent);googleTag.onAdLoad(slotName,element,gptEvent,onAdLoadCallback);}
if(!googleTag.isInitialized()){googleTag.init();googleTag.setPageLevelParams(adLogicPageParams.getPageLevelParams());}
if(!shouldPush){log(['Push blocked',slotName],log.levels.debug,logGroup);slot.collapse();return;}
log(['pushAd',slotName,slotTargetingData],log.levels.info,logGroup);if(!slotTargetingData.flushOnly){slot.pre('renderEnded',gptCallback);googleTag.push(queueAd);}
if(!sraHelper||!extra.sraEnabled||sraHelper.shouldFlush(slotName)){log('flushing',log.levels.debug,logGroup);googleTag.flush();}
if(slotTargetingData.flushOnly){log(['flushOnly - success',slotName],log.levels.debug,logGroup);slot.success();}}
function refreshSlot(slot){log(['Refresh slot',slot.name,slot],log.levels.debug,logGroup);refreshTargetingData(slot);googleTag.refreshSlot(slot);}
function refreshTargetingData(slot){slot.setTargeting('uap',uapContext.getUapId().toString());return slot;}
adContext.addCallback(function(){if(googleTag.isInitialized()){googleTag.setPageLevelParams(adLogicPageParams.getPageLevelParams());uapContext.reset();}});return{refreshSlot:refreshSlot,pushAd:pushAd};});;define('ext.wikia.adEngine.provider.gpt.sraHelper',['wikia.log'],function(log){'use strict';var logGroup='ext.wikia.adEngine.provider.gpt.sraHelper',flushed=false,sraSlots=['INVISIBLE_SKIN','TOP_LEADERBOARD'];function shouldFlush(slotName){if(sraSlots.indexOf(slotName)===-1){log(['shouldFlush','Non-SRA slot',slotName],'debug',logGroup);flushed=true;}
log(['shouldFlush',slotName,flushed],'debug',logGroup);return flushed;}
return{shouldFlush:shouldFlush};});;define('ext.wikia.adEngine.provider.remnantGpt',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.uapContext','ext.wikia.adEngine.provider.factory.wikiaGpt','ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.service.megaAdUnitBuilder','ext.wikia.adEngine.slotTweaker'],function(adContext,uapContext,factory,adUnitBuilder,megaAdUnitBuilder,slotTweaker){'use strict';return factory.createProvider('ext.wikia.adEngine.provider.remnantGpt','RemnantGpt','remnant',{BOTTOM_LEADERBOARD:{size:'728x90',loc:'footer'},INCONTENT_BOXAD_1:{size:'120x600,160x600,300x250,300x600',loc:'hivi'},INVISIBLE_HIGH_IMPACT_2:{loc:'hivi'},INVISIBLE_SKIN:{size:'1000x1000,1x1',loc:'top'},LEFT_SKYSCRAPER_2:{size:'120x600,160x600,300x250,300x600,300x1050',loc:'middle'},LEFT_SKYSCRAPER_3:{size:'120x600,160x600,300x250,300x600',loc:'footer'},PREFOOTER_LEFT_BOXAD:{size:'300x250',loc:'footer'},PREFOOTER_MIDDLE_BOXAD:{size:'300x250',loc:'footer'},PREFOOTER_RIGHT_BOXAD:{size:'300x250',loc:'footer'},TOP_LEADERBOARD:{size:'728x90,1030x130,1030x65,1030x250,970x365,970x250,970x90,970x66,970x180,980x150',loc:'top'},TOP_RIGHT_BOXAD:{size:'300x250,300x600,300x1050',loc:'top'}},{beforeSuccess:function(slotName){slotTweaker.removeDefaultHeight(slotName);if(!uapContext.isUapLoaded()){slotTweaker.removeTopButtonIfNeeded(slotName);slotTweaker.adjustLeaderboardSize(slotName);}},adUnitBuilder:adContext.getContext().opts.enableRemnantNewAdUnit?megaAdUnitBuilder:adUnitBuilder});});;define('ext.wikia.adEngine.provider.rubiconFastlane',['ext.wikia.adEngine.slotTweaker','wikia.iframeWriter','wikia.instantGlobals','wikia.log','wikia.window'],function(slotTweaker,iframeWriter,instantGlobals,log,win){'use strict';var logGroup='ext.wikia.adEngine.provider.rubiconFastlane',providerName='RubiconFastlane',rubiconTiersKey='rpfl_7450',skipTier=instantGlobals.wgAdDriverRubiconFastlaneProviderSkipTier||0,sizeMap={'1':[468,60],'2':[728,90],'8':[120,600],'9':[160,600],'10':[300,600],'15':[300,250],'43':[320,50],'44':[300,50],'49':[336,280],'54':[300,1050],'57':[970,250],'67':[320,480]},slotMap=['INCONTENT_BOXAD_1','LEFT_SKYSCRAPER_2','LEFT_SKYSCRAPER_3','PREFOOTER_LEFT_BOXAD','PREFOOTER_MIDDLE_BOXAD','PREFOOTER_RIGHT_BOXAD','TOP_LEADERBOARD','TOP_RIGHT_BOXAD','MOBILE_IN_CONTENT','MOBILE_PREFOOTER','MOBILE_TOP_LEADERBOARD'];function getTiers(slotName){var slot,tiers;if(win.rubicontag&&typeof win.rubicontag.getSlot==='function'){slot=win.rubicontag.getSlot(slotName);}
if(slot&&typeof slot.getAdServerTargetingByKey==='function'){tiers=slot.getAdServerTargetingByKey(rubiconTiersKey);}
return tiers||[];}
function getBestTier(tiers){var bestPrice=0,bestTier=null;tiers.forEach(function(tier){var matches=tier.match(/^\d+_tier(\d+)/),value=0;if(matches&&matches[1]){value=parseInt(matches[1],10);}
if(value>bestPrice){bestPrice=value;bestTier=tier;}});return bestPrice>skipTier?bestTier:null;}
function getSizeFromTier(tier){var matches;if(tier===null){return;}
matches=tier.match(/^(\d+)_tier/);if(matches&&matches[1]&&sizeMap[matches[1]]){return matches[1];}}
function renderCreative(slot,size){var dimensions=sizeMap[size],iframe=iframeWriter.getIframe({code:'',width:dimensions[0],height:dimensions[1]});iframe.id=['wikia',providerName,slot.name,size].join('/');slot.post('success',function(){slotTweaker.removeDefaultHeight(slot.name);slotTweaker.removeTopButtonIfNeeded(slot.name);slotTweaker.adjustLeaderboardSize(slot.name);log(['success',slot.name],'info',logGroup);});slot.container.setAttribute('data-creative-size',JSON.stringify(dimensions));slot.container.appendChild(iframe);win.rubicontag.renderCreative(iframe.contentWindow.document.body,slot.name,size);slot.success({adType:'success'});}
function canHandleSlot(slotName){var canHandle=slotMap.indexOf(slotName)!==-1;log(['canHandleSlot',slotName,canHandle],'debug',logGroup);return canHandle;}
function fillInSlot(slot){var tiers=getTiers(slot.name),bestTier=getBestTier(tiers),size=getSizeFromTier(bestTier);log(['fillInSlot',slot.name,bestTier],'debug',logGroup);slot.post('collapse',function(){slotTweaker.hide(slot.name);log(['collapse',slot.name],'info',logGroup);});slot.container.setAttribute('data-creative-tier',JSON.stringify(tiers));if(!size||typeof win.rubicontag.renderCreative!=='function'){return slot.collapse({adType:'collapse'});}
renderCreative(slot,size);}
return{name:providerName,canHandleSlot:canHandleSlot,fillInSlot:fillInSlot};});;define('ext.wikia.adEngine.provider.turtle',['wikia.log','ext.wikia.adEngine.provider.gpt.helper','ext.wikia.adEngine.slotTweaker',require.optional('ext.wikia.adEngine.lookup.openx.openXBidderHelper')],function(log,gptHelper,slotTweaker,openXHelper){'use strict';var logGroup='ext.wikia.adEngine.provider.turtle',slotMap={INVISIBLE_SKIN:{size:'1000x1000,1x1'},LEFT_SKYSCRAPER_2:{size:'160x600,300x600'},TOP_LEADERBOARD:{size:'728x90,970x250,970x90'},TOP_RIGHT_BOXAD:{size:'300x250,300x600'},TURTLE_FLUSH:{flushOnly:true}};function canHandleSlot(slotName){log(['canHandleSlot',slotName],'debug',logGroup);var ret=!!slotMap[slotName];log(['canHandleSlot',slotName,ret],'debug',logGroup);return ret;}
function fillInSlot(slot){log(['fillInSlot',slot.name],'debug',logGroup);slot.pre('success',function(){slotTweaker.removeDefaultHeight(slot.name);slotTweaker.removeTopButtonIfNeeded(slot.name);slotTweaker.adjustLeaderboardSize(slot.name);});slot.pre('hop',function(){openXHelper&&openXHelper.addOpenXSlot(slot.name);});gptHelper.pushAd(slot,'/98544404/Wikia/Nordics_RoN/'+slot.name,slotMap[slot.name],{forcedAdType:'turtle',sraEnabled:true});log(['fillInSlot',slot,'done'],'debug',logGroup);}
return{name:'Turtle',canHandleSlot:canHandleSlot,fillInSlot:fillInSlot};});;define('ext.wikia.adEngine.slot.adSlot',['ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.service.megaAdUnitBuilder','wikia.document','wikia.log','wikia.window',require.optional('ext.wikia.aRecoveryEngine.adBlockDetection')],function(adUnitBuilder,megaAdUnitBuilder,doc,log,win,adBlockDetection){'use strict';var logGroup='ext.wikia.adEngine.slot.adSlot';function create(name,container,callbacks){function registerHook(name){return function(adInfo){if(typeof callbacks[name]==='function'){callbacks[name](adInfo);}};}
return{name:name,container:container,isViewed:false,collapse:registerHook('collapse'),hop:registerHook('hop'),renderEnded:registerHook('renderEnded'),success:registerHook('success'),viewed:registerHook('viewed')};}
function getShortSlotName(slotName){if(megaAdUnitBuilder.isValid(slotName)){return megaAdUnitBuilder.getShortSlotName(slotName);}
return adUnitBuilder.getShortSlotName(slotName);}
function getRecoveredIframe(slotName){var node=doc.querySelector('#'+slotName+' > .provider-container:not(.hidden) > div'),fallbackId=node&&win._sp_.getElementId(node.id),elementById=fallbackId&&doc.getElementById(fallbackId);if(elementById){return elementById.querySelector('div[id*="_container_"] iframe');}}
function getIframe(slotName){var cssSelector='#'+slotName+' > .provider-container:not(.hidden) div[id*="_container_"] > iframe',iframe=doc.querySelector(cssSelector);if(!iframe&&adBlockDetection&&adBlockDetection.isBlocking()){iframe=getRecoveredIframe(slotName);}
log(['getIframe',slotName,iframe&&iframe.id],log.levels.debug,logGroup);return iframe;}
function getRecoveredProviderContainer(providerContainer){var elementId=providerContainer.childNodes.length>0&&providerContainer.childNodes[0].id,recoveredElementId=win._sp_.getElementId(elementId),element=doc.getElementById(recoveredElementId);log(['getRecoveredProviderContainer for container',providerContainer],log.levels.debug,logGroup);log(['getRecoveredProviderContainer recovered element ID',recoveredElementId],log.levels.debug,logGroup);log(['getRecoveredProviderContainer recovered element',element],log.levels.debug,logGroup);if(element&&element.parentNode){log(['getRecoveredProviderContainer recovered provider container',element.parentNode],log.levels.debug,logGroup);return element.parentNode;}
return null;}
function getProviderContainer(slotName){var isRecovering=adBlockDetection.isBlocking(),providerContainer,slotContainer=doc.getElementById(slotName);providerContainer=slotContainer.lastElementChild;if(isRecovering&&providerContainer.hasAttribute('data-sp-clone')){providerContainer=getRecoveredProviderContainer(providerContainer);}
return providerContainer;}
return{create:create,getIframe:getIframe,getProviderContainer:getProviderContainer,getShortSlotName:getShortSlotName};});;define('ext.wikia.adEngine.slot.bottomLeaderboard',['wikia.document','wikia.domCalculator','wikia.log','wikia.throttle','wikia.window'],function(doc,dom,log,throttle,win){'use strict';var slotName='BOTTOM_LEADERBOARD',threshold=100,viewPortHeight=Math.max(doc.documentElement.clientHeight,win.innerHeight||0),logGroup='ext.wikia.adEngine.slot.bottomLeaderboard',pushed=false,wikiaFooter=doc.getElementById('WikiaFooter'),pushSlot=throttle(function(){var scrollPosition=win.scrollY||win.pageYOffset||doc.documentElement.scrollTop,pushPos=dom.getTopOffset(wikiaFooter)-viewPortHeight-threshold;if(win.ArticleComments&&!win.ArticleComments.initCompleted){return;}
if(!pushed&&pushPos<scrollPosition){pushed=true;doc.removeEventListener('scroll',pushSlot);win.adslots2.push(slotName);log(['pushSlot','Pushed '+slotName],'debug',logGroup);}});function init(){if(!doc.getElementById(slotName)){log(['init','No '+slotName],'error',logGroup);return;}
doc.addEventListener('scroll',pushSlot);}
return{init:init};});;define('ext.wikia.adEngine.slot.floatingMedrec',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.slot.service.viewabilityHandler','jquery','wikia.abTest','wikia.log','wikia.throttle','wikia.window'],function(adContext,viewabilityHandler,$,abTest,log,throttle,win){'use strict';var logGroup='ext.wikia.adEngine.slot.floatingMedrec';function init(){var context=adContext.getContext(),isEnoughSpace=false,enabled=false,adPushed=false,globalNavigationHeight=$('#globalNavigation').outerHeight(true),margin=10,minDistance=800,leftSkyscraper3Selector='#LEFT_SKYSCRAPER_3',slotName='INCONTENT_BOXAD_1',startPosition,stopPoint,stopPosition,$adSlot=$('<div class="wikia-ad"></div>').attr('id',slotName),$footer=$('#WikiaFooter'),$recirculationRail=$('#recirculation-rail'),$placeHolder=$('#WikiaAdInContentPlaceHolder'),$win=$(win),refresh={refreshAdPos:0,lastRefreshTime:new Date(),refreshNumber:0,adVisible:true,};function getStartPosition(placeHolder){return parseInt(placeHolder.offset().top,10)-
globalNavigationHeight-margin;}
function getStopPosition(ad,footer,leftSkyscraper3){stopPoint=parseInt(footer.offset().top,10);if(leftSkyscraper3.length&&parseInt(leftSkyscraper3.height(),10)!==0){stopPoint=parseInt(leftSkyscraper3.offset().top,10);}
return stopPoint-globalNavigationHeight-2*margin-ad.height();}
function update(){if($win.scrollTop()<=startPosition){$adSlot.css({position:'relative',top:'0px',visibility:'visible'});}
if(!context.opts.adMixExperimentEnabled){if($win.scrollTop()>startPosition&&$win.scrollTop()<stopPosition){$adSlot.css({position:'fixed',top:globalNavigationHeight+margin+'px',visibility:'visible'});}
if($win.scrollTop()>=stopPosition){$adSlot.css({position:'absolute',top:stopPosition-startPosition+'px',visibility:'visible'});}}
if(context.opts.adMix1Enabled){refreshAdIfPossible();}
if(context.opts.adMix3Enabled&&shouldChangeSlot($adSlot.offset().top,6)){if(refresh.adVisible){$adSlot.addClass('hidden');$recirculationRail.show();}else{viewabilityHandler.refreshOnView(slotName,0);$recirculationRail.hide();}
refresh.adVisible=!refresh.adVisible;}}
function getDifference(currentAdPos){return currentAdPos>refresh.refreshAdPos?currentAdPos-refresh.refreshAdPos:refresh.refreshAdPos-currentAdPos;}
function refreshAdIfPossible(){var currentAdPos=$adSlot.offset().top;if(shouldChangeSlot(currentAdPos,3)){viewabilityHandler.refreshOnView(slotName,0);}}
function shouldChangeSlot(currentAdPos,maxChanges){var heightScrolled=getDifference(currentAdPos),timeDifference=(new Date())-refresh.lastRefreshTime,result=heightScrolled>10&&timeDifference>10000&&refresh.refreshNumber<maxChanges;if(result){refresh.lastRefreshTime=new Date();refresh.refreshAdPos=currentAdPos;refresh.refreshNumber++;}
return result;}
function handleFloatingMedrec(){var scrollTop=$win.scrollTop();startPosition=getStartPosition($placeHolder);stopPosition=getStopPosition($adSlot,$footer,$(leftSkyscraper3Selector));isEnoughSpace=stopPosition-startPosition>minDistance;if(enabled&&!isEnoughSpace){log(['handleFloatingMedrec','Disabling floating medrec: not enough space in right rail'],'debug',logGroup);win.removeEventListener('scroll',update);win.removeEventListener('resize',update);if(!context.opts.adMixExperimentEnabled){$adSlot.css({visibility:'hidden'});}
enabled=false;}
if(!enabled&&isEnoughSpace&&scrollTop>=startPosition){log(['handleFloatingMedrec','Enabling floating medrec'],'debug',logGroup);enabled=!context.opts.adMix3Enabled;if(!adPushed&&(!context.opts.adMix3Enabled||shouldChangeSlot(scrollTop,6))){$placeHolder.append($adSlot);win.adslots2.push({slotName:slotName,onSuccess:function(){win.addEventListener('scroll',update);win.addEventListener('resize',update);refresh.refreshAdPos=$adSlot.offset().top;refresh.lastRefreshTime=new Date();}});adPushed=true;if(context.opts.adMix3Enabled){$recirculationRail.hide();}}}}
function start(){if(!context.opts.floatingMedrec){log(['init','Floating medrec disabled: ad context returns false'],'debug',logGroup);return;}
if(!win.wgIsContentNamespace){log(['init','Floating medrec disabled: $wgIsContentNamespace equals false'],'debug',logGroup);return;}
if(!$placeHolder.length){log(['init','Floating medrec disabled: no placeHolder'],'debug',logGroup);return;}
win.addEventListener('scroll',throttle(handleFloatingMedrec));win.addEventListener('resize',throttle(handleFloatingMedrec));}
start();}
return{init:init};});;define('ext.wikia.adEngine.slot.highImpact',['ext.wikia.adEngine.context.slotsContext','wikia.window'],function(slotsContext,win){'use strict';var slotName='INVISIBLE_HIGH_IMPACT_2';function init(){if(slotsContext.isApplicable(slotName)){win.adslots2.push({slotName:slotName});}}
return{init:init};});;define('ext.wikia.adEngine.slot.inContent',['ext.wikia.adEngine.adTracker','ext.wikia.adEngine.context.slotsContext','JSMessages','wikia.document','wikia.log','wikia.window'],function(adTracker,slotsContext,msg,doc,log,win){'use strict';var logGroup='ext.wikia.adEngine.slot.inContent',selector='#mw-content-text > h2';function createInContentWrapper(slotName){var adHtml=doc.createElement('div'),label=msg('adengine-advertisement');adHtml.id='INCONTENT_WRAPPER';adHtml.innerHTML='<div id="'+slotName+'" class="wikia-ad default-height" data-label="'+label+'"></div>';return adHtml;}
function insertSlot(header,slotName,onSuccessCallback){var wrapper=createInContentWrapper(slotName);log('insertSlot','debug',logGroup);header.parentNode.insertBefore(wrapper,header);win.adslots2.push({slotName:slotName,onSuccess:onSuccessCallback});}
function init(slotName,onSuccessCallback){var header=doc.querySelectorAll(selector)[1],logMessage,logWikiData='(wikiId: '+win.wgCityId+' articleId: '+win.wgArticleId+')',slotNameGA=slotName.toLowerCase();if(!header){logMessage='missing second section '+logWikiData;log(slotName+' not added - '+logMessage,'debug',logGroup);adTracker.track('slot/'+slotNameGA+'/failed',{'reason':logMessage});return;}
if(!slotsContext.isApplicable(slotName)){logMessage='2nd section in the article is not full width '+logWikiData;log(slotName+' not added - '+logMessage,'debug',logGroup);adTracker.track('slot/'+slotNameGA+'/failed',{'reason':logMessage});return;}
insertSlot(header,slotName,onSuccessCallback);adTracker.track('slot/'+slotNameGA+'/success');}
return{init:init};});;define('ext.wikia.adEngine.slot.resolvedState',['ext.wikia.adEngine.context.uapContext','wikia.cache','wikia.log','wikia.querystring','wikia.window'],function(uapContext,cache,log,QueryString,win){'use strict';var cacheKey='adEngine_resolvedStateCounter',cacheTtl=cache.CACHE_STANDARD,logGroup='ext.wikia.adEngine.slot.resolvedState',now=win.wgNow||new Date(),qs=new QueryString();function getQueryParam(){return qs.getVal('resolved_state',null);}
function isForcedByURLParam(){return[true,'true','1'].indexOf(getQueryParam())>-1;}
function isBlockedByURLParam(){return[false,'blocked','false','0'].indexOf(getQueryParam())>-1;}
function createCacheKey(){return cacheKey+'_'+uapContext.getUapId();}
function findRecordInCache(){return cache.get(createCacheKey(),now);}
function wasDefaultStateSeen(){var adId=uapContext.getUapId(),record=findRecordInCache(),seen=!!record&&record.lastSeenDate!==now.getTime();if(seen){log('Full version of uap was seen in last 24h. adId: '+adId,log.levels.debug,logGroup);}else{log('Full version of uap was not seen in last 24h. adId: '+adId,log.levels.debug,logGroup);}
return seen;}
function updateInformationAboutSeenDefaultStateAd(){cache.set(createCacheKey(),{adId:uapContext.getUapId(),lastSeenDate:now.getTime()},cacheTtl,now);}
function setResolvedState(params){log('Resolved state is turned on',logGroup,log.levels.debug);params.aspectRatio=params.resolvedStateAspectRatio;params.image1.element.src=params.image1.resolvedStateSrc;if(params.image2&&params.image2.resolvedStateSrc){params.image2.element.src=params.image2.resolvedStateSrc;}}
function templateSupportsResolvedState(params){return!!(params.image1&&params.image1.resolvedStateSrc);}
function setDefaultState(params){params.image1.element.src=params.image1.defaultStateSrc;if(params.image2&&params.image2.defaultStateSrc){params.image2.element.src=params.image2.defaultStateSrc;}}
function setImage(videoSettings){var params=videoSettings.getParams();if(templateSupportsResolvedState(params)){if(videoSettings.isResolvedState()){setResolvedState(params);}else{setDefaultState(params);updateInformationAboutSeenDefaultStateAd();}}}
function isResolvedState(){var showResolvedState=!isBlockedByURLParam(),defaultStateSeen=true;if(showResolvedState){defaultStateSeen=wasDefaultStateSeen()||isForcedByURLParam();}
return showResolvedState&&defaultStateSeen;}
return{isResolvedState:isResolvedState,setImage:setImage};});;define('ext.wikia.adEngine.slot.skyScraper3',['ext.wikia.adEngine.adContext','jquery','wikia.log','wikia.window'],function(adContext,$,log,win){'use strict';var logGroup='ext.wikia.adEngine.slot.skyScraper3';log('load','debug',logGroup);function adjustSize($slot){$slot.css('top',(-1*$slot.height())+'px');}
function init(){var $footer=$('#WikiaFooter'),$rail=$('#WikiaRail'),slotName='LEFT_SKYSCRAPER_3',$slot=$('<div class="wikia-ad"></div>').attr('id',slotName),context=adContext.getContext();log('init','debug',logGroup);if(context.opts.pageType!=='all_ads'){log('skyScraper3 not started, because context.opts.pageType is not all_ads','info',logGroup);return;}
if(!$rail.length){log('skyScraper3 not started, because there is no rail','info',logGroup);return;}
if(!$footer.length){log('skyScraper3 not started, because there is no footer','info',logGroup);return;}
if($('#'+slotName).length){log('skyScraper3 not added. It was already there','error',logGroup);return;}
$footer.prepend($slot);win.adslots2.push({slotName:slotName,onSuccess:function(){adjustSize($slot);$rail.addClass('left-skyscraper-3-present');}});}
return{init:init};});;define('ext.wikia.adEngine.slot.service.actionHandler',['ext.wikia.adEngine.messageListener','ext.wikia.adEngine.slotTweaker','ext.wikia.adEngine.slot.service.viewabilityHandler','wikia.abTest','wikia.log'],function(messageListener,slotTweaker,viewabilityHandler,abTest,log){'use strict';var logGroup='ext.wikia.adEngine.slot.service.actionHandler';function messageCallback(data){if(!data.slotName){return log('messageCallback: missing slot name',log.levels.debug,logGroup);}
switch(data.action){case'expand':slotTweaker.expand(data.slotName);break;case'collapse':slotTweaker.collapse(data.slotName);break;case'hide':slotTweaker.hide(data.slotName);break;case'show':slotTweaker.show(data.slotName);break;case'make-responsive':slotTweaker.makeResponsive(data.slotName,data.aspectRatio);break;case'refresh-on-view':if(!abTest.getGroup('AD_MIX')||(abTest.getGroup('AD_MIX')&&abTest.getGroup('AD_MIX').indexOf('AD_MIX_1')===0)){viewabilityHandler.refreshOnView(data.slotName,data.delay);}
break;default:log(['messageCallback: unknown action',data.action],log.levels.debug,logGroup);}}
function registerMessageListener(){messageListener.register({dataKey:'action',infinite:true},messageCallback);}
return{registerMessageListener:registerMessageListener};});;define('ext.wikia.adEngine.slot.service.passbackHandler',['ext.wikia.adEngine.slot.service.stateMonitor'],function(slotStateMonitor){'use strict';function get(slotName){var slotHops=slotStateMonitor.getSlotStatuses(slotName,'hop');if(slotHops.length>0){var lastHop=slotHops[slotHops.length-1];return lastHop&&lastHop.adInfo&&lastHop.adInfo.source?lastHop.adInfo.source:'unknown';}
return null;}
return{get:get};});;define('ext.wikia.adEngine.slot.service.slotRegistry',['ext.wikia.adEngine.adContext'],function(adContext){'use strict';var slots={},slotQueueCount={};function incrementSlotQueueCount(slotName){slotQueueCount[slotName]=slotQueueCount[slotName]||0;if(slots[slotName].length===0){slotQueueCount[slotName]+=1;}}
function add(slot,providerName){slots[slot.name]=slots[slot.name]||[];incrementSlotQueueCount(slot.name);slots[slot.name].push({providerName:providerName,slot:slot});}
function get(slotName,providerName){var slotsCount,foundSlots;if(!slots[slotName]){return null;}
slotsCount=slots[slotName].length;if(!slotsCount){return null;}
if(!providerName){return slots[slotName][slotsCount-1].slot;}
foundSlots=slots[slotName].filter(function(registryRow){if(registryRow.providerName===providerName){return registryRow.slot;}});if(foundSlots.length){return foundSlots[0].slot;}
return null;}
function getRefreshCount(slotName){return slotQueueCount[slotName]||0;}
function reset(slotName){slots[slotName]=[];}
adContext.addCallback(function(){slots={};slotQueueCount={};});return{add:add,get:get,getRefreshCount:getRefreshCount,reset:reset};});;define('ext.wikia.adEngine.slot.service.stateMonitor',['wikia.window'],function(win){'use strict';var slotHistoryMap={};function store(data){if(!slotHistoryMap[data.slot.name]){slotHistoryMap[data.slot.name]=[];}
slotHistoryMap[data.slot.name].push(data);}
function run(){win.addEventListener('adengine.slot.status',function(e){store(e.detail);});}
function filterByStatus(data,status){return data.filter(function(e){return e.status===status;});}
function getSlotStatuses(slotName,statusType){var result=slotHistoryMap[slotName];if(!result){return[];}
return statusType?filterByStatus(result,statusType):result;}
return{getSlotStatuses:getSlotStatuses,run:run};});;define('ext.wikia.adEngine.slot.service.viewabilityHandler',['ext.wikia.adEngine.provider.gpt.googleTag','ext.wikia.adEngine.slot.service.slotRegistry','wikia.log','wikia.window'],function(googleTag,slotRegistry,log,win){'use strict';var logGroup='ext.wikia.adEngine.slot.service.viewabilityHandler';function refreshSlot(slotName,delay){delay=delay!==undefined?delay:1000;win.setTimeout(function(){googleTag.destroySlots([slotName]);if(win.adslots2){win.adslots2.push([slotName]);}else{win.Mercury.Modules.Ads.getInstance().pushSlotToQueue(slotName);}},delay);}
function refreshOnView(slotName,delay){var slot=slotRegistry.get(slotName);log(['refresh on view',slotName,slot],log.levels.debug,logGroup);if(slot){if(slot.isViewed){refreshSlot(slot.name,delay);}else{slot.post('viewed',function(){refreshSlot(slot.name,delay);});}}}
return{refreshOnView:refreshOnView};});;define('ext.wikia.adEngine.template.bfaa',['ext.wikia.adEngine.adContext','wikia.log',require.optional('ext.wikia.adEngine.template.bfaaDesktop'),require.optional('ext.wikia.adEngine.template.bfaaMobile')],function(adContext,log,bfaaDesktop,bfaaMobile){'use strict';var bfaa,logGroup='ext.wikia.adEngine.template.bfaa';function show(params){switch(adContext.getContext().targeting.skin){case'oasis':bfaa=bfaaDesktop;break;case'mercury':bfaa=bfaaMobile;break;default:return log(['show','not supported skin'],log.levels.error,logGroup);}
if(!bfaa){log(['show','module is not loaded'],log.levels.error,logGroup);}
bfaa.show(params);}
return{show:show};});;define('ext.wikia.adEngine.template.bfaaDesktop',['ext.wikia.adEngine.context.uapContext','ext.wikia.adEngine.provider.btfBlocker','ext.wikia.adEngine.provider.gpt.googleSlots','ext.wikia.adEngine.provider.gpt.helper','ext.wikia.adEngine.slot.resolvedState','ext.wikia.adEngine.slotTweaker','ext.wikia.adEngine.video.uapVideo','ext.wikia.adEngine.video.videoSettings','wikia.document','wikia.log','wikia.throttle','wikia.window',require.optional('ext.wikia.aRecoveryEngine.tweaker')],function(uapContext,btfBlocker,googleSlots,helper,resolvedState,slotTweaker,uapVideo,VideoSettings,doc,log,throttle,win,recoveryTweaker){'use strict';var breakPointWidthNotSupported=767,logGroup='ext.wikia.adEngine.template.bfaaDesktop',nav,page,slotContainer,unblockedSlots=['BOTTOM_LEADERBOARD','INCONTENT_BOXAD_1'],wrapper;function updateNavBar(height){var position=win.scrollY||win.pageYOffset;log(['updateNavBar',height,position],log.levels.info,logGroup);if(doc.body.offsetWidth<=breakPointWidthNotSupported||position<=height){nav.classList.add('bfaa-pinned');}else{nav.classList.remove('bfaa-pinned');}}
function runOnReady(iframe,params,videoSettings){var spotlightFooter=doc.getElementById('SPOTLIGHT_FOOTER');nav.style.top='';page.classList.add('bfaa-template');if(!win.ads.runtime.disableCommunitySkinOverride){doc.body.classList.add('uap-skin');}
log('desktopHandler::show',log.levels.info,logGroup);updateNavBar(slotContainer.offsetHeight);doc.addEventListener('scroll',throttle(function(){updateNavBar(slotContainer.offsetHeight);},100));if(win.WikiaBar){win.WikiaBar.hideContainer();}
if(spotlightFooter){spotlightFooter.parentNode.style.display='none';}
if(recoveryTweaker&&recoveryTweaker.isTweakable()){slotTweaker.removeDefaultHeight(params.slotName);recoveryTweaker.tweakSlot(params.slotName,iframe);}
if(uapVideo.isEnabled(params)){uapVideo.loadVideoAd(videoSettings);}}
function show(params){var medrecSlotName='TOP_RIGHT_BOXAD',videoSettings;slotContainer=doc.getElementById(params.slotName);nav=doc.getElementById('globalNavigation');page=doc.getElementsByClassName('WikiaSiteWrapper')[0];wrapper=doc.getElementById('WikiaTopAds');log(['show',page,wrapper,params],log.levels.info,logGroup);wrapper.style.opacity='0';uapContext.setUapId(params.uap);videoSettings=VideoSettings.create(params);resolvedState.setImage(videoSettings);slotTweaker.makeResponsive(params.slotName,params.aspectRatio);slotTweaker.onReady(params.slotName,function(iframe){runOnReady(iframe,params,videoSettings);wrapper.style.opacity='';if(params.loadMedrecFromBTF){helper.refreshSlot(googleSlots.getSlotByName(medrecSlotName));}});unblockedSlots.forEach(btfBlocker.unblock);log(['show',params.uap],log.levels.info,logGroup);}
return{show:show};});;define('ext.wikia.adEngine.template.bfab',['ext.wikia.adEngine.slot.resolvedState','ext.wikia.adEngine.slotTweaker','ext.wikia.adEngine.video.uapVideo','ext.wikia.adEngine.video.videoSettings','wikia.log','wikia.document',require.optional('ext.wikia.aRecoveryEngine.tweaker')],function(resolvedState,slotTweaker,uapVideo,VideoSettings,log,doc,recoveryTweaker){'use strict';var logGroup='ext.wikia.adEngine.template.bfab',slot=doc.getElementById('BOTTOM_LEADERBOARD')||doc.getElementById('MOBILE_BOTTOM_LEADERBOARD');function show(params){var videoSettings=VideoSettings.create(params);slot.classList.add('bfab-template');resolvedState.setImage(videoSettings);slotTweaker.makeResponsive(slot.id,params.aspectRatio);slotTweaker.onReady(slot.id,function(iframe){if(recoveryTweaker&&recoveryTweaker.isTweakable()){recoveryTweaker.tweakSlot(slot.id,iframe);}
if(uapVideo.isEnabled(params)){uapVideo.loadVideoAd(videoSettings);}});log('show','info',logGroup);}
return{show:show};});;define('ext.wikia.adEngine.template.floatingRail',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.math','jquery','wikia.log','wikia.throttle','wikia.window'],function(adContext,math,$,log,throttle,win){'use strict';var $medrec=$('#TOP_RIGHT_BOXAD'),$rail=$('#WikiaRail'),$railWrapper=$('#WikiaRailWrapper'),$wikiaMainContent=$('#WikiaMainContent'),$win=$(win),adsInRail=2,biggestAdSize=600,globalNavHeight=$('#globalNavigation').height(),margin=10,medrecDefaultSize=250,logGroup='ext.wikia.adEngine.template.floatingRail',railWidth=300,availableSpace,articleHeight,floatingSpace,scrollTop,startPosition,stopPosition,update=throttle(function(){startPosition=parseInt($railWrapper.offset().top,10)-globalNavHeight-margin;stopPosition=startPosition+floatingSpace;scrollTop=$win.scrollTop();if(scrollTop<=startPosition||$medrec.hasClass('hidden')){$rail.css({position:'relative',top:'0px',width:railWidth+'px'});}else if(scrollTop>startPosition&&scrollTop<stopPosition){$rail.css({position:'fixed',top:globalNavHeight+margin+'px',width:railWidth+'px'});}else if(scrollTop>=stopPosition){$rail.css({position:'absolute',top:floatingSpace+2*globalNavHeight+'px',width:railWidth+'px'});}},50);function getAvailableSpace(){if(!availableSpace){availableSpace=$wikiaMainContent.height()-$railWrapper.height()+medrecDefaultSize-adsInRail*biggestAdSize;availableSpace=Math.max(0,availableSpace);log(['getAvailableSpace',availableSpace],'debug',logGroup);}
return availableSpace;}
function getArticleHeight(){if(!articleHeight){articleHeight=$wikiaMainContent.height();log(['getArticleHeight',articleHeight],'debug',logGroup);}
return articleHeight;}
function show(params){var offset=params.offset||0,context=adContext.getContext(),isPageSupported=context.targeting.skin==='oasis'&&context.targeting.pageType==='article';if(context.opts.adMixExperimentEnabled){return;}
if(!isPageSupported||getAvailableSpace()===0){return;}
floatingSpace=Math.min(offset,getAvailableSpace());win.addEventListener('scroll',update);win.addEventListener('resize',update);}
function getArticleHeightParameter(){var space=getArticleHeight();return math.getBucket(space,1500);}
return{getArticleHeightParameter:getArticleHeightParameter,show:show};});;define('ext.wikia.adEngine.template.floor',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.slot.adSlot','ext.wikia.adEngine.provider.gpt.adDetect','wikia.log','wikia.document','wikia.iframeWriter','wikia.window'],function(adContext,adSlot,adDetect,log,doc,iframeWriter,win){'use strict';var logGroup='ext.wikia.adEngine.template.floor',floorId='ext-wikia-adEngine-template-floor',floorHtml='<div id="'+floorId+'">'+'<div class="background"></div>'+'<div class="ad"></div>'+'<a class="close" title="Close" href="#">'+'<svg role="img" class="ads-floor-close-button"><use xlink:href="#close"></use></svg>'+'</a>'+'</div>',$=win.$;function show(params){log(['show',params],'debug',logGroup);var iframe=iframeWriter.getIframe({code:params.code,width:params.width,height:params.height}),$floor=$('#'+floorId),isFloorPresent=$floor.length>0,gptEventMock={size:{width:params.width,height:params.height}},async=params.canHop&&params.slotName,slot;function showFloor(){var skin=adContext.getContext().targeting.skin;if(skin==='oasis'){win.WikiaBar.hideContainer();}
$floor.removeClass('hidden');}
if(params.onClick){$(iframe).on('load',function(){var iframeDoc=iframe.contentWindow.document;$('html',iframeDoc).css('cursor','pointer').on('click',params.onClick);});}
if(async){log(['show',params.slotName,'can hop'],'info',logGroup);slot=adSlot.create(params.slotName,null,{success:function(){log(['ad detect',params.slotName,'success'],'info',logGroup);win.postMessage('{"AdEngine":{"slot_'+params.slotName+'":true,"status":"success"}}','*');showFloor();},hop:function(){log(['ad detect',params.slotName,'hop'],'info',logGroup);win.postMessage('{"AdEngine":{"slot_'+params.slotName+'":true,"status":"hop"}}','*');}});$(iframe).on('load',function(){adDetect.onAdLoad(slot,gptEventMock,iframe);});}
if(!isFloorPresent){$floor=$(floorHtml);$floor.addClass('hidden');$(doc.body).append($floor);}
$floor.find('a.close').click(function(event){event.preventDefault();$floor.addClass('hidden');});$floor.find('.ad').html(iframe);if(!async){showFloor();}}
adContext.addCallback(function(){var floor=doc.getElementById(floorId);if(floor){floor.parentElement.removeChild(floor);}});return{show:show};});;define('ext.wikia.adEngine.template.floorAdhesion',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.slotTweaker','wikia.log','wikia.document','wikia.window'],function(adContext,slotTweaker,log,doc,win){'use strict';var logGroup='ext.wikia.adEngine.template.floorAdhesion',slotName='INVISIBLE_HIGH_IMPACT_2';function show(){var skin=adContext.getContext().targeting.skin,wrapper=doc.getElementById('InvisibleHighImpactWrapper');wrapper.querySelector('.close').addEventListener('click',function(event){event.preventDefault();wrapper.classList.add('hidden');});if(skin==='oasis'){win.WikiaBar.hideContainer();}
wrapper.classList.add('floor-adhesion');wrapper.classList.remove('hidden');slotTweaker.adjustIframeByContentSize(slotName);log('Show floor adhesion','info',logGroup);}
return{show:show};});;define('ext.wikia.adEngine.template.interstitial',['ext.wikia.adEngine.slotTweaker','wikia.document','wikia.log'],function(slotTweaker,doc,log){'use strict';var logGroup='ext.wikia.adEngine.template.interstitial',slotName='INVISIBLE_HIGH_IMPACT_2';function show(){var wrapper=doc.getElementById('InvisibleHighImpactWrapper');wrapper.querySelector('.close').addEventListener('click',function(event){event.preventDefault();wrapper.classList.add('hidden');doc.documentElement.classList.remove('stop-scrolling');log('Hide interstitial','info',logGroup);});wrapper.classList.add('interstitial');wrapper.classList.remove('hidden');doc.documentElement.classList.add('stop-scrolling');slotTweaker.adjustIframeByContentSize(slotName);log('Show interstitial','info',logGroup);}
return{show:show};});;define('ext.wikia.adEngine.template.modal',['ext.wikia.adEngine.slot.adSlot','ext.wikia.adEngine.provider.gpt.adDetect','ext.wikia.adEngine.template.modalHandlerFactory','wikia.document','wikia.log','wikia.iframeWriter','wikia.throttle','wikia.window'],function(adSlot,adDetect,modalHandlerFactory,doc,log,iframeWriter,throttle,win){'use strict';var logGroup='ext.wikia.adEngine.template.modal',modalHandler=modalHandlerFactory.create();function show(params){log(['show',params],'debug',logGroup);var adContainer=doc.createElement('DIV'),adIframe=iframeWriter.getIframe({code:params.code,height:params.height,width:params.width,classes:'wikia-ad-iframe'}),async=params.canHop&&params.slotName,gptEventMock={size:{width:params.width,height:params.height}},lightboxParams=modalHandler.getExpansionModel(),slot;if(modalHandler===null){return;}
function scaleAd(){var availableWidth=Math.max(win.innerWidth*lightboxParams.availableWidthRatio,lightboxParams.minWidth),availableHeight=Math.max(win.innerHeight*lightboxParams.availableHeightRatio-lightboxParams.heightSubtract,lightboxParams.minHeight),ratioWidth=availableWidth/params.width,ratioHeight=availableHeight/params.height,ratio=Math.min(ratioWidth,ratioHeight,lightboxParams.maximumRatio);adIframe.style.transform='scale('+ratio+')';adIframe.style.msTransform='scale('+ratio+')';adIframe.style.WebkitTransform='scale('+ratio+')';adIframe.style.transformOrigin='top left';adIframe.style.msTransformOrigin='top left';adIframe.style.WebkitTransformOrigin='top left';adContainer.style.width=Math.floor(params.width*ratio)+'px';adContainer.style.height=Math.floor(params.height*ratio)+'px';}
function scaleAdIfNeeded(){if(params.scalable){scaleAd();win.addEventListener('resize',throttle(function(){scaleAd();}));}}
adIframe.style.maxWidth='none';adContainer.appendChild(adIframe);if(async){slot=adSlot.create(params.slotName,null,{success:function(){log(['ad detect',params.slotName,'success'],'info',logGroup);win.postMessage('{"AdEngine":{"slot_'+params.slotName+'":true,"status":"success"}}','*');modalHandler.show();},hop:function(){log(['ad detect',params.slotName,'hop'],'info',logGroup);win.postMessage('{"AdEngine":{"slot_'+params.slotName+'":true,"status":"hop"}}','*');}});adIframe.addEventListener('load',function(){adDetect.onAdLoad(slot,gptEventMock,adIframe);});}
scaleAdIfNeeded();if(!params.hasOwnProperty('closeDelay')){params.closeDelay=0;}
modalHandler.create(adContainer,!async,params.closeDelay);}
return{show:show};});;define('ext.wikia.adEngine.template.modalHandlerFactory',['ext.wikia.adEngine.adContext','wikia.log',require.optional('ext.wikia.adEngine.template.modalMercuryHandler'),require.optional('ext.wikia.adEngine.template.modalOasisHandler')],function(adContext,log,MercuryHandler,OasisHandler){'use strict';var logGroup='ext.wikia.adEngine.template.modalHandlerFactory',skin=adContext.getContext().targeting.skin;function create(){log(['create',skin],'debug',logGroup);switch(skin){case'mercury':log('Created handler for mercury skin','debug',logGroup);return new MercuryHandler();case'oasis':log('Created handler for oasis skin','debug',logGroup);return new OasisHandler();default:log('Unsupported skin','debug',logGroup);return null;}}
return{create:create};});;define('ext.wikia.adEngine.template.modalOasisHandler',['jquery',require.optional('wikia.ui.factory')],function($,uiFactory){'use strict';var oasisHandler=function(){this.modalId='ext-wikia-adEngine-template-modal';};oasisHandler.prototype.create=function(adContainer,modalVisible,closeButtonDelay){var modalConfig={vars:{id:this.modalId,size:'medium',content:'',title:'Advertisement',closeText:'Close',buttons:[]}};uiFactory.init('modal').then((function(uiModal){uiModal.createComponent(modalConfig,(function(modal){closeButtonDelay=parseInt(closeButtonDelay,10)||0;var hideCloseButton=closeButtonDelay>0,$header,$counter,counter;this.modal=modal;modal.$content.append(adContainer);modal.$element.width('auto');function timer(){closeButtonDelay=closeButtonDelay-1;if(closeButtonDelay<0){clearInterval(counter);$counter.hide();modal.$close.show();return;}
$counter.text(closeButtonDelay);}
if(hideCloseButton){$header=modal.$close.parent();$counter=$(document.createElement('div'));modal.$close.hide();$counter.addClass('close-counter');$counter.text(closeButtonDelay);$header.prepend($counter);counter=setInterval(timer,1000);}
if(modalVisible){this.show();}}).bind(this));}).bind(this));};oasisHandler.prototype.show=function(){if(this.modal){this.modal.show();}};oasisHandler.prototype.getExpansionModel=function(){return{availableHeightRatio:0.8,availableWidthRatio:0.9,heightSubtract:90,minWidth:200,minHeight:150,maximumRatio:2};};return oasisHandler;});;define('ext.wikia.adEngine.template.ooyala',['ext.wikia.adEngine.video.vastUrlBuilder','wikia.log','wikia.videoBootstrap'],function(vastUrlBuilder,log,VideoBootstrap){'use strict';var libraryUrl='http://player.ooyala.com/v3/52bc289bedc847e3aa8eb2b347644f68?platform=html5-priority',logGroup='ext.wikia.adEngine.template.ooyala';function show(params){var aspectRatio=params.width/params.height,playerId='ooyala_'+Math.floor((1+Math.random())*0x10000),vastTargeting={passback:'ooyala',pos:params.slotName,src:params.src},vb;vb=new VideoBootstrap(params.container,{html:'<div id="'+playerId+'" style="width: 100%; height: 100%;"></div>',width:params.width,height:params.height,jsParams:{playerId:playerId,videoId:params.videoId,autoPlay:params.autoPlay||true,tagUrl:params.vastUrl||vastUrlBuilder.build(aspectRatio,vastTargeting),jsFile:[libraryUrl,'extensions/wikia/VideoHandlers/js/handlers/lib/OoyalaAgeGate.js'],onCreate:params.onReady},init:'wikia.videohandler.ooyala',scripts:['extensions/wikia/VideoHandlers/js/handlers/Ooyala.js']});log(['show',vb,params],'debug',logGroup);}
return{show:show};});;define('ext.wikia.adEngine.template.playwire',['ext.wikia.adEngine.video.player.playwire','wikia.log'],function(player,log){'use strict';var logGroup='ext.wikia.adEngine.template.playwire';function show(params){params.configUrl=params.configUrl||player.getConfigUrl(params.publisherId,params.videoId);if(params.container){player.inject(params);log(['show',params.configUrl],'info',logGroup);}}
return{show:show};});;define('ext.wikia.adEngine.template.porvata',['ext.wikia.adEngine.domElementTweaker','ext.wikia.adEngine.slot.service.slotRegistry','ext.wikia.adEngine.slotTweaker','ext.wikia.adEngine.video.player.porvata','ext.wikia.adEngine.video.player.uiTemplate','ext.wikia.adEngine.video.player.ui.videoInterface','ext.wikia.adEngine.video.videoSettings','ext.wikia.adEngine.wrappers.prebid','wikia.browserDetect','wikia.document','wikia.log','wikia.window',require.optional('ext.wikia.adEngine.lookup.prebid.adapters.veles'),require.optional('ext.wikia.adEngine.mobile.mercuryListener')],function(DOMElementTweaker,slotRegistry,slotTweaker,porvata,uiTemplate,videoInterface,videoSettings,prebid,browserDetect,doc,log,win,veles,mercuryListener){'use strict';var logGroup='ext.wikia.adEngine.template.porvata',videoAspectRatio=640/360;function loadVeles(params){params.vastResponse=params.vastResponse||params.bid.ad;veles.markBidsAsUsed(params.hbAdId);}
function createInteractiveArea(){var controlBar=doc.createElement('div'),controlBarItems=doc.createElement('div'),interactiveArea=doc.createElement('div');controlBar.classList.add('control-bar');controlBarItems.classList.add('control-bar-items');interactiveArea.classList.add('interactive-area');controlBar.appendChild(controlBarItems);interactiveArea.appendChild(controlBar);return{controlBar:controlBar,controlBarItems:controlBarItems,interactiveArea:interactiveArea};}
function getVideoContainer(slotName){var container=doc.createElement('div'),displayWrapper=doc.createElement('div'),providerContainer=doc.querySelector('#'+slotName+' > .provider-container');container.classList.add('video-overlay');displayWrapper.classList.add('video-display-wrapper');container.appendChild(displayWrapper);providerContainer.appendChild(container);return displayWrapper;}
function isVpaid(contentType){return contentType.indexOf('application/')===0;}
function onReady(video,params){var slot=doc.getElementById(params.slotName),slotExpanded=false,slotWidth;video.addEventListener('loaded',function(){var adsManager=video.ima.getAdsManager(),videoContainer=video.container||video.ima.container;setTimeout(function(){adsManager.setVolume(0);});videoContainer.classList.remove('hidden');if(!params.hasUiControls){params.container.addEventListener('mouseenter',function(){adsManager.setVolume(1);});params.container.addEventListener('mouseleave',function(){adsManager.setVolume(0);});}});video.addEventListener('start',function(){setTimeout(function(){video.ima.getAdsManager().setVolume(0);});if(params.isDynamic&&!slotExpanded){slotTweaker.expand(params.slotName);slotExpanded=true;video.ima.dispatchEvent('wikiaSlotExpanded');}
if(params.isDynamic){slotWidth=slot.scrollWidth;video.resize(slotWidth,slotWidth/videoAspectRatio);}});video.addEventListener('allAdsCompleted',function(){video.ima.getAdsManager().pause();if(params.isDynamic){slotTweaker.collapse(params.slotName);}});if(params.isDynamic){win.addEventListener('resize',function(){if(!(video.isFloating&&video.isFloating())){slotWidth=slot.clientWidth;video.resize(slotWidth,slotWidth/videoAspectRatio);}});}}
function isVideoAutoplaySupported(){return!browserDetect.isAndroid()||(browserDetect.getBrowser().indexOf('Chrome')!==-1&&browserDetect.getBrowserVersion()>=54);}
function show(params){var imaVpaidModeInsecure=2,settings;log(['show',params],log.levels.debug,logGroup);if(params.hbAdId){params.bid=prebid.getBidByAdId(params.hbAdId);params.vastUrl=params.bid.vastUrl;}
if(params.bid&&params.adProduct==='veles'){loadVeles(params);}
if(!isVideoAutoplaySupported()){log(['hop',params.adProduct,params.slotName,params],log.levels.info,logGroup);slotRegistry.get(params.slotName).hop({adType:params.adType,source:'porvata'});return;}else{slotRegistry.get(params.slotName).success({adType:params.adType,source:'porvata'});}
if(params.vpaidMode===imaVpaidModeInsecure){params.originalContainer=params.container;params.container=getVideoContainer(params.slotName);}
if(params.isDynamic){slotTweaker.collapse(params.slotName);slotTweaker.makeResponsive(params.slotName,videoAspectRatio);}
settings=videoSettings.create(params);porvata.inject(settings).then(function(video){if(typeof params.onReady==='function'){params.onReady(video);}else{onReady(video,params);}
return video;}).then(function(video){var imaVpaidMode=win.google.ima.ImaSdkSettings.VpaidMode,videoPlayer;if(params.vpaidMode===imaVpaidMode.INSECURE){videoPlayer=params.container.querySelector('.video-player');video.addEventListener('loaded',function(){var ad=video.ima.getAdsManager().getCurrentAd();if(ad&&isVpaid(ad.getContentType()||'')){params.container.classList.add('vpaid-enabled');DOMElementTweaker.show(videoPlayer);}});video.addEventListener('allAdsCompleted',function(){DOMElementTweaker.hide(params.container);});}
if(mercuryListener){mercuryListener.onPageChange(function(){video.destroy();});}
return video;}).then(function(video){if(settings.hasUiControls()){var elements=createInteractiveArea();video.container.appendChild(elements.interactiveArea);videoInterface.setup(video,uiTemplate.featureVideo,elements);}});}
return{show:show};});;define('ext.wikia.adEngine.template.skin',['ext.wikia.adEngine.adContext','wikia.document','wikia.window','wikia.log'],function(adContext,doc,win,log){'use strict';var logGroup='ext.wikia.adengine.template.skin';function show(params){win.wgAfterContentAndJS.push(function(){log(params,'debug',logGroup);params=params||{};var adSkin=doc.getElementById('ad-skin'),adSkinStyle=adSkin.style,wikiaSkin=doc.getElementById('WikiaPageBackground'),wikiaSkinStyle=wikiaSkin&&wikiaSkin.style,i,len,pixelElement,pixelUrl;if(win.wgOasisResponsive||win.wgOasisBreakpoints){require(['wikia.backgroundchanger'],function(backgroundchanger){if(!params.middleColor){params.middleColor=params.backgroundColor;}
var bcParams={skinImage:params.skinImage,skinImageWidth:1700,skinImageHeight:800,backgroundTiled:false,backgroundFixed:true,backgroundDynamic:true};if(params.backgroundColor){bcParams.backgroundColor='#'+params.backgroundColor;}
if(params.middleColor){bcParams.backgroundMiddleColor='#'+params.middleColor;}
if(params.ten64){bcParams.ten64=true;}
backgroundchanger.load(bcParams);});}else{adSkinStyle.background='url("'+params.skinImage+'") no-repeat top center #'+params.backgroundColor;}
doc.body.classList.add('background-ad');adSkinStyle.position='fixed';adSkinStyle.height='100%';adSkinStyle.width='100%';adSkinStyle.left=0;adSkinStyle.top=0;adSkinStyle.zIndex=1;adSkinStyle.cursor='pointer';if(wikiaSkinStyle){wikiaSkinStyle.opacity=1;}
adSkin.onclick=function(){log('Click on skin','user',logGroup);win.open(params.destUrl);};win.wgAdSkinPresent=true;log('Skin set',5,logGroup);if(params.pixels){for(i=0,len=params.pixels.length;i<len;i+=1){pixelUrl=params.pixels[i];if(pixelUrl){log('Adding tracking pixel '+pixelUrl,'debug',logGroup);pixelElement=doc.createElement('img');pixelElement.src=pixelUrl;pixelElement.width=1;pixelElement.height=1;adSkin.appendChild(pixelElement);}}}
log('Pixels added','debug',logGroup);});}
return{show:show};});;define('ext.wikia.adEngine.utils.adLogicZoneParams',['ext.wikia.adEngine.adContext','wikia.log','wikia.location'],function(adContext,log,loc){'use strict';var calculated=false,context={},hostname=loc.hostname,logGroup='ext.wikia.adEngine.utils.adLogicZoneParams',maxNumberOfCategories=3,site,zone1,zone2;function updateContext(){context=adContext.getContext();calculated=false;}
function getDomain(){var lhost,pieces,sld='',np;lhost=hostname.toLowerCase();pieces=lhost.split('.');np=pieces.length;if(pieces[np-2]==='co'){sld=pieces[np-3]+'.'+pieces[np-2]+'.'+pieces[np-1];}else{sld=pieces[np-2]+'.'+pieces[np-1];}
return sld.replace(/\./g,'');}
function getHostnamePrefix(){var lhost=hostname.toLowerCase(),pieces=lhost.split('.');if(pieces.length){return pieces[0];}}
function getVerticalName(targeting){if(getHostnamePrefix()==='showcase'||context.opts.showcase===true){return'showcase';}
return targeting.mappedVerticalName;}
function getRawDbName(){return'_'+(context.targeting.wikiDbName||'wikia').replace('/[^0-9A-Z_a-z]/','_');}
function calculateParams(){log('calculateParams','info',logGroup);var mappedVertical=getVerticalName(context.targeting);if(context.targeting.pageIsHub){site='hub';zone1='_'+mappedVertical+'_hub';zone2='hub';}else{site=mappedVertical;zone1=getRawDbName();zone2=context.targeting.pageType||'article';}
calculated=true;log(['calculateParams',site,zone1,zone2],'info',logGroup);}
function getSite(){if(!calculated){calculateParams();}
return site;}
function getName(){if(!calculated){calculateParams();}
return zone1;}
function getPageType(){if(!calculated){calculateParams();}
return zone2;}
function getVertical(){return context.targeting.wikiVertical;}
function getPageCategories(){var categories=context.targeting.pageCategories,outCategories;if(categories instanceof Array&&categories.length>0){outCategories=categories.slice(0,maxNumberOfCategories);return outCategories.join('|').toLowerCase().replace(/ /g,'_').split('|');}}
function getLanguage(){return context.targeting.wikiLanguage||'unknown';}
function getWikiCategories(){return context.targeting.newWikiCategories;}
updateContext();adContext.addCallback(updateContext);return{getDomain:getDomain,getHostnamePrefix:getHostnamePrefix,getSite:getSite,getName:getName,getPageType:getPageType,getVertical:getVertical,getPageCategories:getPageCategories,getWikiCategories:getWikiCategories,getLanguage:getLanguage,getRawDbName:getRawDbName};});;define('ext.wikia.adEngine.utils.eventDispatcher',['wikia.document','wikia.log','wikia.window'],function(doc,log,win){'use strict';var logGroup='ext.wikia.adEngine.utils.eventDispatcher';function dispatchEvent(name,data){var event=doc.createEvent('CustomEvent');event.initCustomEvent(name,true,true,data||{});win.dispatchEvent(event);log(['dispatchEvent',name,data],'info',logGroup);}
return{dispatch:dispatchEvent};});;define('ext.wikia.adEngine.utils.hooks',[],function(){'use strict';return function(objectInstance,methodNames){var hooks={};function addHookListeners(){if(typeof objectInstance.pre==='function'||typeof objectInstance.post==='function'){return;}
objectInstance.pre=function(methodName,callback){if(!hooks[methodName]){throw new Error('Method '+methodName+' is not registered.');}
if(typeof callback==='function'){hooks[methodName].pre.push(callback);}};objectInstance.post=function(methodName,callback){if(!hooks[methodName]){throw new Error('Method '+methodName+' is not registered.');}
if(typeof callback==='function'){hooks[methodName].post.push(callback);}};}
function callAllCallbacks(callbacks,args){callbacks.forEach(function(callback){callback.apply(objectInstance,args);});}
methodNames.forEach(function(methodName){var copy=objectInstance[methodName];if(typeof copy!=='function'){throw new Error('Method '+methodName+' does not exist.');}
hooks[methodName]={pre:[],post:[]};objectInstance[methodName]=function(){callAllCallbacks(hooks[methodName].pre,arguments);copy.apply(objectInstance,arguments);callAllCallbacks(hooks[methodName].post,arguments);};});addHookListeners();};});;define('ext.wikia.adEngine.utils.math',[],function(){'use strict';function getBucket(number,bucketSize){return parseInt(number/bucketSize,10)*bucketSize;}
function leftPad(number,offset){var label=number+'';while(label.length<offset){label='0'+label;}
return label;}
return{getBucket:getBucket,leftPad:leftPad};});;define('ext.wikia.adEngine.video.player.ooyala.ooyalaTracker',['ext.wikia.adEngine.video.player.playerTracker','wikia.window'],function(playerTracker,win){'use strict';var playerName='ooyala',trackingEventsMap={adsClickthroughOpened:'clicked',ADS_ERROR:'error',ADS_PLAYED:'completed',WILL_PLAY_ADS:'loaded',PLAYER_CREATED:'ready',WILL_PAUSE_ADS:'paused',WILL_RESUME_ADS:'resumed',WILL_PLAY_SINGLE_AD:'started',WILL_PLAY_FROM_BEGINNING:'content_started',PLAYED:'content_completed'};function track(params,eventName){playerTracker.track(params,playerName,eventName);}
function register(player,params){if(!win.OO||!player||!playerTracker.isEnabled()){return;}
Object.keys(trackingEventsMap).forEach(function(playerEvent){player.mb.subscribe(win.OO.EVENTS[playerEvent]||playerEvent,'ooyala-kikimora-tracking',function(){track(params,trackingEventsMap[playerEvent]);});});}
return{register:register,track:track};});;define('ext.wikia.adEngine.video.player.playerTracker',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams','ext.wikia.adEngine.adTracker','ext.wikia.adEngine.slot.slotTargeting','wikia.browserDetect','wikia.geo','wikia.log','wikia.window',require.optional('ext.wikia.adEngine.lookup.prebid.bidHelper'),require.optional('ext.wikia.adEngine.video.player.porvata.floater')],function(adContext,pageLevel,adTracker,slotTargeting,browserDetect,geo,log,win,bidHelper,floater){'use strict';var context=adContext.getContext(),logGroup='ext.wikia.adEngine.video.player.playerTracker',emptyValue={int:0,string:'(none)',price:-1};function isEnabled(){return!!context.opts.playerTracking;}
function prepareData(params,playerName,eventName,errorCode,contentType){var pageLevelParams=pageLevel.getPageLevelParams(),canFloat=floater&&floater.canFloat(params)?'canFloat':'',floatingState=(params.floatingContext&&params.floatingContext.state)||(canFloat?'never':''),trackingData={'pv_unique_id':win.adEnginePvUID,'pv_number':pageLevelParams.pv,'country':geo.getCountryCode(),'skin':pageLevelParams.skin,'wsi':params.src?slotTargeting.getWikiaSlotId(params.slotName,params.src):emptyValue.string,'player':playerName,'ad_product':params.adProduct,'position':params.slotName||emptyValue.string,'event_name':eventName,'ad_error_code':errorCode||emptyValue.int,'content_type':contentType||emptyValue.string,'line_item_id':params.lineItemId||emptyValue.int,'creative_id':params.creativeId||emptyValue.int,'price':emptyValue.price,'browser':[browserDetect.getOS(),browserDetect.getBrowser()].join(' '),'additional_1':canFloat,'additional_2':floatingState};if(bidHelper&&params.bid&&params.adProduct==='rubicon'){trackingData['vast_id']=[params.bid.rubiconAdvertiserId||emptyValue.string,params.bid.rubiconAdId||emptyValue.string].join(':');trackingData['price']=bidHelper.transformPriceFromBid(params.bid);}
if(bidHelper&&params.bid&&params.adProduct==='veles'){trackingData['vast_id']=params.bid.vastId||emptyValue.string;}
return trackingData;}
function track(params,playerName,eventName,errorCode,contentType){if(!isEnabled()||params.trackingDisabled){log(['track','Tracking disabled',params],log.levels.debug,logGroup);return;}
if(!params.adProduct||!playerName||!eventName){log(['track','Missing argument',params.adProduct,playerName,eventName],log.levels.debug,logGroup);return;}
var data=prepareData(params,playerName,eventName,errorCode,contentType);log(['track',data],log.levels.debug,logGroup);adTracker.trackDW(data,'adengplayerinfo');return data;}
return{isEnabled:isEnabled,track:track};});;define('ext.wikia.adEngine.video.player.playwire',['ext.wikia.adEngine.video.player.playwire.playwirePlayerFactory','ext.wikia.adEngine.video.player.playwire.playwireTracker','ext.wikia.adEngine.video.vastUrlBuilder','wikia.document','wikia.log'],function(playerFactory,tracker,vastUrlBuilder,doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.playwire',playerUrl='//cdn.playwire.com/bolt/js/zeus/embed.js';function getConfigUrl(publisherId,videoId){return'//config.playwire.com/'+publisherId+'/videos/v2/'+videoId+'/zeus.json';}
function inject(params){var configUrl=params.configUrl,container=params.container,height=params.height,playerId='playwire_'+Math.floor((1+Math.random())*0x10000),script=doc.createElement('script'),vastUrl=params.vastUrl,vastTargeting=params.vastTargeting||{passback:'playwire',pos:params.slotName,src:params.src},width=params.width,win=container.ownerDocument.defaultView||container.ownerDocument.parentWindow;tracker.track(params,'init');return new Promise(function(resolve){configUrl=configUrl||getConfigUrl(params.publisherId,params.videoId);vastUrl=vastUrl||vastUrlBuilder.build(width/height,vastTargeting);win[playerId+'_ready']=function(){var video=playerFactory.create(win.Bolt,playerId,params);tracker.register(video,params);video.addEventListener('boltContentStarted',function(){video.api.dispatchEvent(video.id,'wikiaAdStarted');});video.addEventListener('boltContentComplete',function(){video.api.dispatchEvent(video.id,'wikiaAdCompleted');});resolve(video);if(params.onReady){params.onReady(win.Bolt,playerId,video);}};script.setAttribute('data-id',playerId);script.setAttribute('data-config',configUrl);script.setAttribute('data-onready',playerId+'_ready');script.setAttribute('data-ad-tag',vastUrl);if(params.volume!==undefined){script.setAttribute('data-volume',params.volume);}
script.setAttribute('type','text/javascript');script.src=playerUrl;container.appendChild(script);log(['inject',configUrl],log.levels.debug,logGroup);});}
return{getConfigUrl:getConfigUrl,inject:inject};});;define('ext.wikia.adEngine.video.player.playwire.playwirePlayerFactory',[],function(){'use strict';function create(api,playerId,params){return{api:api,id:playerId,container:params.container,addEventListener:function(eventName,callback){this.api.on(this.id,eventName,callback);},play:function(width,height){this.api.dispatchEvent(this.id,'wikiaAdPlayTriggered');this.resize(width,height);this.api.playMedia(this.id);this.api.dispatchEvent(this.id,'wikiaAdStarted');},stop:function(){this.api.dispatchEvent(this.id,'wikiaAdStop');this.api.stopMedia(this.id);this.api.dispatchEvent(this.id,'wikiaAdCompleted');},resize:function(width,height){this.api.resizeVideo(this.id,width+'px',height+'px');}};}
return{create:create};});;define('ext.wikia.adEngine.video.player.playwire.playwireTracker',['ext.wikia.adEngine.video.player.playerTracker'],function(playerTracker){'use strict';var playerName='playwire',trackingEventsMap={'boltAdRequestStart':'loaded','boltAdStarted':'started','boltFirstQuartile':'first_quartile','boltMidPoint':'midpoint','boltThirdQuartile':'third_quartile','boltAdComplete':'completed','boltAdClicked':'clicked','boltAdError':'error','boltContentStarted':'content_started','boltContentComplete':'content_completed','boltContentError':'content_error','wikiaAdPlayTriggered':'play_triggered','wikiaAdStop':'closed'};function track(params,eventName,errorCode){playerTracker.track(params,playerName,eventName,errorCode);}
function register(player,params){if(!playerTracker.isEnabled()){return;}
playerTracker.track(params,playerName,'ready');Object.keys(trackingEventsMap).forEach(function(playerEvent){player.api.addEventListener(player.id,playerEvent,function(){playerTracker.track(params,playerName,trackingEventsMap[playerEvent]);});});}
return{register:register,track:track};});;define('ext.wikia.adEngine.video.player.porvata.floater',['ext.wikia.adEngine.video.player.porvata.floaterConfiguration','ext.wikia.adEngine.video.player.porvata.floatingContextFactory','wikia.document','wikia.throttle','wikia.window'],function(floaterConfiguration,floatingContextFactory,doc,throttle,win){'use strict';var activeFloatingCssClass='floating',withArticleVideoCssClass='with-article-video',wikiFloatingVideoSelector='.video-container';function updateDimensions(element,width,height){if(element){element.style.width=width+'px';element.style.height=height+'px';}}
function createCloseButton(){var a=doc.createElement('a'),img=doc.createElement('img');a.classList.add('floating-close-button');img.src='/extensions/wikia/ArticleVideo/images/close.svg';a.appendChild(img);return a;}
function resizeVideoAndShowCloseButton(floatingContext,width,height){var elements=floatingContext.elements,listeners=floatingContext.listeners;if(!listeners.start){listeners.start=function(){if(floatingContext.isFloating()){elements.video.resize(width,height);}};elements.video.addEventListener('start',listeners.start);}
elements.video.resize(width,height);}
function deleteCloseButton(floatingContext){var elements=floatingContext.elements;if(elements.closeButton){elements.ad.removeChild(elements.closeButton);}}
function endFloating(floatingContext){var video=floatingContext.elements.video,listeners=floatingContext.listeners;win.removeEventListener('scroll',listeners.scroll);if(listeners.start){video.removeEventListener('start',listeners.start);}
if(listeners.adResumed){video.removeEventListener('resume',listeners.adResumed);}
if(listeners.adCompleted){video.removeEventListener('wikiaAdCompleted',listeners.adCompleted);}
floatingContext.stop();}
function createOnCloseListener(floatingContext){return function(){disableFloating(floatingContext);if(floatingContext.pauseOnClose){floatingContext.stop();}else{endFloating(floatingContext);}};}
function enableFloating(floatingContext){var elements=floatingContext.elements,width=0,height=0;floatingContext.beforeFloat();elements.adContainer.classList.add(activeFloatingCssClass);width=floatingContext.getWidth();height=floatingContext.getHeight();updateDimensions(elements.imageContainer,width,height);resizeVideoAndShowCloseButton(floatingContext,width,height);floatingContext.float();}
function disableFloating(floatingContext){var elements=floatingContext.elements,preferred=floatingContext.preferred;elements.adContainer.classList.remove(activeFloatingCssClass);updateDimensions(elements.imageContainer,preferred.width,preferred.height);elements.video.resize(preferred.width,preferred.height);floatingContext.pause();if(elements.video.isCompleted()){deleteCloseButton(floatingContext);endFloating(floatingContext);}}
function isArticleVideoFloating(){var element=doc.querySelector(wikiFloatingVideoSelector);return element&&'fixed'===win.getComputedStyle(element).position;}
function showAboveArticleVideo(floatingContext){floatingContext.elements.adContainer.classList.toggle(withArticleVideoCssClass,isArticleVideoFloating());}
function createOnScrollListener(floatingContext){return function(){if(!floatingContext.doNotFloat){if(floatingContext.isOutsideOfViewport()){showAboveArticleVideo(floatingContext);if(floatingContext.isStill()){enableFloating(floatingContext);}}else if(floatingContext.isFloating()){disableFloating(floatingContext);}}};}
function enableFloatingOn(video,params,eventHandlers){var floatingContext=floatingContextFactory.create(video,params,eventHandlers),elements=floatingContext.elements,listeners=floatingContext.listeners;if(!elements.closeButton){elements.closeButton=createCloseButton();listeners.close=createOnCloseListener(floatingContext);elements.closeButton.addEventListener('click',listeners.close);elements.ad.insertBefore(elements.closeButton,elements.ad.firstChild);}
listeners.scroll=throttle(createOnScrollListener(floatingContext),100);win.addEventListener('scroll',listeners.scroll);listeners.adCompleted=function(){disableFloating(floatingContext);elements.video.removeEventListener('wikiaAdCompleted',listeners.adCompleted);};elements.video.addEventListener('wikiaAdCompleted',listeners.adCompleted);if(floatingContext.pauseOnClose){listeners.adResumed=function(){if(floatingContext.isStopped()){floatingContext.pause();}};elements.video.addEventListener('resume',listeners.adResumed);}
return floatingContext;}
function makeFloat(video,params,eventHandlers){var floatingContext=enableFloatingOn(video,params,eventHandlers);floatingContext.invokeLater(function(floatingContext){showAboveArticleVideo(floatingContext);enableFloating(floatingContext);});return floatingContext;}
function canFloat(params){return floaterConfiguration.canFloat(params);}
return{canFloat:canFloat,makeFloat:makeFloat};});;define('ext.wikia.adEngine.video.player.porvata.floaterConfiguration',['wikia.window'],function(win){'use strict';var slotsConfiguration={'INCONTENT_PLAYER':{enableKeyword:'enableInContentFloating',container:'WikiaArticle',configure:function(floatingContext){var elements=floatingContext.elements;elements.viewport=elements.ad.parentElement;floatingContext.forceDoNotFloat();},floatLater:function(callback){var floatingContext=this,video=this.elements.video;video.addEventListener('wikiaSlotExpanded',function(){var container=floatingContext.elements.originalContainer||video.container,body=container.ownerDocument.body;floatingContext.preferred.width=body.scrollWidth;floatingContext.preferred.height=body.scrollHeight;floatingContext.floatAgain();floatingContext.fireEvent('start');if(floatingContext.isOutsideOfViewport()){callback(floatingContext);}});},onAttach:function(floatingContext){var elements=floatingContext.elements;elements.ad.style.maxHeight=elements.ad.scrollHeight+'px';elements.viewport.style.removeProperty('height');elements.providerContainer.style.removeProperty('height');},onBeforeDetach:function(floatingContext){var viewport=floatingContext.elements.viewport;viewport.style.height=viewport.offsetHeight+'px';},onDetach:function(floatingContext){floatingContext.elements.providerContainer.style.height=floatingContext.getHeight()+'px';}},'TOP_LEADERBOARD':{enableKeyword:'enableLeaderboardFloating',container:'WikiaTopAds',configure:function(floatingContext){var elements=floatingContext.elements;elements.viewport=elements.adContainer;floatingContext.forceDoNotFloat();},calculateViewportHeight:function(viewport){return win.getComputedStyle(viewport).height;},floatLater:function(callback){var floatingContext=this,video=this.elements.video;if(this.isOutsideOfViewport()){floatingContext.fireEvent('start');}
video.addEventListener('loaded',function(){floatingContext.floatAgain();if(floatingContext.isOutsideOfViewport()){callback(floatingContext);}});},onAttach:function(floatingContext){var elements=floatingContext.elements;elements.viewport.style.removeProperty('height');elements.iframe.style.removeProperty('height');},onBeforeDetach:function(floatingContext){var viewport=floatingContext.elements.viewport;viewport.style.height=win.getComputedStyle(viewport).height;},onDetach:function(floatingContext){floatingContext.elements.iframe.style.height=floatingContext.getHeight()+'px';}}};function onBeforeDetach(floatingContext,configuration){var viewport=floatingContext.elements.viewport,height=configuration.calculateViewportHeight(viewport);viewport.style.height=height;}
function configure(floatingContext,params){var configuration=selectConfigurationUsing(params);configuration.configure(floatingContext);floatingContext.preferred={};floatingContext.preferred.width=params.width;floatingContext.preferred.height=params.height;floatingContext.eventHandlers.onAttach=configuration.onAttach;floatingContext.eventHandlers.onBeforeDetach=configuration.onBeforeDetach;floatingContext.eventHandlers.onDetach=configuration.onDetach;floatingContext.floatLater=configuration.floatLater;}
function selectConfigurationUsing(params){return slotsConfiguration[params.slotName];}
function canFloat(params){var configuration=selectConfigurationUsing(params);return Boolean(configuration&&params[configuration.enableKeyword]);}
return{canFloat:canFloat,configure:configure,selectConfigurationUsing:selectConfigurationUsing};});;define('ext.wikia.adEngine.video.player.porvata.floatingContextFactory',['ext.wikia.adEngine.video.player.porvata.floaterConfiguration','wikia.document','wikia.window'],function(floaterConfiguration,doc,win){'use strict';var events={attach:'attach',beforeDetach:'beforeDetach',detach:'detach',end:'end',start:'start'},floatingThreshold=55,state={deactivated:'deactivated',floating:'floating',never:'never',paused:'paused',stopped:'stopped'};function create(video,params,eventHandlers){var configuration=floaterConfiguration.selectConfigurationUsing(params),adContainer=doc.getElementById(configuration.container),ad=adContainer.querySelector('.wikia-ad'),container=params.originalContainer||params.container,elements={adContainer:adContainer,ad:ad,originalContainer:params.originalContainer,iframe:container.ownerDocument.defaultView.frameElement,imageContainer:container.parentElement.querySelector('#image'),providerContainer:ad.querySelector('.provider-container'),video:video},floatingContext={beforeFloat:function(){this.fireEvent(events.beforeDetach);},doNotFloat:false,elements:elements,eventHandlers:eventHandlers,fireEvent:function(eventName){var eventHandler='on'+eventName.charAt(0).toUpperCase()+eventName.slice(1);if(this.eventHandlers[eventHandler]){this.eventHandlers[eventHandler](this);}},float:function(){this.state=state.floating;this.fireEvent(events.detach);},floatAgain:function(){this.doNotFloat=false;},forceDoNotFloat:function(){this.doNotFloat=true;},getHeight:function(){return this.getWidth()/this.elements.video.computeVastMediaAspectRatio();},getWidth:function(){return elements.ad.offsetWidth;},isActive:function(){return this.state!==state.stopped;},invokeLater:function(callback){this.floatLater(callback);},isFloating:function(){return this.state===state.floating;},isOutsideOfViewport:function(){var rect=this.elements.viewport.getBoundingClientRect();return rect.top>(win.innerHeight||doc.documentElement.clientHeight)||rect.bottom<floatingThreshold;},isStill:function(){return this.state===state.never||this.state===state.paused;},isStopped:function(){return this.state==state.stopped;},listeners:{},pause:function(){this.state=state.paused;this.fireEvent(events.attach);},pauseOnClose:params.hasUiControls,state:state.never,stop:function(){this.state=state.stopped;this.fireEvent(events.end);}};floaterConfiguration.configure(floatingContext,params);return floatingContext;}
return{create:create};});;define('ext.wikia.adEngine.video.player.porvata.googleIma',['ext.wikia.adEngine.utils.scriptLoader','ext.wikia.adEngine.video.player.porvata.googleImaPlayerFactory','ext.wikia.aRecoveryEngine.sourcePoint.recovery','wikia.log','wikia.window'],function(scriptLoader,imaPlayerFactory,adBlockRecovery,log,win){'use strict';var imaLibraryUrl='//imasdk.googleapis.com/js/sdkloader/ima3.js',logGroup='ext.wikia.adEngine.video.player.porvata.googleIma';function load(){if(win.google&&win.google.ima){return new Promise(function(resolve){log('Google IMA library already loaded',log.levels.info,logGroup);resolve();});}
return scriptLoader.loadScript(adBlockRecovery.getSafeUri(imaLibraryUrl));}
function getPlayer(videoSettings){var params=videoSettings.getParams(),adDisplayContainer=new win.google.ima.AdDisplayContainer(params.container),adsLoader,iframe=params.container.querySelector('div > iframe');if(win.performance&&win.performance.navigation.type===win.performance.navigation.TYPE_BACK_FORWARD){iframe.contentWindow.location.href=iframe.src;}
adsLoader=new win.google.ima.AdsLoader(adDisplayContainer);adsLoader.getSettings().setVpaidMode(videoSettings.getVpaidMode());return imaPlayerFactory.create(adDisplayContainer,adsLoader,videoSettings);}
return{load:load,getPlayer:getPlayer};});;define('ext.wikia.adEngine.video.player.porvata.googleImaPlayerFactory',['ext.wikia.adEngine.video.player.porvata.googleImaSetup','ext.wikia.adEngine.video.player.porvata.moatVideoTracker','wikia.document','wikia.log'],function(imaSetup,moatVideoTracker,doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.porvata.googleImaPlayerFactory';function getVideoElement(){var videoElement=doc.createElement('video');videoElement.setAttribute('preload','none');return videoElement;}
function create(adDisplayContainer,adsLoader,videoSettings){var params=videoSettings.getParams(),isAdsManagerLoaded=false,status='',videoElement=getVideoElement(),adsManager,mobileVideoAd=params.container.querySelector('video'),eventListeners={};function adsManagerLoadedCallback(adsManagerLoadedEvent){adsManager=adsManagerLoadedEvent.getAdsManager(videoElement,imaSetup.getRenderingSettings(params));isAdsManagerLoaded=true;if(videoSettings.isMoatTrackingEnabled()){moatVideoTracker.init(adsManager,params.container,google.ima.ViewMode.NORMAL,params.src,params.slotName);}
log('AdsManager loaded',log.levels.debug,logGroup);}
function addEventListener(eventName,callback){log(['addEventListener to AdManager',eventName],log.levels.debug,logGroup);if(eventName.indexOf('wikia')!==-1){eventListeners[eventName]=eventListeners[eventName]||[];eventListeners[eventName].push(callback);return;}
if(isAdsManagerLoaded){adsManager.addEventListener(eventName,callback);}else{adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(){adsManager.addEventListener(eventName,callback);});}}
function removeEventListener(eventName,callback){log(['removeEventListener to AdManager',eventName],log.levels.debug,logGroup);if(eventListeners[eventName]){var listenerId=eventListeners[eventName].indexOf(callback);if(listenerId!==-1){eventListeners[eventName].splice(listenerId,1);}
return;}
if(isAdsManagerLoaded){adsManager.removeEventListener(eventName,callback);}else{adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,function(){adsManager.removeEventListener(eventName,callback);});}}
function setAutoPlay(value){if(mobileVideoAd){mobileVideoAd.autoplay=value;mobileVideoAd.muted=value;}}
function playVideo(width,height){function callback(){var roundedWidth=Math.round(width),roundedHeight=Math.round(height);log(['Video play: prepare player UI',roundedWidth,roundedHeight],log.levels.debug,logGroup);dispatchEvent('wikiaAdPlayTriggered');adDisplayContainer.initialize();adsManager.init(roundedWidth,roundedHeight,google.ima.ViewMode.NORMAL);adsManager.start();adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,callback);log('Video play: started',log.levels.debug,logGroup);}
if(isAdsManagerLoaded){callback();}else{setAutoPlay(true);adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,callback,false);log(['Video play: waiting for full load of adsManager'],log.levels.debug,logGroup);}}
function reload(){adsManager.destroy();adsLoader.contentComplete();adsLoader.requestAds(imaSetup.createRequest(params));log('IMA player reloaded',log.levels.debug,logGroup);}
function resize(width,height){var roundedWidth=Math.round(width),roundedHeight=Math.round(height);if(adsManager){adsManager.resize(roundedWidth,roundedHeight,google.ima.ViewMode.NORMAL);log(['IMA player resized',roundedWidth,roundedHeight],log.levels.debug,logGroup);}}
function dispatchEvent(eventName){if(eventListeners[eventName]&&eventListeners[eventName].length>0){eventListeners[eventName].forEach(function(callback){callback({});});}}
function setStatus(newStatus){return function(){status=newStatus;};}
function getStatus(){return status;}
function getAdsManager(){return adsManager;}
adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,adsManagerLoadedCallback,false);adsLoader.requestAds(imaSetup.createRequest(params));if(videoSettings.isAutoPlay()){setAutoPlay(true);}
addEventListener(google.ima.AdEvent.Type.RESUMED,setStatus('playing'));addEventListener(google.ima.AdEvent.Type.STARTED,setStatus('playing'));addEventListener(google.ima.AdEvent.Type.PAUSED,setStatus('paused'));addEventListener(google.ima.AdEvent.Type.COMPLETE,setStatus('completed'));return{addEventListener:addEventListener,dispatchEvent:dispatchEvent,getAdsManager:getAdsManager,getStatus:getStatus,playVideo:playVideo,reload:reload,removeEventListener:removeEventListener,resize:resize,setAutoPlay:setAutoPlay};}
return{create:create};});;define('ext.wikia.adEngine.video.player.porvata.googleImaSetup',['ext.wikia.adEngine.video.vastUrlBuilder','ext.wikia.aRecoveryEngine.sourcePoint.recovery','wikia.browserDetect','wikia.log','wikia.window'],function(vastUrlBuilder,adBlockRecovery,browserDetect,log,win){'use strict';var logGroup='ext.wikia.adEngine.video.player.porvata.googleImaSetup';function buildVastUrl(params){var vastUrl=params.vastUrl||vastUrlBuilder.build(params.width/params.height,params.vastTargeting);log(['build vast url',vastUrl,params],log.levels.debug,logGroup);return adBlockRecovery.getSafeUri(vastUrl);}
function getOverriddenVast(){if(win.location.href.indexOf('porvata_override_vast=1')!==-1){return win.localStorage.getItem('porvata_vast');}}
function createRequest(params){var adsRequest=new win.google.ima.AdsRequest(),overriddenVast=getOverriddenVast();if(params.vastResponse||overriddenVast){adsRequest.adsResponse=overriddenVast||params.vastResponse;}
adsRequest.adTagUrl=buildVastUrl(params);adsRequest.linearAdSlotWidth=params.width;adsRequest.linearAdSlotHeight=params.height;adsRequest.nonLinearAdSlotWidth=params.width;adsRequest.nonLinearAdSlotHeight=params.height;log(['ads request created',adsRequest],log.levels.debug,logGroup);return adsRequest;}
function getRenderingSettings(params){var adsRenderingSettings=new win.google.ima.AdsRenderingSettings(),maximumRecommendedBitrate=68000;params=params||{};if(!browserDetect.isMobile()){adsRenderingSettings.bitrate=maximumRecommendedBitrate;}
adsRenderingSettings.loadVideoTimeout=params.loadVideoTimeout||15000;adsRenderingSettings.enablePreloading=true;adsRenderingSettings.uiElements=[];log(['ads rendering settings created',adsRenderingSettings],log.levels.debug,logGroup);return adsRenderingSettings;}
return{createRequest:createRequest,getRenderingSettings:getRenderingSettings};});;define('ext.wikia.adEngine.video.player.porvata.moatVideoTracker',['wikia.log','wikia.window'],function(log,win){'use strict';var logGroup='ext.wikia.adEngine.video.player.porvata.moatVideoTracker',partnerCode='wikiaimajsint377461931603';function init(adsManager,container,viewMode,src,pos){var ids={partnerCode:partnerCode,viewMode:viewMode,slicer1:src,slicer2:pos};try{win.initMoatTracking(adsManager,ids,container,src,pos);log(['MOAT video tracking initialized with params',adsManager,ids,container,src,pos],log.levels.debug,logGroup);}catch(error){log(['MOAT video tracking initalization error',error],log.levels.debug,logGroup);}}
return{init:init};});;function initMoatTracking(a,f,c){if(!1===f.hasOwnProperty("partnerCode"))return!1;var g=document.createElement("script");c=c||a&&("undefined"!==typeof a.O?a.O.parentNode:document.body)||document.body;listeners=[];moatapi={adsManager:a,ids:f,imaSDK:!0,events:[]};eventMapping={complete:"AdVideoComplete",firstquartile:"AdVideoFirstQuartile",impression:"AdImpression",loaded:"AdLoaded",midpoint:"AdVideoMidpoint",pause:"AdPaused",skip:"AdSkipped",start:"AdVideoStart",thirdquartile:"AdVideoThirdQuartile",volumeChange:"AdVolumeChange"};if(google&&google.ima&&a){var d="_moatApi"+Math.floor(1E8*Math.random()),h;for(h in google.ima.AdEvent.Type){var l=function(b){if(moatapi.sendEvent){for(b=listeners.length-1;0<=b;b--)a.removeEventListener(listeners[b].type,listeners[b].func);moatapi.sendEvent(moatapi.events)}else moatapi.events.push({type:eventMapping[b.type]||b.type,adVolume:a.getVolume()})};a.addEventListener(google.ima.AdEvent.Type[h],l);listeners.push({type:google.ima.AdEvent.Type[h],func:l})}}var d="undefined"!==typeof d?d:"",e,k;try{e=c.ownerDocument,k=e.defaultView||e.parentWindow}catch(m){e=document,k=window}k[d]=moatapi;g.type="text/javascript";c&&c.appendChild(g);g.src="https://z.moatads.com/"+f.partnerCode+"/moatvideo.js#"+d};;define('ext.wikia.adEngine.video.player.porvata',['ext.wikia.adEngine.video.player.porvata.googleIma','ext.wikia.adEngine.video.player.porvata.porvataPlayerFactory','ext.wikia.adEngine.video.player.porvata.porvataTracker','wikia.log','wikia.viewportObserver',require.optional('ext.wikia.adEngine.video.player.porvata.floater')],function(googleIma,porvataPlayerFactory,tracker,log,viewportObserver,floater){'use strict';var logGroup='ext.wikia.adEngine.video.player.porvata';function inject(videoSettings){var params=videoSettings.getParams(),isFirstPlay=true,autoPlayed=false,autoPaused=false,viewportListener=null;function isFloatingEnabled(params){return params.floatingContext&&params.floatingContext.isActive();}
function tryEnablingFloating(video,inViewportCallback){if(floater&&floater.canFloat(params)){params.floatingContext=floater.makeFloat(video,params,{onStart:function(){inViewportCallback(true);},onEnd:function(){inViewportCallback(false);}});}}
function muteFirstPlay(video){video.addEventListener('loaded',function(){if(isFirstPlay){video.mute();}});}
log(['injecting porvata player',params],log.levels.debug,logGroup);tracker.track(params,'init');params.vastTargeting=params.vastTargeting||{src:params.src,pos:params.slotName,passback:'porvata'};return googleIma.load().then(function(){log('google ima loaded',log.levels.debug,logGroup);return googleIma.getPlayer(videoSettings);}).then(function(ima){log(['ima player set up',ima],log.levels.debug,logGroup);return porvataPlayerFactory.create(videoSettings,ima);}).then(function(video){log(['porvata video player created',video],log.levels.debug,logGroup);tracker.register(video,params);function shouldResume(isVisible){return isVisible&&autoPaused&&!videoSettings.hasUiControls()&&!isFloatingEnabled(params);}
function shouldPause(isVisible){return!params.blockOutOfViewportPausing&&!isVisible&&video.isPlaying()&&!isFloatingEnabled(params);}
function inViewportCallback(isVisible){if(isVisible&&!autoPlayed&&videoSettings.isAutoPlay()){video.play();autoPlayed=true;}else if(shouldResume(isVisible)){video.resume();}else if(shouldPause(isVisible)){video.pause();autoPaused=true;}}
video.addEventListener('adCanPlay',function(){video.ima.dispatchEvent('wikiaAdStarted');});video.addEventListener('allAdsCompleted',function(){isFirstPlay=false;video.ima.dispatchEvent('wikiaAdCompleted');video.ima.setAutoPlay(false);if(viewportListener){viewportObserver.removeListener(viewportListener);viewportListener=null;}});video.addEventListener('start',function(){video.ima.dispatchEvent('wikiaAdPlay');if(!viewportListener){viewportListener=viewportObserver.addListener(params.container,inViewportCallback);}});video.addEventListener('resume',function(){video.ima.dispatchEvent('wikiaAdPlay');autoPaused=false;});video.addEventListener('pause',function(){video.ima.dispatchEvent('wikiaAdPause');});video.addOnDestroyCallback(function(){if(viewportListener){viewportObserver.removeListener(viewportListener);viewportListener=null;}});if(videoSettings.isAutoPlay()){muteFirstPlay(video);}
viewportListener=viewportObserver.addListener(params.container,inViewportCallback);tryEnablingFloating(video,inViewportCallback);return video;});}
return{inject:inject};});;define('ext.wikia.adEngine.video.player.porvata.porvataPlayerFactory',['ext.wikia.adEngine.domElementTweaker','wikia.log'],function(DOMElementTweaker,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.porvata.porvataPlayerFactory',autoPlayClassName='autoplay',defaultAspectRatio=320/240,videoPlayerClassName='video-player';function prepareVideoAdContainer(videoAdContainer,videoSettings){DOMElementTweaker.hide(videoAdContainer);videoAdContainer.classList.add(videoPlayerClassName);if(videoSettings.isAutoPlay()){videoAdContainer.classList.add(autoPlayClassName);}
return videoAdContainer;}
function create(videoSettings,ima){var params=videoSettings.getParams(),width=params.width,height=params.height,mobileVideoAd=params.container.querySelector('video'),videoAdContainer=params.container.querySelector('div'),destroyCallbacks=[];log(['create porvata player'],log.levels.debug,logGroup);return{container:prepareVideoAdContainer(videoAdContainer,videoSettings),ima:ima,addEventListener:function(eventName,callback){ima.addEventListener(eventName,callback);},computeVastMediaAspectRatio:function(){var adsManager=ima.getAdsManager(),aspectRatio=width/height,currentAd,vastHeight=0,vastWidth=0;if(adsManager){currentAd=adsManager.getCurrentAd();vastHeight=currentAd.getVastMediaHeight();vastWidth=currentAd.getVastMediaWidth();aspectRatio=(vastWidth&&vastHeight)?vastWidth/vastHeight:defaultAspectRatio;}
return aspectRatio;},getRemainingTime:function(){return ima.getAdsManager().getRemainingTime();},getVolume:function(){return ima.getAdsManager().getVolume();},isFloating:function(){return Boolean(params.floatingContext&&params.floatingContext.isFloating());},isMuted:function(){return ima.getAdsManager().getVolume()===0;},isMobilePlayerMuted:function(){var mobileVideoAd=this.container.querySelector('video');return mobileVideoAd&&mobileVideoAd.autoplay&&mobileVideoAd.muted;},isPaused:function(){return ima.getStatus()==='paused';},isPlaying:function(){return ima.getStatus()==='playing';},isCompleted:function(){return ima.getStatus()==='completed';},pause:function(){ima.getAdsManager().pause();},play:function(newWidth,newHeight){if(newWidth!==undefined&&newHeight!==undefined){width=newWidth;height=newHeight;}
if(!width||!height){width=params.container.offsetWidth;height=params.container.offsetHeight;}
ima.playVideo(width,height);},reload:function(){ima.reload();},removeEventListener:function(eventName,callback){ima.removeEventListener(eventName,callback);},resize:function(newWidth,newHeight){width=newWidth;height=newHeight;ima.resize(width,height);},resume:function(){ima.getAdsManager().resume();},mute:function(){return this.setVolume(0);},unmute:function(){return this.setVolume(0.75);},volumeToggle:function(){if(this.isMuted()){this.unmute();}else{this.mute();}},setVolume:function(volume){this.updateVideoDOMElement(volume);ima.getAdsManager().setVolume(volume);ima.dispatchEvent('wikiaVolumeChange');},stop:function(){ima.dispatchEvent('wikiaAdStop');ima.getAdsManager().stop();},updateVideoDOMElement:function(volume){if(mobileVideoAd){mobileVideoAd.muted=volume===0;}},addOnDestroyCallback:function(callback){destroyCallbacks.push(callback);},destroy:function(){var callback=destroyCallbacks.pop();while(callback){callback(this);callback=destroyCallbacks.pop();}}};}
return{create:create};});;define('ext.wikia.adEngine.video.player.porvata.porvataTracker',['ext.wikia.adEngine.video.player.playerTracker','ext.wikia.adEngine.video.player.porvata.vastLogger'],function(playerTracker,logger){'use strict';var playerName='porvata',trackingEventsMap={'adCanPlay':'ad_can_play','complete':'completed','click':'clicked','firstquartile':'first_quartile','impression':'impression','loaded':'loaded','midpoint':'midpoint','pause':'paused','resume':'resumed','start':'started','thirdquartile':'third_quartile','viewable_impression':'viewable_impression','adError':'error','wikiaAdPlayTriggered':'play_triggered','wikiaAdStop':'closed'};function getContentType(player){var ad;if(player){ad=player.ima.getAdsManager().getCurrentAd();if(ad){return ad.getContentType();}}}
function track(params,eventName,errorCode,player){var contentType=getContentType(player),data=playerTracker.track(params,playerName,eventName,errorCode,contentType);if(data&&params.adProduct==='rubicon'){logger.logVast(player,params,data);}}
function register(player,params){if(!playerTracker.isEnabled()){return;}
track(params,'ready');Object.keys(trackingEventsMap).forEach(function(playerEvent){player.addEventListener(playerEvent,function(event){var errorCode=event.getError&&event.getError().getErrorCode();track(params,trackingEventsMap[playerEvent],errorCode,player);});});}
return{register:register,track:track};});;define('ext.wikia.adEngine.video.player.porvata.vastLogger',['wikia.instantGlobals','wikia.log','wikia.window'],function(instantGlobals,log,win){'use strict';var config=instantGlobals.wgPorvataVastLoggerConfig||[],trackEndpoint='/wikia.php?controller=AdEngine2Api&method=postPorvataInfo',logGroup='ext.wikia.adEngine.video.player.porvata.vastLogger';function createConfigKey(advertiserId,eventName){return[advertiserId,eventName].join('_');}
function prepareData(data,playerParams){return['advertiser_id='+playerParams.bid.rubiconAdvertiserId||'','event_name='+data['event_name']||'','ad_error_code='+data['ad_error_code']||'','position='+data['position']||'','browser='+data['browser']||'','vast_url='+encodeURIComponent(playerParams.vastUrl||'')];}
function addCurrentAdDetails(player,postData){var ad=player&&player.ima.getAdsManager()&&player.ima.getAdsManager().getCurrentAd();if(ad){postData.push('ad_system='+ad.getAdSystem()||'');postData.push('advertiser='+ad.getAdvertiserName()||'');postData.push('content_type='+ad.getContentType()||'');postData.push('media_url='+encodeURIComponent(ad.getMediaUrl())||'');}}
function sendRequest(data){var request=new win.XMLHttpRequest();request.open('POST',trackEndpoint,true);request.setRequestHeader('Content-type','application/x-www-form-urlencoded');request.send(data);}
function logVast(player,params,data){if(!params.bid){return;}
var configKey=createConfigKey(params.bid.rubiconAdvertiserId,data['event_name']),postData;if(config.indexOf(configKey)===-1){return;}
postData=prepareData(data,params);addCurrentAdDetails(player,postData);log(['Track',postData],log.levels.debug,logGroup);sendRequest(postData.join('&'));}
return{logVast:logVast};});;define('ext.wikia.adEngine.video.player.ui.closeButton',['wikia.document','wikia.log'],function(doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.closeButton';function add(video){var closeButton=doc.createElement('div');closeButton.classList.add('close-ad');closeButton.addEventListener('click',function(event){video.stop();event.preventDefault();log(['stop',log.levels.debug,logGroup]);});video.container.appendChild(closeButton);}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.pauseOverlay',['wikia.document','wikia.log'],function(doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.pauseOverlay';function add(video){var overlay=doc.createElement('div');overlay.classList.add('pause-overlay');overlay.addEventListener('click',function(){if(video.isPaused()){video.resume();log(['resume',log.levels.debug,logGroup]);}else{video.pause();log(['pause',log.levels.debug,logGroup]);}});video.container.appendChild(overlay);}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.playPauseButton',['wikia.document','wikia.log'],function(doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.playPauseButton',animateCssClass='animate',playSvg='<svg width="12" height="16" viewBox="0 0 12 16" xmlns="http://www.w3.org/2000/svg"><path d="M11.767 8.437L.857 15.903a.553.553 0 0 1-.564.037.53.53 0 0 1-.293-.473V.533c0-.2.113-.38.293-.473a.557.557 0 0 1 .565.036l10.91 7.467A.53.53 0 0 1 12 8a.53.53 0 0 1-.233.437z"/></svg>',pauseSvg='<svg width="14" height="16" viewBox="0 0 14 16" xmlns="http://www.w3.org/2000/svg"><g><rect width="5" height="16" rx="1"/><rect x="9" width="5" height="16" rx="1"/></g></svg>',pauseCssClass='paused';function pause(elements){elements.button.classList.add(pauseCssClass);elements.button.innerHTML=playSvg;elements.pauseShadow.classList.add(animateCssClass);log(['pause',log.levels.debug,logGroup]);}
function resume(elements){elements.button.classList.remove(pauseCssClass);elements.button.innerHTML=pauseSvg;elements.pauseShadow.classList.remove(animateCssClass);log(['resume',log.levels.debug,logGroup]);}
function add(video,params){var button=doc.createElement('a'),pauseShadow=doc.createElement('div'),elements={button:button,pauseShadow:pauseShadow,video:video};button.classList.add('play-pause-button','control-bar-item');pauseShadow.classList.add('pause-shadow');button.innerHTML=pauseSvg;pauseShadow.innerHTML=pauseSvg;button.addEventListener('click',function(){if(video.isPaused()){video.resume();}else{video.pause();}});video.addEventListener('pause',function(){pause(elements);});video.addEventListener('resume',function(){resume(elements);});params.controlBarItems.appendChild(button);video.container.appendChild(pauseShadow);}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.progressBar',['ext.wikia.adEngine.domElementTweaker','wikia.document','wikia.log'],function(DOMElementTweaker,doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.progressBar';function add(video,params){var progressBar=doc.createElement('div'),currentTime=doc.createElement('div');progressBar.classList.add('progress-bar');currentTime.classList.add('current-time');progressBar.currentTime=currentTime;progressBar.appendChild(currentTime);progressBar.pause=function(){var currentStatus=(currentTime.offsetWidth/progressBar.offsetWidth*100)+'%';currentTime.style.width=currentStatus;log(['pause',currentStatus],log.levels.debug,logGroup);};progressBar.reset=function(){currentTime.style.transitionDuration='';currentTime.style.width='0';log(['update, reset'],log.levels.debug,logGroup);};progressBar.start=function(){var remainingTime=video.getRemainingTime();if(remainingTime){currentTime.style.transitionDuration=remainingTime+'s';DOMElementTweaker.forceRepaint(currentTime);currentTime.style.width='100%';}else{currentTime.style.width='0';}
log(['update, remaining time:',remainingTime],log.levels.debug,logGroup);};video.addEventListener('wikiaAdPlay',progressBar.start);video.addEventListener('wikiaAdCompleted',progressBar.reset);video.addEventListener('wikiaAdPause',progressBar.pause);if(params.controlBar){params.controlBar.insertBefore(progressBar,params.controlBar.firstChild);}else{video.container.appendChild(progressBar);}}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.replayOverlay',['wikia.document','wikia.log'],function(doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.replayOverlay',replayOverlayClass='replay-overlay';function add(video,params){var overlay=doc.createElement('div'),overlayPercentWidth=0;if(video.container.classList.contains('video-player-right')){overlay.style.right=0;}
overlay.classList.add(replayOverlayClass);overlay.addEventListener('click',function(){video.play();log(['replay',log.levels.debug,logGroup]);overlay.style.width='';});if(!params.autoPlay){overlayPercentWidth=computeOverlayWidth(params,overlayPercentWidth);showOverlay(overlay,overlayPercentWidth);}
video.addEventListener('wikiaAdCompleted',function(){overlayPercentWidth=computeOverlayWidth(params,overlayPercentWidth);showOverlay(overlay,overlayPercentWidth);});video.container.parentElement.insertBefore(overlay,video.container);}
function computeOverlayWidth(params,overlayPercentWidth){var width=overlayPercentWidth;if(!width){width=getOverlayWidth(params);}
return width;}
function showOverlay(overlay,overlayPercentWidth){overlay.style.width=overlayPercentWidth;}
function getOverlayWidth(params){var adWidth=params.container.offsetWidth,videoWidth=params.hideWhenPlaying.offsetWidth;return 100*videoWidth/adWidth+'%';}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.soundControl',['wikia.document','wikia.log'],function(doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.soundControl',volumeOn='<svg width="18" height="14" viewBox="0 0 18 14" xmlns="http://www.w3.org/2000/svg"><g><path d="M8.45.17L4.664 4.28H1.036C.256 4.28 0 4.74 0 5.175v3.522c0 .436.256.985 1.036.985h3.646l3.785 4.176c.165.092.35.143.533.143a.964.964 0 0 0 .5-.136c.33-.185.5-.526.5-.897V1.013c0-.37-.17-.713-.5-.898-.33-.186-.72-.13-1.05.054zm4.95 10.156a4.393 4.393 0 0 0 0-6.19.708.708 0 0 0-1.004 1 2.978 2.978 0 0 1 0 4.192.707.707 0 1 0 1.003.998z"/><path d="M17.515 7.23A6.186 6.186 0 0 0 15.7 2.84a.707.707 0 1 0-1.003.998A4.777 4.777 0 0 1 16.1 7.23a4.778 4.778 0 0 1-1.4 3.395.708.708 0 1 0 1.002 1 6.186 6.186 0 0 0 1.814-4.394z"/></g></svg>',volumeOff='<svg width="22" height="14" viewBox="0 0 22 14" xmlns="http://www.w3.org/2000/svg"><path d="M8.45.17L4.664 4.28H1.036C.256 4.28 0 4.74 0 5.175v3.522c0 .436.256.985 1.036.985h3.646l3.785 4.176c.165.092.35.143.533.143a.964.964 0 0 0 .5-.136c.33-.185.5-.526.5-.897V1.013c0-.37-.17-.713-.5-.898-.33-.186-.72-.13-1.05.054zM18.413 7l3.294-3.294a1 1 0 0 0-1.412-1.413L17 5.588l-3.294-3.295a.998.998 0 1 0-1.413 1.413L15.588 7l-3.295 3.295a.998.998 0 1 0 1.413 1.412L17 8.413l3.295 3.294a.996.996 0 0 0 1.412 0 1 1 0 0 0 0-1.412L18.413 7z"/></svg>',numberOfBars=10;function lit(soundBars,index){log('lit '+index+' sound bars',log.levels.info,logGroup);soundBars.forEach(function(soundBar,i){soundBar.classList.toggle('unlit',i>index);});}
function volumeToSoundBarIndex(video){return video.getVolume()*10-1;}
function soundBarIndexToVolume(index){return(index+1)/10;}
function createOutsideSoundBarHandler(video,soundBars){return function(){lit(soundBars,volumeToSoundBarIndex(video));}}
function createOverSoundBarHandler(soundBars,index){return function(){lit(soundBars,index);}}
function createClickSoundBarHandler(video,index){return function(){video.setVolume(soundBarIndexToVolume(index));}}
function createSoundControlsFor(video){var i=0,soundBars=[],soundBarsContainer=doc.createElement('div'),soundControl=doc.createElement('div'),speaker=doc.createElement('a');soundControl.classList.add('sound-control');speaker.classList.add('speaker','control-bar-item');soundBarsContainer.classList.add('sound-bars-container');soundControl.appendChild(speaker);soundControl.appendChild(soundBarsContainer);for(i=0;i<numberOfBars;i++){soundBars[i]=doc.createElement('a');soundBars[i].classList.add('sound-bar');soundBarsContainer.appendChild(soundBars[i]);}
return{speaker:speaker,soundBars:soundBars,soundControl:soundControl,video:video};}
function refresh(controls){var video=controls.video,soundControl=controls.soundControl,speaker=controls.speaker;if(video.isMuted()||video.isMobilePlayerMuted()){soundControl.classList.add('mute');speaker.innerHTML=volumeOff;}else{soundControl.classList.remove('mute');speaker.innerHTML=volumeOn;}
lit(controls.soundBars,volumeToSoundBarIndex(video));log('change volume',log.levels.info,logGroup);}
function attachEventListenersFor(controls){var video=controls.video;video.addEventListener('wikiaVolumeChange',function(){refresh(controls);});video.addEventListener('wikiaAdStarted',function(){refresh(controls);});controls.speaker.addEventListener('click',function(event){video.volumeToggle();event.preventDefault();});controls.soundBars.forEach(function(soundBar,index,soundBars){soundBar.addEventListener('click',createClickSoundBarHandler(video,index));soundBar.addEventListener('mouseover',createOverSoundBarHandler(soundBars,index));soundBar.addEventListener('mouseout',createOutsideSoundBarHandler(video,soundBars));});}
function add(video,params){var controls=createSoundControlsFor(video);attachEventListenersFor(controls);params.controlBarItems.appendChild(controls.soundControl);}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.toggleAnimation',['ext.wikia.adEngine.domElementTweaker'],function(DOMElementTweaker){'use strict';var animationDuration=400;function getAdHeight(params){return params.container.clientWidth/params.aspectRatio;}
function getVideoHeight(params){return params.container.clientWidth/params.videoAspectRatio;}
function updateHeight(element,value){value=value?value+'px':'';element.style.height=value;}
function toggle(elementToShow,elementToHide){DOMElementTweaker.hide(elementToHide);DOMElementTweaker.show(elementToShow);}
function clearHeight(element){setTimeout(function(){element.style.height='';},animationDuration);}
function hideVideo(video,params){updateHeight(params.container,getVideoHeight(params));updateHeight(params.container,getAdHeight(params));setTimeout(function(){toggle(params.image,video.container);},animationDuration);clearHeight(params.container);}
function showVideo(video,params){updateHeight(params.container,getAdHeight(params));updateHeight(params.container,getVideoHeight(params));toggle(video.container,params.image);clearHeight(params.container);}
function add(video,params){video.addEventListener('wikiaAdStarted',function(){showVideo(video,params);});video.addEventListener('wikiaAdCompleted',function(){hideVideo(video,params);});}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.toggleVideo',['ext.wikia.adEngine.domElementTweaker'],function(DOMElementTweaker){'use strict';function toggle(elementToShow,elementToHide){DOMElementTweaker.hide(elementToHide);DOMElementTweaker.show(elementToShow);}
function hideVideo(video,params){toggle(params.hideWhenPlaying||params.image,video.container);}
function showVideo(video,params){toggle(video.container,params.hideWhenPlaying||params.image);}
function add(video,params){video.addEventListener('wikiaAdStarted',function(){showVideo(video,params);});video.addEventListener('wikiaAdCompleted',function(){hideVideo(video,params);});}
return{add:add};});;define('ext.wikia.adEngine.video.player.ui.videoInterface',['wikia.log'],function(log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.videoInterface';function setup(video,uiElements,params){uiElements.forEach(function(element){var module='ext.wikia.adEngine.video.player.ui.'+element;require([module],function(uiElement){uiElement.add(video,params);log(['setup',element,video],'debug',logGroup);});});}
return{setup:setup};});;define('ext.wikia.adEngine.video.player.ui.volumeControl',['wikia.document','wikia.log'],function(doc,log){'use strict';var logGroup='ext.wikia.adEngine.video.player.ui.volumeControl';function createVolumeControl(){var volume=doc.createElement('div'),speaker=doc.createElement('a');speaker.className='speaker';speaker.appendChild(doc.createElement('span'));volume.className='ima-mute-div hidden';volume.appendChild(speaker);volume.speaker=speaker;log('volume control is added',log.levels.info,logGroup);volume.mute=function(){volume.speaker.classList.add('mute');log('mute',log.levels.info,logGroup);};volume.unmute=function(){volume.speaker.classList.remove('mute');log('unmute',log.levels.info,logGroup);};return volume;}
function updateCurrentState(video,volumeControl){if(video.isMuted()||video.isMobilePlayerMuted()){volumeControl.mute();}else{volumeControl.unmute();}}
function add(video){var volumeControl=createVolumeControl();video.addEventListener('wikiaVolumeChange',function(){updateCurrentState(video,volumeControl);});video.addEventListener('wikiaAdStarted',function(){updateCurrentState(video,volumeControl);volumeControl.classList.remove('hidden');});volumeControl.addEventListener('click',function(e){video.volumeToggle();e.preventDefault();});video.container.appendChild(volumeControl);}
return{add:add};});;define('ext.wikia.adEngine.video.player.uiTemplate',['wikia.log'],function(log){'use strict';var autoPlayLayout=['progressBar','pauseOverlay','volumeControl','toggleAnimation'],defaultLayout=['progressBar','pauseOverlay','volumeControl','closeButton','toggleAnimation'],splitLayout=['progressBar','pauseOverlay','volumeControl','toggleVideo','replayOverlay'],clickToPlaySplitLayout=['progressBar','pauseOverlay','volumeControl','toggleVideo','replayOverlay','closeButton'],featureVideo=['progressBar','playPauseButton','soundControl'],logGroup='ext.wikia.adEngine.video.player.uiTemplate';function selectTemplate(videoSettings){var template=defaultLayout;if(!videoSettings.isAutoPlay()&&videoSettings.isSplitLayout()){template=clickToPlaySplitLayout;}else if(videoSettings.isSplitLayout()){template=splitLayout;}else if(videoSettings.isAutoPlay()){template=autoPlayLayout;}
log(['VUAP UI elements',template],log.levels.debug,logGroup);return template;}
return{autoPlayLayout:autoPlayLayout,defaultLayout:defaultLayout,splitLayout:splitLayout,featureVideo:featureVideo,selectTemplate:selectTemplate};});;define('ext.wikia.adEngine.video.uapVideo',['ext.wikia.adEngine.context.uapContext','ext.wikia.adEngine.slot.adSlot','ext.wikia.adEngine.video.player.porvata','ext.wikia.adEngine.video.player.playwire','ext.wikia.adEngine.video.player.ui.videoInterface','ext.wikia.adEngine.video.player.uiTemplate','ext.wikia.adEngine.video.videoSettings','wikia.document','wikia.log','wikia.throttle','wikia.window',require.optional('ext.wikia.adEngine.mobile.mercuryListener')],function(uapContext,adSlot,porvata,playwire,videoInterface,UITemplate,VideoSettings,doc,log,throttle,win,mercuryListener){'use strict';var logGroup='ext.wikia.adEngine.video.uapVideo',positionVideoPlayerClassName='video-player-';function getVideoSize(slot,params,videoSettings){var width=slot.clientWidth;if(videoSettings.isSplitLayout()&&params.videoPlaceholderElement){width=params.videoPlaceholderElement.offsetWidth;}
return{width:width,height:width/params.videoAspectRatio};}
function loadPorvata(params,slotContainer,providerContainer,videoSettings){params.container=slotContainer;log(['VUAP loadPorvata',params],log.levels.debug,logGroup);return porvata.inject(videoSettings).then(function(video){video.container.style.position='relative';if(mercuryListener){mercuryListener.onPageChange(function(){video.destroy();});}
return video;}).then(function(video){var splitLayoutVideoPosition=params.splitLayoutVideoPosition,template=UITemplate.selectTemplate(videoSettings);videoInterface.setup(video,template,{aspectRatio:params.aspectRatio,autoPlay:videoSettings.isAutoPlay(),container:slotContainer,hideWhenPlaying:params.videoPlaceholderElement||params.image,image:providerContainer,videoAspectRatio:params.videoAspectRatio});if(splitLayoutVideoPosition){video.container.style.position='absolute';video.container.classList.add(positionVideoPlayerClassName+splitLayoutVideoPosition);}
video.addEventListener('allAdsCompleted',function(){video.reload();});return video;});}
function loadPlaywire(params,adSlot,providerContainer,videoSettings){var container=doc.createElement('div');container.classList.add('video-player','hidden');adSlot.appendChild(container);params.container=container;log(['VUAP loadPlaywire',params],log.levels.debug,logGroup);return playwire.inject(params).then(function(video){videoInterface.setup(video,['closeButton','toggleAnimation'],{image:providerContainer,container:adSlot,aspectRatio:params.aspectRatio,videoAspectRatio:params.videoAspectRatio});video.addEventListener('wikiaAdStarted',function(){var size=getVideoSize(adSlot,params,videoSettings);video.resize(size.width,size.height);});if(params.autoPlay){var size=getVideoSize(adSlot,params,videoSettings);video.play(size.width,size.height);}
return video;});}
function loadVideoAd(videoSettings){var params=videoSettings.getParams(),loadedPlayer,providerContainer=adSlot.getProviderContainer(params.slotName),videoContainer=providerContainer.parentNode,size;log(['loadVideoAd params',params],log.levels.debug,logGroup);size=getVideoSize(videoContainer,params,videoSettings);params.width=size.width;params.height=size.height;params.adProduct='vuap';params.vastTargeting={src:params.src,pos:params.slotName,passback:'vuap',uap:uapContext.getUapId()};log(['loadVideoAd upadated params',params],log.levels.debug,logGroup);if(params.player==='playwire'){loadedPlayer=loadPlaywire(params,videoContainer,providerContainer,videoSettings);}else{loadedPlayer=loadPorvata(params,videoContainer,providerContainer,videoSettings);}
return loadedPlayer.then(function(video){function playVideo(){var videoSize=getVideoSize(videoContainer,params,videoSettings);video.play(videoSize.width,videoSize.height);}
win.addEventListener('resize',throttle(function(){var videoSize=getVideoSize(videoContainer,params,videoSettings);video.resize(videoSize.width,videoSize.height);}));if(params.videoTriggerElement){params.videoTriggerElement.addEventListener('click',playVideo);}else if(params.videoTriggers){params.videoTriggers.forEach(function(trigger){trigger.addEventListener('click',playVideo);});}
return video;});}
function isEnabled(params){return!!params.videoAspectRatio&&(params.videoTriggerElement||params.videoTriggers);}
return{isEnabled:isEnabled,loadVideoAd:loadVideoAd};});;define('ext.wikia.adEngine.video.videoSettings',['ext.wikia.adEngine.slot.resolvedState','ext.wikia.adEngine.utils.sampler','wikia.geo','wikia.window'],function(resolvedState,sampler,geo,win){'use strict';var moatTrackingCountries=['AU','CA','DE','UK','US'];function create(params){var state={autoPlay:false,moatTracking:false,resolvedState:false,splitLayout:false,withUiControls:false};function calculateAutoPlayFlag(params){var defaultStateAutoPlay=params.autoPlay&&!state.resolvedState,resolvedStateAutoPlay=params.resolvedStateAutoPlay&&state.resolvedState;return Boolean(defaultStateAutoPlay||resolvedStateAutoPlay);}
function calculateMoatTrackingFlag(params){var sampling=params.moatTracking||0;if(typeof params.moatTracking==='boolean'){return params.moatTracking;}
if((params.bid&&params.bid.moatTracking===100)||sampling===100){return true;}
if(sampling>0){return sampler.sample('moatVideoTracking',sampling,100)&&geo.isProperGeo(moatTrackingCountries);}
return false;}
function init(){state.resolvedState=resolvedState.isResolvedState();state.autoPlay=calculateAutoPlayFlag(params);state.splitLayout=Boolean(params.splitLayoutVideoPosition);state.moatTracking=calculateMoatTrackingFlag(params);state.withUiControls=Boolean(params.hasUiControls);}
init();return{getParams:function(){return params;},getVpaidMode:function(){return params.vpaidMode!==undefined?params.vpaidMode:win.google.ima.ImaSdkSettings.VpaidMode.ENABLED;},hasUiControls:function(){return state.withUiControls;},isAutoPlay:function(){return state.autoPlay;},isResolvedState:function(){return state.resolvedState;},isSplitLayout:function(){return state.splitLayout;},isMoatTrackingEnabled:function(){return state.moatTracking;}};}
return{create:create};});;define('ext.wikia.aRecoveryEngine.adBlockDetection',['ext.wikia.adEngine.adContext','ext.wikia.aRecoveryEngine.sourcePoint.recovery','wikia.document','wikia.instantGlobals','wikia.lazyqueue','wikia.log'],function(adContext,sourcePoint,doc,instantGlobals,lazyQueue,log){'use strict';var cb=function(callback){callback();},logGroup='ext.wikia.aRecoveryEngine.adBlockDetection',onBlockingEventsQueue=lazyQueue.makeQueue([],cb),onNotBlockingEventsQueue=lazyQueue.makeQueue([],cb);function initEventQueues(){doc.addEventListener('sp.not_blocking',onNotBlockingEventsQueue.start);doc.addEventListener('sp.blocking',onBlockingEventsQueue.start);}
function addOnBlockingCallback(callback){onBlockingEventsQueue.push(callback);}
function addOnNotBlockingCallback(callback){onNotBlockingEventsQueue.push(callback);}
function isBlocking(){return isEnabled()&&sourcePoint.isBlocking();}
function isEnabled(){var context=adContext.getContext();log(['isEnabled',context.opts.sourcePointDetection],log.levels.debug,logGroup);return context.opts.sourcePointDetection;}
return{addOnBlockingCallback:addOnBlockingCallback,addOnNotBlockingCallback:addOnNotBlockingCallback,initEventQueues:initEventQueues,isBlocking:isBlocking,isEnabled:isEnabled};});;define('ext.wikia.aRecoveryEngine.adBlockRecovery',['ext.wikia.adEngine.adContext','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.document','wikia.instantGlobals','wikia.log','wikia.window'],function(adContext,adBlockDetection,doc,instantGlobals,log,win){'use strict';var customLogEndpoint='/wikia.php?controller=ARecoveryEngineApi&method=getLogInfo&kind=',logGroup='ext.wikia.aRecoveryEngine.adBlockRecovery';function getName(){return'adBlockRecovery';}
function addResponseListener(callback){adBlockDetection.addOnBlockingCallback(callback);adBlockDetection.addOnNotBlockingCallback(callback);}
function isEnabled(){var context=adContext.getContext(),enabled=context.opts.sourcePointRecovery||context.opts.pageFairRecovery;log(['isEnabled',enabled],log.levels.debug,logGroup);return enabled;}
function track(type){if(win._sp_&&!win._sp_.trackingSent){if(Wikia&&Wikia.Tracker){Wikia.Tracker.track({eventName:'ads.recovery',category:'ads-recovery-blocked',action:Wikia.Tracker.ACTIONS.IMPRESSION,label:type,trackingMethod:'analytics'});}
if(instantGlobals.wgARecoveryEngineCustomLog){sendCustomLog(type);}
win._sp_.trackingSent=true;}}
function sendCustomLog(type){var xmlHttp=new XMLHttpRequest();try{xmlHttp.open('GET',customLogEndpoint+type,true);xmlHttp.send();}catch(e){log(['track',e],log.levels.error,logGroup);}}
function verifyContent(){var wikiaArticle=doc.getElementById('WikiaArticle'),display=wikiaArticle.currentStyle?wikiaArticle.currentStyle.display:getComputedStyle(wikiaArticle,null).display;if(display==='none'){track('css-display-none');}}
return{addResponseListener:addResponseListener,isEnabled:isEnabled,getName:getName,track:track,verifyContent:verifyContent,wasCalled:isEnabled};});;define('ext.wikia.aRecoveryEngine.sourcePoint.recovery',['ext.wikia.adEngine.adContext','wikia.log','wikia.window'],function(adContext,log,win){'use strict';var logGroup='ext.wikia.aRecoveryEngine.sourcePoint.recovery',context=adContext.getContext(),recoverableSlots=['TOP_LEADERBOARD','TOP_RIGHT_BOXAD','LEFT_SKYSCRAPER_2','LEFT_SKYSCRAPER_3','INCONTENT_BOXAD_1','BOTTOM_LEADERBOARD','GPT_FLUSH'];function isEnabled(){var enabled=!!context.opts.sourcePointRecovery&&!context.opts.pageFairRecovery;log(['isEnabled',enabled],log.levels.debug,logGroup);return enabled;}
function isBlocking(){var isBlocking=!!(win.ads&&win.ads.runtime.sp&&win.ads.runtime.sp.blocking);log(['isBlocking',isBlocking],log.levels.debug,logGroup);return isBlocking;}
function isSlotRecoverable(slotName){var result=isEnabled()&&recoverableSlots.indexOf(slotName)!==-1;log(['isSlotRecoverable',result],log.levels.info,logGroup);return result;}
function getSafeUri(url){if(isBlocking()){url=win._sp_.getSafeUri(url);}
return url;}
return{getSafeUri:getSafeUri,isBlocking:isBlocking,isSlotRecoverable:isSlotRecoverable,isEnabled:isEnabled};});;define('ext.wikia.aRecoveryEngine.sourcePoint.slotFinder',['ext.wikia.adEngine.slot.adUnitBuilder','wikia.document','wikia.window'],function(adUnitBuilder,doc,win){'use strict';function getRecoveredSlot(slotName){var recoveredId=win._sp_.getElementId(getAdUnit(slotName));if(!recoveredId){return null;}
return doc.getElementById(recoveredId);}
function getAdUnit(slotName){return'wikia_gpt'+adUnitBuilder.build(slotName,'gpt');}
return{getRecoveredSlot:getRecoveredSlot};});;define('ext.wikia.aRecoveryEngine.tweaker',['ext.wikia.adEngine.domElementTweaker','ext.wikia.adEngine.slotTweaker','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.browserDetect','wikia.document','wikia.log'],function(DOMElementTweaker,slotTweaker,adBlockDetection,browser,doc,log){'use strict';var logGroup='ext.wikia.aRecoveryEngine.tweaker';function isNotSupportedBrowser(){return browser.isIE()||browser.isEdge();}
function mirrorDOMStructure(parentNode){var div=doc.createElement('div'),originalIframe=doc.createElement('iframe');div.appendChild(originalIframe);parentNode.appendChild(div);originalIframe.style.display='none';div.style.display='none';return originalIframe;}
function tweakSlot(slotName,iframe){var adContainer=iframe.parentNode.parentNode.parentNode.parentNode,originalIframe=mirrorDOMStructure(doc.querySelector('#'+slotName+' > div > div'));if(isNotSupportedBrowser()){DOMElementTweaker.hide(adContainer,true);log(['tweakSlot','not supported browser'],'info',logGroup);return;}
slotTweaker.tweakRecoveredSlot(originalIframe,iframe);log(['tweakSlot',slotName],'info',logGroup);}
function isTweakable(){return adBlockDetection.isBlocking();}
return{isTweakable:isTweakable,tweakSlot:tweakSlot};});;define('ext.wikia.aRecoveryEngine.pageFair.recovery',['ext.wikia.adEngine.adContext','wikia.log','wikia.window'],function(adContext,log,win){'use strict';var logGroup='ext.wikia.aRecoveryEngine.pageFair.recovery',context=adContext.getContext(),recoverableSlots=['TOP_LEADERBOARD','TOP_RIGHT_BOXAD'];function isEnabled(){var enabled=!!context.opts.pageFairRecovery;log(['isEnabled',enabled,log.levels.debug,logGroup]);return enabled;}
function isSlotRecoverable(slotName){var result=isEnabled()&&recoverableSlots.indexOf(slotName)!==-1;log(['isSlotRecoverable',result],log.levels.info,logGroup);return result;}
function isBlocking(){var isBlocking=!!(win.ads&&win.ads.runtime.pf&&win.ads.runtime.pf.blocking);log(['isBlocking',isBlocking],log.levels.debug,logGroup);return isBlocking;}
function addMarker(slotElement){slotElement.setAttribute('adonis-marker','');}
return{isBlocking:isBlocking,isEnabled:isEnabled,isSlotRecoverable:isSlotRecoverable,addMarker:addMarker};});;define('wikia.domCalculator',['wikia.document','wikia.window'],function(doc,win){'use strict';function getTopOffset(element){var topPos=0,elementWindow=element.ownerDocument.defaultView;do{topPos+=element.offsetTop;element=element.offsetParent;}while(element!==null);if(elementWindow&&elementWindow.frameElement){topPos+=getTopOffset(elementWindow.frameElement);}
return topPos;}
function isInViewport(element){var globalNavHeight=55,elementHeight=element.offsetHeight,topElement=getTopOffset(element),bottomElement=topElement+elementHeight,scrollPosition=win.scrollY,topViewport=scrollPosition+globalNavHeight,bottomViewport=scrollPosition+Math.max(doc.documentElement.clientHeight,win.innerHeight||0);return topElement>=(topViewport-elementHeight/2)&&bottomElement<=(bottomViewport+elementHeight/2);}
return{getTopOffset:getTopOffset,isInViewport:isInViewport};});;window.Krux||((Krux=function(){Krux.q.push(arguments);}).q=[]);define('wikia.krux',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','wikia.document','wikia.tracker','wikia.window'],function(adContext,adTracker,doc,wikiaTracker,win){'use strict';var maxNumberOfKruxSegments=50,kruxScriptId='krux-control-tag',kruxLoaded=false,segmentsCountTracked=false;function exportPageParams(adLogicPageParams){var params,value;if(Object.keys){params=adLogicPageParams.getPageLevelParams();Object.keys(params).forEach(function(key){value=params[key];if(value){win['kruxDartParam_'+key]=value.toString();}});}}
function addConfigScript(confid){var k,s;k=document.createElement('script');k.type='text/javascript';k.id=kruxScriptId;k.async=true;k.src=(location.protocol==='https:'?'https:':'http:')+'//cdn.krxd.net/controltag?confid='+confid;s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(k,s);}
function load(confid){require(['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams'],function(adContext,adLogicPageParams){var script;if(adContext.getContext().targeting.enableKruxTargeting){exportPageParams(adLogicPageParams);script=doc.getElementById(kruxScriptId);if(script){script.parentNode.removeChild(script);}
addConfigScript(confid);kruxLoaded=true;adTracker.track('krux/load');wikiaTracker.track({category:'ads-trackers',action:'krux',label:'load',value:0,trackingMethod:'analytics'});}});}
function getParams(n){var k='kx'+n;if(win.localStorage){return win.localStorage[k]||'';}else{return'';}}
function trackNumberOfSegments(numberOfSegments){if(segmentsCountTracked){return;}
var label=numberOfSegments+'';while(label.length<4){label='0'+label;}
adTracker.track('krux/segments_count',{},numberOfSegments,label);segmentsCountTracked=true;}
function getSegments(){var segments=getParams('segs'),segsArray;if(segments===''){trackNumberOfSegments(0);return[];}
segsArray=segments.split(',');trackNumberOfSegments(segsArray.length);return segsArray.slice(0,maxNumberOfKruxSegments);}
function getUser(){return getParams('user');}
function sendEvent(eventId,data){if(!kruxLoaded){return false;}
Krux('admEvent',eventId,data||{});return true;}
adContext.addCallback(function(){segmentsCountTracked=false;});return{load:load,getSegments:getSegments,getUser:getUser,sendEvent:sendEvent};});;define('wikia.throttle',function(){'use strict';function throttle(fn,threshold,scope){threshold=threshold||250;var last,deferTimer;return function(){var context=scope||this,now=+(new Date()),args=arguments;if(last&&now<last+threshold){clearTimeout(deferTimer);deferTimer=setTimeout(function(){last=now;fn.apply(context,args);},threshold);}else{last=now;fn.apply(context,args);}};}
return throttle;});;define('wikia.viewportObserver',['wikia.domCalculator','wikia.throttle','wikia.window'],function(domCalculator,throttle,win){'use strict';function updateInViewport(listener){var newInViewport=domCalculator.isInViewport(listener.element);if(newInViewport!==listener.inViewport){listener.callback(newInViewport);listener.inViewport=newInViewport;}}
function addListener(element,callback,throttleThreshold){var listener={element:element,callback:callback,inViewport:false},updateCallback=throttle(function(){updateInViewport(listener);},throttleThreshold);win.addEventListener('scroll',updateCallback);updateCallback();return updateCallback;}
function removeListener(listener){win.removeEventListener('scroll',listener);}
return{addListener:addListener,removeListener:removeListener};});;require(['wikia.window','wikia.tracker'],function(window,tracker){'use strict';var wikia=window.Wikia=window.Wikia||{};wikia.fliteOoyalaTracker=function(id){tracker.track({action:'content-begin',category:'video-player-stats',label:'ooyala',trackingMethod:'internal',title:id||'',clickSource:'ad'});};});;define('ext.wikia.adEngine.dartVideoHelper',['wikia.log','wikia.location','ext.wikia.adEngine.adLogicPageParams'],function(log,location,adLogicPageParams){'use strict';var logGroup='adengine.dartVideoHelper',pageParams=adLogicPageParams.getPageLevelParams();pageParams.src='ooyala';function getCustParams(){var key,vals,params=[],urlValues,valIndex;for(key in pageParams){if(pageParams.hasOwnProperty(key)&&key!==''){vals=pageParams[key];if(vals&&vals.length){if(!(vals instanceof Array)){vals=[vals];}
urlValues=[];for(valIndex=0;valIndex<vals.length;valIndex+=1){urlValues.push(vals[valIndex].toString());}
params.push(key+'='+urlValues.join(','));}}}
return params.join('&');}
function getUrl(){log('getUrl',5,logGroup);var ord=Math.round(Math.random()*23945290875),out=['http://pubads.g.doubleclick.net/gampad/ads?ciu_szs','&iu=/5441/wka.ooyalavideo/_page_targeting','&cust_params='+encodeURIComponent(getCustParams()),'&sz=320x240','&impl=s','&output=xml_vast2','&gdfp_req=1','&env=vp','&ad_rule=0','&unviewed_position_start=1','&url='+location.origin,'&correlator='+ord].join('');log(out,5,logGroup);return out;}
return{getUrl:getUrl};});;define('ext.wikia.adEngine.utils.scriptLoader',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','wikia.document',],function(adContext,adTracker,doc){'use strict';function createScript(src,type,isAsync,node){var script=doc.createElement('script');node=node||doc.body.lastChild;script.async=isAsync||true;script.type=type||'text/javascript';script.src=src;node.parentNode.insertBefore(script,node);return script;}
function loadAsync(src,node,type){return loadScript(src,type,true,node);}
function loadScript(src,type,isAsync,node){return new Promise(function(resolve,reject){var script=createScript(src,type,isAsync,node);script.onload=resolve;script.onerror=reject;});}
return{loadAsync:loadAsync,loadScript:loadScript};});;define('ext.wikia.adEngine.provider.evolve2',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.provider.gpt.helper','ext.wikia.adEngine.slotTweaker','ext.wikia.adEngine.utils.adLogicZoneParams','ext.wikia.adEngine.utils.eventDispatcher','wikia.log',require.optional('ext.wikia.adEngine.lookup.openx.openXBidderHelper')],function(adContext,gptHelper,slotTweaker,zoneParams,eventDispatcher,log,openXHelper){'use strict';var logGroup='ext.wikia.adEngine.provider.evolve2',posTargetingValue,site='wikia_intl',slotMap={EVOLVE_FLUSH:{flushOnly:true},INVISIBLE_SKIN:{size:'1000x1000,1x1',wloc:'top'},LEFT_SKYSCRAPER_2:{size:'160x600',wloc:'middle'},TOP_LEADERBOARD:{size:'728x90,970x250,970x300,970x90',wloc:'top'},TOP_RIGHT_BOXAD:{size:'300x250,300x600',wloc:'top'},MOBILE_TOP_LEADERBOARD:{size:'320x50,320x100',wsrc:'mobile_evolve'},MOBILE_IN_CONTENT:{size:'300x250',wsrc:'mobile_evolve'},MOBILE_PREFOOTER:{size:'300x250',wsrc:'mobile_evolve'}};function resetPosTargeting(){posTargetingValue={'728x90,970x250,970x300,970x90':'a','300x250,300x600':'a','1000x1000,1x1':'a','160x600':'b','320x50,320x100':'a','300x250':'a'};}
function getSection(){var vertical=zoneParams.getVertical(),mappedVertical=zoneParams.getSite();switch(vertical){case'movies':case'tv':return vertical;}
switch(mappedVertical){case'gaming':return'gaming';case'ent':return'entertainment';}
return'ros';}
function nextChar(char){return String.fromCharCode(char.charCodeAt(0)+1);}
function setTargeting(slot){var position=posTargetingValue[slot.size];slot.pos=position;if(!slot.wsrc){slot.wsrc='evolve';}
posTargetingValue[slot.size]=nextChar(position);}
function canHandleSlot(slotName){log(['canHandleSlot',slotName],'debug',logGroup);var ret=!!slotMap[slotName];log(['canHandleSlot',slotName,ret],'debug',logGroup);return ret;}
function fillInSlot(slot){log(['fillInSlot',slot.name],'debug',logGroup);var section=getSection(),slotCopy=JSON.parse(JSON.stringify(slotMap[slot.name]));if(!slotCopy.flushOnly){slotCopy.wpos=slot.name;setTargeting(slotCopy);}
slot.pre('success',function(){slotTweaker.removeDefaultHeight(slot.name);slotTweaker.removeTopButtonIfNeeded(slot.name);slotTweaker.adjustLeaderboardSize(slot.name);});slot.pre('hop',function(){openXHelper&&openXHelper.addOpenXSlot(slot.name);});gptHelper.pushAd(slot,'/4403/ev/'+site+'/'+section+'/'+slot.name,slotCopy,{forcedAdType:'evolve2',sraEnabled:true});log(['fillInSlot',slot.name,'done'],'debug',logGroup);}
resetPosTargeting();adContext.addCallback(function(){resetPosTargeting();});return{name:'Evolve2',canHandleSlot:canHandleSlot,fillInSlot:fillInSlot};});;require(['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adEngineRunner','ext.wikia.adEngine.adInfoTracker','ext.wikia.adEngine.adLogicPageParams','ext.wikia.adEngine.slot.service.stateMonitor','ext.wikia.adEngine.config.desktop','ext.wikia.adEngine.customAdsLoader','ext.wikia.adEngine.dartHelper','ext.wikia.adEngine.messageListener','ext.wikia.adEngine.pageFairDetection','ext.wikia.adEngine.slot.service.actionHandler','ext.wikia.adEngine.slotTracker','ext.wikia.adEngine.slotTweaker','ext.wikia.adEngine.sourcePointDetection','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.window',require.optional('ext.wikia.adEngine.template.floatingRail')],function(adContext,adEngineRunner,adInfoTracker,pageLevelParams,slotStateMonitor,adConfigDesktop,customAdsLoader,dartHelper,messageListener,pageFairDetection,actionHandler,slotTracker,slotTweaker,sourcePointDetection,adBlockDetection,win,floatingRail){'use strict';var context=adContext.getContext();win.AdEngine_getTrackerStats=slotTracker.getStats;messageListener.init();win.wikiaDartHelper=dartHelper;win.adSlotTweaker=slotTweaker;win.loadCustomAd=customAdsLoader.loadCustomAd;win.wgAfterContentAndJS.push(function(){if(floatingRail){pageLevelParams.add('ah',floatingRail.getArticleHeightParameter().toString());}
adInfoTracker.run();slotStateMonitor.run();win.adslots2=win.adslots2||[];adEngineRunner.run(adConfigDesktop,win.adslots2,'queue.desktop',!!context.opts.delayEngine);actionHandler.registerMessageListener();sourcePointDetection.initDetection();if(context.opts.pageFairDetection){pageFairDetection.initDetection(context);}
adBlockDetection.initEventQueues();});});require(['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.slot.bottomLeaderboard','ext.wikia.adEngine.slot.highImpact','ext.wikia.adEngine.slot.inContent','ext.wikia.adEngine.slot.skyScraper3','wikia.document','wikia.window'],function(adContext,slotsContext,bottomLeaderboard,highImpact,inContent,skyScraper3,doc,win){'use strict';var context=adContext.getContext();function initDesktopSlots(){highImpact.init();skyScraper3.init();inContent.init('INCONTENT_PLAYER');}
win.addEventListener('wikia.uap',bottomLeaderboard.init);if(context.opts.adMixExperimentEnabled&&context.slots.adMixToUnblock.indexOf('BOTTOM_LEADERBOARD')){win.addEventListener('wikia.not_uap',bottomLeaderboard.init);}
if(doc.readyState==='complete'){initDesktopSlots();}else{win.addEventListener('load',initDesktopSlots);}});require(['wikia.querystring','wikia.document'],function(qs,doc){'use strict';if(qs().getVal('fps')){var s=doc.createElement('script');s.src='https://raw.githubusercontent.com/Wikia/fps-meter/master/fps-meter.js';doc.body.appendChild(s);}});;


define('ext.wikia.adEngine.slot.interactiveMaps',['wikia.log','wikia.window','wikia.document','ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams'],function(log,window,document,adContext,adLogicPageParams){'use strict';var iframeCounter=0,logGroup='ext.wikia.adEngine.slot.interactiveMaps';function initSlot(container){log(['initSlot',container],'info',logGroup);var adParams={},context=adContext.getContext(),iframe,params=adLogicPageParams.getPageLevelParams(),url='/extensions/wikia/AdEngine/InteractiveMaps/ad.html';if(!context.opts.enableAdsInMaps||!context.opts.showAds||!container){return;}
adParams.mapid=container.getAttribute('data-map-id');adParams.s0=params.s0;adParams.s1=params.s1;adParams.s2='map';adParams.hostpre=params.hostpre;adParams.dmn=params.dmn;adParams.lang=params.lang;if(!adParams.mapid){return false;}
iframe=document.createElement('iframe');iframe.id='wikia-map-ad-'+adParams.mapid+'-'+iframeCounter;iframe.name='wikia-map-ad-'+adParams.mapid+'-'+iframeCounter;iframe.src=url+'?'+window.wgStyleVersion+'#'+JSON.stringify({adParams:adParams});container.appendChild(iframe);log(['initSlot','iframeCreated',iframe,'adParams',adParams],'info',logGroup);iframeCounter+=1;}
return{initSlot:initSlot};});;


define('mediaGallery.templates.mustache',[],function(){'use strict';return{"MediaGallery_gallery":'<div class="media-gallery-wrapper count-{{count}}" data-visible-count="{{visibleCount}}" data-model="{{json}}" data-expanded="{{expanded}}"><button class="add-image">{{addImageButton}}</button><noscript>{{#media}}<a href="{{linkHref}}"><img src="{{thumbUrl}}" alt="{{{caption}}}"></a>{{/media}}</noscript></div>',"MediaGallery_media":'{{{thumbHtml}}}{{#caption}}<div class="media-gallery-caption"><div class="inner">{{{caption}}}</div></div>{{/caption}}',"MediaGallery_showMore":'<button class="primary show">{{showMore}}</button><button class="secondary hide hidden">{{showLess}}</button>',"done":"true"};});;define('mediaGallery.views.caption',[],function(){'use strict';var Caption=function(options){this.$el=options.$el;this.media=options.media;this.$media=this.media.$el;};Caption.prototype.init=function(){var self=this;this.$el.hover($.proxy(this.expand,this),$.proxy(this.collapse,this));this.$media.on('click',function(){if(self.$el.hasClass('clicked')){self.collapse();}else{self.$el.addClass('clicked');self.expand();}});};Caption.prototype.expand=function(){var mediaHeight=this.$media.height(),contentHeight,newMarginTop;this.setDimensionsCache();this.$el.addClass('hovered');contentHeight=this.$el.find('.inner').outerHeight(false)+(2*this.captionPadding);newMarginTop=-1*(Math.min(mediaHeight,contentHeight)+this.mediaPadding);if(Math.abs(Math.abs(this.marginTop)-Math.abs(newMarginTop))<2){return;}
this.$el.css('marginTop',newMarginTop);if(contentHeight>mediaHeight){this.$el.addClass('scroll');}};Caption.prototype.collapse=function(){this.$el.removeClass('hovered scroll clicked').removeAttr('style');};Caption.prototype.setDimensionsCache=function(){if(!this.mediaPadding){this.mediaPadding=parseFloat(this.$media.css('padding-bottom'));this.captionPadding=parseFloat(this.$el.css('padding-top'));this.marginTop=parseFloat(this.$el.css('margin-top'));}};return Caption;});;define('mediaGallery.views.media',['mediaGallery.views.caption','mediaGallery.templates.mustache'],function(Caption,templates){'use strict';var Media,templateName='MediaGallery_media';Media=function(options){this.$el=options.$el;this.model=options.model;this.gallery=options.gallery;this.model.media=this;this.rendered=false;this.$loaded=$.Deferred();this.$el.on('mediaInserted',$.proxy(this.onInsert,this));};Media.prototype.render=function(){this.$el.addClass('media hidden fade');this.$el.html(Mustache.render(templates[templateName],this.model));this.rendered=true;return this;};Media.prototype.onInsert=function(){var self=this;this.$el.find('img').on('load error',function(){self.$loaded.resolve();});this.initCaption();};Media.prototype.initCaption=function(){var $caption=this.$el.find('.media-gallery-caption');if($caption.length){this.caption=new Caption({$el:$caption,media:this});this.caption.init();}};Media.prototype.show=function(){var self=this;this.$el.removeClass('hidden');setTimeout(function(){self.$el.removeClass('fade');},0);};Media.prototype.hide=function(){var self=this;if(!this.fadeDuration){this.fadeDuration=parseInt(this.$el.css('transition-duration'))*500;}
this.$el.addClass('fade');setTimeout(function(){self.$el.addClass('hidden');},this.fadeDuration);};return Media;});;define('mediaGallery.views.toggler',['mediaGallery.templates.mustache'],function(templates){'use strict';var Toggler=function(){this.templateName='MediaGallery_showMore';this.$el=$('<div></div>').addClass('toggler');return this;};Toggler.prototype.render=function(){var $html,data;data={showMore:$.msg('mediagallery-show-more'),showLess:$.msg('mediagallery-show-less')};$html=$(Mustache.render(templates[this.templateName],data));this.$more=$html.first();this.$less=$html.last();this.$el.html($html);return this;};return Toggler;});;define('mediaGallery.views.gallery',['mediaGallery.views.media','mediaGallery.views.toggler','wikia.tracker','bucky'],function(Media,Toggler,tracker,bucky){'use strict';var Gallery;Gallery=function(options){this.$el=options.$el.addClass('media-gallery-inner');this.$wrapper=options.$wrapper;this.model=options.model;this.origVisibleCount=options.origVisibleCount||8;this.interval=options.interval||12;this.throttleVal=options.throttleVal||200;this.bucky=bucky('mediaGallery.views.gallery.'+options.index);this.rendered=false;this.visibleCount=0;this.media=[];return this;};Gallery.prototype.init=function(){this.createMedia();this.bindEvents();if(this.model.media.length>this.origVisibleCount){this.toggler=new Toggler();this.togglerAdded=false;}
this.track({action:tracker.ACTIONS.IMPRESSION,value:this.model.media.length});return this;};Gallery.prototype.createMedia=function(){var self=this,throttled=this.model.media.slice(this.media.length,this.media.length+this.throttleVal);if(!throttled.length){return;}
this.bucky.timer.start('createMedia');$.each(throttled,function(idx,model){var media=new Media({$el:$('<div></div>'),model:model,gallery:this});self.media.push(media);});this.bucky.timer.stop('createMedia');};Gallery.prototype.bindEvents=function(){var self=this;this.$el.on('galleryInserted',function(){self.rendered=true;$.each(self.media,function(idx,media){if(media.rendered){media.$el.trigger('mediaInserted');}});});this.$wrapper.on('click','.media > a',function(){var index=$(this).parent().index();self.track({label:'gallery-item',value:index});});};Gallery.prototype.render=function(count){var self=this,media,mediaCount,deferredImages=[];this.beforeRender();if(typeof count!=='number'){count=this.origVisibleCount;}
media=this.media.slice(this.visibleCount,this.visibleCount+count);mediaCount=media.length;this.bucky.timer.start('render.'+mediaCount);$.each(media,function(idx,item){item.render();self.$el.append(item.$el);if(self.rendered){item.$el.trigger('mediaInserted');}
self.visibleCount+=1;deferredImages.push(item.$loaded);});$.when.apply(this,deferredImages).done(function(){$.each(media,function(idx,item){item.show();});self.bucky.timer.stop('render.'+mediaCount);self.afterRender();});return this;};Gallery.prototype.beforeRender=function(){if(this.$showMore){this.$showMore.startThrobbing();}};Gallery.prototype.afterRender=function(){if(this.$showMore){this.$showMore.stopThrobbing();}
this.updateToggler(true);this.$el.trigger('mediaLoaded');};Gallery.prototype.updateToggler=function(show){if(!this.toggler){return;}
this.appendToggler();if(show){this.$showLess.removeClass('hidden');if(this.visibleCount>=this.model.media.length){this.$showMore.addClass('hidden');}}else{this.$showLess.addClass('hidden');this.$showMore.removeClass('hidden');}};Gallery.prototype.appendToggler=function(){if(this.toggler&&this.togglerAdded===false){this.$wrapper.append(this.toggler.render().$el);this.$showMore=this.toggler.$more.on('click',$.proxy(this.showMore,this));this.$showLess=this.toggler.$less.on('click',$.proxy(this.showLess,this));this.togglerAdded=true;}};Gallery.prototype.showMore=function(){var self=this,media=this.media.slice(this.visibleCount,this.visibleCount+this.interval),toRender=0;$.each(media,function(idx,item){if(item.rendered){item.show();self.visibleCount+=1;}else{toRender+=1;}});this.render(toRender);this.track({label:'show-more-items',value:this.visibleCount});this.createMedia();};Gallery.prototype.showLess=function(){var media=this.media.slice(this.origVisibleCount,this.visibleCount);$.each(media,function(idx,item){item.hide();});this.track({label:'show-less-items',value:this.visibleCount});this.visibleCount=this.origVisibleCount;this.updateToggler(false);this.scrollToTop();};Gallery.prototype.scrollToTop=function(){$('body, html').animate({scrollTop:this.$wrapper.offset().top-50},500);};Gallery.prototype.track=tracker.buildTrackingFunction({category:'media-gallery',label:'gallery',trackingMethod:'analytics',action:tracker.ACTIONS.CLICK,value:0});return Gallery;});;require(['mediaGallery.views.gallery'],function(Gallery){'use strict';var GalleriesController=function(options){this.$container=options.$container;this.$galleries=this.$container.find('.media-gallery-wrapper');this.galleries=[];return this;};GalleriesController.prototype.createGallery=function($wrapper,idx){var gallery,model=$wrapper.data('model'),galleryOptions={$el:$('<div></div>'),$wrapper:$wrapper,model:{media:model},index:idx,origVisibleCount:$wrapper.data('visible-count'),interval:$wrapper.data('expanded')};gallery=new Gallery(galleryOptions).init();$wrapper.append(gallery.render().$el);gallery.$el.trigger('galleryInserted');this.galleries.push(gallery);};GalleriesController.prototype.init=function(){var self=this;$.each(this.$galleries,function(idx){var $this=$(this);self.createGallery($this,idx);});return this;};mw.hook('wikipage.content').add(function($content){new GalleriesController({$container:$content}).init();});});;


(function(w,d,s,p,v,e,r){w['$igniter_var']=v;w[v]=w[v]||function(){(w[v].q=w[v].q||[]).push(arguments)};w[v].l=1*new Date();e=d.createElement(s),r=d.getElementsByTagName(s)[0];e.async=1;e.src=p+'?ts='+(+new Date()/3600000|0);r.parentNode.insertBefore(e,r)})(window,document,'script','//cdn.fandommetrics.com/l9ehhrb6mtv75bp2.js','$p');function getLiftIgniterGlobalContext(){var context={};if(window.ads&&window.ads.context&&window.ads.context.targeting){var targeting=window.ads.context.targeting;context={_wCategory:targeting.wikiCategory,_wName:targeting.wikiDbName,_wTop:targeting.wikiIsTop1000,_wikiLanguage:targeting.wikiLanguage,_wVert:targeting.wikiVertical,_pType:targeting.pageType,_pName:targeting.pageName};if(targeting.wikiCustomKeyValues){targeting.wikiCustomKeyValues.split(';').map(function(keyVal){return keyVal.split('=');}).forEach(function(parts){var key='_'+parts[0];if(!context[key]){context[key]=[parts[1]];}else{context[key].push(parts[1]);}})}}
if(localStorage.kxallsegs){context['_kruxTags']=localStorage.kxallsegs.split(',');}
return context;}
$p("init","l9ehhrb6mtv75bp2",{config:{sdk:{queryServer:"//query.fandommetrics.com"},activity:{activityServer:"//api.fandommetrics.com"},inventory:{inventoryServer:"//api.fandommetrics.com"},globalCtx:getLiftIgniterGlobalContext()}});$p("send","pageview");$p("setRequestFields",["rank","thumbnail","title","url","presented_by","author"]);;


define('ext.wikia.recirculation.tracker',['wikia.tracker','wikia.abTest'],function(tracker,abTest){'use strict';function trackClick(label){tracker.track({action:tracker.ACTIONS.CLICK,category:'recirculation',label:label,trackingMethod:'analytics'});}
function trackImpression(label){tracker.track({action:tracker.ACTIONS.IMPRESSION,category:'recirculation',label:label,trackingMethod:'analytics'});}
return{trackImpression:trackImpression,trackClick:trackClick};});;define('ext.wikia.recirculation.utils',['jquery','wikia.loader','wikia.cache','wikia.mustache'],function($,loader,cache,Mustache){'use strict';var footerState={cleared:false,loading:false,pending:[]};function prepareFooter(){var deferred=$.Deferred();if(!footerState.cleared){footerState.pending.push(deferred);if(!footerState.loading){footerState.loading=true;return renderTemplate('footer-index-container.mustache',{}).then(function($html){$('#WikiaFooter').find('#BOTTOM_LEADERBOARD').siblings().remove().end().end().append($html);footerState.cleared=true;footerState.pending.forEach(function(d){d.resolve();});});}else{return deferred.promise();}}else{return deferred.resolve();}}
function loadTemplate(templateName){var dfd=new $.Deferred(),templateLocation='extensions/wikia/Recirculation/templates/'+templateName,cacheKey='RecirculationAssets_'+templateLocation,template=cache.getVersioned(cacheKey);if(!templateName){return dfd.reject('Invalid template name');}
if(template){dfd.resolve(template);}else{loader({type:loader.MULTI,resources:{mustache:templateLocation}}).done(function(data){template=data.mustache[0];dfd.resolve(template);cache.setVersioned(cacheKey,template,86400);});}
return dfd.promise();}
function renderTemplate(templateName,data){return loadTemplate(templateName).then(function(template){return $(Mustache.render(template,data));});}
function buildLabel(element,label){var $parent=$(element).parent(),slot=$parent.data('index')+1,source=$parent.data('source')||'undefined',isVideo=$parent.hasClass('is-video')?'video':'not-video',parts=[label,'slot-'+slot,source,isVideo];return parts.join('=');}
function waitForRail(){var $rail=$('#WikiaRail'),deferred=$.Deferred(),args=Array.prototype.slice.call(arguments);if($rail.find('.loading').exists()){$rail.one('afterLoad.rail',function(){deferred.resolve.apply(null,args);});}else{deferred.resolve.apply(null,args);}
return deferred.promise();}
return{buildLabel:buildLabel,renderTemplate:renderTemplate,waitForRail:waitForRail,prepareFooter:prepareFooter};});;define('ext.wikia.recirculation.helpers.fandom',['jquery','wikia.window','wikia.abTest','wikia.nirvana'],function($,w,abTest,nirvana){'use strict';return function(config){var defaults={limit:3,type:'recent_popular',ignoreError:false,fill:false},options=$.extend({},defaults,config);function loadData(){var deferred=$.Deferred();nirvana.sendRequest({controller:'RecirculationApi',method:'getFandomPosts',format:'json',type:'get',scriptPath:w.wgCdnApiUrl,data:{type:options.type,cityId:w.wgCityId,limit:options.limit,fill:options.fill},callback:function(data){data=formatData(data);if(data.items&&data.items.length>=options.limit){deferred.resolve(data);}else{if(options.ignoreError){deferred.resolve({title:data.title,items:[]});}else{deferred.reject('Recirc widget not shown. Not enough items returned from Fandom API');}}}});return deferred.promise();}
function formatData(data){var items=[];$.each(data.posts,function(index,item){if(items.length<options.limit){item.thumbnail=item.image_url||item.thumbnail;item.index=index;items.push(item);}});return{title:data.title,items:items.sort(sortItem)};}
function sortItem(a,b){if(a.type==='recent_popular'&&b.type!=='recent_popular'){return 1;}
if(b.type==='recent_popular'&&a.type!=='recent_popular'){return-1;}
return b.isVideo-a.isVideo;}
return{loadData:loadData};};});;define('ext.wikia.recirculation.helpers.discussions',['jquery','wikia.window','wikia.abTest','wikia.nirvana'],function($,w,abTest,nirvana){'use strict';return function(config){var defaults={type:'all',cityId:w.wgCityId},options=$.extend({},defaults,config);function loadData(){var deferred=$.Deferred();nirvana.sendRequest({controller:'RecirculationApi',method:'getDiscussions',format:'json',type:'get',scriptPath:w.wgCdnApiUrl,data:options,callback:function(data){data=formatData(data);deferred.resolve(data);}});return deferred.promise();}
function formatData(data){var returnData={};if(data.posts){returnData.items=data.posts;}
return returnData;}
return{loadData:loadData};};});;define('ext.wikia.recirculation.helpers.curatedContent',['jquery','underscore','wikia.window','wikia.nirvana','wikia.cache','ext.wikia.recirculation.tracker'],function($,_,w,nirvana,cache,tracker){'use strict';return function(config){var defaults={limit:1},options=$.extend({},defaults,config);function loadData(){var deferred=$.Deferred();nirvana.sendRequest({controller:'RecirculationApi',method:'getFandomPosts',format:'json',type:'get',scriptPath:w.wgCdnApiUrl,data:{type:'curated'},callback:function(data){data=formatData(data);if(data&&data.length>0){deferred.resolve(data);}else{deferred.reject();}},onErrorCallback:function(){deferred.reject();}});return deferred.promise();}
function formatData(data){var items=[];var posts=_.shuffle(data.posts);$.each(posts,function(index,item){if(items.length<options.limit&&!hasSeen(item)){items.push(item);}});return items;}
function hasSeen(post){return cache.get(key(post));}
function setSeen(post){return cache.set(key(post),true,cache.CACHE_STANDARD);}
function key(post){return'recirculation:curated:'+post.id;}
function injectContent(data){var deferred=$.Deferred();loadData().then(function(curatedPosts){var randomIndex=Math.floor(Math.random()*data.items.length);data.items.splice(randomIndex,1,curatedPosts[0]);data.items.map(function(item,index){item.index=index;return item;});setSeen(curatedPosts[0]);deferred.resolve(data);}).fail(function(){deferred.resolve(data);});return deferred.promise();}
function setupTracking($html){var $curatedItem=$html.find('.item-curated'),label,slot,id;if($curatedItem.length){id=$curatedItem.data('id');slot=$curatedItem.data('index')+1;label='CURATED='+id+'=slot_'+slot;tracker.trackImpression(label);$curatedItem.on('mousedown','a',function(){tracker.trackClick(label);});}
return $html;}
return{injectContent:injectContent,setupTracking:setupTracking,loadData:loadData};};});;define('ext.wikia.recirculation.helpers.liftigniter',['jquery','wikia.window','wikia.thumbnailer'],function($,w,thumbnailer){'use strict';var helper=function(config){var defaults={max:5,width:320,height:180,flush:false},options=$.extend({},defaults,config);function loadData(){var deferred=$.Deferred(),registerOptions={max:options.max*2,widget:options.widget,callback:function(response){deferred.resolve(formatData(response));}};if(!w.$p){return deferred.reject('Liftigniter library not found').promise();}
if(options.opts){registerOptions.opts=options.opts;}
w.$p('register',registerOptions);if(options.flush){w.$p('fetch');}
return deferred.promise();}
function formatData(data){var items=[],title='';if(options.title){title=options.title;}
$.each(data.items,function(index,item){item.isWiki=false;if(items.length<options.max&&item.thumbnail){item.source=options.source;item.meta=options.widget;item.index=index;if(item.source==='wiki'){item.isWiki=true;}
if(thumbnailer.isThumbUrl(item.thumbnail)){item.thumbnail=thumbnailer.getThumbURL(item.thumbnail,'image',options.width,options.height);}
items.push(item);}});return{title:title,items:items};}
function setupTracking(){var elements=$('.recirculation-unit .item[data-meta="'+options.widget+'"]').get(),trackOptions={elements:elements,name:options.widget,source:'LI'};if(options.opts){trackOptions.opts=options.opts;}
w.$p('track',trackOptions);}
return{setupTracking:setupTracking,loadData:loadData};};return helper;});;define('ext.wikia.recirculation.views.premiumRail',['jquery','wikia.window','wikia.abTest','ext.wikia.recirculation.tracker','ext.wikia.recirculation.utils','ext.wikia.recirculation.helpers.curatedContent'],function($,w,abTest,tracker,utils,CuratedHelper){'use strict';var options={};function render(data){var curated=new CuratedHelper();return curated.injectContent(data).then(renderTemplate('client/premiumRail.mustache')).then(utils.waitForRail).then(function($html){var $recirculationRail=$('#recirculation-rail');if(options.before){$html=options.before($html);}
$recirculationRail.html($html);curated.setupTracking($html);$recirculationRail.trigger('premiumRecirculationRail.ready');return $html;});}
function renderTemplate(templateName){return function(data){data.title=data.title||$.msg('recirculation-fandom-title');data.items=data.items.slice(0,5);return utils.renderTemplate(templateName,data);};}
function setupTracking(){return function($html){tracker.trackImpression('rail');$html.on('mousedown','a',function(){tracker.trackClick(utils.buildLabel(this,'rail'));});return $html;};}
return function(config){$.extend(options,config);return{render:render,setupTracking:setupTracking};};});;define('ext.wikia.recirculation.views.footer',['jquery','wikia.window','ext.wikia.recirculation.tracker','ext.wikia.recirculation.utils'],function($,w,tracker,utils){'use strict';function render(data){return utils.prepareFooter().then(function(){return utils.renderTemplate('client/footer.mustache',data)}).then(function($html){$('#recirculation-footer-container').html($html);return $html;});}
function setupTracking(){return function($html){tracker.trackImpression('footer');$html.on('mousedown','a',function(){tracker.trackClick(utils.buildLabel(this,'footer'));});};}
return function(){return{render:render,setupTracking:setupTracking};};});;define('ext.wikia.recirculation.views.impactFooter',['jquery','wikia.window','ext.wikia.recirculation.tracker','ext.wikia.recirculation.utils'],function($,w,tracker,utils){'use strict';var imageRatio=9/16,options={};function render(data){var renderData={},structuredData=structureData(data.items);renderData.title=data.title;renderData.items=structuredData.items;if(structuredData.discussions&&structuredData.discussions.length>0){renderData.discussions={discussionsUrl:getDiscussionsUrl(structuredData.discussions),posts:structuredData.discussions};}
renderData.i18n={title:$.msg('recirculation-impact-footer-title'),discussionsTitle:$.msg('recirculation-discussion-title'),discussionsLinkText:$.msg('recirculation-discussion-link-text'),discussionsNew:$.msg('recirculation-discussions-new'),discussionsPosts:$.msg('recirculation-discussions-posts'),discussionsReplies:$.msg('recirculation-discussions-replies'),discussionsUpvotes:$.msg('recirculation-discussions-upvotes'),featuredFandomSubtitle:$.msg('recirculation-impact-footer-featured-fandom-subtitle'),trendingTag:$.msg('recirculation-impact-footer-trending-tag'),wikiTag:$.msg('recirculation-impact-footer-wiki-tag')};return utils.prepareFooter().then(function(){return utils.renderTemplate('client/impactFooter.mustache',renderData)}).then(function($html){$('#recirculation-impactFooter-container').html($html).find('.discussion-timestamp').timeago();adjustFeatureItem($html);renderDiscussionHeaderImage($html);return $html;});}
function adjustFeatureItem($html){var $firstSet,firstSetHeight,firstSetDifference,$secondSet,secondSetHeight,secondSetDifference,$feature,featureHeight,move;$firstSet=$html.find('.item:eq(1) h4, .item:eq(2) h4');firstSetHeight=$firstSet.outerWidth(true)*imageRatio+$firstSet.outerHeight(true);$secondSet=$html.find('.item:eq(3) h4, .item:eq(4) h4');secondSetHeight=$secondSet.outerWidth(true)*imageRatio+$secondSet.outerHeight(true);$feature=$html.find('.item:eq(5)');featureHeight=$feature.outerWidth(true)*imageRatio;firstSetDifference=(featureHeight-firstSetHeight);secondSetDifference=(featureHeight-secondSetHeight);move=firstSetDifference>secondSetDifference?secondSetDifference:firstSetDifference;$feature.css('margin-top',-move);}
function renderDiscussionHeaderImage($html){var $discussionHeader=$html.find('.discussion-header');if($discussionHeader.length>0){var cityId=mw.config.get('wgCityId'),requestUrl=servicesUrl()+'/site-attribute/site/'+cityId+'/attr/heroImage';$.ajax({type:'GET',url:requestUrl,xhrFields:{withCredentials:true},}).done(function(data){if(data.value){$discussionHeader.css('background-image','url('+data.value+')');}}).fail(function(){});}}
function servicesUrl(){if(mw.config.get('wgDevelEnvironment')){if(mw.config.get('wgWikiaDatacenter')==='poz'){return'https://services.wikia-dev.pl';}
return'https://services.wikia-dev.us';}
return'https://services.wikia.com';}
function structureData(items){var fandom=items.filter(function(element){return element.source==='fandom';});var wiki=items.filter(function(element){return element.source==='wiki';});var discussions=items.filter(function(element){return element.source==='discussions';});items=[];if(fandom.length>0){items.push(fandom.shift());}
items=items.concat(wiki.splice(0,2));items=items.concat(fandom);items=items.concat(wiki);items.forEach(function(item,index){if(items[index]){items[index].index=index;}});return{items:items.slice(0,12),discussions:discussions};}
function getDiscussionsUrl(posts){var parser=document.createElement('a');parser.href=posts[0].url;return parser.protocol+'//'+parser.hostname+'/d/f';}
function setupTracking(){return function($html){tracker.trackImpression('impact-footer');$html.on('mousedown','.track-items',function(){tracker.trackClick(utils.buildLabel(this,'impact-footer'));});if($html.find('.discussion-module').length){tracker.trackImpression('impact-footer-discussions');$html.on('mousedown','.track-discussions',function(){tracker.trackClick(utils.buildLabel(this,'impact-footer-discussions'));});}};}
return function(config){$.extend(options,config);return{render:render,setupTracking:setupTracking};};});;require(['jquery','wikia.window','wikia.log','ext.wikia.recirculation.utils','ext.wikia.recirculation.discussions','ext.wikia.recirculation.helpers.liftigniter',require.optional('videosmodule.controllers.rail')],function($,w,log,utils,discussions,liftigniter,videosModule){'use strict';var recircModules=[{id:'LI_rail',viewModule:'ext.wikia.recirculation.views.premiumRail',options:{max:5,widget:'wikia-rail',source:'fandom',opts:{resultType:'cross-domain',domainType:'fandom.wikia.com'}}},{id:'LI_impactFooter',viewModule:'ext.wikia.recirculation.views.impactFooter',options:{max:9,widget:'wikia-impactfooter',source:'fandom',opts:{resultType:'cross-domain',domainType:'fandom.wikia.com'}}},{id:'LI_footer',viewModule:'ext.wikia.recirculation.views.footer',options:{max:3,widget:'wikia-footer-wiki-rec',source:'wiki',title:'Discover New Wikis',width:332,height:187,flush:true,opts:{resultType:'subdomain',domainType:'fandom.wikia.com'}}}],logGroup='ext.wikia.recirculation.experiments.mix',views={},completed=[],liftigniterHelpers={};if(w.wgContentLanguage!=='en'){if(videosModule){videosModule('#recirculation-rail');}
discussions();return;}
recircModules.forEach(function(recircModule){var deferred=$.Deferred();var configuredHelper=liftigniter(recircModule.options);configuredHelper.loadData().done(function(data){deferred.resolve(data);}).fail(function(err){deferred.reject(err);});liftigniterHelpers[recircModule.id]=configuredHelper;if(recircModule.viewModule){views[recircModule.viewModule]=views[recircModule.viewModule]||[];views[recircModule.viewModule].push(deferred);}});$.each(views,function(viewModule,promises){var deferred=$.Deferred();completed.push(deferred);log('Initializing View: '+viewModule,'info',logGroup);require([viewModule],function(viewFactory){$.when.apply($,promises).done(function(){var view=viewFactory(),args=Array.prototype.slice.call(arguments),data={title:'',items:[]};log(args,'info',logGroup);args.forEach(function(result){if(!result){return;}
if(result.title&&data.title.length===0){data.title=result.title;}
data.items=data.items.concat(result.items);});view.render(data).then(view.setupTracking()).then(deferred.resolve);}).fail(handleError(viewModule),function(){deferred.reject(viewModule);});});});$.when.apply($,completed).done(function(){log('Finished rendering recirculation','info',logGroup);$.each(liftigniterHelpers,function(viewModule,helper){helper.setupTracking();});}).fail(function(viewModule){log('Error running recirc at: '+viewModule,'info',logGroup);});function handleError(viewModule){return function(errorMessage){log(errorMessage,'info',logGroup);if(viewModule==='ext.wikia.recirculation.views.premiumRail'){require(['ext.wikia.recirculation.helpers.fandom',viewModule],function(helper,view){helper({type:'community',fill:true,limit:10}).loadData().done(function(data){view().render(data);});});}};}});;define('ext.wikia.recirculation.discussions',['jquery','wikia.window','wikia.abTest','wikia.nirvana','ext.wikia.recirculation.tracker'],function($,w,abTest,nirvana,tracker){'use strict';function injectDiscussions(){nirvana.sendRequest({controller:'Recirculation',method:'discussions',format:'html',type:'get',data:{cityId:w.wgCityId},callback:function(response){var $WikiaArticleFooter=$('#WikiaArticleFooter'),$response=$(response);if($WikiaArticleFooter.length){$WikiaArticleFooter.before($response);}else{$('#WikiaArticleBottomAd').before($response);}
tracker.trackImpression('discussions');$response.find('.discussion-timestamp').timeago();$response.find('.discussion-thread').click(function(){var slot=$(this).index()+1,label='discussions-tile=slot-'+slot+'=discussions';tracker.trackClick(label);w.location=$(this).data('link');});$response.find('.discussion-link').mousedown(function(){tracker.trackClick('discussions-link');});}});}
return injectDiscussions;});;


var Mustache=(typeof module!=="undefined"&&module.exports)||{};(function(exports){exports.name="mustache.js";exports.version="0.5.0-dev";exports.tags=["{{","}}"];exports.parse=parse;exports.compile=compile;exports.render=render;exports.clearCache=clearCache;exports.to_html=function(template,view,partials,send){var result=render(template,view,partials);if(typeof send==="function"){send(result);}else{return result;}};var _toString=Object.prototype.toString;var _isArray=Array.isArray;var _forEach=Array.prototype.forEach;var _trim=String.prototype.trim;var isArray;if(_isArray){isArray=_isArray;}else{isArray=function(obj){return _toString.call(obj)==="[object Array]";};}
var forEach;if(_forEach){forEach=function(obj,callback,scope){return _forEach.call(obj,callback,scope);};}else{forEach=function(obj,callback,scope){for(var i=0,len=obj.length;i<len;++i){callback.call(scope,obj[i],i,obj);}};}
var spaceRe=/^\s*$/;function isWhitespace(string){return spaceRe.test(string);}
var trim;if(_trim){trim=function(string){return string==null?"":_trim.call(string);};}else{var trimLeft,trimRight;if(isWhitespace("\xA0")){trimLeft=/^\s+/;trimRight=/\s+$/;}else{trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}
trim=function(string){return string==null?"":String(string).replace(trimLeft,"").replace(trimRight,"");};}
var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;'};function escapeHTML(string){return String(string).replace(/&(?!\w+;)|[<>"']/g,function(s){return escapeMap[s]||s;});}
function debug(e,template,line,file){file=file||"<template>";var lines=template.split("\n"),start=Math.max(line-3,0),end=Math.min(lines.length,line+3),context=lines.slice(start,end);var c;for(var i=0,len=context.length;i<len;++i){c=i+start+1;context[i]=(c===line?" >> ":"    ")+context[i];}
e.template=template;e.line=line;e.file=file;e.message=[file+":"+line,context.join("\n"),"",e.message].join("\n");return e;}
function lookup(name,stack,defaultValue){if(name==="."){return stack[stack.length-1];}
var names=name.split(".");var lastIndex=names.length-1;var target=names[lastIndex];var value,context,i=stack.length,j,localStack;while(i){localStack=stack.slice(0);context=stack[--i];j=0;while(j<lastIndex){context=context[names[j++]];if(context==null){break;}
localStack.push(context);}
if(context&&typeof context==="object"&&target in context){value=context[target];break;}}
if(typeof value==="function"){value=value.call(localStack[localStack.length-1]);}
if(value==null){return defaultValue;}
return value;}
function renderSection(name,stack,callback,inverted){var buffer="";var value=lookup(name,stack);if(inverted){if(value==null||value===false||(isArray(value)&&value.length===0)){buffer+=callback();}}else if(isArray(value)){forEach(value,function(value){stack.push(value);buffer+=callback();stack.pop();});}else if(typeof value==="object"){stack.push(value);buffer+=callback();stack.pop();}else if(typeof value==="function"){var scope=stack[stack.length-1];var scopedRender=function(template){return render(template,scope);};buffer+=value.call(scope,callback(),scopedRender)||"";}else if(value){buffer+=callback();}
return buffer;}
function parse(template,options){options=options||{};var tags=options.tags||exports.tags,openTag=tags[0],closeTag=tags[tags.length-1];var code=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var spaces=[],hasTag=false,nonSpace=false;var stripSpace=function(){if(hasTag&&!nonSpace&&!options.space){while(spaces.length){code.splice(spaces.pop(),1);}}else{spaces=[];}
hasTag=false;nonSpace=false;};var sectionStack=[],updateLine,nextOpenTag,nextCloseTag;var setTags=function(source){tags=trim(source).split(/\s+/);nextOpenTag=tags[0];nextCloseTag=tags[tags.length-1];};var includePartial=function(source){code.push('";',updateLine,'\nvar partial = partials["'+trim(source)+'"];','\nif (partial) {','\n  buffer += render(partial,stack[stack.length - 1],partials);','\n}','\nbuffer += "');};var openSection=function(source,inverted){var name=trim(source);if(name===""){throw debug(new Error("Section name may not be empty"),template,line,options.file);}
sectionStack.push({name:name,inverted:inverted});code.push('";',updateLine,'\nvar name = "'+name+'";','\nvar callback = (function () {','\n  return function () {','\n    var buffer = "";','\nbuffer += "');};var openInvertedSection=function(source){openSection(source,true);};var closeSection=function(source){var name=trim(source);var openName=sectionStack.length!=0&&sectionStack[sectionStack.length-1].name;if(!openName||name!=openName){throw debug(new Error('Section named "'+name+'" was never opened'),template,line,options.file);}
var section=sectionStack.pop();code.push('";','\n    return buffer;','\n  };','\n})();');if(section.inverted){code.push("\nbuffer += renderSection(name,stack,callback,true);");}else{code.push("\nbuffer += renderSection(name,stack,callback);");}
code.push('\nbuffer += "');};var sendPlain=function(source){code.push('";',updateLine,'\nbuffer += lookup("'+trim(source)+'",stack,"");','\nbuffer += "');};var sendEscaped=function(source){code.push('";',updateLine,'\nbuffer += escapeHTML(lookup("'+trim(source)+'",stack,""));','\nbuffer += "');};var line=1,c,callback;for(var i=0,len=template.length;i<len;++i){if(template.slice(i,i+openTag.length)===openTag){i+=openTag.length;c=template.substr(i,1);updateLine='\nline = '+line+';';nextOpenTag=openTag;nextCloseTag=closeTag;hasTag=true;switch(c){case"!":i++;callback=null;break;case"=":i++;closeTag="="+closeTag;callback=setTags;break;case">":i++;callback=includePartial;break;case"#":i++;callback=openSection;break;case"^":i++;callback=openInvertedSection;break;case"/":i++;callback=closeSection;break;case"{":closeTag="}"+closeTag;case"&":i++;nonSpace=true;callback=sendPlain;break;default:nonSpace=true;callback=sendEscaped;}
var end=template.indexOf(closeTag,i);if(end===-1){throw debug(new Error('Tag "'+openTag+'" was not closed properly'),template,line,options.file);}
var source=template.substring(i,end);if(callback){callback(source);}
var n=0;while(~(n=source.indexOf("\n",n))){line++;n++;}
i=end+closeTag.length-1;openTag=nextOpenTag;closeTag=nextCloseTag;}else{c=template.substr(i,1);switch(c){case'"':case"\\":nonSpace=true;code.push("\\"+c);break;case"\r":break;case"\n":spaces.push(code.length);code.push("\\n");stripSpace();line++;break;default:if(isWhitespace(c)){spaces.push(code.length);}else{nonSpace=true;}
code.push(c);}}}
if(sectionStack.length!=0){throw debug(new Error('Section "'+sectionStack[sectionStack.length-1].name+'" was not closed properly'),template,line,options.file);}
stripSpace();code.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var body=code.join("").replace(/buffer \+= "";\n/g,"");if(options.debug){if(typeof console!="undefined"&&console.log){console.log(body);}else if(typeof print==="function"){print(body);}}
return body;}
function _compile(template,options){var args="view,partials,stack,lookup,escapeHTML,renderSection,render";var body=parse(template,options);var fn=new Function(args,body);return function(view,partials){partials=partials||{};var stack=[view];try{return fn(view,partials,stack,lookup,escapeHTML,renderSection,render);}catch(e){throw debug(e.error,template,e.line,options.file);}};}
var _cache={};function clearCache(){_cache={};}
function compile(template,options){options=options||{};if(options.cache!==false){if(!_cache[template]){_cache[template]=_compile(template,options);}
return _cache[template];}
return _compile(template,options);}
function render(template,view,partials){return compile(template)(view,partials);}})(Mustache);(function(context){context.Mustache=Mustache;if(context.define&&context.define.amd){context.define('wikia.mustache',Mustache);}}(window));;define('wikia.toc',function(){'use strict';function getData(headers,createSection,checkHeader){var toc={sections:[]},levels=[toc.sections],headersLength=headers.length,hToLevel=[],level=-1,lastHeader=-1,headerLevel,i,obj,header;for(i=0;i<headersLength;i++){header=headers[i];headerLevel=parseInt(header.nodeName.slice(1),10);if(checkHeader){header=checkHeader(header);}
if(!header){continue;}
if(headerLevel>lastHeader){level+=1;}else if(headerLevel<lastHeader&&level>0){level=0;if(typeof hToLevel[headerLevel]!=='undefined'){level=hToLevel[headerLevel];}}
obj=createSection(header,level+1);hToLevel[headerLevel]=level;lastHeader=headerLevel;levels[level].push(obj);levels[level+1]=obj.sections;}
return toc;}
return{getData:getData};});;require(['jquery','wikia.toc','wikia.mustache',require.optional('wikia.toc.mustache')],function($,toc,mustache,tocTemplate){'use strict';var containerHasTOC={},cacheKey='TOCAssets';function wrapper(){return function(text,render){if(text!==''){return'<ol>'+render(text)+'</ol>';}else{return false;}};}
function getHeader(rawHeader){rawHeader=$(rawHeader).children('.mw-headline');if(rawHeader.length===0||rawHeader.is(':hidden')){return false;}
rawHeader=rawHeader.clone();rawHeader.find('noscript').remove();return rawHeader;}
function createTOCSection(header,tocLevel){return{title:header.text(),id:header.attr('id'),class:'toclevel-'+tocLevel,sections:[]};}
function loadTemplate(){var dfd=new $.Deferred();require(['wikia.loader','wikia.cache'],function(loader,cache){var template=cache.getVersioned(cacheKey);if(template){dfd.resolve(template);}else{require(['wikia.throbber'],function(throbber){var toc=$('#toc');throbber.show(toc);loader({type:loader.MULTI,resources:{mustache:'extensions/wikia/TOC/templates/TOC_articleContent.mustache'}}).done(function(data){template=data.mustache[0];dfd.resolve(template);cache.setVersioned(cacheKey,template,604800);throbber.remove(toc);});});}});return dfd.promise();}
function renderTOC($target){var $tocContainer=$target.parents('#toc'),$container=$tocContainer.children('ol'),$contentContainer=getContentContainer($target),$headers=$contentContainer.find('h1, h2, h3, h4, h5, h6'),data=toc.getData($headers,createTOCSection,getHeader);function render(template){$container.append(mustache.render(template,data));$tocContainer.trigger('afterLoad.toc').data('loaded',true);setHasTOC($target,true);}
data.wrapper=wrapper;if(tocTemplate){render(tocTemplate);}else{loadTemplate().done(render);}}
function setTOCCookie(isHidden){$.cookie('mw_hidetoc',isHidden,{expires:30,path:'/'});}
function showHideTOC($target){var tocWrapper=$target.parents('#toc'),targetLabel,tocCookie;tocWrapper.toggleClass('show');if(tocWrapper.hasClass('show')){targetLabel=$target.data('hide');tocCookie=null;}else{targetLabel=$target.data('show');tocCookie=1;}
$target.text(targetLabel);$target.attr('title',targetLabel);setTOCCookie(tocCookie);}
function isNewTOC(){return $('#toc').is('nav');}
function initTOC(){var $showLink=$('#togglelink');if(!hasTOC($showLink)){renderTOC($showLink);}
showHideTOC($showLink);}
function hasTOC($target){var containerIdentifier=getContainerIdentifier($target);return typeof containerHasTOC[containerIdentifier]!=='undefined'&&containerHasTOC[containerIdentifier];}
function setHasTOC($target,value){var containerIdentifier=getContainerIdentifier($target);containerHasTOC[containerIdentifier]=value;}
function getContentContainer($target){return $target.parents('.tabBody, #mw-content-text').first();}
function getContainerIdentifier($target){return getContentContainer($target).data('tab-body')||'main';}
$(function(){$('body').on('click','#togglelink',function(event){event.preventDefault();if(isNewTOC()){var $target=$(event.target);if(!hasTOC($target)){renderTOC($target);}
showHideTOC($target);}});$(window).on('EditPageAfterRenderPreview',function(){containerHasTOC={};if(isNewTOC()&&window.wgUserName!==null){initTOC();}});if(isNewTOC()&&window.wgUserName!==null&&$.cookie('mw_hidetoc')===null){initTOC();}});});;


(function(window,document){'use strict';var _kiq=[],createCookie,setABTestProperties;createCookie=function(cookieName){var cookieValue=cookieName+'=true;path=/;domain=',hostName=window.location.host,devDomainIndex=hostName.indexOf('wikia-dev');if(devDomainIndex>-1){cookieValue+='.'+hostName.substr(devDomainIndex);}else{cookieValue+='.wikia.com';}
document.cookie=cookieValue;};setABTestProperties=function(){var ABTestPrefix='ABTest_',ABTestProperties={},isAnyABTestActive=false;Wikia.AbTest.getExperiments().forEach(function(experiment){if(experiment.group){ABTestProperties[ABTestPrefix+experiment.name]=experiment.group.name;isAnyABTestActive=true;}});if(isAnyABTestActive){_kiq.push(['set',ABTestProperties]);}};function loadQualaroo(){setTimeout(function(){var d=document,f=d.getElementsByTagName('script')[0],s=d.createElement('script');s.type='text/javascript';s.async=true;s.src=window.wgQualarooUrl;f.parentNode.insertBefore(s,f);},1);}
function setAdBlockEnabledAndLoadQualaroo(enabled){_kiq.push(['set',{'adBlockEnabled':enabled}]);loadQualaroo();}
if(window.wgUser){_kiq.push(['identify',window.wgUser]);}
var dartGnreValues=window.dartGnreValues||[];_kiq.push(['set',{'userLanguage':window.wgUserLanguage,'contentLanguage':window.wgContentLanguage,'pageType':window.wikiaPageType,'isCorporatePage':(window.wikiaPageIsCorporate?'Yes':'No'),'verticalName':window.verticalName,'fullVerticalName':window.fullVerticalName,'visitorType':window.visitorType,'isPowerUserAdmin':!!window.wikiaIsPowerUserAdmin,'isPowerUserFrequent':!!window.wikiaIsPowerUserFrequent,'isPowerUserLifetime':!!window.wikiaIsPowerUserLifetime,'isLoggedIn':!!window.wgUserName,'cpBenefitsModalShown':document.cookie.indexOf('cpBenefitsModalShown')>-1,'isContributor':window.isContributor,'isCurrentWikiAdmin':window.isCurrentWikiAdmin,'isDartGnreAdventure':dartGnreValues.indexOf('adventure')>-1,'isDartGnreAction':dartGnreValues.indexOf('action')>-1,'isDartGnreFantasy':dartGnreValues.indexOf('fantasy')>-1,'isDartGnreRpg':dartGnreValues.indexOf('rpg')>-1,'isDartGnreScifi':dartGnreValues.indexOf('scifi')>-1,'isDartGnreOpenworld':dartGnreValues.indexOf('openworld')>-1,'isDartGnreFighting':dartGnreValues.indexOf('fighting')>-1,'isDartGnreDrama':dartGnreValues.indexOf('drama')>-1,'isDartGnreCasual':dartGnreValues.indexOf('casual')>-1,'isDartGnreAnime':dartGnreValues.indexOf('anime')>-1,'isDartGnreShooter':dartGnreValues.indexOf('shooter')>-1,'isDartGnreCartoon':dartGnreValues.indexOf('cartoon')>-1,'isDartGnreComedy':dartGnreValues.indexOf('comedy')>-1,'isDartGnre3rdpersonshooter':dartGnreValues.indexOf('3rdpersonshooter')>-1,'isDartGnreFps':dartGnreValues.indexOf('fps')>-1,'isDartGnreHorror':dartGnreValues.indexOf('horror')>-1,'isDartGnreDriving':dartGnreValues.indexOf('driving')>-1,'isDartGnreSports':dartGnreValues.indexOf('sports')>-1}]);$('body').on('mousedown','form[id*="ki-"] > div[class*="ki-"]',function(){window._gaq.push(['_setSampleRate','100']);createCookie('qualaroo_survey_submission');});if(window.ads.context.opts.sourcePointDetection){if(!window.ads.runtime||!window.ads.runtime.sp||window.ads.runtime.sp.blocking===undefined){document.addEventListener('sp.blocking',function(){setAdBlockEnabledAndLoadQualaroo(true);});document.addEventListener('sp.not_blocking',function(){setAdBlockEnabledAndLoadQualaroo(false);});}else{setAdBlockEnabledAndLoadQualaroo(window.ads.runtime.sp.blocking);}}else{loadQualaroo();}
setABTestProperties();window._kiq=_kiq;})(window,document);;


(function(context){'use strict';var sloth=function(){var slice=Array.prototype.slice,wTop,wBottom,undef,debounce=(function(element){return element?parseInt(element.getAttribute('data-sloth-debounce'),10):200;})(context.document.querySelector('script[data-sloth-debounce]')),delegate=context.setTimeout,branches=[],Branch=function(element,threshold,callback){this.elem=element;this.threshold=threshold;this.callback=function(){callback(element);};},addEvent=function(){context.addEventListener('scroll',execute);},removeEvent=function(){context.removeEventListener('scroll',execute);},lock=0,execute=function(force){var i=branches.length,branch;if(debounce){removeEvent();}
if(i&&(force||!lock)){if(debounce){lock=delegate(function(){lock=0;addEvent();},debounce);}
wTop=context.scrollY||context.pageYOffset;wBottom=wTop+context.innerHeight;while(i--){branch=branches[i];if(branch.isVisible()){delegate(branch.callback,0);branches.splice(i,1);}}}};Branch.prototype.isVisible=function(){var elem=this.elem,mayBeVisible=elem.offsetHeight||elem.offsetWidth,height,threshold,top,bottom;if(mayBeVisible){threshold=this.threshold;height=elem.offsetHeight;top=(elem.offsetTop||elem.y||0)-threshold;bottom=top+height+threshold;return wBottom>=top&&wTop<=bottom;}
return false;};Branch.prototype.compare=function(element){return this.elem===element;};return function(params){if(params){var elements=params.on,prune=params.off,threshold=params.threshold!==undef?params.threshold:100,callback=params.callback,i;if(elements&&callback){if(elements.length!==undef){elements=slice.call(elements);i=elements.length;while(i--){branches.push(new Branch(elements[i],threshold,callback));}}else{branches.push(new Branch(elements,threshold,callback));}}
if(prune){if(prune.length!==undef){prune=slice.call(prune);i=prune.length;while(i--){branches=branches.filter(function(branch){return!branch.compare(prune[i]);});}}else{branches=branches.filter(function(branch){return!branch.compare(prune);});}}}
execute(true);};};if(context.define&&context.define.amd){context.define('sloth',sloth);}else{context.sloth=sloth();}})(this);;var Mustache=(typeof module!=="undefined"&&module.exports)||{};(function(exports){exports.name="mustache.js";exports.version="0.5.0-dev";exports.tags=["{{","}}"];exports.parse=parse;exports.compile=compile;exports.render=render;exports.clearCache=clearCache;exports.to_html=function(template,view,partials,send){var result=render(template,view,partials);if(typeof send==="function"){send(result);}else{return result;}};var _toString=Object.prototype.toString;var _isArray=Array.isArray;var _forEach=Array.prototype.forEach;var _trim=String.prototype.trim;var isArray;if(_isArray){isArray=_isArray;}else{isArray=function(obj){return _toString.call(obj)==="[object Array]";};}
var forEach;if(_forEach){forEach=function(obj,callback,scope){return _forEach.call(obj,callback,scope);};}else{forEach=function(obj,callback,scope){for(var i=0,len=obj.length;i<len;++i){callback.call(scope,obj[i],i,obj);}};}
var spaceRe=/^\s*$/;function isWhitespace(string){return spaceRe.test(string);}
var trim;if(_trim){trim=function(string){return string==null?"":_trim.call(string);};}else{var trimLeft,trimRight;if(isWhitespace("\xA0")){trimLeft=/^\s+/;trimRight=/\s+$/;}else{trimLeft=/^[\s\xA0]+/;trimRight=/[\s\xA0]+$/;}
trim=function(string){return string==null?"":String(string).replace(trimLeft,"").replace(trimRight,"");};}
var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':'&quot;',"'":'&#39;'};function escapeHTML(string){return String(string).replace(/&(?!\w+;)|[<>"']/g,function(s){return escapeMap[s]||s;});}
function debug(e,template,line,file){file=file||"<template>";var lines=template.split("\n"),start=Math.max(line-3,0),end=Math.min(lines.length,line+3),context=lines.slice(start,end);var c;for(var i=0,len=context.length;i<len;++i){c=i+start+1;context[i]=(c===line?" >> ":"    ")+context[i];}
e.template=template;e.line=line;e.file=file;e.message=[file+":"+line,context.join("\n"),"",e.message].join("\n");return e;}
function lookup(name,stack,defaultValue){if(name==="."){return stack[stack.length-1];}
var names=name.split(".");var lastIndex=names.length-1;var target=names[lastIndex];var value,context,i=stack.length,j,localStack;while(i){localStack=stack.slice(0);context=stack[--i];j=0;while(j<lastIndex){context=context[names[j++]];if(context==null){break;}
localStack.push(context);}
if(context&&typeof context==="object"&&target in context){value=context[target];break;}}
if(typeof value==="function"){value=value.call(localStack[localStack.length-1]);}
if(value==null){return defaultValue;}
return value;}
function renderSection(name,stack,callback,inverted){var buffer="";var value=lookup(name,stack);if(inverted){if(value==null||value===false||(isArray(value)&&value.length===0)){buffer+=callback();}}else if(isArray(value)){forEach(value,function(value){stack.push(value);buffer+=callback();stack.pop();});}else if(typeof value==="object"){stack.push(value);buffer+=callback();stack.pop();}else if(typeof value==="function"){var scope=stack[stack.length-1];var scopedRender=function(template){return render(template,scope);};buffer+=value.call(scope,callback(),scopedRender)||"";}else if(value){buffer+=callback();}
return buffer;}
function parse(template,options){options=options||{};var tags=options.tags||exports.tags,openTag=tags[0],closeTag=tags[tags.length-1];var code=['var buffer = "";',"\nvar line = 1;","\ntry {",'\nbuffer += "'];var spaces=[],hasTag=false,nonSpace=false;var stripSpace=function(){if(hasTag&&!nonSpace&&!options.space){while(spaces.length){code.splice(spaces.pop(),1);}}else{spaces=[];}
hasTag=false;nonSpace=false;};var sectionStack=[],updateLine,nextOpenTag,nextCloseTag;var setTags=function(source){tags=trim(source).split(/\s+/);nextOpenTag=tags[0];nextCloseTag=tags[tags.length-1];};var includePartial=function(source){code.push('";',updateLine,'\nvar partial = partials["'+trim(source)+'"];','\nif (partial) {','\n  buffer += render(partial,stack[stack.length - 1],partials);','\n}','\nbuffer += "');};var openSection=function(source,inverted){var name=trim(source);if(name===""){throw debug(new Error("Section name may not be empty"),template,line,options.file);}
sectionStack.push({name:name,inverted:inverted});code.push('";',updateLine,'\nvar name = "'+name+'";','\nvar callback = (function () {','\n  return function () {','\n    var buffer = "";','\nbuffer += "');};var openInvertedSection=function(source){openSection(source,true);};var closeSection=function(source){var name=trim(source);var openName=sectionStack.length!=0&&sectionStack[sectionStack.length-1].name;if(!openName||name!=openName){throw debug(new Error('Section named "'+name+'" was never opened'),template,line,options.file);}
var section=sectionStack.pop();code.push('";','\n    return buffer;','\n  };','\n})();');if(section.inverted){code.push("\nbuffer += renderSection(name,stack,callback,true);");}else{code.push("\nbuffer += renderSection(name,stack,callback);");}
code.push('\nbuffer += "');};var sendPlain=function(source){code.push('";',updateLine,'\nbuffer += lookup("'+trim(source)+'",stack,"");','\nbuffer += "');};var sendEscaped=function(source){code.push('";',updateLine,'\nbuffer += escapeHTML(lookup("'+trim(source)+'",stack,""));','\nbuffer += "');};var line=1,c,callback;for(var i=0,len=template.length;i<len;++i){if(template.slice(i,i+openTag.length)===openTag){i+=openTag.length;c=template.substr(i,1);updateLine='\nline = '+line+';';nextOpenTag=openTag;nextCloseTag=closeTag;hasTag=true;switch(c){case"!":i++;callback=null;break;case"=":i++;closeTag="="+closeTag;callback=setTags;break;case">":i++;callback=includePartial;break;case"#":i++;callback=openSection;break;case"^":i++;callback=openInvertedSection;break;case"/":i++;callback=closeSection;break;case"{":closeTag="}"+closeTag;case"&":i++;nonSpace=true;callback=sendPlain;break;default:nonSpace=true;callback=sendEscaped;}
var end=template.indexOf(closeTag,i);if(end===-1){throw debug(new Error('Tag "'+openTag+'" was not closed properly'),template,line,options.file);}
var source=template.substring(i,end);if(callback){callback(source);}
var n=0;while(~(n=source.indexOf("\n",n))){line++;n++;}
i=end+closeTag.length-1;openTag=nextOpenTag;closeTag=nextCloseTag;}else{c=template.substr(i,1);switch(c){case'"':case"\\":nonSpace=true;code.push("\\"+c);break;case"\r":break;case"\n":spaces.push(code.length);code.push("\\n");stripSpace();line++;break;default:if(isWhitespace(c)){spaces.push(code.length);}else{nonSpace=true;}
code.push(c);}}}
if(sectionStack.length!=0){throw debug(new Error('Section "'+sectionStack[sectionStack.length-1].name+'" was not closed properly'),template,line,options.file);}
stripSpace();code.push('";',"\nreturn buffer;","\n} catch (e) { throw {error: e, line: line}; }");var body=code.join("").replace(/buffer \+= "";\n/g,"");if(options.debug){if(typeof console!="undefined"&&console.log){console.log(body);}else if(typeof print==="function"){print(body);}}
return body;}
function _compile(template,options){var args="view,partials,stack,lookup,escapeHTML,renderSection,render";var body=parse(template,options);var fn=new Function(args,body);return function(view,partials){partials=partials||{};var stack=[view];try{return fn(view,partials,stack,lookup,escapeHTML,renderSection,render);}catch(e){throw debug(e.error,template,e.line,options.file);}};}
var _cache={};function clearCache(){_cache={};}
function compile(template,options){options=options||{};if(options.cache!==false){if(!_cache[template]){_cache[template]=_compile(template,options);}
return _cache[template];}
return _compile(template,options);}
function render(template,view,partials){return compile(template)(view,partials);}})(Mustache);(function(context){context.Mustache=Mustache;if(context.define&&context.define.amd){context.define('wikia.mustache',Mustache);}}(window));;require(['sloth','wikia.window','jquery'],function(sloth,w,$){'use strict';var $placeholder,cacheKey='RelatedPagesAssets',articleId=w.wgArticleId,loaded,shouldLoad;if(w.skin==='oasis'||w.skin==='monobook'){$placeholder=$('#RelatedPagesModuleWrapper');}else{return;}
shouldLoad=$placeholder.length&&articleId;function loadTemplate(){var dfd=new $.Deferred();require(['wikia.loader','wikia.cache'],function(loader,cache){var template=cache.getVersioned(cacheKey);if(template){dfd.resolve(template);}else{loader({type:loader.MULTI,resources:{mustache:'extensions/wikia/RelatedPages/templates/RelatedPages_section.mustache'}}).done(function(data){template=data.mustache[0];dfd.resolve(template);cache.setVersioned(cacheKey,template,604800);});}});return dfd.promise();}
function load(){if(!loaded&&articleId){require(['wikia.mustache','JSMessages','wikia.nirvana','wikia.tracker'],function(mustache,msg,nirvana,tracker){$.when(nirvana.getJson('RelatedPagesApi','getList',{ids:[articleId]}),loadTemplate()).done(function(data,template){var items=data[0]&&data[0].items,pages=items&&items[articleId],page,relatedPages=[];if(pages&&pages.length){while((page=pages.shift())){relatedPages.push({url:page.url,title:page.title,imgUrl:page.imgUrl||null,text:page.imgUrl?undefined:page.text});}
$placeholder.prepend(mustache.render(template,{relatedPagesHeading:msg('wikiarelatedpages-heading'),imgWidth:200,imgHeight:100,pages:relatedPages})).on('mousedown','.RelatedPagesModule a',function(event){if(event.type==='mousedown'&&event.which!==1){return;}
tracker.track({action:tracker.ACTIONS.CLICK,trackingMethod:'analytics',category:'article',label:'related-pages'});}).trigger('afterLoad.relatedPages');}});});loaded=true;}}
if(shouldLoad){sloth({on:$placeholder,threshold:200,callback:load});}});;