(function(window){var AbTest,Wikia=window.Wikia=(window.Wikia||{}),config=Wikia.AbTestConfig||{},logCache={},beacon=window.beacon_id||getCookie('wikia_beacon_id'),serverTimeString=window.varnishTime,serverDate=serverTimeString?new Date(serverTimeString):new Date(),serverTime=serverDate.getTime()/1000;var log=(function(console){return(console&&console.log)?function(methodName,message){if(!message){message=methodName;methodName=undefined;}
if(!logCache[message]){logCache[message]=true;console.log('Wikia.AbTest'+(methodName?'.'+methodName+'()':'')+':',message);}}:function(){};})(window.console);AbTest=function(expName){this.expName=expName;};AbTest.uuid=(function(uuid){var ret=uuid&&uuid!='ThisIsFake'?uuid:null;if(!ret){log('init','UUID is not available, A/B testing will be disabled');}
return ret;})(beacon);AbTest.isExperimentActive=function(expName){return expName in AbTest.experiments;};AbTest.getGroup=function(expName){var exp=getExperiment(expName,'getGroup'),group=exp&&exp.group;return group&&group.name;};AbTest.inGroup=function(expName,groupName){return AbTest.getGroup(expName)===groupName;};AbTest.isValidGroup=function(expName,groupName){var exp=getExperiment(expName,'isValidGroup'),current=exp&&exp.current;return!!(current&&current.groups[groupName]);};AbTest.getGASlot=function(expName){var exp=getExperiment(expName,'getGASlot'),current=exp&&exp.current,gaSlot=current&&current.gaSlot;return parseInt(gaSlot,10)||undefined;};AbTest.getExperiments=function(includeAll){var expName,exp,group,el,list=[];if(!AbTest.uuid){list.nouuid=true;}
for(expName in AbTest.experiments){exp=AbTest.experiments[expName];group=exp.group;if(!group&&!includeAll){continue;}
el={id:exp.id,name:exp.name,flags:exp.flags};if(group){el.group={id:group.id,name:group.name}}
list.push(el);}
return list;};AbTest.loadExternalData=function(data){var index,groupData,html='';log('init','Received external configuration');for(index in data){groupData=data[index];if(groupData.styles){html+='<style>'+groupData.styles+'</style>';}
if(groupData.scripts){html+='<script>'+groupData.scripts+'</script>';}}
if(html!=''){document.write(html);}};(function(prototype){var i,length,methodNames=['inGroup','getGroup','getGASlot','getUserSlot'];for(i=0,length=methodNames.length;i<length;i++){(function(methodName){prototype[methodName]=function(){return AbTest[methodName].apply(AbTest,[this.expName].concat(arguments));};})(methodNames[i]);}})(AbTest.prototype);function getExperiment(expName,methodName){if(!expName){log(methodName,'Missing required argument "expName".');}
var exp=AbTest.experiments[expName];if(!exp){log(methodName,'Experiment configuration not found for "'+expName+'."');}
return exp;}
function hash(s){var slot=0,i;for(i=0;i<s.length;i++){slot+=s.charCodeAt(i)*(i+1);}
return Math.abs(slot)%100;}
function getSlot(expName){return AbTest.uuid?hash(AbTest.uuid+expName):-1;}
function setActiveGroup(expName,groupName,force){var exp=getExperiment(expName,'setActiveGroup'),current=exp&&exp.current,group=current&&current.groups[groupName];if(group&&(!exp.group||force)){exp.group=group;return true;}
return false;}
function isInRanges(value,ranges){var i,range;if(!ranges||!ranges.length){return false;}
for(i=0;i<ranges.length;i++){range=ranges[i];if(value>=range.min&&value<=range.max){return true;}}
return false;}
function getCookie(name){if(!name){return null;}
return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(name).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null;}
AbTest.experiments=(function(experiments){var expName,exp,versions,version,i,activeExperiments={},count=0;for(expName in experiments){if(experiments.hasOwnProperty(expName)){exp=experiments[expName];versions=exp.versions;for(i=0;i<versions.length;i++){version=versions[i];if(serverTime>=version.startTime&&serverTime<version.endTime){exp.current=version;exp.flags=version.flags;count++;break;}}
if(exp.current){activeExperiments[expName]=exp;}}}
AbTest.experimentCount=count;return activeExperiments;})(config.experiments||{});(function(experiments){var matches,rTreatmentGroups=/AbTest\.([^=]+)=([^?&]+)/gi,queryString=window.location.search,expName,groupName,exp,slot,externalIds=[];if(queryString){while((matches=rTreatmentGroups.exec(queryString))!=null){expName=matches[1];groupName=matches[2];if(!AbTest.isValidGroup(expName,groupName)){log('init','Invalid experiment/group specified in URL: '+expName+'/'+groupName);continue;}
setActiveGroup(expName,groupName);}}
for(expName in experiments){exp=experiments[expName];slot=getSlot(expName);if(exp.group||!exp.current||slot<0){continue;}
if(exp.flags&&exp.flags.limit_to_special_wikis&&!window.wgIsGASpecialWiki){log('init','Skipping experiment '+expName+' - not a special Wiki');continue;}
for(groupName in exp.current.groups){if(isInRanges(slot,exp.current.groups[groupName].ranges)){setActiveGroup(expName,groupName);}}}
for(expName in experiments){exp=experiments[expName];if(exp.current.external&&exp.group){externalIds.push(exp.name+'.'+exp.current.id+'.'+exp.group.id);}}
if(externalIds.length>0&&!window.Mercury){log('init','Loading external configuration');var url=window.wgCdnApiUrl+'/wikia.php?controller=AbTesting&method=externalData&callback=Wikia.AbTest.loadExternalData&ids=';url+=externalIds.join(',');document.write('<scr'+'ipt src="'+encodeURI(url)+'"></script>');}})(AbTest.experiments);(function(experiments){var expName,exp;for(expName in experiments){exp=experiments[expName];if(Wikia.Tracker&&exp.flags&&exp.flags.dw_tracking&&exp.group){Wikia.Tracker.track({eventName:'ab_treatment',experiment:exp.name,experimentId:exp.id,time:serverTimeString,trackingMethod:'internal',treatmentGroup:exp.group.name,treatmentGroupId:exp.group.id});}}})(AbTest.experiments);Wikia.AbTest=AbTest;})(window);;


(function(context){'use strict';function lazyQueue(){function makeQueue(queue,callback){if(typeof callback!=='function'){throw new Error('LazyQueue used with callback not being a function');}else if(queue instanceof Array){queue.start=function(){while(queue.length>0){callback(queue.shift());}
queue.push=function(item){callback(item);};};return queue;}else{throw new Error('LazyQueue requires an array as the first parameter');}}
return{makeQueue:makeQueue};}
if(!context.Wikia){context.Wikia={};}
context.Wikia.LazyQueue=lazyQueue();if(context.define&&context.define.amd){context.define('wikia.lazyqueue',lazyQueue);}}(this));;


(function(window,undefined){'use strict';if(!window.wgNoExternals){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);})(window,document,'script','//www.google-analytics.com/analytics.js','ga');}else{window.ga=function(){};}
var cookieExists,isProductionEnv,blockingTracked={sourcePoint:false,pageFair:false},GASettings={sourcePoint:{trackName:'sourcePoint',name:'sourcepoint',dimension:6},pageFair:{trackName:'pageFair',dimension:7,name:'pagefair'}},listenerSettings=[{eventName:'sp.blocking',value:true,detectorSettings:GASettings.sourcePoint},{eventName:'sp.not_blocking',value:false,detectorSettings:GASettings.sourcePoint},{eventName:'pf.blocking',value:true,detectorSettings:GASettings.pageFair},{eventName:'pf.not_blocking',value:false,detectorSettings:GASettings.pageFair}];isProductionEnv=!window.wgGaStaging;cookieExists=function(cookieName){return document.cookie.indexOf(cookieName)>-1;};if(isProductionEnv){window.ga('create','UA-32129070-1','auto',{'sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32129070-2','auto',{'sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
if(window.wgIsGASpecialWiki){if(isProductionEnv){window.ga('create','UA-32132943-1','auto',{'name':'special','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32132943-2','auto',{'name':'special','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
window.ga('special.require','displayfeatures');}
if(window.wgGAUserIdHash){if(isProductionEnv){window.ga('create','UA-32132943-7','auto',{'name':'loggedin_users','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32132943-8','auto',{'name':'loggedin_users','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});window.ga('loggedin_users.require','displayfeatures');}}
if(isProductionEnv){window.ga('create','UA-32132943-4','auto',{'name':'ve','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});window.ga('ve.require','displayfeatures');}
window.ga('require','displayfeatures');function _gaWikiaPush(commands){var i,spec,args=Array.prototype.slice.call(arguments);for(i=0;i<args.length;i++){if(typeof args[i]==='function'){window.ga(args[i]);continue;}else if(args[i][0]==='send'&&args[i].length===7){args[i][6]={'nonInteraction':args[i][6]};}
window.ga.apply(window,args[i]);if(args[i][0].indexOf('.')===-1){if(window.wgIsGASpecialWiki){spec=args[i].slice();spec[0]='special.'+spec[0];window.ga.apply(window,spec);}
if(window.wgGAUserIdHash){spec=args[i].slice();spec[0]='loggedin_users.'+spec[0];window.ga.apply(window,spec);}
if(args[i][1]&&args[i][1]==='editor-ve'){spec=args[i].slice();spec[0]='ve.'+spec[0];window.ga.apply(window,spec);}}}}
function getEsrbRating(){var rating='not set';if(window.ads&&window.ads.context.targeting.esrbRating){rating=window.ads.context.targeting.esrbRating;}
return rating;}
function hasPortableInfobox(){if(window.ads&&window.ads.context.targeting.hasPortableInfobox){return'Yes';}
return'No';}
function getKruxSegment(){var kruxSegment='not set',uniqueKruxSegments={ocry7a4xg:'Game Heroes 2014',ocr1te1tc:'Digital DNA 2014',ocr6m2jd6:'Inquisitive Minds 2014',ocr05ve5z:'Culture Caster 2014',ocr88oqh9:'Social Entertainers 2014'},uniqueKruxSegmentsKeys=Object.keys(uniqueKruxSegments),markedSegments=[],kruxSegments=[];if(window.localStorage){kruxSegments=(window.localStorage.kxsegs||'').split(',');}
if(kruxSegments.length){markedSegments=uniqueKruxSegmentsKeys.filter(function(n){return kruxSegments.indexOf(n)!==-1;});if(markedSegments.length){kruxSegment=uniqueKruxSegments[markedSegments[0]];}}
return kruxSegment;}
function trackBlocking(detectorSettings,isBlocked){var value=isBlocked?'Yes':'No';if(blockingTracked[detectorSettings.trackName]){return;}
blockingTracked[detectorSettings.trackName]=true;_gaWikiaPush(['set','dimension'+detectorSettings.dimension,value]);window.ga('ads.set','dimension'+detectorSettings.dimension,value);guaTrackAdEvent('ad/'+detectorSettings.name+'/detection',value,'',0,true);guaTrackEvent('ads-'+detectorSettings.name+'-detection','impression',value,0,true);}
_gaWikiaPush(['set','dimension1',window.wgDBname],['set','dimension2',window.wgContentLanguage],['set','dimension3',window.cscoreCat],['set','dimension4',window.skin],['set','dimension5',!!window.wgUserName?'user':'anon']);function getUnconfirmedEmailUserType(){if(!window.wgUserName){return'anon';}else{switch(window.wgNotConfirmedEmail){case'1':return'unconfirmed';case'2':return'confirmed';default:return'old user';}}}
_gaWikiaPush(['set','dimension8',window.wikiaPageType],['set','dimension9',window.wgCityId],['set','dimension13',getEsrbRating()],['set','dimension14',window.wgGaHasAds?'Yes':'No'],['set','dimension15',window.wikiaPageIsCorporate?'Yes':'No'],['set','dimension16',getKruxSegment()],['set','dimension17',window.wgWikiVertical],['set','dimension18',window.wgWikiCategories.join(',')],['set','dimension19',window.wgArticleType],['set','dimension20','not set'],['set','dimension21',String(window.wgArticleId)],['set','dimension23',window.wikiaIsPowerUserFrequent?'Yes':'No'],['set','dimension24',window.wikiaIsPowerUserLifetime?'Yes':'No'],['set','dimension25',String(window.wgNamespaceNumber)],['set','dimension26',String(window.wgSeoTestingBucket||0)],['set','dimension27',String(window.wgCanonicalSpecialPageName||'')],['set','dimension28',hasPortableInfobox()]);_gaWikiaPush(['set','dimension39',getUnconfirmedEmailUserType()]);function isOptimizelyLoadedAndActive(){var optimizely=window.optimizely;return optimizely&&optimizely.activeExperiments&&Array.isArray(optimizely.activeExperiments)&&optimizely.activeExperiments.length>0&&typeof optimizely.allExperiments==='object'&&Object.keys(optimizely.allExperiments).length>0&&typeof optimizely.variationNamesMap==='object'&&Object.keys(optimizely.variationNamesMap).length>0;}
if(isOptimizelyLoadedAndActive()){var optimizely=window.optimizely;optimizely.activeExperiments.forEach(function(experimentId){if(optimizely.allExperiments.hasOwnProperty(experimentId)&&typeof optimizely.allExperiments[experimentId].universal_analytics==='object'){var dimension=optimizely.allExperiments[experimentId].universal_analytics.slot,experimentName=optimizely.allExperiments[experimentId].name,variationName=optimizely.variationNamesMap[experimentId];_gaWikiaPush(['set','dimension'+dimension,'Optimizely '+experimentName+' ('+experimentId+'): '+variationName]);}});}
if(window.Wikia&&window.Wikia.AbTest){var abList=window.Wikia.AbTest.getExperiments(true),abExp,abGroupName,abSlot,abIndex,abForceTrackOnLoad=false,abCustomVarsForAds=[];for(abIndex=0;abIndex<abList.length;abIndex++){abExp=abList[abIndex];if(!abExp||!abExp.flags){continue;}
if(!abExp.flags.ga_tracking){continue;}
if(abExp.flags.forced_ga_tracking_on_load&&abExp.group){abForceTrackOnLoad=true;}
abSlot=window.Wikia.AbTest.getGASlot(abExp.name);if(abSlot>=40&&abSlot<=49){abGroupName=abExp.group?abExp.group.name:(abList.nouuid?'NOBEACON':'NOT_IN_ANY_GROUP');_gaWikiaPush(['set','dimension'+abSlot,abGroupName]);abCustomVarsForAds.push(['ads.set','dimension'+abSlot,abGroupName]);}}
if(abForceTrackOnLoad){var abRenderStart=window.wgNow||(new Date()),abOnLoadHandler;abOnLoadHandler=function(){var renderTime=(new Date()).getTime()-abRenderStart.getTime();setTimeout(function(){window.guaTrackEvent('ABtest','ONLOAD','TIME',renderTime);},10);};if(window.attachEvent){window.attachEvent('onload',abOnLoadHandler);}else if(window.addEventListener){window.addEventListener('load',abOnLoadHandler,false);}}}
_gaWikiaPush(['send','pageview']);if(window.ads&&window.ads.context.opts.showAds){listenerSettings.map(function(listenerSetting){document.addEventListener(listenerSetting.eventName,function(){trackBlocking(listenerSetting.detectorSettings,listenerSetting.value);});});}
if(isProductionEnv){window.ga('create','UA-32129071-1','auto',{'name':'ads','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}else{window.ga('create','UA-32129071-2','auto',{'name':'ads','sampleRate':100,'allowLinker':true,'userId':window.wgGAUserIdHash});}
window.ga('ads.require','displayfeatures');window.ga('ads.set','dimension1',window.wgDBname);window.ga('ads.set','dimension2',window.wgContentLanguage);window.ga('ads.set','dimension3',window.cscoreCat);window.ga('ads.set','dimension4',window.skin);window.ga('ads.set','dimension5',!!window.wgUserName?'user':'anon');window.ga('ads.set','dimension8',window.wikiaPageType);window.ga('ads.set','dimension9',window.wgCityId);window.ga('ads.set','dimension13',getEsrbRating());window.ga('ads.set','dimension14',window.wgGaHasAds?'Yes':'No');window.ga('ads.set','dimension15',window.wikiaPageIsCorporate?'Yes':'No');window.ga('ads.set','dimension16',getKruxSegment());window.ga('ads.set','dimension17',window.wgWikiVertical);window.ga('ads.set','dimension18',window.wgWikiCategories.join(','));window.ga('ads.set','dimension19',window.wgArticleType);window.ga('ads.set','dimension20','not set');window.ga('ads.set','dimension21',String(window.wgArticleId));window.ga('ads.set','dimension23',window.wikiaIsPowerUserFrequent?'Yes':'No');window.ga('ads.set','dimension24',window.wikiaIsPowerUserLifetime?'Yes':'No');window.ga('ads.set','dimension25',String(window.wgNamespaceNumber));window.ga('ads.set','dimension26',String(window.wgSeoTestingBucket||0));window.ga('ads.set','dimension27',String(window.wgCanonicalSpecialPageName||''));window.ga('ads.set','dimension28',hasPortableInfobox());if(window.Wikia&&window.Wikia.AbTest){var i;for(i=0;i<abCustomVarsForAds.length;i++){window.ga.apply(window,abCustomVarsForAds[i]);}}
window.guaTrackAdEvent=function(category,action,opt_label,opt_value,opt_noninteractive){var args,adHitSample=1;if(Math.random()*100<=adHitSample){args=Array.prototype.slice.call(arguments);if(args.length===5){args[4]={'nonInteraction':args[4]};}
args.unshift('ads.send','event');try{window.ga.apply(window,args);}catch(e){}}};window.guaTrackEvent=function(category,action,opt_label,opt_value,opt_noninteractive){var args=Array.prototype.slice.call(arguments);args.unshift('send','event');try{_gaWikiaPush(args);}catch(e){}};window.guaTrackPageview=function(fakePage,opt_namespace){var nsPrefix=(opt_namespace)?opt_namespace+'.':'';_gaWikiaPush([nsPrefix+'send','pageview',fakePage]);};}(window));;


define('ext.wikia.adEngine.adLogicPageParams',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageViewCounter','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.document','wikia.geo','wikia.location','wikia.log','wikia.window',require.optional('wikia.abTest'),require.optional('wikia.krux')],function(adContext,pvCounter,zoneParams,doc,geo,loc,log,win,abTest,krux){'use strict';var context={},logGroup='ext.wikia.adEngine.adLogicPageParams',runtimeParams={},skin=adContext.getContext().targeting.skin;function updateContext(){context=adContext.getContext();}
function getAb(){var experiments,experimentsNumber,i,ab=[];if(abTest){experiments=abTest.getExperiments();experimentsNumber=experiments.length;for(i=0;i<experimentsNumber;i+=1){ab.push(experiments[i].id+'_'+experiments[i].group.id);}}
return ab;}
function extend(target,obj){var key;for(key in obj){if(obj.hasOwnProperty(key)){target[key]=obj[key];}}
return target;}
function addParam(key,value){runtimeParams[key]=value;}
function decodeLegacyDartParams(dartString){var params={},kvs,kv,key,value,i,len;log(['decodeLegacyDartParams',dartString],9,logGroup);if(typeof dartString==='string'){kvs=dartString.split(';');for(i=0,len=kvs.length;i<len;i+=1){kv=kvs[i].split('=');key=kv[0];value=kv[1];if(key&&value&&key!=='esrb'){params[key]=params[key]||[];params[key].push(value);}}}
return params;}
function getRefParam(){var hostnameMatch,ref=doc.referrer,refHostname,searchDomains=/(google|search\.yahooo|bing|baidu|ask|yandex)/,wikiDomains=['wikia.com','ffxiclopedia.org','jedipedia.de','memory-alpha.org','uncyclopedia.org','websitewiki.de','wowwiki.com','yoyowiki.org'],wikiDomainsRegex=new RegExp('(^|\\.)('+wikiDomains.join('|').replace(/\./g,'\\.')+')$');if(!ref||typeof ref!=='string'){return'direct';}
refHostname=ref.match(/\/\/([^\/]+)\//);if(refHostname){refHostname=refHostname[1];}
hostnameMatch=refHostname===loc.hostname;if(hostnameMatch&&ref.indexOf('search=')>-1){return'wiki_search';}
if(hostnameMatch){return'wiki';}
hostnameMatch=wikiDomainsRegex.test(refHostname);if(hostnameMatch&&ref.indexOf('search=')>-1){return'wikia_search';}
if(hostnameMatch){return'wikia';}
if(searchDomains.test(refHostname)){return'external_search';}
return'external';}
function getAspectRatio(){return win.innerWidth>win.innerHeight?'4:3':'3:4';}
function getPageLevelParams(options){log('getPageLevelParams',9,logGroup);var params,targeting=context.targeting,pvs=pvCounter.get();options=options||{};params={s0:zoneParams.getSite(),s0v:zoneParams.getVertical(),s0c:zoneParams.getWikiCategories(),s1:zoneParams.getName(),s2:zoneParams.getPageType(),ab:getAb(),ar:getAspectRatio(),artid:targeting.pageArticleId&&targeting.pageArticleId.toString(),cat:zoneParams.getPageCategories(),dmn:zoneParams.getDomain(),hostpre:zoneParams.getHostnamePrefix(),skin:targeting.skin,lang:zoneParams.getLanguage(),wpage:targeting.pageName&&targeting.pageName.toLowerCase(),ref:getRefParam(),esrb:targeting.esrbRating,geo:geo.getCountryCode()||'none'};if(pvs){params.pv=pvs.toString();}
if(options.includeRawDbName){params.rawDbName=zoneParams.getRawDbName();}
if(krux&&targeting.enableKruxTargeting){params.u=krux.getUser();params.ksgmnt=krux.getSegments();}
if(targeting.wikiIsTop1000){params.top='1k';}
extend(params,decodeLegacyDartParams(targeting.wikiCustomKeyValues));extend(params,runtimeParams);log(params,9,logGroup);return params;}
if(skin&&skin!=='mercury'){pvCounter.increment();}
updateContext();adContext.addCallback(updateContext);return{add:addParam,getPageLevelParams:getPageLevelParams};});;define('ext.wikia.adEngine.adLogicPageViewCounter',['wikia.cache','wikia.window'],function(cache,window){'use strict';var cacheKey='adEngine_pageViewCounter',cacheTtl=24*3600*1000,now=window.wgNow||new Date(),initialValue={since:now.getTime(),pvs:0};function isValidValue(val){if(!val||isNaN(val.since)||isNaN(val.pvs)){return false;}
var pvs=val.pvs,age=now.getTime()-val.since;if(pvs<0||age<0||age>cacheTtl){return false;}
return true;}
function get(){var val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
return val.pvs;}
function increment(){var val,age,ttlLeft;val=cache.get(cacheKey,now);if(!isValidValue(val)){val=initialValue;}
age=now.getTime()-val.since;ttlLeft=cacheTtl-age;val.pvs+=1;cache.set(cacheKey,val,ttlLeft,now);}
return{get:get,increment:increment};});;define('ext.wikia.adEngine.adTracker',['ext.wikia.adEngine.utils.timeBuckets','wikia.tracker','wikia.window','wikia.log'],function(timeBuckets,tracker,win,log){'use strict';var buckets=[0.0,0.5,1.0,1.5,2.0,2.5,3.5,5.0,8.0,20.0,60.0],logGroup='ext.wikia.adEngine.adTracker';function encodeAsQueryString(extraParams){var out=[],key,keys=[],i,len;if(win.ads&&win.ads.runtime.sp&&typeof win.ads.runtime.sp.blocking==='boolean'){extraParams.sp=win.ads.runtime.sp.blocking?'yes':'no';}
if(win.ads&&win.ads.runtime.pf&&typeof win.ads.runtime.pf.blocking==='boolean'){extraParams.pf=win.ads.runtime.pf.blocking?'yes':'no';}
for(key in extraParams){if(extraParams.hasOwnProperty(key)){keys.push(key);}}
keys.sort();for(i=0,len=keys.length;i<len;i+=1){key=keys[i];out.push(key+'='+extraParams[key]);}
return out.join(';');}
function track(eventName,data,value,forcedLabel){var category='ad/'+eventName,action=typeof data==='string'?data:encodeAsQueryString(data||{}),gaLabel=forcedLabel,gaValue,trackValue;if(!gaLabel){if(value===undefined){gaLabel='';value=0;}else{gaLabel=timeBuckets.getTimeBucket(buckets,value/1000);if(/\+$|invalid/.test(gaLabel)){category=category.replace('ad','ad/error');}}}
gaValue=Math.round(value);action=action||'nodata';trackValue={ga_category:category,ga_action:action,ga_label:gaLabel,ga_value:isNaN(gaValue)?0:gaValue,trackingMethod:'ad'};tracker.track(trackValue);log(trackValue,'debug',logGroup);}
function trackDW(data,eventName){var trackValue={eventName:eventName,trackingMethod:'internal'};if(typeof data==='string'){trackValue.ping=data;}else{Object.keys(data).forEach(function(key){trackValue[key]=data[key];});}
tracker.track(trackValue);log(['trackDW',trackValue],'debug',logGroup);}
function measureTime(eventName,eventData,eventType){var timingValue=win.wgNow&&new Date().getTime()-win.wgNow.getTime();eventType=eventType?'/'+eventType:'';return{measureDiff:function(diffData,diffType){eventType='/'+diffType;eventData=diffData;timingValue=win.wgNow&&new Date().getTime()-win.wgNow.getTime()-timingValue;return{track:this.track};},track:function(){if(timingValue){track('timing/'+eventName+eventType,eventData,timingValue);}}};}
return{track:track,trackDW:trackDW,measureTime:measureTime};});;define('ext.wikia.adEngine.utils.sampler',['wikia.querystring'],function(QueryString){'use strict';var qs=new QueryString(),queryStringParam='ignored_samplers';function samplerIsIgnored(name){var ignored=qs.getVal(queryStringParam,'').split(',');return ignored.indexOf(name)>-1;}
function sample(name,partToSample,all){return samplerIsIgnored(name)?true:getRandomInt(0,all)<partToSample;}
function getRandomInt(min,max){return Math.floor(Math.random()*(max-min))+min;}
return{sample:sample};});;define('ext.wikia.adEngine.utils.timeBuckets',function(){function getTimeBucket(timeBuckets,time){var i,len=timeBuckets.length,bucket;for(i=0;i<len;i+=1){if(time>=timeBuckets[i]){bucket=i;}}
if(bucket===len-1){return timeBuckets[bucket]+'+';}
if(bucket>=0){return timeBuckets[bucket]+'-'+timeBuckets[bucket+1];}
return'invalid';}
return{getTimeBucket:getTimeBucket}});;define('ext.wikia.adEngine.adContext',['wikia.abTest','wikia.cookies','wikia.document','wikia.geo','wikia.instantGlobals','ext.wikia.adEngine.utils.sampler','wikia.window','wikia.querystring'],function(abTest,cookies,doc,geo,instantGlobals,sampler,w,Querystring){'use strict';instantGlobals=instantGlobals||{};var context,callbacks=[],qs=new Querystring();function getContext(){return context;}
function getMercuryCategories(){if(!context.targeting.mercuryPageCategories){return;}
return context.targeting.mercuryPageCategories.map(function(item){return item.title;});}
function isUrlParamSet(param){return!!parseInt(qs.getVal(param,'0'),10);}
function isPageType(pageType){return context.targeting.pageType===pageType;}
function isPageFairDetectionEnabled(){var isSupportedGeo=geo.isProperGeo(instantGlobals.wgAdDriverPageFairDetectionCountries);return isUrlParamSet('pagefairdetection')||(isSupportedGeo&&sampler.sample('pageFairDetection',1,10));}
function isSourcePointDetectionDesktopEnabled(context){return context.opts.sourcePointDetectionUrl&&context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionCountries);}
function isSourcePointDetectionMobileEnabled(context){return context.opts.sourcePointDetectionUrl&&context.targeting.skin==='mercury'&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointDetectionMobileCountries);}
function updateDetectionServicesAdContext(context,noExternals){context.opts.sourcePointDetection=!noExternals&&isSourcePointDetectionDesktopEnabled(context);context.opts.sourcePointDetectionMobile=!noExternals&&isSourcePointDetectionMobileEnabled(context);context.opts.pageFairDetection=!noExternals&&isPageFairDetectionEnabled();}
function updateAdContextRecoveryServices(context,noExternals){var isRecoveryServiceAlreadyEnabled=false,serviceCanBeEnabled=!noExternals&&context.opts.showAds!==false;context.opts.pageFairRecovery=serviceCanBeEnabled&&!isRecoveryServiceAlreadyEnabled&&context.opts.pageFairRecovery&&geo.isProperGeo(instantGlobals.wgAdDriverPageFairRecoveryCountries);isRecoveryServiceAlreadyEnabled|=context.opts.pageFairRecovery;context.opts.sourcePointRecovery=serviceCanBeEnabled&&!isRecoveryServiceAlreadyEnabled&&context.opts.sourcePointRecovery&&geo.isProperGeo(instantGlobals.wgAdDriverSourcePointRecoveryCountries);isRecoveryServiceAlreadyEnabled|=context.opts.sourcePointRecovery;context.opts.sourcePointMMS=serviceCanBeEnabled&&!isRecoveryServiceAlreadyEnabled&&context.opts.sourcePointMMS;context.opts.sourcePointBootstrap=context.opts.sourcePointMMS||context.opts.sourcePointRecovery;}
function enableAdMixExperiment(context){var group=abTest.getGroup('AD_MIX')||'';context.opts.adMixExperimentEnabled=!!(group.indexOf('AD_MIX_')===0&&isPageType('article')&&context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverAdMixCountries));context.opts.adMix1Enabled=context.opts.adMixExperimentEnabled&&abTest.getGroup('AD_MIX').indexOf('AD_MIX_1')===0;context.opts.adMix3Enabled=context.opts.adMixExperimentEnabled&&abTest.getGroup('AD_MIX').indexOf('AD_MIX_3')===0;context.slots.adMixToUnblock=['INCONTENT_BOXAD_1'];if(context.opts.adMix3Enabled){context.slots.adMixToUnblock.push('BOTTOM_LEADERBOARD');}}
function referrerIsSonySite(){return doc&&doc.referrer&&doc.referrer.match(/info\.tvsideview\.sony\.net/);}
function setContext(newContext){var i,len,noExternals=w.wgNoExternals||isUrlParamSet('noexternals');context=newContext;context.opts=context.opts||{};context.slots=context.slots||{};context.targeting=context.targeting||{};context.providers=context.providers||{};context.forcedProvider=qs.getVal('forcead',null)||context.forcedProvider||null;context.opts.noExternals=noExternals;if(referrerIsSonySite()){context.opts.showAds=false;}
if(geo.isProperGeo(instantGlobals.wgAdDriverDelayCountries)){context.opts.delayEngine=true;}
context.opts.premiumOnly=context.targeting.hasFeaturedVideo&&geo.isProperGeo(instantGlobals.wgAdDriverSrcPremiumCountries);updateDetectionServicesAdContext(context,noExternals);updateAdContextRecoveryServices(context,noExternals);if(cookies.get('mock-ads')==='NlfdjR5xC0'){context.opts.showcase=true;}
if(context.targeting.enablePageCategories){context.targeting.pageCategories=w.wgCategories||getMercuryCategories();}
if(context.providers.evolve2){context.providers.evolve2=geo.isProperGeo(instantGlobals.wgAdDriverEvolve2Countries);}
if(geo.isProperGeo(instantGlobals.wgAdDriverTurtleCountries)){context.providers.turtle=true;}
if(context.providers.rubiconFastlane){context.providers.rubiconFastlane=geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneCountries)&&geo.isProperGeo(instantGlobals.wgAdDriverRubiconFastlaneProviderCountries);}
context.opts.enableRemnantNewAdUnit=geo.isProperGeo(instantGlobals.wgAdDriverMEGACountries);context.opts.enableKILOAdUnit=geo.isProperGeo(instantGlobals.wgAdDriverKILOCountries);context.slots.invisibleHighImpact=(context.slots.invisibleHighImpact&&geo.isProperGeo(instantGlobals.wgAdDriverHighImpactSlotCountries))||isUrlParamSet('highimpactslot');context.opts.enableAdInfoLog=geo.isProperGeo(instantGlobals.wgAdDriverKikimoraTrackingCountries);context.opts.playerTracking=geo.isProperGeo(instantGlobals.wgAdDriverKikimoraPlayerTrackingCountries);context.targeting.enableKruxTargeting=!!(context.targeting.enableKruxTargeting&&geo.isProperGeo(instantGlobals.wgAdDriverKruxCountries)&&!instantGlobals.wgSitewideDisableKrux);context.opts.floatingMedrec=!!(context.opts.showAds&&context.opts.adsInContent&&(isPageType('article')||isPageType('search'))&&!context.targeting.wikiIsCorporate);context.opts.overridePrefootersSizes=!!(context.targeting.skin==='oasis'&&geo.isProperGeo(instantGlobals.wgAdDriverOverridePrefootersCountries)&&!isPageType('home'));enableAdMixExperiment(context);context.opts.openXRemnantEnabled=geo.isProperGeo(instantGlobals.wgAdDriverOpenXBidderCountriesRemnant);if(w.ads&&w.ads.context){w.ads.context=context;}
for(i=0,len=callbacks.length;i<len;i+=1){callbacks[i](context);}}
function addCallback(callback){callbacks.push(callback);}
setContext(w.ads?w.ads.context:{});return{addCallback:addCallback,getContext:getContext,setContext:setContext};});;define('ext.wikia.adEngine.context.slotsContext',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.document','wikia.geo','wikia.instantGlobals','wikia.log'],function(adContext,params,doc,geo,instantGlobals,log){'use strict';var logGroup='ext.wikia.adEngine.context.slotsContext',slots={};function setStatus(slotName,status){slots[slotName]=!!status;}
function isInContentApplicable(){var header=doc.querySelectorAll('#mw-content-text > h2')[1];return header&&header.offsetWidth>=header.parentNode.offsetWidth;}
function setupSlots(){var context=adContext.getContext(),isHome=params.getPageType()==='home',isOasis=context.targeting.skin==='oasis';setStatus('PREFOOTER_MIDDLE_BOXAD',isHome);setStatus('TOP_LEADERBOARD',true);setStatus('TOP_RIGHT_BOXAD',true);setStatus('LEFT_SKYSCRAPER_2',!isHome);setStatus('LEFT_SKYSCRAPER_3',!isHome);setStatus('INCONTENT_BOXAD_1',!isHome);setStatus('INVISIBLE_HIGH_IMPACT_2',geo.isProperGeo(instantGlobals.wgAdDriverHighImpact2SlotCountries));setStatus('PREFOOTER_RIGHT_BOXAD',!context.opts.overridePrefootersSizes);setStatus('INCONTENT_PLAYER',!isHome&&isOasis&&isInContentApplicable());log(['Disabled slots:',slots],'info',logGroup);}
function isApplicable(slotName){return slots[slotName]!==false;}
function filterSlotMap(slotMap){var map={};if(!slotMap){return map;}
Object.keys(slotMap).forEach(function(slotName){if(isApplicable(slotName)){map[slotName]=slotMap[slotName];}});return map;}
setupSlots();adContext.addCallback(function(){setupSlots();});return{filterSlotMap:filterSlotMap,isApplicable:isApplicable};});;define('ext.wikia.adEngine.lookup.lookupFactory',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.lazyqueue','wikia.log'],function(adContext,adTracker,adBlockDetection,lazyQueue,log){'use strict';function create(module){var called=false,onResponseCallbacks=[],response=false,timing,context=adContext.getContext();function onResponse(){log('onResponse','debug',module.logGroup);timing.measureDiff({},'end').track();module.calculatePrices();response=true;onResponseCallbacks.start();if(module.name==='prebid'){module.trackAdaptersOnLookupEnd();}else{adTracker.track(module.name+'/lookup_end',module.getPrices(),0,'nodata');}}
function addResponseListener(callback){onResponseCallbacks.push(callback);}
function call(){log('call','debug',module.logGroup);response=false;if(!Object.keys){log(['call','Module is not supported in IE8',module.name],'debug',module.logGroup);return;}
timing=adTracker.measureTime(module.name,{},'start');timing.track();module.call(context.targeting.skin||'mercury',onResponse);called=true;adBlockDetection.addOnBlockingCallback(onResponseCallbacks.start);}
function wasCalled(){log(['wasCalled',called],'debug',module.logGroup);return called;}
function trackState(providerName,slotName,params){log(['trackState',response,providerName,slotName],'debug',module.logGroup);var category,encodedParams,eventName;if(!module.isSlotSupported(slotName)){log(['trackState','Not supported slot',slotName],'debug',module.logGroup);return;}
if(module.name==='prebid'){module.trackAdaptersSlotState(providerName,slotName,params);}else{encodedParams=module.encodeParamsForTracking(params,slotName);eventName=encodedParams?'lookup_success':'lookup_error';category=module.name+'/'+eventName+'/'+providerName;adTracker.track(category,slotName,0,encodedParams||'nodata');}}
function getSlotParams(slotName){log(['getSlotParams',slotName,called,response],'debug',module.logGroup);if(!called||!module.isSlotSupported(slotName)){log(['getSlotParams','Not called or slot is not supported',slotName],'debug',module.logGroup);return{};}
return module.getSlotParams(slotName);}
function getBestSlotPrice(slotName){if(module.getBestSlotPrice){return module.getBestSlotPrice(slotName);}
return{};}
function getName(){return module.name;}
function hasResponse(){log(['hasResponse',response],'debug',module.logGroup);return response;}
function isSlotSupported(slotName){return module.isSlotSupported(slotName);}
lazyQueue.makeQueue(onResponseCallbacks,function(callback){callback();});return{addResponseListener:addResponseListener,call:call,getBestSlotPrice:getBestSlotPrice,getName:getName,getSlotParams:getSlotParams,hasResponse:hasResponse,isSlotSupported:isSlotSupported,trackState:trackState,wasCalled:wasCalled};}
return{create:create};});;define('ext.wikia.adEngine.slot.adSlot',['ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.service.megaAdUnitBuilder','wikia.document','wikia.log','wikia.window',require.optional('ext.wikia.aRecoveryEngine.adBlockDetection')],function(adUnitBuilder,megaAdUnitBuilder,doc,log,win,adBlockDetection){'use strict';var logGroup='ext.wikia.adEngine.slot.adSlot';function create(name,container,callbacks){function registerHook(name){return function(adInfo){if(typeof callbacks[name]==='function'){callbacks[name](adInfo);}};}
return{name:name,container:container,isViewed:false,collapse:registerHook('collapse'),hop:registerHook('hop'),renderEnded:registerHook('renderEnded'),success:registerHook('success'),viewed:registerHook('viewed')};}
function getShortSlotName(slotName){if(megaAdUnitBuilder.isValid(slotName)){return megaAdUnitBuilder.getShortSlotName(slotName);}
return adUnitBuilder.getShortSlotName(slotName);}
function getRecoveredIframe(slotName){var node=doc.querySelector('#'+slotName+' > .provider-container:not(.hidden) > div'),fallbackId=node&&win._sp_.getElementId(node.id),elementById=fallbackId&&doc.getElementById(fallbackId);if(elementById){return elementById.querySelector('div[id*="_container_"] iframe');}}
function getIframe(slotName){var cssSelector='#'+slotName+' > .provider-container:not(.hidden) div[id*="_container_"] > iframe',iframe=doc.querySelector(cssSelector);if(!iframe&&adBlockDetection&&adBlockDetection.isBlocking()){iframe=getRecoveredIframe(slotName);}
log(['getIframe',slotName,iframe&&iframe.id],log.levels.debug,logGroup);return iframe;}
function getRecoveredProviderContainer(providerContainer){var elementId=providerContainer.childNodes.length>0&&providerContainer.childNodes[0].id,recoveredElementId=win._sp_.getElementId(elementId),element=doc.getElementById(recoveredElementId);log(['getRecoveredProviderContainer for container',providerContainer],log.levels.debug,logGroup);log(['getRecoveredProviderContainer recovered element ID',recoveredElementId],log.levels.debug,logGroup);log(['getRecoveredProviderContainer recovered element',element],log.levels.debug,logGroup);if(element&&element.parentNode){log(['getRecoveredProviderContainer recovered provider container',element.parentNode],log.levels.debug,logGroup);return element.parentNode;}
return null;}
function getProviderContainer(slotName){var isRecovering=adBlockDetection.isBlocking(),providerContainer,slotContainer=doc.getElementById(slotName);providerContainer=slotContainer.lastElementChild;if(isRecovering&&providerContainer.hasAttribute('data-sp-clone')){providerContainer=getRecoveredProviderContainer(providerContainer);}
return providerContainer;}
return{create:create,getIframe:getIframe,getProviderContainer:getProviderContainer,getShortSlotName:getShortSlotName};});;define('ext.wikia.adEngine.slot.adUnitBuilder',['ext.wikia.adEngine.adLogicPageParams'],function(page){'use strict';var dfpId='5441';function build(slotName,src){var params=page.getPageLevelParams();if(slotName instanceof Array){slotName=slotName[0];}
return['',dfpId,'wka.'+params.s0,params.s1,'',params.s2,src,slotName].join('/');}
function getShortSlotName(adUnit){return adUnit.replace(/^.*\/([^\/]*)$/,'$1');}
return{build:build,getShortSlotName:getShortSlotName};});;define('ext.wikia.adEngine.slot.service.kiloAdUnitBuilder',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams'],function(adContext,page){'use strict';var dfpId='5441',context;function getContextTargeting(){if(!context){context=adContext.getContext();}
return context.targeting;}
function build(slotName,src){var params=page.getPageLevelParams();if(slotName instanceof Array){slotName=slotName[0];}
var wikiName=getContextTargeting().wikiIsTop1000?params.s1:'_not_a_top1k_wiki';return['',dfpId,'wka.'+params.s0,wikiName,'',params.s2,src,slotName].join('/');}
function getShortSlotName(adUnit){return adUnit.replace(/^.*\/([^\/]*)$/,'$1');}
return{build:build,getShortSlotName:getShortSlotName};});;define('ext.wikia.adEngine.slot.service.megaAdUnitBuilder',['ext.wikia.adEngine.adLogicPageParams','wikia.browserDetect','ext.wikia.adEngine.adContext'],function(page,browserDetect,adContext){'use strict';var dfpId='5441',context;function getContextTargeting(){if(!context){context=adContext.getContext();}
return context.targeting;}
function findSlotGroup(map,slotName){var result=Object.keys(map).filter(function(name){return map[name].indexOf(slotName)!==-1;});return result.length===1?result[0]:null;}
function getGroup(slotName){var map={'LB':['TOP_LEADERBOARD','MOBILE_TOP_LEADERBOARD'],'MR':['TOP_RIGHT_BOXAD'],'SKY':['LEFT_SKYSCRAPER_2','LEFT_SKYSCRAPER_3'],'PF':['PREFOOTER_LEFT_BOXAD','PREFOOTER_MIDDLE_BOXAD','PREFOOTER_RIGHT_BOXAD','MOBILE_PREFOOTER'],'PX':['INVISIBLE_SKIN','INVISIBLE_HIGH_IMPACT_2'],'HiVi':['INCONTENT_BOXAD_1','MOBILE_IN_CONTENT']};return findSlotGroup(map,slotName)||'OTHER';}
function getDevice(params){var result='unknown';if(params.s2==='special'){return'unknown-specialpage';}
if(params.skin==='oasis'){result=browserDetect.isMobile()?'tablet':'desktop';}else if(params.skin==='mercury'||params.skin==='mobile-wiki'){result='smartphone';}
return result;}
function build(slotName,src){var adUnitElements,params=page.getPageLevelParams(),device=getDevice(params),skin=params.skin,pageType=params.s2,provider=src.indexOf('remnant')===-1?'wka1a':'wka2a',wikiName=getContextTargeting().wikiIsTop1000?params.s1:'_not_a_top1k_wiki',vertical=params.s0;adUnitElements=['',dfpId,provider+'.'+getGroup(slotName),slotName.toLowerCase(),device,skin+'-'+pageType,wikiName+'-'+vertical];return adUnitElements.join('/');}
function isValid(adUnit){return adUnit.indexOf('wka1a.')!==-1||adUnit.indexOf('wka2a.')!==-1;}
function getShortSlotName(adUnit){return adUnit.replace(/^.*\/(wka1a|wka2a)\.[\w]+\/([^\/]*)\/.*$/,function(){if(arguments[2]){return arguments[2].toUpperCase();}});}
return{build:build,getShortSlotName:getShortSlotName,isValid:isValid};});;define('ext.wikia.adEngine.slot.slotTargeting',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.math','wikia.abTest','wikia.instantGlobals'],function(adContext,math,abTest,instantGlobals){'use strict';var skins={mercury:'m',oasis:'o'},pageTypes={article:'a',home:'h'},prebidIds={aol:'ao',appnexus:'an',audienceNetwork:'fb',indexExchange:'ie',openx:'ox',veles:'ve',rubicon:'ru',wikia:'wk'},slotSources={gpt:'1',mobile:'1',remnant:'2',mobile_remnant:'2',rec:'r',premium:'p'},wsiSlots={TOP_LEADERBOARD:'l',TOP_RIGHT_BOXAD:'m',INCONTENT_PLAYER:'i',INCONTENT_BOXAD_1:'f',BOTTOM_LEADERBOARD:'b',LEFT_SKYSCRAPER_2:'s',LEFT_SKYSCRAPER_3:'k',PREFOOTER_LEFT_BOXAD:'p',PREFOOTER_RIGHT_BOXAD:'r',MOBILE_TOP_LEADERBOARD:'l',MOBILE_IN_CONTENT:'i',MOBILE_PREFOOTER:'p',MOBILE_BOTTOM_LEADERBOARD:'b'};function valueOrX(map,key){if(!key||!map[key]){return'x';}
return map[key];}
function getWikiaSlotId(slotName,slotSource){var context=adContext.getContext(),skin=valueOrX(skins,context.targeting.skin),slot=valueOrX(wsiSlots,slotName),pageType=valueOrX(pageTypes,context.targeting.pageType),src=valueOrX(slotSources,slotSource);return skin+slot+pageType+src;}
function getPrebidSlotId(slotData){var id='x',bidder,cpm,size,tier;if(slotData.hb_bidder){cpm=parseFloat(slotData.hb_pb);bidder=valueOrX(prebidIds,slotData.hb_bidder);size=slotData.hb_size;tier='t'+math.leftPad(cpm*100,4);id=bidder+size+tier;}
return id+slotData.wsi.substr(0,2);}
function getAbTestId(slotData){var experimentId=instantGlobals.wgAdDriverAbTestIdTargeting,experiments=abTest.getExperiments(),id;experiments.forEach(function(experiment){if(experimentId===experiment.id){id=experiment.id+'_'+experiment.group.id;}});if(id){return id+slotData.wsi;}}
return{getAbTestId:getAbTestId,getPrebidSlotId:getPrebidSlotId,getWikiaSlotId:getWikiaSlotId};});;define('ext.wikia.adEngine.utils.adLogicZoneParams',['ext.wikia.adEngine.adContext','wikia.log','wikia.location'],function(adContext,log,loc){'use strict';var calculated=false,context={},hostname=loc.hostname,logGroup='ext.wikia.adEngine.utils.adLogicZoneParams',maxNumberOfCategories=3,site,zone1,zone2;function updateContext(){context=adContext.getContext();calculated=false;}
function getDomain(){var lhost,pieces,sld='',np;lhost=hostname.toLowerCase();pieces=lhost.split('.');np=pieces.length;if(pieces[np-2]==='co'){sld=pieces[np-3]+'.'+pieces[np-2]+'.'+pieces[np-1];}else{sld=pieces[np-2]+'.'+pieces[np-1];}
return sld.replace(/\./g,'');}
function getHostnamePrefix(){var lhost=hostname.toLowerCase(),pieces=lhost.split('.');if(pieces.length){return pieces[0];}}
function getVerticalName(targeting){if(getHostnamePrefix()==='showcase'||context.opts.showcase===true){return'showcase';}
return targeting.mappedVerticalName;}
function getRawDbName(){return'_'+(context.targeting.wikiDbName||'wikia').replace('/[^0-9A-Z_a-z]/','_');}
function calculateParams(){log('calculateParams','info',logGroup);var mappedVertical=getVerticalName(context.targeting);if(context.targeting.pageIsHub){site='hub';zone1='_'+mappedVertical+'_hub';zone2='hub';}else{site=mappedVertical;zone1=getRawDbName();zone2=context.targeting.pageType||'article';}
calculated=true;log(['calculateParams',site,zone1,zone2],'info',logGroup);}
function getSite(){if(!calculated){calculateParams();}
return site;}
function getName(){if(!calculated){calculateParams();}
return zone1;}
function getPageType(){if(!calculated){calculateParams();}
return zone2;}
function getVertical(){return context.targeting.wikiVertical;}
function getPageCategories(){var categories=context.targeting.pageCategories,outCategories;if(categories instanceof Array&&categories.length>0){outCategories=categories.slice(0,maxNumberOfCategories);return outCategories.join('|').toLowerCase().replace(/ /g,'_').split('|');}}
function getLanguage(){return context.targeting.wikiLanguage||'unknown';}
function getWikiCategories(){return context.targeting.newWikiCategories;}
updateContext();adContext.addCallback(updateContext);return{getDomain:getDomain,getHostnamePrefix:getHostnamePrefix,getSite:getSite,getName:getName,getPageType:getPageType,getVertical:getVertical,getPageCategories:getPageCategories,getWikiCategories:getWikiCategories,getLanguage:getLanguage,getRawDbName:getRawDbName};});;define('ext.wikia.adEngine.video.vastUrlBuilder',['ext.wikia.adEngine.adLogicPageParams','ext.wikia.adEngine.slot.adUnitBuilder','ext.wikia.adEngine.slot.slotTargeting','wikia.location','wikia.log'],function(page,adUnitBuilder,slotTargeting,loc,log){'use strict';var adSizes={vertical:'320x480',horizontal:'640x480'},baseUrl='https://pubads.g.doubleclick.net/gampad/ads?',logGroup='ext.wikia.adEngine.video.vastUrlBuilder';function getCustomParameters(slotParams){var customParameters,params=page.getPageLevelParams(),wsi=slotTargeting.getWikiaSlotId(slotParams.pos,slotParams.src);customParameters=['wsi='+wsi];Object.keys(params).forEach(function(key){if(params[key]){customParameters.push(key+'='+params[key]);}});Object.keys(slotParams).forEach(function(key){if(slotParams[key]){customParameters.push(key+'='+slotParams[key]);}});return encodeURIComponent(customParameters.join('&'));}
function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n);}
function getSizeByAspectRatio(aspectRatio){return aspectRatio>=1||!isNumeric(aspectRatio)?adSizes.horizontal:adSizes.vertical;}
function build(aspectRatio,slotParams,options){options=options||{};slotParams=slotParams||{};var correlator=Math.round(Math.random()*10000000000),params=['output=vast','env=vp','gdfp_req=1','impl=s','unviewed_position_start=1','iu='+adUnitBuilder.build(slotParams.pos,slotParams.src),'sz='+getSizeByAspectRatio(aspectRatio),'url='+loc.href,'correlator='+correlator,'cust_params='+getCustomParameters(slotParams)],url;if(options.numberOfAds!==undefined){params.push('pmad='+options.numberOfAds);}
if(options.prerollOnly){params.push('vpos=preroll');}
url=baseUrl+params.join('&');log(['build',url],'debug',logGroup);return url;}
return{build:build};});;define('ext.wikia.aRecoveryEngine.adBlockDetection',['ext.wikia.adEngine.adContext','ext.wikia.aRecoveryEngine.sourcePoint.recovery','wikia.document','wikia.instantGlobals','wikia.lazyqueue','wikia.log'],function(adContext,sourcePoint,doc,instantGlobals,lazyQueue,log){'use strict';var cb=function(callback){callback();},logGroup='ext.wikia.aRecoveryEngine.adBlockDetection',onBlockingEventsQueue=lazyQueue.makeQueue([],cb),onNotBlockingEventsQueue=lazyQueue.makeQueue([],cb);function initEventQueues(){doc.addEventListener('sp.not_blocking',onNotBlockingEventsQueue.start);doc.addEventListener('sp.blocking',onBlockingEventsQueue.start);}
function addOnBlockingCallback(callback){onBlockingEventsQueue.push(callback);}
function addOnNotBlockingCallback(callback){onNotBlockingEventsQueue.push(callback);}
function isBlocking(){return isEnabled()&&sourcePoint.isBlocking();}
function isEnabled(){var context=adContext.getContext();log(['isEnabled',context.opts.sourcePointDetection],log.levels.debug,logGroup);return context.opts.sourcePointDetection;}
return{addOnBlockingCallback:addOnBlockingCallback,addOnNotBlockingCallback:addOnNotBlockingCallback,initEventQueues:initEventQueues,isBlocking:isBlocking,isEnabled:isEnabled};});;define('ext.wikia.aRecoveryEngine.adBlockRecovery',['ext.wikia.adEngine.adContext','ext.wikia.aRecoveryEngine.adBlockDetection','wikia.document','wikia.instantGlobals','wikia.log','wikia.window'],function(adContext,adBlockDetection,doc,instantGlobals,log,win){'use strict';var customLogEndpoint='/wikia.php?controller=ARecoveryEngineApi&method=getLogInfo&kind=',logGroup='ext.wikia.aRecoveryEngine.adBlockRecovery';function getName(){return'adBlockRecovery';}
function addResponseListener(callback){adBlockDetection.addOnBlockingCallback(callback);adBlockDetection.addOnNotBlockingCallback(callback);}
function isEnabled(){var context=adContext.getContext(),enabled=context.opts.sourcePointRecovery||context.opts.pageFairRecovery;log(['isEnabled',enabled],log.levels.debug,logGroup);return enabled;}
function track(type){if(win._sp_&&!win._sp_.trackingSent){if(Wikia&&Wikia.Tracker){Wikia.Tracker.track({eventName:'ads.recovery',category:'ads-recovery-blocked',action:Wikia.Tracker.ACTIONS.IMPRESSION,label:type,trackingMethod:'analytics'});}
if(instantGlobals.wgARecoveryEngineCustomLog){sendCustomLog(type);}
win._sp_.trackingSent=true;}}
function sendCustomLog(type){var xmlHttp=new XMLHttpRequest();try{xmlHttp.open('GET',customLogEndpoint+type,true);xmlHttp.send();}catch(e){log(['track',e],log.levels.error,logGroup);}}
function verifyContent(){var wikiaArticle=doc.getElementById('WikiaArticle'),display=wikiaArticle.currentStyle?wikiaArticle.currentStyle.display:getComputedStyle(wikiaArticle,null).display;if(display==='none'){track('css-display-none');}}
return{addResponseListener:addResponseListener,isEnabled:isEnabled,getName:getName,track:track,verifyContent:verifyContent,wasCalled:isEnabled};});;define('ext.wikia.aRecoveryEngine.sourcePoint.recovery',['ext.wikia.adEngine.adContext','wikia.log','wikia.window'],function(adContext,log,win){'use strict';var logGroup='ext.wikia.aRecoveryEngine.sourcePoint.recovery',context=adContext.getContext(),recoverableSlots=['TOP_LEADERBOARD','TOP_RIGHT_BOXAD','LEFT_SKYSCRAPER_2','LEFT_SKYSCRAPER_3','INCONTENT_BOXAD_1','BOTTOM_LEADERBOARD','GPT_FLUSH'];function isEnabled(){var enabled=!!context.opts.sourcePointRecovery&&!context.opts.pageFairRecovery;log(['isEnabled',enabled],log.levels.debug,logGroup);return enabled;}
function isBlocking(){var isBlocking=!!(win.ads&&win.ads.runtime.sp&&win.ads.runtime.sp.blocking);log(['isBlocking',isBlocking],log.levels.debug,logGroup);return isBlocking;}
function isSlotRecoverable(slotName){var result=isEnabled()&&recoverableSlots.indexOf(slotName)!==-1;log(['isSlotRecoverable',result],log.levels.info,logGroup);return result;}
function getSafeUri(url){if(isBlocking()){url=win._sp_.getSafeUri(url);}
return url;}
return{getSafeUri:getSafeUri,isBlocking:isBlocking,isSlotRecoverable:isSlotRecoverable,isEnabled:isEnabled};});;define('wikia.browserDetect',['wikia.window'],function(win){'use strict';var appName=win.navigator.appName,userAgent=win.navigator.userAgent,browser=null,operatingSystem=null;function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);}
function isIE(){var bool=false;if(appName==='Microsoft Internet Explorer'||(appName==='Netscape'&&userAgent.indexOf('Trident/')!==-1)){bool=true;}
return bool;}
function isEdge(){return userAgent.indexOf('Edge')!==-1;}
function isFirefox(){return userAgent.toLowerCase().indexOf('firefox')>-1;}
function isIPad(){var bool=false;if(userAgent.match(/iPad/i)!==null){bool=true;}
return bool;}
function isIOS7orLower(){return!!userAgent.match(/iPad.+OS.[6,7].\d.+like.Mac.OS.+Safari/i);}
function isAndroid(){return userAgent.toLowerCase().indexOf('android')>-1;}
function getOS(){if(null!==operatingSystem){return operatingSystem;}
operatingSystem='unknown';if(userAgent.indexOf('Win')!==-1){operatingSystem='Windows';}
if(userAgent.indexOf('Mac')!==-1){operatingSystem='OSX';}
if(userAgent.indexOf('Linux')!==-1){operatingSystem='Linux';}
if(userAgent.indexOf('Android')!==-1){operatingSystem='Android';}
if(userAgent.indexOf('like Mac')!==-1){operatingSystem='iOS';}
return operatingSystem;}
function getBrowser(){if(null!==browser){return browser;}
var appVersion=win.navigator.appVersion,temp,matches=userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(matches[1])){temp=/\brv[ :]+(\d+)/g.exec(userAgent)||[];browser='IE '+(temp[1]||'');return browser;}
if(matches[1]==='Chrome'){temp=userAgent.match(/\b(OPR|Edge)\/(\d+)/);if(temp!==null){browser=temp.slice(1).join(' ').replace('OPR','Opera');return browser;}}
matches=matches[2]?[matches[1],matches[2]]:[appName,appVersion,'-?'];temp=userAgent.match(/version\/(\d+)/i);if(temp!==null){matches.splice(1,1,temp[1]);}
browser=matches.join(' ');return browser;}
function getBrowserVersion(){var browserStringParts=getBrowser().split(' ');return parseInt(browserStringParts[1],10);}
return{getBrowser:getBrowser,getBrowserVersion:getBrowserVersion,getOS:getOS,isIE:isIE,isFirefox:isFirefox,isIPad:isIPad,isIOS7orLower:isIOS7orLower,isAndroid:isAndroid,isMobile:isMobile,isEdge:isEdge};});;window.Krux||((Krux=function(){Krux.q.push(arguments);}).q=[]);define('wikia.krux',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adTracker','wikia.document','wikia.tracker','wikia.window'],function(adContext,adTracker,doc,wikiaTracker,win){'use strict';var maxNumberOfKruxSegments=50,kruxScriptId='krux-control-tag',kruxLoaded=false,segmentsCountTracked=false;function exportPageParams(adLogicPageParams){var params,value;if(Object.keys){params=adLogicPageParams.getPageLevelParams();Object.keys(params).forEach(function(key){value=params[key];if(value){win['kruxDartParam_'+key]=value.toString();}});}}
function addConfigScript(confid){var k,s;k=document.createElement('script');k.type='text/javascript';k.id=kruxScriptId;k.async=true;k.src=(location.protocol==='https:'?'https:':'http:')+'//cdn.krxd.net/controltag?confid='+confid;s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(k,s);}
function load(confid){require(['ext.wikia.adEngine.adContext','ext.wikia.adEngine.adLogicPageParams'],function(adContext,adLogicPageParams){var script;if(adContext.getContext().targeting.enableKruxTargeting){exportPageParams(adLogicPageParams);script=doc.getElementById(kruxScriptId);if(script){script.parentNode.removeChild(script);}
addConfigScript(confid);kruxLoaded=true;adTracker.track('krux/load');wikiaTracker.track({category:'ads-trackers',action:'krux',label:'load',value:0,trackingMethod:'analytics'});}});}
function getParams(n){var k='kx'+n;if(win.localStorage){return win.localStorage[k]||'';}else{return'';}}
function trackNumberOfSegments(numberOfSegments){if(segmentsCountTracked){return;}
var label=numberOfSegments+'';while(label.length<4){label='0'+label;}
adTracker.track('krux/segments_count',{},numberOfSegments,label);segmentsCountTracked=true;}
function getSegments(){var segments=getParams('segs'),segsArray;if(segments===''){trackNumberOfSegments(0);return[];}
segsArray=segments.split(',');trackNumberOfSegments(segsArray.length);return segsArray.slice(0,maxNumberOfKruxSegments);}
function getUser(){return getParams('user');}
function sendEvent(eventId,data){if(!kruxLoaded){return false;}
Krux('admEvent',eventId,data||{});return true;}
adContext.addCallback(function(){segmentsCountTracked=false;});return{load:load,getSegments:getSegments,getUser:getUser,sendEvent:sendEvent};});;


define('ext.wikia.adEngine.lookup.amazonMatch',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.lookup.lookupFactory','wikia.document','wikia.log','wikia.window'],function(adContext,slotsContext,factory,doc,log,win){'use strict';var logGroup='ext.wikia.adEngine.lookup.amazonMatch',config={oasis:{INCONTENT_BOXAD_1:['3x2','1x6','3x6'],LEFT_SKYSCRAPER_2:['1x6','3x2','3x6'],LEFT_SKYSCRAPER_3:['1x6','3x2','3x6'],TOP_LEADERBOARD:['7x9','9x2'],TOP_RIGHT_BOXAD:['3x2','3x6']},mercury:{MOBILE_IN_CONTENT:['3x2'],MOBILE_PREFOOTER:['3x2'],MOBILE_TOP_LEADERBOARD:['3x5']}},rendered=false,paramPattern=/([0-9]x[0-9])/,amazonId='3115',priceMap={},slots=[];function call(skin,onResponse){var amznMatch=doc.createElement('script'),context=adContext.getContext(),node=doc.getElementsByTagName('script')[0];slots=slotsContext.filterSlotMap(config[skin]);if(context.opts.overridePrefootersSizes){slots.PREFOOTER_LEFT_BOXAD=['3x2','7x9'];}
amznMatch.type='text/javascript';amznMatch.src='http://c.amazon-adsystem.com/aax2/amzn_ads.js';amznMatch.addEventListener('load',function(){var renderAd=win.amznads.renderAd;if(!win.amznads.getAdsCallback||!renderAd){return;}
win.amznads.getAdsCallback(amazonId,onResponse);win.amznads.renderAd=function(doc,adId){renderAd(doc,adId);rendered=true;};});node.parentNode.insertBefore(amznMatch,node);}
function calculatePrices(){var size,tokens,m;tokens=win.amznads.getTokens();log(['calculatePrices',tokens],'debug',logGroup);tokens.forEach(function(param){m=param.match(paramPattern);if(m){size=m[1];if(!priceMap[size]){priceMap[size]=[];}
priceMap[size].push(param);}});}
function encodeParamsForTracking(params){if(!params.amznslots){return;}
return params.amznslots.join(';');}
function getSlotParams(slotName){var params=[];if(rendered){log(['getSlotParams','No params since ad has been already displayed',slotName],'debug',logGroup);return{};}
slots[slotName].forEach(function(size){if(priceMap[size]){priceMap[size].forEach(function(price){params.push(price);});}});return params.length>0?{amznslots:params.sort()}:{};}
function getPrices(){return priceMap;}
function isSlotSupported(slotName){return slots[slotName];}
return factory.create({logGroup:logGroup,name:'amazon',call:call,calculatePrices:calculatePrices,getPrices:getPrices,isSlotSupported:isSlotSupported,encodeParamsForTracking:encodeParamsForTracking,getSlotParams:getSlotParams});});;


define('ext.wikia.adEngine.lookup.prebid.bidHelper',['ext.wikia.adEngine.lookup.prebid.priceGranularityHelper'],function(priceGranularityHelper){'use strict';function transformPriceFromBid(bid){var maxSupportedCpm=20;if(bid.bidder==='veles'){maxSupportedCpm=50;}
return priceGranularityHelper.transformPriceFromCpm(bid.cpm,maxSupportedCpm);}
return{transformPriceFromBid:transformPriceFromBid};});;define('ext.wikia.adEngine.lookup.prebid',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.lookup.prebid.adaptersPerformanceTracker','ext.wikia.adEngine.lookup.prebid.adaptersPricesTracker','ext.wikia.adEngine.lookup.prebid.adaptersRegistry','ext.wikia.adEngine.lookup.prebid.prebidHelper','ext.wikia.adEngine.lookup.prebid.prebidSettings','ext.wikia.adEngine.lookup.lookupFactory','wikia.document','wikia.window'],function(adContext,performanceTracker,pricesTracker,adaptersRegistry,helper,settings,factory,doc,win){'use strict';var adUnits=[],biddersPerformanceMap={},prebidLoaded=false;function call(skin,onResponse){var prebid,node;if(!prebidLoaded){prebid=doc.createElement('script');node=doc.getElementsByTagName('script')[0];adaptersRegistry.setupCustomAdapters();prebid.async=true;prebid.type='text/javascript';prebid.src=adContext.getContext().opts.prebidBidderUrl||'//acdn.adnxs.com/prebid/prebid.js';node.parentNode.insertBefore(prebid,node);}
biddersPerformanceMap=performanceTracker.setupPerformanceMap(skin);adUnits=helper.setupAdUnits(skin);if(adUnits.length>0){if(!prebidLoaded){win.pbjs.que.push(function(){win.pbjs.bidderSettings=settings.create();win.pbjs.addAdUnits(adUnits);});}
win.pbjs.que.push(function(){win.pbjs.requestBids({bidsBackHandler:onResponse});});}
prebidLoaded=true;}
function calculatePrices(){biddersPerformanceMap=performanceTracker.updatePerformanceMap(biddersPerformanceMap);}
function trackAdaptersOnLookupEnd(){var adapters=adaptersRegistry.getAdapters();biddersPerformanceMap=performanceTracker.updatePerformanceMap(biddersPerformanceMap);adapters.forEach(function(adapter){performanceTracker.trackBidderOnLookupEnd(adapter,biddersPerformanceMap);});}
function trackAdaptersSlotState(providerName,slotName){var adapters=adaptersRegistry.getAdapters();biddersPerformanceMap=performanceTracker.updatePerformanceMap(biddersPerformanceMap);adapters.forEach(function(adapter){performanceTracker.trackBidderSlotState(adapter,slotName,providerName,biddersPerformanceMap);});}
function isSlotSupported(slotName){return adUnits.some(function(adUnit){return adUnit.code===slotName;});}
function getSlotParams(slotName){var params;if(win.pbjs&&typeof win.pbjs.getAdserverTargetingForAdUnitCode==='function'){params=win.pbjs.getAdserverTargetingForAdUnitCode(slotName)||{};}
return params||{};}
function getBestSlotPrice(slotName){return pricesTracker.getSlotBestPrice(slotName);}
return factory.create({logGroup:'ext.wikia.adEngine.lookup.prebid',name:'prebid',call:call,calculatePrices:calculatePrices,isSlotSupported:isSlotSupported,getSlotParams:getSlotParams,getBestSlotPrice:getBestSlotPrice,trackAdaptersOnLookupEnd:trackAdaptersOnLookupEnd,trackAdaptersSlotState:trackAdaptersSlotState});});;define('ext.wikia.adEngine.lookup.prebid.prebidHelper',['ext.wikia.adEngine.lookup.prebid.adaptersRegistry'],function(adaptersRegistry){'use strict';var adUnits=[];function getAdapterAdUnits(adapter,skin){var adapterAdUnits=[],slots=adapter.getSlots(skin);Object.keys(slots).forEach(function(slotName){var adUnit=adapter.prepareAdUnit(slotName,slots[slotName],skin);if(adUnit){adapterAdUnits.push(adUnit);}});return adapterAdUnits;}
function addAdUnits(adapterAdUnits){adapterAdUnits.forEach(function(adUnit){adUnits.push(adUnit);});}
function setupAdUnits(skin){var adapters=adaptersRegistry.getAdapters();adapters.forEach(function(adapter){if(adapter&&adapter.isEnabled()){addAdUnits(getAdapterAdUnits(adapter,skin));}});return adUnits;}
return{setupAdUnits:setupAdUnits};});;define('ext.wikia.adEngine.lookup.prebid.prebidSettings',['ext.wikia.adEngine.lookup.prebid.bidHelper'],function(bidHelper){'use strict';function create(){return{standard:{alwaysUseBid:false,adserverTargeting:[{key:"hb_bidder",val:function(bidResponse){return bidResponse.bidderCode;}},{key:"hb_adid",val:function(bidResponse){return bidResponse.adId;}},{key:"hb_pb",val:function(bidResponse){return bidHelper.transformPriceFromBid(bidResponse);}},{key:'hb_size',val:function(bidResponse){return bidResponse.size;}}]}}}
return{create:create};});;define('ext.wikia.adEngine.lookup.prebid.priceGranularityHelper',function(){'use strict';function transformPriceFromCpm(cpm,maxSupportedCpm){var defaultMaxCpm=20,result;if(typeof maxSupportedCpm==='undefined'||maxSupportedCpm<defaultMaxCpm){maxSupportedCpm=defaultMaxCpm;}
result=Math.floor(maxSupportedCpm).toFixed(2);if(cpm===0){result='0.00';}else if(cpm<0.05){result='0.01';}else if(cpm<5.00){result=(Math.floor(cpm*20)/20).toFixed(2);}else if(cpm<10.00){result=(Math.floor(cpm*10)/10).toFixed(2);}else if(cpm<20.00){result=(Math.floor(cpm*2)/2).toFixed(2);}else if(cpm<maxSupportedCpm){result=Math.floor(cpm).toFixed(2);}
return result;}
return{transformPriceFromCpm:transformPriceFromCpm};});;define('ext.wikia.adEngine.lookup.prebid.priceParsingHelper',['ext.wikia.adEngine.utils.sampler','wikia.geo','wikia.instantGlobals','wikia.log','wikia.window'],function(sampler,geo,instantGlobals,log,win){'use strict';var adxAdSystem='AdSense/AdX',defaults={position:'IC',price:0},invalidResult={moatTracking:1,position:defaults.position,price:defaults.price,valid:false},loggerEndpoint='/wikia.php?controller=AdEngine2Api&method=postVelesInfo',logGroup='ext.wikia.adEngine.lookup.prebid.adapters.veles',validPositions=['LB','IC','XX'];function sendRequest(vast){var request=new win.XMLHttpRequest();request.open('POST',loggerEndpoint,true);request.setRequestHeader('Content-type','application/x-www-form-urlencoded');request.send('vast='+encodeURIComponent(vast));}
function logVast(vastRequest){log(['logVast',vastRequest],log.levels.debug,logGroup);if(sampler.sample('velesLog',1,100)){sendRequest(vastRequest.response);}}
function getPriceInDollars(numberString){return numberString?parseInt(numberString,10)/100:null;}
function extractPriceFrom(regexpResult){return regexpResult?getPriceInDollars(regexpResult[1]):null;}
function extractPositionFrom(regexpResult){var position=regexpResult&&regexpResult[2];if(position){position=position.toUpperCase();if(validPositions.indexOf(position)<0){position=defaults.position;}}else{position=defaults.position;}
log(['extractPositionFrom',position],log.levels.debug,logGroup);return position;}
function extractMoatTrackingSampling(input){return input.indexOf('+100%')!==-1?100:1;}
function parse(input){var re=new RegExp('ve([0-9]{4})(xx|ic|lb)','i'),regexpResult,price,result=invalidResult;if(input){regexpResult=re.exec(input);price=extractPriceFrom(regexpResult);result={moatTracking:extractMoatTrackingSampling(input),position:extractPositionFrom(regexpResult),price:price,valid:Boolean(price)};}
return result;}
function analyzeConfigFor(id){var result=invalidResult;if(id&&instantGlobals.wgAdDriverVelesBidderConfig[id]){result=parse(instantGlobals.wgAdDriverVelesBidderConfig[id]);}
log(['analyzeConfigFor',id,result],log.levels.debug,logGroup);return result;}
function analyzeConfigForAdSystemIn(adSystem){var adConfigPrice=instantGlobals.wgAdDriverVelesBidderConfig[adxAdSystem],result=invalidResult;if(adConfigPrice&&adSystem===adxAdSystem){result=parse(adConfigPrice);}
return result;}
function logInvalidResponse(result,vastRequest){var ad=vastRequest.responseXML.documentElement.querySelector('Ad');if(!result.valid&&ad&&geo.isProperGeo(instantGlobals.wgAdDriverVelesVastLoggerCountries)){logVast(vastRequest);}}
function analyzeResponse(vastInfo){var result=invalidResult;if(vastInfo.id&&instantGlobals.wgAdDriverVelesBidderConfig){result=analyzeConfigFor(vastInfo.id);if(!result.valid){result=analyzeConfigForAdSystemIn(vastInfo.adSystem);}}
return result;}
function getVastId(responseXML){var ad=responseXML.documentElement.querySelector('Ad'),adSystem,vastInfo={};if(ad){vastInfo.id=ad.getAttribute('id');adSystem=ad.querySelector('AdSystem');if(adSystem){vastInfo.adSystem=adSystem.textContent;}}
return vastInfo;}
function analyze(vastRequest){var result=invalidResult,vastInfo;if(vastRequest.responseXML){vastInfo=getVastId(vastRequest.responseXML);result=analyzeResponse(vastInfo);result.vastId=[vastInfo.adSystem,vastInfo.id].join(':');logInvalidResponse(result,vastRequest);}
return result;}
return{analyze:analyze};});;define('ext.wikia.adEngine.lookup.prebid.adaptersPerformanceTracker',['ext.wikia.adEngine.adTracker','ext.wikia.adEngine.lookup.prebid.adaptersRegistry','ext.wikia.adEngine.lookup.prebid.bidHelper','ext.wikia.adEngine.utils.timeBuckets','ext.wikia.adEngine.wrappers.prebid'],function(adTracker,adaptersRegistry,bidHelper,timeBuckets,prebid){'use strict';var buckets=[0.0,0.5,1.0,1.5,2.0,2.5,3.0],emptyResponseMsg='EMPTY_RESPONSE',notRespondedMsg='NO_RESPONSE';function setupPerformanceMap(skin){var biddersPerformanceMap={},adapters=adaptersRegistry.getAdapters();adapters.forEach(function(adapter){var slots=adapter.getSlots(skin),adapterName=adapter.getName();if(adapter.isEnabled()){biddersPerformanceMap[adapterName]={};Object.keys(slots).forEach(function(slotName){biddersPerformanceMap[adapterName][slotName]=notRespondedMsg;});}});return biddersPerformanceMap;}
function updatePerformanceMap(performanceMap){var allBids;if(typeof prebid.get().getBidResponses==='function'){allBids=prebid.get().getBidResponses();Object.keys(allBids).forEach(function(slotName){var slotBids=allBids[slotName].bids;slotBids.forEach(function(bid){performanceMap[bid.bidder][slotName]=getParamsFromBidForTracking(bid);});});}
return performanceMap;}
function trackBidderSlotState(adapter,slotName,providerName,performanceMap){var bidderName=adapter.getName(),category;if(!adapter.isEnabled()){return;}
if(!performanceMap[bidderName][slotName]){return;}
if(performanceMap[bidderName][slotName]!==notRespondedMsg){category=bidderName+'/lookup_success/'+providerName;adTracker.track(category,slotName,0,performanceMap[bidderName][slotName]);}else{category=bidderName+'/lookup_error/'+providerName;adTracker.track(category,slotName,0,'nodata');}}
function trackBidderOnLookupEnd(adapter,performanceMap){var bidderName=adapter.getName();if(adapter.isEnabled()){adTracker.track(bidderName+'/lookup_end',performanceMap[bidderName],0,'nodata');}}
function getParamsFromBidForTracking(bid){var price,bucket=timeBuckets.getTimeBucket(buckets,bid.timeToRespond/1000);if(bid.getStatusCode()===prebid.errorResponseStatusCode){return[emptyResponseMsg,bucket].join(';');}
if(bid.notInvolved){price='NOT_INVOLVED';}else if(bid.used){price='USED';}else{price=bidHelper.transformPriceFromBid(bid);}
return[bid.getSize(),price,bucket].join(';');}
return{setupPerformanceMap:setupPerformanceMap,trackBidderOnLookupEnd:trackBidderOnLookupEnd,trackBidderSlotState:trackBidderSlotState,updatePerformanceMap:updatePerformanceMap};});;define('ext.wikia.adEngine.lookup.prebid.adaptersPricesTracker',['ext.wikia.adEngine.lookup.prebid.adaptersRegistry','ext.wikia.adEngine.lookup.prebid.bidHelper','ext.wikia.adEngine.wrappers.prebid','wikia.log'],function(adaptersRegistry,bidHelper,prebid,log){'use strict';var logGroup='ext.wikia.adEngine.lookup.prebid.adaptersPricesTracker';function getSlotBestPrice(slotName){var getBidResponsesFunction=prebid.get().getBidResponsesForAdUnitCode,slotBids=[],bestPrices={};if(getBidResponsesFunction){slotBids=getBidResponsesFunction(slotName).bids||[];adaptersRegistry.getAdapters().forEach(function(adapter){bestPrices[adapter.getName()]='';});log(['getSlotBestPrices slotBids',slotName,slotBids],'debug',logGroup);slotBids.forEach(function(bid){if(isValidPrice(bid)){var bidderCode=bid.bidderCode,cpmPrice=bidHelper.transformPriceFromBid(bid);bestPrices[bidderCode]=Math.max(bestPrices[bidderCode]||0,parseFloat(cpmPrice)).toFixed(2).toString();if(bid.notInvolved){bestPrices[bidderCode]='NOT_INVOLVED';}else if(bid.used){bestPrices[bidderCode]='USED';}
log(['getSlotBestPrices best price for slot',slotName,bidderCode,bestPrices[bidderCode]],'debug',logGroup);}});}
return bestPrices;}
function isValidPrice(bid){return bid.getStatusCode&&bid.getStatusCode()===prebid.validResponseStatusCode;}
return{getSlotBestPrice:getSlotBestPrice,_isValidPrice:isValidPrice}});;define('ext.wikia.adEngine.lookup.prebid.adaptersRegistry',['ext.wikia.adEngine.lookup.prebid.adapters.aol','ext.wikia.adEngine.lookup.prebid.adapters.appnexus','ext.wikia.adEngine.lookup.prebid.adapters.audienceNetwork','ext.wikia.adEngine.lookup.prebid.adapters.indexExchange','ext.wikia.adEngine.lookup.prebid.adapters.openx','ext.wikia.adEngine.lookup.prebid.adapters.rubicon','ext.wikia.adEngine.lookup.prebid.adapters.wikia','ext.wikia.adEngine.lookup.prebid.adapters.veles','wikia.window'],function(aol,appnexus,audienceNetwork,indexExchange,openx,rubicon,wikia,veles,win){'use strict';var adapters=[rubicon,appnexus,audienceNetwork,indexExchange,aol,openx],customAdapters=[wikia,veles];function getAdapters(){return adapters;}
function push(adapter){adapters.push(adapter);}
function setupCustomAdapters(){customAdapters.forEach(function(adapter){if(adapter&&adapter.isEnabled()){push(adapter);win.pbjs.que.push(function(){win.pbjs.registerBidAdapter(adapter.create,adapter.getName());});}});}
return{getAdapters:getAdapters,push:push,setupCustomAdapters:setupCustomAdapters};});;define('ext.wikia.adEngine.lookup.prebid.adapters.aol',['ext.wikia.adEngine.context.slotsContext','wikia.geo','wikia.instantGlobals'],function(slotsContext,geo,instantGlobals){'use strict';var bidderName='aol',network='9435.1',slots={oasis:{TOP_LEADERBOARD:{size:[728,90],placement:'4431497',network:network,alias:'4431497',sizeId:'225'},TOP_RIGHT_BOXAD:{size:[300,250],placement:'4431473',network:network,alias:'4431473',sizeId:'170'},PREFOOTER_LEFT_BOXAD:{size:[300,250],placement:'4431479',network:network,alias:'4431479',sizeId:'170'},PREFOOTER_MIDDLE_BOXAD:{size:[300,250],placement:'4431480',network:network,alias:'4431480',sizeId:'170'},PREFOOTER_RIGHT_BOXAD:{size:[300,250],placement:'4431478',network:network,alias:'4431478',sizeId:'170'},LEFT_SKYSCRAPER_2:{size:[160,600],placement:'4431477',network:network,alias:'4431477',sizeId:'154'},LEFT_SKYSCRAPER_3:{size:[300,600],placement:'4431475',network:network,alias:'4431475',sizeId:'529'}},mercury:{MOBILE_TOP_LEADERBOARD:{size:[320,50],placement:'4436772',network:network,alias:'4436772',sizeId:'3055'},MOBILE_IN_CONTENT:{size:[300,250],placement:'4431565',network:network,alias:'4431565',sizeId:'170'},MOBILE_PREFOOTER:{size:[300,250],placement:'4431566',network:network,alias:'4431566',sizeId:'170'}}};function isEnabled(){return geo.isProperGeo(instantGlobals.wgAdDriverAolBidderCountries);}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function prepareAdUnit(slotName,config){return{code:slotName,sizes:[config.size],bids:[{bidder:bidderName,params:{placement:config.placement,network:config.network,alias:config.alias,sizeId:config.sizeId}}]};}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.appnexus',['ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.lookup.prebid.adapters.appnexusPlacements','wikia.geo','wikia.instantGlobals'],function(slotsContext,appnexusPlacements,geo,instantGlobals){'use strict';var bidderName='appnexus',slots={oasis:{TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],position:'atf'},TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600]],position:'atf'},PREFOOTER_LEFT_BOXAD:{sizes:[[300,250]],position:'btf'},PREFOOTER_MIDDLE_BOXAD:{sizes:[[300,250]],position:'btf'},PREFOOTER_RIGHT_BOXAD:{sizes:[[300,250]],position:'btf'},LEFT_SKYSCRAPER_2:{sizes:[[160,600],[300,600],[300,250]],position:'btf'},LEFT_SKYSCRAPER_3:{sizes:[[160,600],[300,600],[300,250]],position:'btf'},INCONTENT_BOXAD_1:{sizes:[[160,600],[300,600],[300,250]],position:'hivi'}},mercury:{MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]]},MOBILE_IN_CONTENT:{sizes:[[300,250],[320,480]]},MOBILE_PREFOOTER:{sizes:[[300,250],[320,50]]}}};function isEnabled(){return geo.isProperGeo(instantGlobals.wgAdDriverAppNexusBidderCountries);}
function prepareAdUnit(slotName,config,skin){var placementId=appnexusPlacements.getPlacement(skin,config.position);if(!placementId){return;}
return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName,params:{placementId:placementId}}]};}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.appnexusPlacements',['ext.wikia.adEngine.adContext','wikia.instantGlobals','wikia.log'],function(adContext,instantGlobals,log){'use strict';var logGroup='ext.wikia.adEngine.lookup.prebid.adapters.appnexusPlacements',placementsMap=instantGlobals.wgAdDriverAppNexusBidderPlacementsConfig;function getPlacement(skin,position){var vertical=adContext.getContext().targeting.mappedVerticalName;if(placementsMap&&placementsMap[skin]&&placementsMap[skin][vertical]){if(position&&placementsMap[skin][vertical][position]){return placementsMap[skin][vertical][position];}
if(!position||position==='atf'){return placementsMap[skin][vertical];}}
log(['getPlacement',skin,vertical,position,'wgAdDriverAppNexusBidderPlacementsConfig variable not set or not configured correctly'],'error',logGroup);}
return{getPlacement:getPlacement};});;define('ext.wikia.adEngine.lookup.prebid.adapters.audienceNetwork',['ext.wikia.adEngine.context.slotsContext','wikia.geo','wikia.instantGlobals','ext.wikia.adEngine.adContext','wikia.querystring'],function(slotsContext,geo,instantGlobals,adContext,querystring){'use strict';var bidderName='audienceNetwork',slots={mercury:{MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]],placementId:'963689110376230_1245837502161388'},MOBILE_IN_CONTENT:{sizes:[[300,250]],placementId:'963689110376230_1245838625494609'},MOBILE_PREFOOTER:{sizes:[[300,250]],placementId:'963689110376230_1245839585494513'}}};function isEnabled(){return adContext.getContext().targeting.skin==='mercury'&&geo.isProperGeo(instantGlobals.wgAdDriverAudienceNetworkBidderCountries);}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function prepareAdUnit(slotName,config){return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName,params:{testMode:querystring().getVal('audiencenetworktest','')==='true',placementId:config.placementId}}]};}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.indexExchange',['ext.wikia.adEngine.context.slotsContext','wikia.geo','wikia.instantGlobals'],function(slotsContext,geo,instantGlobals){'use strict';var bidderName='indexExchange',slots={oasis:{TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],id:'1',siteID:183423},TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600]],id:'2',siteID:183567},PREFOOTER_LEFT_BOXAD:{sizes:[[300,250]],id:'4',siteID:185052},PREFOOTER_MIDDLE_BOXAD:{sizes:[[300,250]],id:'5',siteID:185054},PREFOOTER_RIGHT_BOXAD:{sizes:[[300,250]],id:'6',siteID:185053},LEFT_SKYSCRAPER_2:{sizes:[[160,600],[300,600],[300,250]],id:'7',siteID:185050},LEFT_SKYSCRAPER_3:{sizes:[[160,600],[300,600],[300,250]],id:'8',siteID:185051},INCONTENT_BOXAD_1:{sizes:[[160,600],[300,600],[300,250]],id:'9',siteID:185049}},mercury:{MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]],id:'3',siteID:183568},MOBILE_IN_CONTENT:{sizes:[[300,250],[320,480]],id:'10',siteID:185055},MOBILE_PREFOOTER:{sizes:[[300,250],[320,50]],id:'11',siteID:185056}}};function isEnabled(){return geo.isProperGeo(instantGlobals.wgAdDriverIndexExchangeBidderCountries);}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function prepareAdUnit(slotName,config){return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName,params:{id:config.id,siteID:config.siteID}}]};}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.openx',['ext.wikia.adEngine.context.slotsContext','wikia.geo','wikia.instantGlobals'],function(slotsContext,geo,instantGlobals){'use strict';var bidderName='openx',delDomain='wikia-d.openx.net',slots={oasis:{TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],unit:538735690},TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600]],unit:538735691},LEFT_SKYSCRAPER_2:{sizes:[[160,600],[300,600],[300,250]],unit:538735695},LEFT_SKYSCRAPER_3:{sizes:[[160,600],[300,600],[300,250]],unit:538735696},INCONTENT_BOXAD_1:{sizes:[[300,250],[300,600],[160,600]],unit:538735697},PREFOOTER_LEFT_BOXAD:{sizes:[[300,250]],unit:538735692},PREFOOTER_MIDDLE_BOXAD:{sizes:[[300,250]],unit:538735693},PREFOOTER_RIGHT_BOXAD:{sizes:[[300,250]],unit:538735694}},mercury:{MOBILE_IN_CONTENT:{sizes:[[300,250],[320,480]],unit:538735699},MOBILE_PREFOOTER:{sizes:[[300,250],[320,50]],unit:538735700},MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]],unit:538735698}}};function isEnabled(){return geo.isProperGeo(instantGlobals.wgAdDriverOpenXPrebidBidderCountries);}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function prepareAdUnit(slotName,config){return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName,params:{unit:config.unit,delDomain:delDomain}}]};}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.rubicon',['ext.wikia.adEngine.context.slotsContext','wikia.geo','wikia.instantGlobals','wikia.log'],function(slotsContext,geo,instantGlobals,log){'use strict';var bidderName='rubicon',logGroup='ext.wikia.adEngine.lookup.prebid.adapters.rubicon',outstreamSizeId=203,rubiconAccountId=7450,rubiconSiteId=55412,slots={oasis:{TOP_LEADERBOARD:{zoneId:519058,position:'atf'},INCONTENT_PLAYER:{zoneId:260296,position:'btf'}},mercury:{MOBILE_IN_CONTENT:{zoneId:563110,position:'btf'}}};function isEnabled(){return geo.isProperGeo(instantGlobals.wgAdDriverRubiconPrebidCountries);}
function prepareAdUnit(slotName,config){var adUnit={code:slotName,sizes:[[640,480]],mediaType:'video',bids:[{bidder:bidderName,params:{accountId:rubiconAccountId,siteId:rubiconSiteId,zoneId:config.zoneId,name:slotName,position:config.position,video:{playerHeight:480,playerWidth:640,size_id:outstreamSizeId}}}]};log(['prepareAdUnit',adUnit],log.levels.debug,logGroup);return adUnit;}
function getSlots(skin){return slotsContext.filterSlotMap(slots[skin]);}
function getName(){return bidderName;}
return{isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.wikia',['ext.wikia.adEngine.wrappers.prebid','wikia.document','wikia.querystring'],function(prebid,doc,QueryString){'use strict';var bidderName='wikia',slots={oasis:{TOP_LEADERBOARD:{sizes:[[728,90]]},TOP_RIGHT_BOXAD:{sizes:[[300,250]]}},mercury:{MOBILE_TOP_LEADERBOARD:{sizes:[[320,50]]}}},qs=new QueryString();function getPrice(){var price=qs.getVal('wikia_adapter',0);return parseInt(price,10)/100;}
function isEnabled(){return qs.getVal('wikia_adapter',false)!==false;}
function prepareAdUnit(slotName,config){return{code:slotName,sizes:config.sizes,bids:[{bidder:bidderName}]};}
function getSlots(skin){return slots[skin];}
function getName(){return bidderName;}
function getCreative(price,size){var creative=doc.createElement('div'),details=doc.createElement('small'),title=doc.createElement('p');creative.style.background='#00b7e0';creative.style.color='#fff';creative.style.fontFamily='sans-serif';creative.style.height='100%';creative.style.textAlign='center';creative.style.width='100%';title.innerText='Wikia Creative';title.style.fontWeight='bold';title.style.margin='0';title.style.paddingTop='10px';details.innerText='price: '+price+', size: '+size.join('x');creative.appendChild(title);creative.appendChild(details);return creative.outerHTML;}
function addBids(bidderRequest){bidderRequest.bids.forEach(function(bid){var bidResponse=prebid.get().createBid(1),price=getPrice();bidResponse.bidderCode=bidderRequest.bidderCode;bidResponse.cpm=price;bidResponse.ad=getCreative(price,bid.sizes[0]);bidResponse.width=bid.sizes[0][0];bidResponse.height=bid.sizes[0][1];prebid.get().addBidResponse(bid.placementCode,bidResponse);});}
function create(){return{callBids:function(bidderRequest){prebid.push(function(){addBids(bidderRequest);});}};}
return{create:create,isEnabled:isEnabled,getName:getName,getSlots:getSlots,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.lookup.prebid.adapters.veles',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.lookup.prebid.priceParsingHelper','ext.wikia.adEngine.wrappers.prebid','ext.wikia.adEngine.video.vastUrlBuilder','wikia.geo','wikia.instantGlobals','wikia.log','wikia.window'],function(adContext,priceParsingHelper,prebid,vastUrlBuilder,geo,instantGlobals,log,win){'use strict';var bidderName='veles',logGroup='ext.wikia.adEngine.lookup.prebid.adapters.veles',allowedSlots={IC:['INCONTENT_PLAYER','MOBILE_IN_CONTENT'],LB:['TOP_LEADERBOARD'],XX:['TOP_LEADERBOARD','INCONTENT_PLAYER','MOBILE_IN_CONTENT']},slots={oasis:{INCONTENT_PLAYER:{sizes:[[640,480]]},TOP_LEADERBOARD:{sizes:[[640,480]]}},mercury:{MOBILE_IN_CONTENT:{sizes:[[640,480]]}}};function isEnabled(){var isVelesEnabled=geo.isProperGeo(instantGlobals.wgAdDriverVelesBidderCountries);log(['isEnabled',isVelesEnabled],log.levels.debug,logGroup);return isVelesEnabled;}
function prepareAdUnit(slotName,config){var adUnit={code:slotName,sizes:config.sizes,bids:[{bidder:bidderName}]};log(['prepareAdUnit',adUnit],log.levels.debug,logGroup);return adUnit;}
function getSlots(skin){return slots[skin];}
function getName(){return bidderName;}
function addEmptyBids(bidderRequest){log(['addEmptyBids',bidderRequest],log.levels.debug,logGroup);bidderRequest.bids.forEach(function(bid){var bidResponse=prebid.get().createBid(2);bidResponse.bidderCode=bidderRequest.bidderCode;prebid.get().addBidResponse(bid.placementCode,bidResponse);});}
function addBids(bidderRequest,vastResponse,velesParams){log(['addBids',bidderRequest,vastResponse,velesParams],log.levels.debug,logGroup);bidderRequest.bids.forEach(function(bid){var bidResponse=prebid.get().createBid(1);bidResponse.ad='';bidResponse.bidderCode=bidderRequest.bidderCode;bidResponse.bidderRequestId=bidderRequest.bidderRequestId;bidResponse.cpm=0.00;bidResponse.mediaType='video';bidResponse.moatTracking=velesParams.moatTracking;bidResponse.width=bid.sizes[0][0];bidResponse.height=bid.sizes[0][1];bidResponse.vastId=velesParams.vastId;if(velesParams.valid&&allowedSlots[velesParams.position].indexOf(bid.placementCode)>-1){bidResponse.ad=vastResponse;bidResponse.cpm=velesParams.price;}else if(velesParams.valid){bidResponse.notInvolved=true;}
prebid.get().addBidResponse(bid.placementCode,bidResponse);});}
function isValidResponse(status){var result=status!==0&&status<400;log(['isValidResponse',result],log.levels.debug,logGroup);return result;}
function onVastResponse(vastRequest,bidderRequest){var velesParams;if(isValidResponse(vastRequest.status)){velesParams=priceParsingHelper.analyze(vastRequest);addBids(bidderRequest,vastRequest.response,velesParams);}else{addEmptyBids(bidderRequest);}}
function requestVast(bidderRequest){var request=new win.XMLHttpRequest(),skin=adContext.getContext().targeting.skin,vastUrl=vastUrlBuilder.build(640/480,{pos:Object.keys(slots[skin]),src:skin==='oasis'?'gpt':'mobile',passback:bidderName},{numberOfAds:1,prerollOnly:true});request.onreadystatechange=function(){if(this.readyState===4){onVastResponse(request,bidderRequest);}};request.open('GET',vastUrl,true);request.send();log(['requestVast',vastUrl],log.levels.debug,logGroup);}
function create(){return{callBids:function(bidderRequest){prebid.push(function(){requestVast(bidderRequest);});}};}
function markBidsAsUsed(adId){win.pbjs._bidsReceived.forEach(function(bid){if(bid.bidderCode===bidderName&&bid.adId!==adId){bid.cpm=0.00;bid.used=true;}});}
return{create:create,isEnabled:isEnabled,getName:getName,getSlots:getSlots,markBidsAsUsed:markBidsAsUsed,prepareAdUnit:prepareAdUnit};});;define('ext.wikia.adEngine.wrappers.prebid',['wikia.window'],function(win){'use strict';var validResponseStatusCode=1,errorResponseStatusCode=2;win.pbjs=win.pbjs||{};win.pbjs.que=win.pbjs.que||[];function get(){return win.pbjs;}
function getBidByAdId(adId){if(!win.pbjs||!win.pbjs._bidsReceived){return null;}
var bids=win.pbjs._bidsReceived.filter(function(bid){return adId===bid.adId;});return bids.length?bids[0]:null;}
function push(callback){win.pbjs.que.push(callback);}
return{validResponseStatusCode:validResponseStatusCode,errorResponseStatusCode:errorResponseStatusCode,get:get,getBidByAdId:getBidByAdId,push:push};});;


define('ext.wikia.adEngine.lookup.openx.openXBidderHelper',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.utils.adLogicZoneParams','wikia.log','wikia.window'],function(adContext,slotsContext,adLogicZoneParams,log,win){'use strict';var slots={},openXTimeoutChanged=false,logGroup='ext.wikia.adEngine.lookup.openx.openXBidderHelper',config={oasis:{TOP_LEADERBOARD:{sizes:['728x90','970x250']},TOP_RIGHT_BOXAD:{sizes:['300x250','300x600']},LEFT_SKYSCRAPER_2:{sizes:['160x600','300x600']},LEFT_SKYSCRAPER_3:{sizes:['160x600','300x600']},INCONTENT_BOXAD_1:{sizes:['300x250','300x600','160x600']},PREFOOTER_LEFT_BOXAD:{sizes:['300x250']},PREFOOTER_MIDDLE_BOXAD:{sizes:['300x250']},PREFOOTER_RIGHT_BOXAD:{sizes:['300x250']}},mercury:{MOBILE_IN_CONTENT:{sizes:['300x250','320x50']},MOBILE_PREFOOTER:{sizes:['300x250','320x50']},MOBILE_TOP_LEADERBOARD:{sizes:['320x50']}}};function getSlots(){return slots;}
function addSlot(slotName,properties){slots[slotName]=properties;}
function removeSlot(slotName){delete slots[slotName];}
function isOpenXRemnantEnabledInGeo(){var context=adContext.getContext();return context.opts.openXRemnantEnabled;}
function setupSlots(skin){slots=slotsContext.filterSlotMap(config[skin]);}
function isSlotSupported(slotName){var isSupported=!!slots[slotName];log(['isSupported',slotName,isSupported],'debug',logGroup);return isSupported;}
function changeTimeout(){if(!openXTimeoutChanged){if(win.OXHBConfig){win.OXHBConfig.DFP_mapping.timeout=0;log(['changeTimeout'],'debug',logGroup);}
openXTimeoutChanged=true;}}
function getPagePath(){return['/5441','wka.'+adLogicZoneParams.getSite(),adLogicZoneParams.getName(),'',adLogicZoneParams.getPageType()].join('/');}
function getSlothPath(slotName,src){src=src||'remnant';return'wikia_gpt'+getPagePath()+'/'+src+'/'+slotName;}
function addOpenXSlot(slotName){if(isOpenXRemnantEnabledInGeo()&&isSlotSupported(slotName)&&win.OX){log(['addOpenXSlot',slotName],'debug',logGroup);changeTimeout();win.OX.dfp_bidder.addSlots([[getPagePath(),slots[slotName].sizes,getSlothPath(slotName)]]);}}
return{addOpenXSlot:addOpenXSlot,getSlots:getSlots,addSlot:addSlot,removeSlot:removeSlot,isSlotSupported:isSlotSupported,setupSlots:setupSlots,getPagePath:getPagePath,getSlotPath:getSlothPath};});;define('ext.wikia.adEngine.lookup.openXBidder',['ext.wikia.adEngine.lookup.lookupFactory','ext.wikia.adEngine.slot.adSlot','ext.wikia.adEngine.lookup.openx.openXBidderHelper','wikia.document','wikia.log','wikia.window'],function(factory,adSlot,openXHelper,doc,log,win){'use strict';var logGroup='ext.wikia.adEngine.lookup.openXBidder',priceTimeout='t',priceMap={};function getAds(){var ads=[],sizes,slotName,slots=openXHelper.getSlots(),pagePath=openXHelper.getPagePath();for(slotName in slots){if(slots.hasOwnProperty(slotName)){sizes=slots[slotName].sizes;ads.push([pagePath,sizes,openXHelper.getSlotPath(slotName,'gpt')]);}}
return ads;}
function getSlotParams(slotName){var dfpParams={},dfpKey,price,size;if(!priceMap[slotName]){log(['getSlotParams','No response for the slot',slotName],'debug',logGroup);return{};}
price=priceMap[slotName].price;size=priceMap[slotName].size;if(!price){log(['getSlotParams','No price for the slot',slotName],'debug',logGroup);return{};}
dfpKey='ox'+size;dfpParams[dfpKey]=price;log(['getSlotParams',dfpKey,price],'debug',logGroup);return dfpParams;}
function encodeParamsForTracking(params){var key,encoded=[];for(key in params){if(params.hasOwnProperty(key)){encoded.push(key+'='+params[key]);}}
return encoded.join(';');}
function calculatePrices(){var prices=win.OX.dfp_bidder.getPriceMap(),slotName,shortSlotName;for(slotName in prices){if(prices.hasOwnProperty(slotName)&&prices[slotName].price!==priceTimeout){shortSlotName=adSlot.getShortSlotName(slotName);priceMap[shortSlotName]=prices[slotName];}}}
function call(skin,onResponse){var openx=doc.createElement('script'),node=doc.getElementsByTagName('script')[0];openXHelper.setupSlots(skin);win.OX_dfp_ads=getAds();win.OX_dfp_options={callback:onResponse};openx.async=true;openx.type='text/javascript';openx.src='//ox-d.wikia.servedbyopenx.com/w/1.0/jstag?nc=5441-Wikia';node.parentNode.insertBefore(openx,node);}
function getPrices(){var prices={};for(var slotName in priceMap){if(priceMap.hasOwnProperty(slotName)){prices[slotName]=priceMap[slotName].price;}}
return prices;}
return factory.create({logGroup:logGroup,name:'ox_bidder',call:call,calculatePrices:calculatePrices,getPrices:getPrices,encodeParamsForTracking:encodeParamsForTracking,getSlotParams:getSlotParams,isSlotSupported:openXHelper.isSlotSupported});});;


define('ext.wikia.adEngine.lookup.rubicon.rubiconTargeting',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.utils.adLogicZoneParams'],function(adContext,adLogicZoneParams){'use strict';var context;function getContextTargeting(){if(!context){context=adContext.getContext();}
return context.targeting;}
function getTargeting(slotName,skin,passback){var provider=skin==='oasis'?'gpt':'mobile',s1=getContextTargeting().wikiIsTop1000?adLogicZoneParams.getName():'not a top1k wiki';return{pos:slotName,src:provider,s0:adLogicZoneParams.getSite(),s1:s1,s2:adLogicZoneParams.getPageType(),lang:adLogicZoneParams.getLanguage(),passback:passback};}
return{getTargeting:getTargeting};});;define('ext.wikia.adEngine.lookup.rubicon.rubiconTier',['ext.wikia.adEngine.utils.math'],function(math){'use strict';var privateTierSuffix='deals',cpmBuckets=[{maxValue:4,bucket:1},{maxValue:99,bucket:5},{maxValue:499,bucket:10},{maxValue:1999,bucket:50}];function create(sizeId,cpm){var index=0,tier=2000;while(cpmBuckets[index]&&cpm>cpmBuckets[index].maxValue){index+=1;}
if(cpmBuckets[index]){tier=math.getBucket(cpm,cpmBuckets[index].bucket);}
tier=Math.max(0,parseInt(tier,10));return sizeId+'_tier'+math.leftPad(tier,4);}
function parseOpenMarketPrice(tier){if(tier.indexOf(privateTierSuffix)===-1){var matches=/^\d+_tier(\d+)/g.exec(tier);if(matches&&matches[1]){return parseInt(matches[1],10);}}
return 0;}
function parsePrivatePrice(tier){var matches=new RegExp('^\\d+_tier(\\d+)'+privateTierSuffix,'g').exec(tier);if(matches&&matches[1]){return parseInt(matches[1],10);}
return 0;}
return{create:create,parseOpenMarketPrice:parseOpenMarketPrice,parsePrivatePrice:parsePrivatePrice};});;define('ext.wikia.adEngine.lookup.rubicon.rubiconFastlane',['ext.wikia.adEngine.adContext','ext.wikia.adEngine.context.slotsContext','ext.wikia.adEngine.lookup.lookupFactory','ext.wikia.adEngine.lookup.rubicon.rubiconTargeting','ext.wikia.adEngine.lookup.rubicon.rubiconTier','wikia.document','wikia.log','wikia.window'],function(adContext,slotsContext,factory,rubiconTargeting,rubiconTier,doc,log,win){'use strict';var bestPrices={},bestPricesPrivate={},config={oasis:{TOP_LEADERBOARD:{sizes:[[728,90],[970,250]],targeting:{loc:'top'}},TOP_RIGHT_BOXAD:{sizes:[[300,250],[300,600],[300,1050]],targeting:{loc:'top'}},LEFT_SKYSCRAPER_2:{sizes:[[120,600],[160,600],[300,250],[300,600],[300,1050]],targeting:{loc:'middle'}},LEFT_SKYSCRAPER_3:{sizes:[[120,600],[160,600],[300,250],[300,600]],targeting:{loc:'footer'}},INCONTENT_BOXAD_1:{sizes:[[120,600],[160,600],[300,250],[300,600]],targeting:{loc:'hivi'}},PREFOOTER_LEFT_BOXAD:{sizes:[[300,250],[336,280]],targeting:{loc:'footer'}},PREFOOTER_MIDDLE_BOXAD:{sizes:[[300,250]],targeting:{loc:'footer'}},PREFOOTER_RIGHT_BOXAD:{sizes:[[300,250]],targeting:{loc:'footer'}}},mercury:{MOBILE_IN_CONTENT:{sizes:[[300,50],[300,250],[320,50],[320,480]]},MOBILE_PREFOOTER:{sizes:[[300,50],[300,250],[320,50]]},MOBILE_TOP_LEADERBOARD:{sizes:[[300,50],[320,50],[320,480]]}}},context,logGroup='ext.wikia.adEngine.lookup.rubicon.rubiconFastlane',priceMap={},response,rubiconSlots=[],rubiconElementKey='rpfl_elemid',rubiconTierKey='rpfl_7450',rubiconLibraryUrl='//ads.rubiconproject.com/header/7450.js',rubiconDomains=['//fastlane.rubiconproject.com/','//fastlane-adv.rubiconproject.com/'],rubiconLoaded=false,sizeMap={'468x60':1,'728x90':2,'120x600':8,'160x600':9,'300x600':10,'300x250':15,'320x50':43,'300x50':44,'336x280':49,'300x1050':54,'970x250':57,'320x480':67},slots={};function compareTiers(a,b){var aMatches=/^(\d+)/.exec(a),bMatches=/^(\d+)/.exec(b);if(aMatches&&bMatches){return parseInt(aMatches[1],10)>parseInt(bMatches[1],10)?1:-1;}
return 0;}
function addSlotPrice(slotName,rubiconTargeting){rubiconTargeting.forEach(function(params){if(params.key===rubiconTierKey){priceMap[slotName]=params.values.sort(compareTiers).join(',');saveBestPrice(slotName,params.values);}});}
function setTargeting(slotName,slotTargeting,rubiconSlot,skin){var targeting=rubiconTargeting.getTargeting(slotName,skin,'fastlane');if(slotTargeting){Object.keys(slotTargeting).forEach(function(key){rubiconSlot.setFPI(key,slotTargeting[key]);});}
Object.keys(targeting).forEach(function(key){rubiconSlot.setFPI(key,targeting[key]);});}
function defineSingleSlot(slotName,slot,skin){var position=slotName.indexOf('TOP')!==-1?'atf':'btf';log(['defineSlot',slotName,slot],'debug',logGroup);win.rubicontag.cmd.push(function(){var rubiconSlot=win.rubicontag.defineSlot(slotName,slot.sizes,slotName);if(skin==='oasis'){rubiconSlot.setPosition(position);}
setTargeting(slotName,slot.targeting,rubiconSlot,skin);rubiconSlots.push(rubiconSlot);});}
function configureSlots(skin){slots=slotsContext.filterSlotMap(config[skin]);if(context.opts.overridePrefootersSizes){slots.PREFOOTER_LEFT_BOXAD.sizes=[[300,250],[336,280],[468,60],[728,90]];}}
function defineSlots(skin,onResponse){rubiconSlots=[];Object.keys(slots).forEach(function(slotName){defineSingleSlot(slotName,slots[slotName],skin);});win.rubicontag.cmd.push(function(){win.rubicontag.run(onResponse,{slots:rubiconSlots});});}
function fillInWithMissingTiers(slotName,parameters){var allTiers;if(!response){return;}
parameters[rubiconTierKey]=parameters[rubiconTierKey]||[];allTiers=';'+parameters[rubiconTierKey].join(';');slots[slotName].sizes.forEach(function(dimensions){var size=dimensions[0]+'x'+dimensions[1],tierSize=sizeMap[size]+'_tier';if(allTiers.indexOf(';'+tierSize)===-1){parameters[rubiconTierKey].push(tierSize+'NONE');}});}
function saveBestPrice(slotName,tiers){tiers.forEach(function(tier){bestPrices[slotName]=Math.max(rubiconTier.parseOpenMarketPrice(tier),bestPrices[slotName]||0);bestPricesPrivate[slotName]=Math.max(rubiconTier.parsePrivatePrice(tier),bestPricesPrivate[slotName]||0);});}
function getBestSlotPrice(slotName){return{fastlane:getBestPriceString(bestPrices[slotName]),fastlane_private:getBestPriceString(bestPricesPrivate[slotName])};}
function getBestPriceString(bestPriceForSlot){var price;if(typeof bestPriceForSlot!=='undefined'){price=(bestPriceForSlot/100).toFixed(2).toString();}
return price;}
function getSlotParams(slotName){var targeting,parameters={};if(!win.rubicontag||typeof win.rubicontag.getSlot!=='function'||!win.rubicontag.getSlot(slotName)){return{};}
targeting=win.rubicontag.getSlot(slotName).getAdServerTargeting();targeting.forEach(function(params){if(params.key!==rubiconElementKey){parameters[params.key]=params.values;}});fillInWithMissingTiers(slotName,parameters);if(parameters[rubiconTierKey]&&typeof parameters[rubiconTierKey].sort==='function'){parameters[rubiconTierKey].sort(compareTiers);}
log(['getSlotParams',slotName,parameters],'debug',logGroup);return parameters;}
function encodeParamsForTracking(params){if(!params[rubiconTierKey]){return;}
return params[rubiconTierKey].join(';');}
function calculatePrices(){var allSlots;if(!win.rubicontag||typeof win.rubicontag.getAllSlots!=='function'){return;}
allSlots=win.rubicontag.getAllSlots();if(allSlots.length){win.rubicontag.getAllSlots().forEach(function(slot){addSlotPrice(slot.getSlotName(),slot.getAdServerTargeting());});}}
function call(skin,onResponse){response=false;if(!rubiconLoaded){var rubicon=doc.createElement('script'),node=doc.getElementsByTagName('script')[0];win.rubicontag=win.rubicontag||{};win.rubicontag.cmd=win.rubicontag.cmd||[];rubicon.async=true;rubicon.type='text/javascript';rubicon.src=rubiconLibraryUrl;node.parentNode.insertBefore(rubicon,node);context=adContext.getContext();configureSlots(skin);prefetchDNS();rubiconLoaded=true;}
defineSlots(skin,function(){response=true;priceMap={};bestPrices={};onResponse();});}
function prefetchDNS(){var node=doc.getElementsByTagName('script')[0],fragment=doc.createDocumentFragment();rubiconDomains.forEach(function(domain){var linkToPrefetch=doc.createElement('link');linkToPrefetch.rel='dns-prefetch';linkToPrefetch.href=domain;fragment.appendChild(linkToPrefetch);});node.parentNode.insertBefore(fragment,node);}
function getPrices(){return priceMap;}
function isSlotSupported(slotName){return slots[slotName];}
return factory.create({logGroup:logGroup,name:'rubicon_fastlane',call:call,calculatePrices:calculatePrices,getBestSlotPrice:getBestSlotPrice,getPrices:getPrices,isSlotSupported:isSlotSupported,encodeParamsForTracking:encodeParamsForTracking,getSlotParams:getSlotParams});});;define('ext.wikia.adEngine.utils.math',[],function(){'use strict';function getBucket(number,bucketSize){return parseInt(number/bucketSize,10)*bucketSize;}
function leftPad(number,offset){var label=number+'';while(label.length<offset){label='0'+label;}
return label;}
return{getBucket:getBucket,leftPad:leftPad};});;


window.visitorType=(document.cookie.indexOf('__utma')>-1)?'Returning':'New';;